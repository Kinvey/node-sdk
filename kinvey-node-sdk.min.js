/**
 * kinvey-node-sdk - Kinvey JavaScript SDK for Node.js applications.
 * @version v3.9.3
 * @author Kinvey, Inc.
 * @link http://www.kinvey.com
 * @license Apache-2.0
 */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("es6-promise"),require("qs"),require("fast-memory-cache"),require("loglevel"),require("sift"),require("pubnub"),require("url-join"),require("request")):"function"==typeof define&&define.amd?define(["es6-promise","qs","fast-memory-cache","loglevel","sift","pubnub","url-join","request"],t):"object"==typeof exports?exports.Kinvey=t(require("es6-promise"),require("qs"),require("fast-memory-cache"),require("loglevel"),require("sift"),require("pubnub"),require("url-join"),require("request")):e.Kinvey=t(e["es6-promise"],e.qs,e["fast-memory-cache"],e.loglevel,e.sift,e.pubnub,e["url-join"],e.request)}("undefined"!=typeof self?self:this,function(e,t,r,n,o,i,u,a){return function(e){function t(n){if(r[n])return r[n].exports;var o=r[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,t),o.l=!0,o.exports}var r={};return t.m=e,t.c=r,t.d=function(e,r,n){t.o(e,r)||Object.defineProperty(e,r,{configurable:!1,enumerable:!0,get:n})},t.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(r,"a",r),r},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=127)}([function(e,t,r){"use strict";function n(e,t,r,n){this.name="BaseError",this.message=e||"An error occurred.",this.debug=t||void 0,this.code=r||void 0,this.kinveyRequestId=n||void 0,this.stack=(new Error).stack}Object.defineProperty(t,"__esModule",{value:!0}),t.BaseError=n,(n.prototype=Object.create(Error.prototype)).constructor=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(131);Object.keys(n).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return n[e]}})});var o=r(132);Object.keys(o).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return o[e]}})});var i=r(133);Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return i[e]}})});var u=r(134);Object.keys(u).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return u[e]}})});var a=r(135);Object.keys(a).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return a[e]}})});var s=r(0);Object.keys(s).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return s[e]}})});var c=r(136);Object.keys(c).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return c[e]}})});var l=r(137);Object.keys(l).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return l[e]}})});var f=r(138);Object.keys(f).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return f[e]}})});var d=r(139);Object.keys(d).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return d[e]}})});var h=r(140);Object.keys(h).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return h[e]}})});var p=r(141);Object.keys(p).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return p[e]}})});var y=r(142);Object.keys(y).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return y[e]}})});var v=r(143);Object.keys(v).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return v[e]}})});var b=r(144);Object.keys(b).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return b[e]}})});var m=r(145);Object.keys(m).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return m[e]}})});var g=r(146);Object.keys(g).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return g[e]}})});var _=r(147);Object.keys(_).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return _[e]}})});var w=r(148);Object.keys(w).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return w[e]}})});var O=r(149);Object.keys(O).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return O[e]}})});var k=r(150);Object.keys(k).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return k[e]}})});var j=r(151);Object.keys(j).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return j[e]}})});var E=r(152);Object.keys(E).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return E[e]}})});var P=r(153);Object.keys(P).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return P[e]}})});var x=r(154);Object.keys(x).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return x[e]}})});var S=r(155);Object.keys(S).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return S[e]}})});var q=r(156);Object.keys(q).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return q[e]}})});var M=r(157);Object.keys(M).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return M[e]}})});var T=r(158);Object.keys(T).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return T[e]}})});var A=r(159);Object.keys(A).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return A[e]}})});var R=r(160);Object.keys(R).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return R[e]}})});var C=r(161);Object.keys(C).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return C[e]}})});var I=r(162);Object.keys(I).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return I[e]}})});var K=r(163);Object.keys(K).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return K[e]}})});var D=r(164);Object.keys(D).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return D[e]}})});var U=r(165);Object.keys(U).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return U[e]}})});var L=r(166);Object.keys(L).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return L[e]}})})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(82);Object.keys(n).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return n[e]}})});var o=r(169);Object.keys(o).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return o[e]}})});var i=r(170);Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return i[e]}})})},function(e,t){var r=Array.isArray;e.exports=r},function(t,r){t.exports=e},function(e,t,r){var n=r(16),o=r(3),i=r(14),u="[object String]";e.exports=function(e){return"string"==typeof e||!o(e)&&i(e)&&n(e)==u}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(94);Object.keys(n).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return n[e]}})});var o=r(285);Object.keys(o).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return o[e]}})});var i=r(44);Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return i[e]}})});var u=r(114);Object.keys(u).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return u[e]}})});var a=r(43);Object.keys(a).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return a[e]}})});var s=r(29);Object.keys(s).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return s[e]}})});var c=r(68);Object.keys(c).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return c[e]}})});var l=r(110);Object.keys(l).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return l[e]}})})},function(e,t){e.exports=require("url")},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.Client=void 0;var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),u=n(r(92)),a=n(r(7)),s=n(r(5)),c=n(r(61)),l=r(1),f=r(21),d=r(2),h=6e4,p=null,y=function(){function e(){o(this,e),this.memory=new u.default}return i(e,[{key:"get",value:function(e){if(!(0,s.default)(e))throw new l.KinveyError("ActiveUserStorage key must be a string.");try{return JSON.parse(this.memory.get(e))}catch(e){return null}}},{key:"set",value:function(e,t){if(!(0,s.default)(e))throw new l.KinveyError("ActiveUserStorage key must be a string.");return(0,d.isDefined)(t)?this.memory.set(e,JSON.stringify(t)):this.memory.delete(e),t}}]),e}();t.Client=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};o(this,e);var r=(0,s.default)(t.apiHostname)?t.apiHostname:"https://baas.kinvey.com";!1===/^https?:\/\//i.test(r)&&(r="https://"+r);var n=a.default.parse(r);this.deviceId=(0,d.uuidv4)(),this.apiProtocol=n.protocol,this.apiHost=n.host;var i=(0,s.default)(t.micHostname)?t.micHostname:"https://auth.kinvey.com";!1===/^https?:\/\//i.test(i)&&(i="https://"+i);var u=a.default.parse(i);this.micProtocol=u.protocol,this.micHost=u.host,this.appKey=t.appKey,this.appSecret=t.appSecret,this.masterSecret=t.masterSecret,this.encryptionKey=t.encryptionKey,this.appVersion=t.appVersion,this.defaultTimeout=(0,c.default)(t.defaultTimeout)&&t.defaultTimeout>=0?t.defaultTimeout:h,this.activeUserStorage=new y}return i(e,[{key:"getActiveUser",value:function(){return this.activeUserStorage.get(this.appKey+".active_user")}},{key:"setActiveUser",value:function(e){return this.activeUserStorage.set(this.appKey+".active_user",e)}},{key:"toPlainObject",value:function(){return{deviceId:this.deviceId,apiHostname:this.apiHostname,apiProtocol:this.apiProtocol,apiHost:this.apiHost,micHostname:this.micHostname,micProtocol:this.micProtocol,micHost:this.micHost,appKey:this.appKey,appSecret:this.appSecret,masterSecret:this.masterSecret,encryptionKey:this.encryptionKey,appVersion:this.appVersion}}},{key:"apiHostname",get:function(){return a.default.format({protocol:this.apiProtocol,host:this.apiHost})}},{key:"micHostname",get:function(){return a.default.format({protocol:this.micProtocol,host:this.micHost})}},{key:"appVersion",get:function(){return this._appVersion},set:function(e){e&&!(0,s.default)(e)&&(e=String(e)),this._appVersion=e}},{key:"defaultTimeout",get:function(){return this._defaultTimeout},set:function(e){if(e=parseInt(e,10),!1===(0,c.default)(e)||isNaN(e))throw new l.KinveyError("Invalid timeout. Timeout must be a number.");e<0&&(f.Log.info("Default timeout is less than 0. Setting default timeout to "+defaultTimeout+"ms."),e=defaultTimeout),this._defaultTimeout=e}}],[{key:"initialize",value:function(){throw new l.KinveyError("Please use Client.init().")}},{key:"init",value:function(t){return p=new e(t)}},{key:"sharedInstance",value:function(){if(!1===(0,d.isDefined)(p))throw new l.KinveyError("You have not initialized the library. Please call Kinvey.init() to initialize the library.");return p}}]),e}()},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.Query=void 0;var o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=n(r(239)),u=n(r(27)),a=r(1),s=r(2),c=r(21),l=["$nearSphere"],f=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),t=Object.assign({fields:[],filter:{},sort:null,limit:null,skip:0},t),this.fields=t.fields,this.filter=t.filter,this.sort=t.sort,this.limit=t.limit,this.skip=t.skip,this._parent=null}return o(e,[{key:"isSupportedOffline",value:function(){var e=this;return Object.keys(this.filter).reduce(function(t,r){if(t){var n=e.filter[r];return l.some(function(e){return!n||!Object.keys(n).some(function(t){return t===e})})}return t},!0)}},{key:"equalTo",value:function(e,t){return this.addFilter(e,t)}},{key:"contains",value:function(e,t){if(!1===(0,s.isDefined)(t))throw new a.QueryError("You must supply a value.");return!1===Array.isArray(t)&&(t=[t]),this.addFilter(e,"$in",t)}},{key:"containsAll",value:function(e,t){if(!1===(0,s.isDefined)(t))throw new a.QueryError("You must supply a value.");return!1===Array.isArray(t)&&(t=[t]),this.addFilter(e,"$all",t)}},{key:"greaterThan",value:function(e,t){if(!1===(0,s.isNumber)(t)&&"string"!=typeof t)throw new a.QueryError("You must supply a number or string.");return this.addFilter(e,"$gt",t)}},{key:"greaterThanOrEqualTo",value:function(e,t){if(!1===(0,s.isNumber)(t)&&"string"!=typeof t)throw new a.QueryError("You must supply a number or string.");return this.addFilter(e,"$gte",t)}},{key:"lessThan",value:function(e,t){if(!1===(0,s.isNumber)(t)&&"string"!=typeof t)throw new a.QueryError("You must supply a number or string.");return this.addFilter(e,"$lt",t)}},{key:"lessThanOrEqualTo",value:function(e,t){if(!1===(0,s.isNumber)(t)&&"string"!=typeof t)throw new a.QueryError("You must supply a number or string.");return this.addFilter(e,"$lte",t)}},{key:"notEqualTo",value:function(e,t){return this.addFilter(e,"$ne",t)}},{key:"notContainedIn",value:function(e,t){return!1===Array.isArray(t)&&(t=[t]),this.addFilter(e,"$nin",t)}},{key:"and",value:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return this.join("$and",t)}},{key:"nor",value:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];if((0,s.isDefined)(this._parent)&&Object.hasOwnProperty.call(this._parent.filter,"$and")){var n;return(n=this._parent).nor.apply(n,t)}return this.join("$nor",t)}},{key:"or",value:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];if((0,s.isDefined)(this._parent)){var n;return(n=this._parent).or.apply(n,t)}return this.join("$or",t)}},{key:"exists",value:function(e,t){return t=void 0===t||(t||!1),this.addFilter(e,"$exists",t)}},{key:"mod",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if("string"==typeof t&&(t=parseFloat(t)),"string"==typeof r&&(r=parseFloat(r)),!(0,s.isNumber)(t))throw new a.QueryError("divisor must be a number");if(!(0,s.isNumber)(r))throw new a.QueryError("remainder must be a number");return this.addFilter(e,"$mod",[t,r])}},{key:"matches",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=[];if(t instanceof RegExp||(t=new RegExp(t)),0!==t.source.indexOf("^"))throw new a.QueryError("regExp must have '^' at the beginning of the expression to make it an anchored expression.");if((t.ignoreCase||r.ignoreCase)&&!1!==r.ignoreCase)throw new a.QueryError("ignoreCase flag is not supported");return(t.multiline||r.multiline)&&!1!==r.multiline&&n.push("m"),!0===r.extended&&n.push("x"),!0===r.dotMatchesAll&&n.push("s"),n.length>0&&this.addFilter(e,"$options",n.join("")),this.addFilter(e,"$regex",t.source)}},{key:"near",value:function(e,t,r){if(!Array.isArray(t)||!(0,s.isNumber)(t[0])||!(0,s.isNumber)(t[1]))throw new a.QueryError("coord must be a [number, number]");var n=this.addFilter(e,"$nearSphere",[t[0],t[1]]);return(0,s.isNumber)(r)&&this.addFilter(e,"$maxDistance",r),n}},{key:"withinBox",value:function(e,t,r){if(!Array.isArray(t)||!(0,s.isNumber)(t[0])||!(0,s.isNumber)(t[1]))throw new a.QueryError("bottomLeftCoord must be a [number, number]");if(!Array.isArray(r)||!(0,s.isNumber)(r[0])||!(0,s.isNumber)(r[1]))throw new a.QueryError("upperRightCoord must be a [number, number]");t[0]=parseFloat(t[0]),t[1]=parseFloat(t[1]),r[0]=parseFloat(r[0]),r[1]=parseFloat(r[1]);var n=[[t[0],t[1]],[r[0],r[1]]];return this.addFilter(e,"$within",{$box:n})}},{key:"withinPolygon",value:function(e,t){if(!1===Array.isArray(t)||0===t.length||t.length>3)throw new a.QueryError("coords must be a [[number, number]]");return t=t.map(function(e){if(!1===(0,s.isNumber)(e[0])||!1===(0,s.isNumber)(e[1]))throw new a.QueryError("coords argument must be a [number, number]");return[parseFloat(e[0]),parseFloat(e[1])]}),this.addFilter(e,"$within",{$polygon:t})}},{key:"size",value:function(e,t){if("string"==typeof t&&(t=parseFloat(t)),!(0,s.isNumber)(t))throw new a.QueryError("size must be a number");return this.addFilter(e,"$size",t)}},{key:"ascending",value:function(e){return(0,s.isDefined)(this._parent)?this._parent.ascending(e):this.sort[e]=1,this}},{key:"descending",value:function(e){return(0,s.isDefined)(this._parent)?this._parent.descending(e):this.sort[e]=-1,this}},{key:"addFilter",value:function(e,t,r){return(0,s.isDefined)(t)&&(0,s.isDefined)(r)?((0,u.default)(this.filter[e])||(this.filter[e]={}),this.filter[e][t]=r):this.filter[e]=t,this}},{key:"join",value:function(t,r){var n=this,o=this,i={};0===(r=r.map(function(t){if(!(t instanceof e)){if(!(0,u.default)(t))throw new a.QueryError("query argument must be of type: Kinvey.Query[] or Object[].");t=new e(t)}return t.toPlainObject().filter})).length&&(r=[(o=new e).toPlainObject().filter],o._parent=this);return Object.keys(this.filter).forEach(function(e){i[e]=n.filter[e],delete n.filter[e]}),this.filter[t]=[i].concat(r),o}},{key:"process",value:function(e){if(!this.isSupportedOffline()){var t="This query is not able to run locally. The following filters are not supported locally:";throw l.forEach(function(e){t=t+" "+e}),c.Log.error(t),new a.QueryError(t)}if(!Array.isArray(e))throw new a.QueryError("data argument must be of type: Array.");c.Log.debug("Data length before processiong query",e.length);var r=this.toPlainObject();return e=(0,i.default)(r.filter,e),c.Log.debug("Data length after applying query filter",r.filter,e.length),Array.isArray(r.fields)&&r.fields.length>0&&(c.Log.debug("Removing fields from data",r.fields),e=e.map(function(e){return Object.keys(e).forEach(function(t){-1===r.fields.indexOf(t)&&delete e[t]}),e})),(0,s.isDefined)(r.sort)&&(c.Log.debug("Sorting data",r.sort),e.sort(function(e,t){for(var n in r.sort)if(r.sort.hasOwnProperty(n)){var o=(0,s.nested)(e,n),i=(0,s.nested)(t,n);if((0,s.isDefined)(o)&&!1===(0,s.isDefined)(i))return-1;if((0,s.isDefined)(i)&&!1===(0,s.isDefined)(o))return 1;if(o!==i){var u=r.sort[n];return(o<i?-1:1)*u}}return 0})),(0,s.isNumber)(r.skip)?(0,s.isNumber)(r.limit)&&r.limit>0?(c.Log.debug("Skipping and limiting data",r.skip,r.limit),e.slice(r.skip,r.skip+r.limit)):(c.Log.debug("Skipping data",r.skip),e.slice(r.skip)):e}},{key:"toPlainObject",value:function(){if((0,s.isDefined)(this._parent))return this._parent.toPlainObject();return{fields:this.fields,filter:this.filter,sort:this.sort,skip:this.skip,limit:this.limit}}},{key:"toQueryString",value:function(){var e={};Object.keys(this.filter).length>0&&(e.query=this.filter),this.fields.length>0&&(e.fields=this.fields.join(",")),(0,s.isNumber)(this.limit)&&(e.limit=this.limit),(0,s.isNumber)(this.skip)&&this.skip>0&&(e.skip=this.skip),Object.keys(this.sort).length>0&&(e.sort=this.sort);return Object.keys(e).forEach(function(t){e[t]="string"==typeof e[t]?e[t]:JSON.stringify(e[t])}),e}},{key:"toString",value:function(){return JSON.stringify(this.toQueryString())}},{key:"fields",get:function(){return this._fields},set:function(e){if(e=e||[],!Array.isArray(e))throw new a.QueryError("fields must be an Array");(0,s.isDefined)(this._parent)?this._parent.fields=e:this._fields=e}},{key:"filter",get:function(){return this._filter},set:function(e){this._filter=e}},{key:"sort",get:function(){return this._sort},set:function(e){if(e&&!(0,u.default)(e))throw new a.QueryError("sort must an Object");(0,s.isDefined)(this._parent)?this._parent.sort=e:this._sort=e||{}}},{key:"limit",get:function(){return this._limit},set:function(e){if("string"==typeof e&&(e=parseFloat(e)),(0,s.isDefined)(e)&&!1===(0,s.isNumber)(e))throw new a.QueryError("limit must be a number");this._parent?this._parent.limit=e:this._limit=e}},{key:"skip",get:function(){return this._skip},set:function(e){if("string"==typeof e&&(e=parseFloat(e)),!1===(0,s.isNumber)(e))throw new a.QueryError("skip must be a number");(0,s.isDefined)(this._parent)?this._parent.skip=e:this._skip=e}}]),e}();t.Query=f},function(e,t,r){var n=r(84),o="object"==typeof self&&self&&self.Object===Object&&self,i=n||o||Function("return this")();e.exports=i},function(e,t){e.exports=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}},function(e,t,r){var n=r(51),o=r(20),i=r(53),u=r(13),a=r(26),s=r(17),c=Object.prototype.hasOwnProperty,l=i(function(e,t){if(a(t)||u(t))o(t,s(t),e);else for(var r in t)c.call(t,r)&&n(e,r,t[r])});e.exports=l},function(e,t,r){var n=r(15),o=r(55);e.exports=function(e){return null!=e&&o(e.length)&&!n(e)}},function(e,t){e.exports=function(e){return null!=e&&"object"==typeof e}},function(e,t,r){var n=r(16),o=r(11),i="[object AsyncFunction]",u="[object Function]",a="[object GeneratorFunction]",s="[object Proxy]";e.exports=function(e){if(!o(e))return!1;var t=n(e);return t==u||t==a||t==i||t==s}},function(e,t,r){var n=r(22),o=r(172),i=r(173),u="[object Null]",a="[object Undefined]",s=n?n.toStringTag:void 0;e.exports=function(e){return null==e?void 0===e?a:u:s&&s in Object(e)?o(e):i(e)}},function(e,t,r){var n=r(88),o=r(90),i=r(13);e.exports=function(e){return i(e)?n(e):o(e)}},function(e,t,r){var n=r(245),o=r(254),i=r(32),u=r(3),a=r(264);e.exports=function(e){return"function"==typeof e?e:null==e?i:"object"==typeof e?u(e)?o(e[0],e[1]):n(e):a(e)}},function(e,t,r){var n=r(171),o=r(176);e.exports=function(e,t){var r=o(e,t);return n(r)?r:void 0}},function(e,t,r){var n=r(51),o=r(52);e.exports=function(e,t,r,i){var u=!r;r||(r={});for(var a=-1,s=t.length;++a<s;){var c=t[a],l=i?i(r[c],e[c],c,r,e):void 0;void 0===l&&(l=e[c]),u?o(r,c,l):n(r,c,l)}return r}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Log=void 0;var n=function(e){return e&&e.__esModule?e:{default:e}}(r(192));n.default.setDefaultLevel(n.default.levels.SILENT);var o=n.default.methodFactory;n.default.methodFactory=function(e,t,r){var n=o(e,t,r);return function(e){e="Kinvey: "+e;for(var t=arguments.length,r=Array(t>1?t-1:0),o=1;o<t;o++)r[o-1]=arguments[o];r.length>0?n(e,r):n(e)}},t.Log=n.default},function(e,t,r){var n=r(10).Symbol;e.exports=n},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.Aggregation=void 0;var o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=n(r(12)),u=n(r(42)),a=n(r(5)),s=n(r(11)),c=n(r(15)),l=n(r(95)),f=r(1),d=r(2),h=r(9);t.Aggregation=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),t=(0,i.default)({query:null,initial:{},key:{},reduceFn:function(){}.toString()},t),this.query=t.query,this.initial=t.initial,this.key=t.key,this.reduceFn=t.reduceFn}return o(e,[{key:"by",value:function(e){return this.key[e]=!0,this}},{key:"process",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=this.toPlainObject(),r=Object.keys(t.key),n=t.reduceFn.replace(/function[\s\S]*?\([\s\S]*?\)/,"");if(t.reduce=new Function(["doc","out"],n),this.query&&(e=this.query.process(e)),r.length>0){var o=[];return r.forEach(function(r){var n={};e.forEach(function(e){var o=e[r],i=(0,d.isDefined)(n[o])?n[o]:(0,l.default)(t.initial),u=t.reduce(e,i);(0,d.isDefined)(u)&&(i=u),n[o]=i}),Object.keys(n).forEach(function(e){var t={};t[r]=e,t=(0,i.default)({},t,n[e]),o.push(t)})}),o}var a=(0,l.default)(t.initial);return(0,u.default)(e,function(e){var r=t.reduce(e,a);(0,d.isDefined)(r)&&(a=r)}),a}},{key:"toPlainObject",value:function(){return{key:this.key,initial:this.initial,reduce:this.reduceFn,reduceFn:this.reduceFn,condition:this.query?this.query.toPlainObject().filter:{},query:this.query?this.query.toPlainObject():null}}},{key:"initial",get:function(){return(0,l.default)(this._initial)},set:function(e){if(!(0,s.default)(e))throw new f.KinveyError("initial must be an Object.");this._initial=e}},{key:"query",get:function(){return this._query},set:function(e){if((0,d.isDefined)(e)&&!(e instanceof h.Query))throw new f.KinveyError("Invalid query. It must be an instance of the Query class.");this._query=e}},{key:"reduceFn",get:function(){return this._reduceFn},set:function(e){if((0,c.default)(e)&&(e=e.toString()),!(0,a.default)(e))throw new f.KinveyError("fn argument must be of type function or string.");this._reduceFn=e}}],[{key:"count",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";t=t.replace("'","\\'");var r=new e;return r.by(t),r.initial={count:0},r.reduceFn="function(doc, out) {  out.count += 1;  return out;}",r}},{key:"sum",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";t=t.replace("'","\\'");var r=new e;return r.initial={sum:0},r.reduceFn='function(doc, out) {  out.sum += doc["'+t+'"];  return out;}',r}},{key:"min",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";t=t.replace("'","\\'");var r=new e;return r.initial={min:1/0},r.reduceFn='function(doc, out) {  out.min = Math.min(out.min, doc["'+t+'"]);  return out;}',r}},{key:"max",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";t=t.replace("'","\\'");var r=new e;return r.initial={max:-1/0},r.reduceFn='function(doc, out) {  out.max = Math.max(out.max, doc["'+t+'"]);  return out;}',r}},{key:"average",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";t=t.replace("'","\\'");var r=new e;return r.initial={count:0,average:0},r.reduceFn='function(doc, out) {  out.average = (out.average * out.count + doc["'+t+'"]) / (out.count + 1);  out.count += 1;  return out;}',r}}]),e}()},function(e,t,r){var n=r(46),o=1/0;e.exports=function(e){if("string"==typeof e||n(e))return e;var t=e+"";return"0"==t&&1/e==-o?"-0":t}},function(e,t){e.exports=function(e,t){return e===t||e!=e&&t!=t}},function(e,t){var r=Object.prototype;e.exports=function(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||r)}},function(e,t,r){var n=r(16),o=r(58),i=r(14),u="[object Object]",a=Function.prototype,s=Object.prototype,c=a.toString,l=s.hasOwnProperty,f=c.call(Object);e.exports=function(e){if(!i(e)||n(e)!=u)return!1;var t=o(e);if(null===t)return!0;var r=l.call(t,"constructor")&&t.constructor;return"function"==typeof r&&r instanceof r&&c.call(r)==f}},function(e,t,r){var n=r(240),o=r(243)(n);e.exports=o},function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0}),t.KinveyResponse=t.Response=t.StatusCode=void 0;var o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=function(e){return e&&e.__esModule?e:{default:e}}(r(12)),u=r(44),a=r(1),s=t.StatusCode={Ok:200,Created:201,Empty:204,MovedPermanently:301,Found:302,NotModified:304,TemporaryRedirect:307,PermanentRedirect:308,Unauthorized:401,Forbidden:403,NotFound:404,ServerError:500};Object.freeze(s);var c=t.Response=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};n(this,e),t=(0,i.default)({statusCode:s.Empty,headers:new u.Headers,data:null},t),this.statusCode=t.statusCode,this.headers=t.headers,this.data=t.data}return o(e,[{key:"isSuccess",value:function(){return this.statusCode>=200&&this.statusCode<300||this.statusCode===s.MovedPermanently||this.statusCode===s.Found||this.statusCode===s.NotModified||this.statusCode===s.TemporaryRedirect||this.statusCode===s.PermanentRedirect}},{key:"isServerError",value:function(){return this.statusCode>=500&&this.statusCode<600}},{key:"isClientError",value:function(){return this.statusCode>=400&&this.statusCode<500}},{key:"toPlainObject",value:function(){return{statusCode:this.statusCode,headers:this.headers.toPlainObject(),data:this.data}}},{key:"headers",get:function(){return this._headers},set:function(e){e instanceof u.Headers||(e=new u.Headers(e)),this._headers=e}},{key:"error",get:function(){if(this.isSuccess())return null;var e=this.data||{},t=e.message||e.description,r=e.debug,n=this.statusCode,o=this.headers.get("X-Kinvey-Request-ID");return n===s.Unauthorized?new a.InsufficientCredentialsError(t,r,n,o):n===s.NotFound?new a.NotFoundError(t,r,n,o):n===s.ServerError?new a.ServerError(t,r,n,o):new a.KinveyError(t,r,n,o)}}]),e}();t.KinveyResponse=function(e){function t(){return n(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,c),o(t,[{key:"error",get:function(){if(this.isSuccess())return null;var e=this.data||{},r=e.name||e.error,n=e.message||e.description,o=e.debug,i=this.statusCode,u=this.headers.get("X-Kinvey-Request-ID"),s=void 0;if("APIVersionNotAvailable"===r)s=new a.APIVersionNotAvailableError(n,o,i,u);else if("APIVersionNotImplemented"===r)s=new a.APIVersionNotImplementedError(n,o,i,u);else if("AppProblem"===r)s=new a.AppProblemError(n,o,i,u);else if("AppProblem"===r)s=new a.AppProblemError(n,o,i,u);else if("BadRequest"===r)s=new a.BadRequestError(n,o,i,u);else if("BLInternalError"===r||"BLRuntimeError"===r||"BLSyntaxError"===r||"BLTimeoutError"===r||"BLViolationError"===r)s=new a.BLError(n,o,i,u);else if("CORSDisabled"===r)s=new a.CORSDisabledError(n,o,i,u);else if("DuplicateEndUsers"===r)s=new a.DuplicateEndUsersError(n,o,i,u);else if("FeatureUnavailable"===r)s=new a.FeatureUnavailableError(n,o,i,u);else if("IncompleteRequestBody"===r)s=new a.IncompleteRequestBodyError(n,o,i,u);else if("IndirectCollectionAccessDisallowed"===r)s=new a.IndirectCollectionAccessDisallowedError(n,o,i,u);else if("InsufficientCredentials"===r)s=new a.InsufficientCredentialsError(n,o,i,u);else if("InvalidCredentials"===r)s=new a.InvalidCredentialsError(n,o,i,u);else if("InvalidIdentifier"===r)s=new a.InvalidIdentifierError(n,o,i,u);else if("InvalidQuerySyntax"===r)s=new a.InvalidQuerySyntaxError(n,o,i,u);else if("JSONParseError"===r)s=new a.JSONParseError(n,o,i,u);else if("KinveyInternalErrorRetry"===r)s=new a.KinveyInternalErrorRetry(n,o,i,u);else if("KinveyInternalErrorStop"===r)s=new a.KinveyInternalErrorStop(n,o,i,u);else if("MissingQuery"===r)s=new a.MissingQueryError(n,o,i,u);else if("MissingRequestHeader"===r)s=new a.MissingRequestHeaderError(n,o,i,u);else if("MissingRequestParameter"===r)s=new a.MissingRequestParameterError(n,o,i,u);else if("EntityNotFound"===r||"CollectionNotFound"===r||"AppNotFound"===r||"UserNotFound"===r||"BlobNotFound"===r||"DocumentNotFound"===r)s=new a.NotFoundError(n,o,i,u);else if("ParameterValueOutOfRange"===r)s=new a.ParameterValueOutOfRangeError(n,o,i,u);else if("ServerError"===r)s=new a.ServerError(n,o,i,u);else if("StaleRequest"===r)s=new a.StaleRequestError(n,o,i,u);else if("UserAlreadyExists"===r)s=new a.UserAlreadyExistsError(n,o,i,u);else{if("WritesToCollectionDisallowed"!==r)return function e(t,r,n){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,r);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,r,n)}if("value"in o)return o.value;var u=o.get;if(void 0!==u)return u.call(n)}(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"error",this);s=new a.WritesToCollectionDisallowedError(n,o,i,u)}return s}}]),t}()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Middleware=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=function(e){return e&&e.__esModule?e:{default:e}}(r(4)),i=r(270);t.Middleware=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Middleware";!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.name=t}return n(e,[{key:"handle",value:function(){return o.default.reject(new Error("A subclass middleware must override the handle function."))}},{key:"cancel",value:function(){return o.default.resolve()}},{key:"generateTree",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return{value:this.name,level:e,nodes:[]}}},{key:"toString",value:function(){var e=this.generateTree();return i.AsciiTree.generate(e)}}]),e}()},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.KinveyObservable=void 0;var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),c=n(r(4)),l=r(306),f=r(116),d=r(78),h=n(r(15)),p=r(2),y={closed:!0,next:function(){},error:function(e){throw e},complete:function(){},status:function(){},presence:function(){}},v=function(e){function t(e,r,n,u,a,s){o(this,t);var c=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this)),l=void 0,f=c;return c._parentSubscriber=e,(0,h.default)(r)?l=r:r&&(l=r.next,n=r.error,u=r.complete,r!==y&&(f=Object.create(r),(0,h.default)(f.unsubscribe)&&c.add(f.unsubscribe.bind(f)),f.unsubscribe=c.unsubscribe.bind(c))),c._context=f,c._next=l,c._error=n,c._complete=u,c._status=a,c._presence=s,c}return u(t,f.Subscriber),s(t,[{key:"next",value:function(e){if(!this.isStopped&&this._next){var t=this._parentSubscriber;t.syncErrorThrowable?this.__tryOrSetError(t,this._next,e)&&this.unsubscribe():this.__tryOrUnsub(this._next,e)}}},{key:"error",value:function(e){if(!this.isStopped){var t=this._parentSubscriber;if(this._error)t.syncErrorThrowable?(this.__tryOrSetError(t,this._error,e),this.unsubscribe()):(this.__tryOrUnsub(this._error,e),this.unsubscribe());else{if(!t.syncErrorThrowable)throw this.unsubscribe(),e;t.syncErrorValue=e,t.syncErrorThrown=!0,this.unsubscribe()}}}},{key:"complete",value:function(){var e=this;if(!this.isStopped){var t=this._parentSubscriber;if(this._complete){var r=function(){return e._complete.call(e._context)};t.syncErrorThrowable?(this.__tryOrSetError(t,r),this.unsubscribe()):(this.__tryOrUnsub(r),this.unsubscribe())}else this.unsubscribe()}}},{key:"status",value:function(e){if(!this.isStopped&&this._status){var t=this._parentSubscriber;t.syncErrorThrowable?this.__tryOrSetError(t,this._status,e)&&this.unsubscribe():this.__tryOrUnsub(this._status,e)}}},{key:"presence",value:function(e){if(!this.isStopped&&this._presence){var t=this._parentSubscriber;t.syncErrorThrowable?this.__tryOrSetError(t,this._presence,e)&&this.unsubscribe():this.__tryOrUnsub(this._presence,e)}}},{key:"__tryOrUnsub",value:function(e,t){try{e.call(this._context,t)}catch(e){throw this.unsubscribe(),e}}},{key:"__tryOrSetError",value:function(e,t,r){try{t.call(this._context,r)}catch(t){return e.syncErrorValue=t,e.syncErrorThrown=!0,!0}return!1}},{key:"_unsubscribe",value:function(){var e=this._parentSubscriber;this._context=null,this._parentSubscriber=null,e.unsubscribe()}}]),t}(),b=function(e){function t(e,r,n,u,s){o(this,t);var c=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,r,n));switch(arguments.length){case 0:c.destination=y;break;case 1:if(!1===(0,p.isDefined)(e)){c.destination=y;break}if("object"===(void 0===e?"undefined":a(e))){e instanceof f.Subscriber?(c.destination=e,c.destination.add(c)):(c.syncErrorThrowable=!0,c.destination=new v(c,e));break}default:c.syncErrorThrowable=!0,c.destination=new v(c,e,r,n,u,s)}return c}return u(t,f.Subscriber),s(t,[{key:"status",value:function(e){this.isStopped||this._status(e)}},{key:"presence",value:function(e){this.isStopped||this._presence(e)}},{key:"_status",value:function(e){this.destination.status(e)}},{key:"_presence",value:function(e){this.destination.presence(e)}}]),t}();t.KinveyObservable=function(e){function t(){return o(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return u(t,l.Observable),s(t,[{key:"subscribe",value:function(e,t,r,n,o){var i=this.operator,u=function(e,t,r,n,o){if(e){if(e instanceof b)return e;if(e[d.rxSubscriber])return e[d.rxSubscriber]()}return e||t||r||n||o?new b(e,t,r,n,o):new b(y)}(e,t,r,n,o);if(i?i.call(u,this.source):u.add(this._trySubscribe(u)),u.syncErrorThrowable&&(u.syncErrorThrowable=!1,u.syncErrorThrown))throw u.syncErrorValue;return u}},{key:"toPromise",value:function(){var e=this;return new c.default(function(t,r){var n=void 0;e.subscribe(function(e){n=e},r,function(){t(n)})})}}],[{key:"create",value:function(e){return new t(e)}}]),t}()},function(e,t){e.exports=function(e){return e}},function(e,t){var r=9007199254740991,n=/^(?:0|[1-9]\d*)$/;e.exports=function(e,t){return!!(t=null==t?r:t)&&("number"==typeof e||n.test(e))&&e>-1&&e%1==0&&e<t}},function(e,t,r){var n=r(183),o=r(14),i=Object.prototype,u=i.hasOwnProperty,a=i.propertyIsEnumerable,s=n(function(){return arguments}())?n:function(e){return o(e)&&u.call(e,"callee")&&!a.call(e,"callee")};e.exports=s},function(e,t,r){(function(e){var n=r(10),o=r(184),i="object"==typeof t&&t&&!t.nodeType&&t,u=i&&"object"==typeof e&&e&&!e.nodeType&&e,a=u&&u.exports===i?n.Buffer:void 0,s=(a?a.isBuffer:void 0)||o;e.exports=s}).call(t,r(56)(e))},function(e,t,r){var n=r(90),o=r(59),i=r(34),u=r(3),a=r(13),s=r(35),c=r(26),l=r(57),f="[object Map]",d="[object Set]",h=Object.prototype.hasOwnProperty;e.exports=function(e){if(null==e)return!0;if(a(e)&&(u(e)||"string"==typeof e||"function"==typeof e.splice||s(e)||l(e)||i(e)))return!e.length;var t=o(e);if(t==f||t==d)return!e.size;if(c(e))return!n(e).length;for(var r in e)if(h.call(e,r))return!1;return!0}},function(e,t,r){function n(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}var o=r(195),i=r(196),u=r(197),a=r(198),s=r(199);n.prototype.clear=o,n.prototype.delete=i,n.prototype.get=u,n.prototype.has=a,n.prototype.set=s,e.exports=n},function(e,t,r){var n=r(25);e.exports=function(e,t){for(var r=e.length;r--;)if(n(e[r][0],t))return r;return-1}},function(e,t,r){var n=r(19)(Object,"create");e.exports=n},function(e,t,r){var n=r(213);e.exports=function(e,t){var r=e.__data__;return n(t)?r["string"==typeof t?"string":"hash"]:r.map}},function(e,t,r){var n=r(88),o=r(219),i=r(13);e.exports=function(e){return i(e)?n(e,!0):o(e)}},function(e,t,r){var n=r(96),o=r(28),i=r(244),u=r(3);e.exports=function(e,t){return(u(e)?n:o)(e,i(t))}},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.Request=t.RequestMethod=void 0;var o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=n(r(4)),u=n(r(50)),a=n(r(12)),s=n(r(5)),c=n(r(61)),l=r(8),f=r(1),d=r(2),h=r(29),p=r(44),y=t.RequestMethod={GET:"GET",POST:"POST",PATCH:"PATCH",PUT:"PUT",DELETE:"DELETE"};Object.freeze(y);t.Request=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),t=(0,a.default)({followRedirect:!0},t),this.id=(0,d.randomString)(),this.client=t.client,this.method=t.method||y.GET,this.headers=t.headers||new p.Headers,this.url=t.url||"",this.body=t.body||t.data,this.timeout=(0,d.isDefined)(t.timeout)?t.timeout:this.client.defaultTimeout,this.followRedirect=!0===t.followRedirect,this.cache=!0===t.cache}return o(e,[{key:"execute",value:function(){return!1===(0,d.isDefined)(this.rack)?(Log.error("Unable to execute the request. Please provide a rack to execute the request."),i.default.reject(new f.KinveyError("Unable to execute the request. Please provide a rack to execute the request."))):this.rack.execute(this.toPlainObject()).then(function(e){if(!1===(0,d.isDefined)(e))throw new f.NoResponseError;return e instanceof h.Response==!1&&(e=new h.Response({statusCode:e.statusCode,headers:e.headers,data:e.data})),e})}},{key:"cancel",value:function(){return this.rack.cancel()}},{key:"toPlainObject",value:function(){return{id:this.id,method:this.method,headers:this.headers.toPlainObject(),url:this.url,body:this.body,timeout:this.timeout,followRedirect:this.followRedirect,encryptionKey:this.client.encryptionKey}}},{key:"client",get:function(){return this._client||l.Client.sharedInstance()},set:function(e){if(e&&e instanceof l.Client==!1)throw new f.KinveyError("client must be an instance of the Client class.");this._client=e}},{key:"method",get:function(){return this._method},set:function(e){switch((0,s.default)(e)||(e=String(e)),e=e.toUpperCase()){case y.GET:case y.POST:case y.PATCH:case y.PUT:case y.DELETE:this._method=e;break;default:throw new f.KinveyError("Invalid request method. Only GET, POST, PATCH, PUT, and DELETE are allowed.")}}},{key:"headers",get:function(){return this._headers},set:function(e){e instanceof p.Headers||(e=new p.Headers(e)),this._headers=e}},{key:"url",get:function(){return!0===this.cache?(0,d.appendQuery)(this._url,u.default.stringify({_:Math.random().toString(36).substr(2)})):this._url},set:function(e){this._url=e}},{key:"data",get:function(){return this.body},set:function(e){this.body=e}},{key:"timeout",get:function(){return this._timeout},set:function(e){if(e=parseInt(e,10),!1===(0,c.default)(e)||isNaN(e))throw new f.KinveyError("Invalid timeout. Timeout must be a number.");this._timeout=e}},{key:"followRedirect",get:function(){return this._followRedirect},set:function(e){this._followRedirect=!!e}},{key:"cache",get:function(){return this._cache},set:function(e){this._cache=!!e}}]),e}()},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.Headers=void 0;var o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=n(r(42)),u=n(r(5)),a=n(r(27)),s=r(2);t.Headers=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.headers={},this.addAll(t)}return o(e,[{key:"get",value:function(e){if(e){!1===(0,u.default)(e)&&(e=String(e));return this.headers[e.toLowerCase()]}}},{key:"set",value:function(e,t){if(!1===(0,s.isDefined)(e)||!1===(0,s.isDefined)(t))throw new Error("A name and value must be provided to set a header.");!1===(0,u.default)(e)&&(e=String(e));var r=this.headers;return e=e.toLowerCase(),!1===(0,u.default)(t)?r[e]=JSON.stringify(t):r[e]=t,this.headers=r,this}},{key:"has",value:function(e){return!!this.get(e)}},{key:"add",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.set(e.name,e.value)}},{key:"addAll",value:function(){var t=this,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(r instanceof e&&(r=r.toPlainObject()),!1===(0,a.default)(r))throw new Error("Headers argument must be an object.");var n=Object.keys(r);return(0,i.default)(n,function(e){try{t.set(e,r[e])}catch(e){}}),this}},{key:"remove",value:function(e){if(e){!1===(0,u.default)(e)&&(e=String(e));var t=this.headers;delete t[e.toLowerCase()],this.headers=t}return this}},{key:"clear",value:function(){return this.headers={},this}},{key:"toPlainObject",value:function(){return this.headers}},{key:"toString",value:function(){return JSON.stringify(this.toPlainObject())}}]),e}()},function(e,t,r){var n=r(3),o=r(71),i=r(256),u=r(259);e.exports=function(e,t){return n(e)?e:o(e,t)?[e]:i(u(e))}},function(e,t,r){var n=r(16),o=r(14),i="[object Symbol]";e.exports=function(e){return"symbol"==typeof e||o(e)&&n(e)==i}},function(e,t){e.exports=function(e,t){for(var r=-1,n=null==e?0:e.length,o=Array(n);++r<n;)o[r]=t(e[r],r,e);return o}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(74);Object.keys(n).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return n[e]}})});var o=r(79);Object.keys(o).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return o[e]}})});var i=r(124);Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return i[e]}})});var u=r(327);Object.keys(u).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return u[e]}})});var a=r(123);Object.keys(a).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return a[e]}})})},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function o(e){if(!e)return!1;var t=e.onMessage,r=e.onError,n=e.onStatus;return(0,s.default)(t)||(0,s.default)(r)||(0,s.default)(n)}function i(e){return(0,h.isNonemptyString)(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.LiveService=void 0;var u=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();t.isValidReceiver=o,t.isValidChannelName=i,t.getLiveService=function(e){return v||(v=new y(e)),v};var a=n(r(318)),s=n(r(15)),c=n(r(319)),l=r(8),f=r(6),d=r(1),h=r(2),p=r(120),y=t.LiveService=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._client=t||l.Client.sharedInstance(),this._pubnubClient=void 0,this._pubnubListener=void 0,this._userChannelGroup=void 0,this._pubnubConfig=void 0,this._registeredUser=void 0}return u(e,[{key:"fullInitialization",value:function(e){var t=this;return this.registerUser(e).then(function(e){var r=new a.default(e),n=new p.PubNubListener;t.initialize(r,n)})}},{key:"fullUninitialization",value:function(){var e=this;return this.unregisterUser().then(function(t){return e.uninitialize(),t})}},{key:"isInitialized",value:function(){return!!this.__pubnubClient&&!!this.__pubnubListener&&!!this._registeredUser}},{key:"registerUser",value:function(e){var t=this;return e&&e.isActive()?this.isInitialized()?Promise.reject(new d.KinveyError("Live service already initialized")):this._makeRegisterRequest(e._id).then(function(r){t._registeredUser=e,t._userChannelGroup=r.userChannelGroup;return(0,c.default)({ssl:!0,authKey:t._registeredUser._kmd.authtoken},r)}):Promise.reject(new d.ActiveUserError("Missing or invalid active user"))}},{key:"initialize",value:function(e,t){if(this.isInitialized())throw new d.KinveyError("Live service already initialized");this._pubnubListener=t,this._pubnubClient=e,this._pubnubClient.addListener(this._pubnubListener),this._subscribeToUserChannelGroup()}},{key:"uninitialize",value:function(){this._unsubscribeFromAll(),this._pubnubClient=null,this._pubnubListener=null}},{key:"onConnectionStatusUpdates",value:function(e){this._pubnubListener.on(p.PubNubListener.unclassifiedEvents,e),this._pubnubListener.on(this._userChannelGroup,e)}},{key:"offConnectionStatusUpdates",value:function(e){e?(this._pubnubListener.removeListener(p.PubNubListener.unclassifiedEvents,e),this._pubnubListener.removeListener(this._userChannelGroup,e)):(this._pubnubListener.removeAllListeners(p.PubNubListener.unclassifiedEvents),this._pubnubListener.removeAllListeners(this._userChannelGroup))}},{key:"publishToChannel",value:function(e,t){if(!this.isInitialized())return Promise.reject(new d.KinveyError("Live service is not initialized"));var r=this._validatePublishData(e,t);return r?Promise.reject(r):this._pubnubClient.publish({message:t,channel:e}).catch(function(e){e=e.status&&e.status.errorData;var t=new f.Response({data:e,statusCode:e.status,headers:e.response&&e.response.headers});return Promise.reject(t)})}},{key:"subscribeToChannel",value:function(e,t){var r=this._validateSubscribeData(e,t);if(r)throw r;this._subscribeToListener(e,t)}},{key:"unsubscribeFromChannel",value:function(e){this._unsubscribeFromListener(e)}},{key:"unregisterUser",value:function(){var e=this;if(!this._registeredUser){return Promise.reject(new d.KinveyError("Cannot unregister when no user has been registered for live service"))}var t=this._registeredUser._id;return this._makeUnregisterRequst(t).then(function(t){return e._registeredUser=null,t})}},{key:"_unsubscribeFromAll",value:function(){this._pubnubClient.unsubscribeAll(),this._pubnubListener.removeAllListeners()}},{key:"_validatePublishData",value:function(e,t){var r=null;return i(e)||(r=new d.KinveyError("Invalid channel name")),void 0===t&&(r=new d.KinveyError("Missing or invalid message")),r}},{key:"_validateSubscribeData",value:function(e,t){var r=null;return i(e)||(r=new d.KinveyError("Invalid channel name")),t&&o(t)||(r=new d.KinveyError("Missing or invalid receiver")),r}},{key:"_subscribeToUserChannelGroup",value:function(){this._pubnubClient.subscribe({channelGroups:[this._userChannelGroup]})}},{key:"_subscribeToListener",value:function(e,t){(0,s.default)(t.onMessage)&&this._pubnubListener.on(e,t.onMessage),((0,s.default)(t.onError)||(0,s.default)(t.onStatus))&&this._pubnubListener.on(""+p.PubNubListener.statusPrefix+e,function(e){var r=e.error?t.onError:t.onStatus;(0,s.default)(r)&&r.call(t,e)})}},{key:"_unsubscribeFromListener",value:function(e){this._pubnubListener.removeAllListeners(e),this._pubnubListener.removeAllListeners(""+p.PubNubListener.statusPrefix+e)}},{key:"_makeRegisterRequest",value:function(e){return this._makeUserManagementRequest(e,"register-realtime")}},{key:"_makeUnregisterRequst",value:function(e){return this._makeUserManagementRequest(e,"unregister-realtime")}},{key:"_makeUserManagementRequest",value:function(e,t){return f.KinveyRequest.executeShort({method:f.RequestMethod.POST,pathname:"/user/"+this._client.appKey+"/"+e+"/"+t,body:{deviceId:this._client.deviceId}},this._client)}},{key:"_throwNotInitializedError",value:function(){throw new d.KinveyError("Live service has not been initialized")}},{key:"_pubnubClient",get:function(){return this.__pubnubClient||this._throwNotInitializedError(),this.__pubnubClient},set:function(e){this.__pubnubClient=e}},{key:"_pubnubListener",set:function(e){this.__pubnubListener=e},get:function(){return this.__pubnubListener||this._throwNotInitializedError(),this.__pubnubListener}}]),e}(),v=void 0},function(e,r){e.exports=t},function(e,t,r){var n=r(52),o=r(25),i=Object.prototype.hasOwnProperty;e.exports=function(e,t,r){var u=e[t];i.call(e,t)&&o(u,r)&&(void 0!==r||t in e)||n(e,t,r)}},function(e,t,r){var n=r(83);e.exports=function(e,t,r){"__proto__"==t&&n?n(e,t,{configurable:!0,enumerable:!0,value:r,writable:!0}):e[t]=r}},function(e,t,r){var n=r(54),o=r(87);e.exports=function(e){return n(function(t,r){var n=-1,i=r.length,u=i>1?r[i-1]:void 0,a=i>2?r[2]:void 0;for(u=e.length>3&&"function"==typeof u?(i--,u):void 0,a&&o(r[0],r[1],a)&&(u=i<3?void 0:u,i=1),t=Object(t);++n<i;){var s=r[n];s&&e(t,s,n,u)}return t})}},function(e,t,r){var n=r(32),o=r(177),i=r(178);e.exports=function(e,t){return i(o(e,t,n),e+"")}},function(e,t){var r=9007199254740991;e.exports=function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=r}},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(e,t,r){var n=r(185),o=r(89),i=r(186),u=i&&i.isTypedArray,a=u?o(u):n;e.exports=a},function(e,t,r){var n=r(91)(Object.getPrototypeOf,Object);e.exports=n},function(e,t,r){var n=r(188),o=r(60),i=r(189),u=r(190),a=r(191),s=r(16),c=r(85),l="[object Promise]",f="[object WeakMap]",d="[object DataView]",h=c(n),p=c(o),y=c(i),v=c(u),b=c(a),m=s;(n&&m(new n(new ArrayBuffer(1)))!=d||o&&"[object Map]"!=m(new o)||i&&m(i.resolve())!=l||u&&"[object Set]"!=m(new u)||a&&m(new a)!=f)&&(m=function(e){var t=s(e),r="[object Object]"==t?e.constructor:void 0,n=r?c(r):"";if(n)switch(n){case h:return d;case p:return"[object Map]";case y:return l;case v:return"[object Set]";case b:return f}return t}),e.exports=m},function(e,t,r){var n=r(19)(r(10),"Map");e.exports=n},function(e,t,r){var n=r(16),o=r(14),i="[object Number]";e.exports=function(e){return"number"==typeof e||o(e)&&n(e)==i}},function(e,t,r){function n(e){var t=this.__data__=new o(e);this.size=t.size}var o=r(37),i=r(200),u=r(201),a=r(202),s=r(203),c=r(204);n.prototype.clear=i,n.prototype.delete=u,n.prototype.get=a,n.prototype.has=s,n.prototype.set=c,e.exports=n},function(e,t,r){function n(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}var o=r(205),i=r(212),u=r(214),a=r(215),s=r(216);n.prototype.clear=o,n.prototype.delete=i,n.prototype.get=u,n.prototype.has=a,n.prototype.set=s,e.exports=n},function(e,t,r){var n=r(224),o=r(97),i=Object.prototype.propertyIsEnumerable,u=Object.getOwnPropertySymbols,a=u?function(e){return null==e?[]:(e=Object(e),n(u(e),function(t){return i.call(e,t)}))}:o;e.exports=a},function(e,t){e.exports=function(e,t){for(var r=-1,n=t.length,o=e.length;++r<n;)e[o+r]=t[r];return e}},function(e,t,r){var n=r(101);e.exports=function(e){var t=new e.constructor(e.byteLength);return new n(t).set(new n(e)),t}},function(e,t){e.exports=function(e,t,r,n){var o=-1,i=null==e?0:e.length;for(n&&i&&(r=e[++o]);++o<i;)r=t(r,e[o],o,e);return r}},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.NetworkRack=t.CacheRack=t.Rack=void 0;var a=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),s=function e(t,r,n){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,r);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,r,n)}if("value"in o)return o.value;var u=o.get;if(void 0!==u)return u.call(n)},c=n(r(4)),l=n(r(69)),f=n(r(15)),d=n(r(72)),h=r(2),p=r(21),y=r(110),v=t.Rack=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Rack";o(this,t);var r=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.middlewares=[],r.canceled=!1,r.activeMiddleware=void 0,r}return u(t,y.Middleware),a(t,[{key:"use",value:function(e){if((0,h.isDefined)(e)){if(e instanceof y.Middleware)return void this.middlewares.push(e);throw new Error("Unable to use the middleware. It must be an instance of Middleware.")}}},{key:"reset",value:function(){this.middlewares=[]}},{key:"execute",value:function(e){var t=this;return!1===(0,h.isDefined)(e)?c.default.reject(new Error("Request is undefined. Please provide a valid request.")):(0,l.default)((0,d.default)(this.middlewares),function(r,n){return r.then(function(r){var o=r.request,i=r.response;return t.canceled?c.default.reject(new Error("Cancelled")):(t.activeMiddleware=n,n.handle(o||e,i))})},c.default.resolve({request:e})).then(function(e){var r=e.response;return!0===t.canceled?c.default.reject(new Error("Cancelled")):(t.canceled=!1,t.activeMiddleware=void 0,r)}).catch(function(e){throw t.canceled=!1,t.activeMiddleware=void 0,e})}},{key:"cancel",value:function(){return this.canceled=!0,(0,h.isDefined)(this.activeMiddleware)&&(0,f.default)(this.activeMiddleware.cancel)?this.activeMiddleware.cancel():c.default.resolve()}},{key:"handle",value:function(e){return this.execute(e)}},{key:"generateTree",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"generateTree",this).call(this,e);return(0,d.default)(this.middlewares).forEach(function(t){r.nodes.push(t.generateTree(e+1))}),r}}]),t}(),b=new(function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Cache Rack";o(this,t);var r=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.use(new y.CacheMiddleware),r}return u(t,v),a(t,[{key:"useCacheMiddleware",value:function(e){this.reset(),this.use(e)}},{key:"execute",value:function(e){return p.Log.debug("Executing cache request",e),s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"execute",this).call(this,e).then(function(t){return p.Log.debug("Received response for cache request id: "+e.id,t),t}).catch(function(t){throw p.Log.error("Received error for cache request id: "+e.id,t),t})}}]),t}()),m=new(function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Network Rack";o(this,t);var r=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.use(new y.SerializeMiddleware),r.use(new y.HttpMiddleware),r.use(new y.ParseMiddleware),r}return u(t,v),a(t,[{key:"useHttpMiddleware",value:function(e){this.reset(),this.use(new y.SerializeMiddleware),this.use(e),this.use(new y.ParseMiddleware)}},{key:"execute",value:function(e){return p.Log.debug("Executing network request",e),s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"execute",this).call(this,e).then(function(t){return p.Log.debug("Received response for network request: "+e.id,t),t}).catch(function(t){throw p.Log.error("Received error for network request id: "+e.id,t),t})}}]),t}());t.CacheRack=b,t.NetworkRack=m},function(e,t,r){var n=r(67),o=r(28),i=r(18),u=r(267),a=r(3);e.exports=function(e,t,r){var s=a(e)?n:u,c=arguments.length<3;return s(e,i(t,4),r,c,o)}},function(e,t,r){var n=r(45),o=r(24);e.exports=function(e,t){for(var r=0,i=(t=n(t,e)).length;null!=e&&r<i;)e=e[o(t[r++])];return r&&r==i?e:void 0}},function(e,t,r){var n=r(3),o=r(46),i=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,u=/^\w*$/;e.exports=function(e,t){if(n(e))return!1;var r=typeof e;return!("number"!=r&&"symbol"!=r&&"boolean"!=r&&null!=e&&!o(e))||u.test(e)||!i.test(e)||null!=t&&e in Object(t)}},function(e,t,r){var n=r(268),o=r(17);e.exports=function(e){return null==e?[]:n(e,o(e))}},function(e,t,r){var n=r(52),o=r(273)(function(e,t,r){n(e,r,t)});e.exports=o},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.CacheStore=void 0;var o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=function e(t,r,n){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,r);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,r,n)}if("value"in o)return o.value;var u=o.get;if(void 0!==u)return u.call(n)},u=n(r(4)),a=n(r(290)),s=n(r(12)),c=n(r(73)),l=n(r(300)),f=n(r(3)),d=n(r(69)),h=n(r(75)),p=n(r(7)),y=r(6),v=r(1),b=r(9),m=r(23),g=r(76),_=r(2),w=r(31),O=r(79),k=r(123);t.CacheStore=function(e){function t(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,r));return n.ttl=r.ttl||void 0,n.syncManager=new k.SyncManager(n.collection,r),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,O.NetworkStore),o(t,[{key:"find",value:function(e){var r=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=!0===(n=(0,s.default)({syncAutomatically:this.syncAutomatically},n)).syncAutomatically;return w.KinveyObservable.create(function(u){if(e&&!(e instanceof b.Query))return u.error(new v.KinveyError("Invalid query. It must be an instance of the Query class."));return new y.CacheRequest({method:y.RequestMethod.GET,url:p.default.format({protocol:r.client.apiProtocol,host:r.client.apiHost,pathname:r.pathname}),properties:n.properties,query:e,timeout:n.timeout}).execute().then(function(e){return e.data}).catch(function(){return[]}).then(function(){var s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return u.next(s),!0===o?r.pendingSyncCount(e,n).then(function(t){return t>0?r.push(e,n).then(function(){return r.pendingSyncCount(e,n)}):t}).then(function(o){if(o>0)throw new v.KinveyError("Unable to fetch the entities on the backend. There are "+o+" entities that need to be synced.");return i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"find",r).call(r,e,n).toPromise()}).then(function(e){var t=(0,a.default)(s,e,"_id"),o=Object.keys((0,c.default)(t,"_id")),i=(new b.Query).contains("_id",o);return r.clear(i,n).then(function(){return e})}).then(function(e){return new y.CacheRequest({method:y.RequestMethod.PUT,url:p.default.format({protocol:r.client.apiProtocol,host:r.client.apiHost,pathname:r.pathname}),properties:n.properties,body:e,timeout:n.timeout}).execute().then(function(e){return e.data})}):s}).then(function(e){u.next(e)}).then(function(){u.complete()}).catch(function(e){return u.error(e)})})}},{key:"findById",value:function(e){var r=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=!0===(n=(0,s.default)({syncAutomatically:this.syncAutomatically},n)).syncAutomatically;return w.KinveyObservable.create(function(u){if(!1===(0,_.isDefined)(e))return u.next(void 0),u.complete();return new y.CacheRequest({method:y.RequestMethod.GET,url:p.default.format({protocol:r.client.apiProtocol,host:r.client.apiHost,pathname:r.pathname+"/"+e}),properties:n.properties,timeout:n.timeout}).execute().then(function(e){return e.data}).catch(function(){}).then(function(a){if(u.next(a),!0===o){var s=new b.Query;return s.equalTo("_id",e),r.pendingSyncCount(s,n).then(function(e){return e>0?r.push(s,n).then(function(){return r.pendingSyncCount(s,n)}):e}).then(function(e){if(e>0)throw new v.KinveyError("Unable to find the entity on the backend. There are "+e+" entities that need to be synced.")}).then(function(){return i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"findById",r).call(r,e,n).toPromise()}).then(function(e){return new y.CacheRequest({method:y.RequestMethod.PUT,url:p.default.format({protocol:r.client.apiProtocol,host:r.client.apiHost,pathname:r.pathname}),properties:n.properties,body:e,timeout:n.timeout}).execute().then(function(e){return e.data})})}return a}).then(function(e){return u.next(e)}).then(function(){return u.complete()}).catch(function(e){return u.error(e)})})}},{key:"group",value:function(e){var r=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=!0===(n=(0,s.default)({syncAutomatically:this.syncAutomatically},n)).syncAutomatically;return w.KinveyObservable.create(function(u){if(!(e instanceof m.Aggregation))return u.error(new v.KinveyError("Invalid aggregation. It must be an instance of the Aggregation class."));return new y.CacheRequest({method:y.RequestMethod.POST,url:p.default.format({protocol:r.client.apiProtocol,host:r.client.apiHost,pathname:r.pathname+"/_group"}),properties:n.properties,aggregation:e,timeout:n.timeout}).execute().then(function(e){return e.data}).catch(function(){return[]}).then(function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return u.next(a),!0===o?r.pendingSyncCount(null,n).then(function(e){return e>0?r.push(null,n).then(function(){return r.pendingSyncCount(null,n)}):e}).then(function(o){if(o>0)throw new v.KinveyError("Unable to group entities on the backend. There are "+o+" entities that need to be synced.");return i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"group",r).call(r,e,n).toPromise()}):a}).then(function(e){return u.next(e)}).then(function(){return u.complete()}).catch(function(e){return u.error(e)})})}},{key:"count",value:function(e){var r=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=!0===(n=(0,s.default)({syncAutomatically:this.syncAutomatically},n)).syncAutomatically;return w.KinveyObservable.create(function(u){if(e&&!(e instanceof b.Query))return u.error(new v.KinveyError("Invalid query. It must be an instance of the Query class."));return new y.CacheRequest({method:y.RequestMethod.GET,url:p.default.format({protocol:r.client.apiProtocol,host:r.client.apiHost,pathname:r.pathname}),properties:n.properties,query:e,timeout:n.timeout}).execute().then(function(e){return e.data}).catch(function(){return[]}).then(function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).length}).then(function(a){return u.next(a),!0===o?r.pendingSyncCount(e,n).then(function(t){return t>0?r.push(e,n).then(function(){return r.pendingSyncCount(e,n)}):t}).then(function(e){if(e>0)throw new v.KinveyError("Unable to count entities on the backend. There are "+e+" entities that need to be synced.")}).then(function(){return i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"count",r).call(r,e,n).toPromise()}):a}).then(function(e){return u.next(e)}).then(function(){return u.complete()}).catch(function(e){return u.error(e)})})}},{key:"create",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return w.KinveyObservable.create(function(n){if(!1===(0,_.isDefined)(e))return n.next(null),n.complete();if((0,f.default)(e))return n.error(new v.KinveyError("Unable to create an array of entities.","Please create entities one by one."));return new y.CacheRequest({method:y.RequestMethod.POST,url:p.default.format({protocol:t.client.apiProtocol,host:t.client.apiHost,pathname:t.pathname}),properties:r.properties,body:e,timeout:r.timeout}).execute().then(function(e){return e.data}).then(function(e){return t.syncManager.addCreateOperation(e,r).then(function(){return e})}).then(function(e){if(!0===t.syncAutomatically){var n=(new b.Query).equalTo("_id",e._id);return t.push(n,r).then(function(e){var t=e[0];if((0,_.isDefined)(t.error))throw t.error;return t.entity})}return e}).then(function(e){return n.next(e)}).then(function(){return n.complete()}).catch(function(e){return n.error(e)})}).toPromise()}},{key:"update",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return w.KinveyObservable.create(function(n){if(!1===(0,_.isDefined)(e))return n.next(null),n.complete();if((0,f.default)(e))return n.error(new v.KinveyError("Unable to update an array of entities.","Please update entities one by one."));if(!1===(0,_.isDefined)(e._id))return n.error(new v.KinveyError("The entity provided does not contain an _id. An _id is required to update the entity.",e));return new y.CacheRequest({method:y.RequestMethod.PUT,url:p.default.format({protocol:t.client.apiProtocol,host:t.client.apiHost,pathname:t.pathname+"/"+e._id}),properties:r.properties,body:e,timeout:r.timeout}).execute().then(function(e){return e.data}).then(function(e){return t.syncManager.addUpdateOperation(e,r).then(function(){return e})}).then(function(e){if(!0===t.syncAutomatically){var n=(new b.Query).equalTo("_id",e._id);return t.push(n,r).then(function(e){var t=e[0];if((0,_.isDefined)(t.error))throw t.error;return t.entity})}return e}).then(function(e){return n.next(e)}).then(function(){return n.complete()}).catch(function(e){return n.error(e)})}).toPromise()}},{key:"remove",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return w.KinveyObservable.create(function(n){if(e&&!(e instanceof b.Query))return n.error(new v.KinveyError("Invalid query. It must be an instance of the Query class."));return new y.CacheRequest({method:y.RequestMethod.GET,url:p.default.format({protocol:t.client.apiProtocol,host:t.client.apiHost,pathname:t.pathname}),properties:r.properties,query:e,timeout:r.timeout}).execute().then(function(e){return e.data}).then(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return e.length>0?u.default.all((0,h.default)(e,function(e){if(new g.Metadata(e).isLocal()){var n=new b.Query;return n.equalTo("_id",e._id),t.clearSync(n,r).then(function(){return e})}return t.syncManager.addDeleteOperation(e,r).then(function(){return e})})).then(function(){return e}):e}).then(function(e){if(e.length>0&&!0===t.syncAutomatically){var n=(0,l.default)(e,function(e){return new g.Metadata(e).isLocal()}),o=Object.keys((0,c.default)(e,"_id")),i=(new b.Query).contains("_id",o);return t.push(i,r).then(function(e){return e.concat(n)})}return e}).then(function(e){return u.default.all((0,h.default)(e,function(e){if(!1===(0,_.isDefined)(e.error)){return new y.CacheRequest({method:y.RequestMethod.DELETE,url:p.default.format({protocol:t.client.apiProtocol,host:t.client.apiHost,pathname:t.pathname+"/"+e._id}),properties:r.properties,authType:y.AuthType.Default,timeout:r.timeout}).execute().then(function(e){return e.data})}return{count:0}}))}).then(function(e){return(0,d.default)(e,function(e,t){return e.count+=t.count,e},{count:0})}).then().then(function(e){return n.next(e)}).then(function(){return n.complete()}).catch(function(e){return n.error(e)})}).toPromise()}},{key:"removeById",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return w.KinveyObservable.create(function(n){if(!1===(0,_.isDefined)(e))return n.next({count:0}),n.complete();return new y.CacheRequest({method:y.RequestMethod.GET,url:p.default.format({protocol:t.client.apiProtocol,host:t.client.apiHost,pathname:t.pathname+"/"+e}),properties:r.properties,authType:y.AuthType.Default,timeout:r.timeout}).execute().then(function(e){return e.data}).catch(function(e){if(e instanceof v.NotFoundError)return null;throw e}).then(function(e){if((0,_.isDefined)(e)){if(new g.Metadata(e).isLocal()){var n=new b.Query;return n.equalTo("_id",e._id),t.clearSync(n,r).then(function(){return e})}return t.syncManager.addDeleteOperation(e,r).then(function(){return e})}return e}).then(function(e){if(!0===t.syncAutomatically){var n=(new b.Query).equalTo("_id",e._id);return t.push(n,r).then(function(){return e})}return e}).then(function(e){return new y.CacheRequest({method:y.RequestMethod.DELETE,url:p.default.format({protocol:t.client.apiProtocol,host:t.client.apiHost,pathname:t.pathname+"/"+e._id}),properties:r.properties,authType:y.AuthType.Default,timeout:r.timeout}).execute().then(function(e){return e.data})}).then(function(e){return n.next(e)}).then(function(){return n.complete()}).catch(function(e){return n.error(e)})}).toPromise()}},{key:"clear",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return w.KinveyObservable.create(function(n){if(e&&!(e instanceof b.Query))return n.error(new v.KinveyError("Invalid query. It must be an instance of the Query class."));return new y.CacheRequest({method:y.RequestMethod.GET,url:p.default.format({protocol:t.client.apiProtocol,host:t.client.apiHost,pathname:t.pathname}),properties:r.properties,query:e,timeout:r.timeout}).execute().then(function(e){return e.data}).then(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return u.default.all((0,h.default)(e,function(e){return u.default.resolve(e).then(function(e){if(new g.Metadata(e).isLocal()){var n=new b.Query;return n.equalTo("_id",e._id),t.clearSync(n,r).then(function(){return e})}return e}).then(function(e){return new y.CacheRequest({method:y.RequestMethod.DELETE,url:p.default.format({protocol:t.client.apiProtocol,host:t.client.apiHost,pathname:t.pathname+"/"+e._id}),properties:r.properties,authType:y.AuthType.Default,timeout:r.timeout}).execute().then(function(e){return e.data})})}))}).then(function(e){return(0,d.default)(e,function(e,t){return e.count+=t.count,e},{count:0})}).then(function(e){return n.next(e)}).then(function(){return n.complete()}).catch(function(e){return n.error(e)})}).toPromise()}},{key:"pendingSyncCount",value:function(e,t){return this.syncManager.count(e,t)}},{key:"pendingSyncEntities",value:function(e,t){return this.syncManager.find(e,t)}},{key:"push",value:function(e,t){return this.syncManager.push(e,t)}},{key:"pull",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return r=(0,s.default)({useDeltaFetch:this.useDeltaFetch},r),this.syncManager.pull(e,r).then(function(n){return t.clear(e,r).then(function(){return new y.CacheRequest({method:y.RequestMethod.PUT,url:p.default.format({protocol:t.client.apiProtocol,host:t.client.apiHost,pathname:t.pathname}),properties:r.properties,body:n,timeout:r.timeout}).execute()}).then(function(){return n})})}},{key:"sync",value:function(e,t){var r=this;return t=(0,s.default)({useDeltaFetch:this.useDeltaFetch},t),this.push(e,t).then(function(n){return r.pull(e,t).then(function(e){return{push:n,pull:e}})})}},{key:"clearSync",value:function(e,t){return this.syncManager.clear(e,t)}},{key:"syncAutomatically",get:function(){return!0}}]),t}()},function(e,t,r){var n=r(47),o=r(18),i=r(305),u=r(3);e.exports=function(e,t){return(u(e)?n:i)(e,o(t,3))}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Metadata=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=function(e){return e&&e.__esModule?e:{default:e}}(r(27)),i=r(1),u=r(2);t.Metadata=function(){function e(t){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),!1===(0,o.default)(t))throw new i.KinveyError("entity argument must be an object");t._kmd=t._kmd||{},this.entity=t}return n(e,[{key:"isLocal",value:function(){return!0===this.entity._kmd.local}},{key:"toPlainObject",value:function(){return this.entity._kmd}},{key:"createdAt",get:function(){if((0,u.isDefined)(this.entity._kmd.ect))return new Date(this.entity._kmd.ect)}},{key:"ect",get:function(){return this.createdAt}},{key:"emailVerification",get:function(){if((0,u.isDefined)(this.entity._kmd.emailVerification))return this.entity._kmd.emailVerification.status}},{key:"lastModified",get:function(){if((0,u.isDefined)(this.entity._kmd.lmt))return new Date(this.entity._kmd.lmt)}},{key:"lmt",get:function(){return this.lastModified}},{key:"authtoken",get:function(){return this.entity._kmd.authtoken}}]),e}()},function(e,t,r){"use strict";var n="undefined"!=typeof window&&window,o="undefined"!=typeof self&&"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&self,i="undefined"!=typeof global&&global,u=n||i||o;t.root=u,function(){if(!u)throw new Error("RxJS could not find any global context (window, self, global)")}()},function(e,t,r){"use strict";var n=r(77).root.Symbol;t.rxSubscriber="function"==typeof n&&"function"==typeof n.for?n.for("rxSubscriber"):"@@rxSubscriber",t.$$rxSubscriber=t.rxSubscriber},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.NetworkStore=void 0;var o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=n(r(5)),u=n(r(3)),a=n(r(7)),s=r(6),c=r(1),l=r(9),f=r(8),d=r(2),h=r(31),p=r(23),y=r(80);t.NetworkStore=function(){function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),t&&!(0,i.default)(t))throw new c.KinveyError("Collection must be a string.");this.collection=t,this.client=r.client,this.useDeltaFetch=!0===r.useDeltaFetch}return o(e,[{key:"find",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=!0===r.useDeltaFetch||this.useDeltaFetch;return h.KinveyObservable.create(function(o){if((0,d.isDefined)(e)&&!(e instanceof l.Query))return o.error(new c.KinveyError("Invalid query. It must be an instance of the Query class."));var i={method:s.RequestMethod.GET,authType:s.AuthType.Default,url:a.default.format({protocol:t.client.apiProtocol,host:t.client.apiHost,pathname:t.pathname}),properties:r.properties,query:e,timeout:r.timeout,client:t.client},u=new s.KinveyRequest(i);return!0===n&&(u=new s.DeltaFetchRequest(i)),u.execute().then(function(e){return e.data}).then(function(e){return o.next(e)}).then(function(){return o.complete()}).catch(function(e){return o.error(e)})})}},{key:"findById",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=r.useDeltaFetch||this.useDeltaFetch;return h.KinveyObservable.create(function(o){if(!e)return o.next(void 0),o.complete();var i={method:s.RequestMethod.GET,authType:s.AuthType.Default,url:a.default.format({protocol:t.client.apiProtocol,host:t.client.apiHost,pathname:t.pathname+"/"+e}),properties:r.properties,timeout:r.timeout,client:t.client},u=new s.KinveyRequest(i);return!0===n&&(u=new s.DeltaFetchRequest(i)),u.execute().then(function(e){return e.data}).then(function(e){return o.next(e)}).then(function(){return o.complete()}).catch(function(e){return o.error(e)})})}},{key:"group",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return h.KinveyObservable.create(function(n){if(!(e instanceof p.Aggregation))return n.error(new c.KinveyError("Invalid aggregation. It must be an instance of the Aggregation class."));return new s.KinveyRequest({method:s.RequestMethod.POST,authType:s.AuthType.Default,url:a.default.format({protocol:t.client.apiProtocol,host:t.client.apiHost,pathname:t.pathname+"/_group"}),properties:r.properties,aggregation:e,timeout:r.timeout,client:t.client}).execute().then(function(e){return e.data}).then(function(e){return n.next(e)}).then(function(){return n.complete()}).catch(function(e){return n.error(e)})})}},{key:"count",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return h.KinveyObservable.create(function(n){try{if(e&&!(e instanceof l.Query))throw new c.KinveyError("Invalid query. It must be an instance of the Query class.");return new s.KinveyRequest({method:s.RequestMethod.GET,authType:s.AuthType.Default,url:a.default.format({protocol:t.client.apiProtocol,host:t.client.apiHost,pathname:t.pathname+"/_count"}),properties:r.properties,query:e,timeout:r.timeout,client:t.client}).execute().then(function(e){return e.data}).then(function(e){return n.next(e?e.count:0)}).then(function(){return n.complete()}).catch(function(e){return n.error(e)})}catch(e){return n.error(e)}})}},{key:"create",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return h.KinveyObservable.create(function(n){if(!1===(0,d.isDefined)(e))return n.next(null),n.complete();if((0,u.default)(e))return n.error(new c.KinveyError("Unable to create an array of entities.","Please create entities one by one."));return new s.KinveyRequest({method:s.RequestMethod.POST,authType:s.AuthType.Default,url:a.default.format({protocol:t.client.apiProtocol,host:t.client.apiHost,pathname:t.pathname}),properties:r.properties,data:e,timeout:r.timeout,client:t.client}).execute().then(function(e){return e.data}).then(function(e){return n.next(e)}).then(function(){return n.complete()}).catch(function(e){return n.error(e)})}).toPromise()}},{key:"update",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return h.KinveyObservable.create(function(n){if(!1===(0,d.isDefined)(e))return n.next(null),n.complete();if((0,u.default)(e))return n.error(new c.KinveyError("Unable to update an array of entities.","Please update entities one by one."));if(!1===(0,d.isDefined)(e._id))return n.error(new c.KinveyError("Unable to update entity.","Entity must contain an _id to be updated."));return new s.KinveyRequest({method:s.RequestMethod.PUT,authType:s.AuthType.Default,url:a.default.format({protocol:t.client.apiProtocol,host:t.client.apiHost,pathname:t.pathname+"/"+e._id}),properties:r.properties,data:e,timeout:r.timeout,client:t.client}).execute().then(function(e){return e.data}).then(function(e){return n.next(e)}).then(function(){return n.complete()}).catch(function(e){return n.error(e)})}).toPromise()}},{key:"save",value:function(e,t){return e._id?this.update(e,t):this.create(e,t)}},{key:"remove",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return h.KinveyObservable.create(function(n){try{if(e&&!(e instanceof l.Query))throw new c.KinveyError("Invalid query. It must be an instance of the Query class.");return new s.KinveyRequest({method:s.RequestMethod.DELETE,authType:s.AuthType.Default,url:a.default.format({protocol:t.client.apiProtocol,host:t.client.apiHost,pathname:t.pathname}),properties:r.properties,query:e,timeout:r.timeout,client:t.client}).execute().then(function(e){return e.data}).then(function(e){return n.next(e)}).then(function(){return n.complete()}).catch(function(e){return n.error(e)})}catch(e){return n.error(e)}}).toPromise()}},{key:"removeById",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return h.KinveyObservable.create(function(n){try{if(!1===(0,d.isDefined)(e))return n.next(void 0),n.complete();return new s.KinveyRequest({method:s.RequestMethod.DELETE,authType:s.AuthType.Default,url:a.default.format({protocol:t.client.apiProtocol,host:t.client.apiHost,pathname:t.pathname+"/"+e}),properties:r.properties,timeout:r.timeout}).execute().then(function(e){return e.data}).then(function(e){return n.next(e)}).then(function(){return n.complete()}).catch(function(e){return n.error(e)})}catch(e){return n.error(e)}}).toPromise()}},{key:"subscribe",value:function(e){return(0,y.getLiveCollectionManager)().subscribeCollection(this.collection,e)}},{key:"unsubscribe",value:function(){return(0,y.getLiveCollectionManager)().unsubscribeCollection(this.collection)}},{key:"client",get:function(){return(0,d.isDefined)(this._client)?this._client:f.Client.sharedInstance()},set:function(e){e instanceof f.Client?this._client=e:this._client=null}},{key:"pathname",get:function(){var e="/appdata/"+this.client.appKey;return this.collection&&(e=e+"/"+this.collection),e}}]),e}()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(316);Object.keys(n).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return n[e]}})});var o=r(321);Object.keys(o).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return o[e]}})});var i=r(49);Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return i[e]}})});var u=r(120);Object.keys(u).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return u[e]}})});var a=r(326);Object.keys(a).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return a[e]}})})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(125);Object.keys(n).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return n[e]}})});var o=r(328);Object.keys(o).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return o[e]}})})},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function o(e){return!1===(0,a.default)(e)&&!1===(0,u.default)(e)}Object.defineProperty(t,"__esModule",{value:!0});var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};t.isDefined=o,t.isNumber=function(e){return!Number.isNaN(parseFloat(e))&&Number.isFinite(e)},t.nested=function(e,t,r){if(!1===o(t))return e=r||e;for(var n=t.split("."),i=n.shift();i&&e;)e=e[i],i=n.shift();return r||e},t.keyBy=function(e,t){return e?e.reduce(function(e,r){return e[t]=r[t],e},{}):{}},t.isEmpty=function(e){return!o(e)||!(e.length>0)&&(0===e.length||"object"!==(void 0===e?"undefined":i(e))||Object.keys(e).reduce(function(t,r){return!!t&&!Object.hasOwnProperty.call(e,r)},!0))};var u=n(r(167)),a=n(r(168))},function(e,t,r){var n=r(19),o=function(){try{var e=n(Object,"defineProperty");return e({},"",{}),e}catch(e){}}();e.exports=o},function(e,t){var r="object"==typeof global&&global&&global.Object===Object&&global;e.exports=r},function(e,t){var r=Function.prototype.toString;e.exports=function(e){if(null!=e){try{return r.call(e)}catch(e){}try{return e+""}catch(e){}}return""}},function(e,t){e.exports=function(e,t,r){switch(r.length){case 0:return e.call(t);case 1:return e.call(t,r[0]);case 2:return e.call(t,r[0],r[1]);case 3:return e.call(t,r[0],r[1],r[2])}return e.apply(t,r)}},function(e,t,r){var n=r(25),o=r(13),i=r(33),u=r(11);e.exports=function(e,t,r){if(!u(r))return!1;var a=typeof t;return!!("number"==a?o(r)&&i(t,r.length):"string"==a&&t in r)&&n(r[t],e)}},function(e,t,r){var n=r(182),o=r(34),i=r(3),u=r(35),a=r(33),s=r(57),c=Object.prototype.hasOwnProperty;e.exports=function(e,t){var r=i(e),l=!r&&o(e),f=!r&&!l&&u(e),d=!r&&!l&&!f&&s(e),h=r||l||f||d,p=h?n(e.length,String):[],y=p.length;for(var v in e)!t&&!c.call(e,v)||h&&("length"==v||f&&("offset"==v||"parent"==v)||d&&("buffer"==v||"byteLength"==v||"byteOffset"==v)||a(v,y))||p.push(v);return p}},function(e,t){e.exports=function(e){return function(t){return e(t)}}},function(e,t,r){var n=r(26),o=r(187),i=Object.prototype.hasOwnProperty;e.exports=function(e){if(!n(e))return o(e);var t=[];for(var r in Object(e))i.call(e,r)&&"constructor"!=r&&t.push(r);return t}},function(e,t){e.exports=function(e,t){return function(r){return e(t(r))}}},function(e,t){e.exports=r},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(193);Object.keys(n).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return n[e]}})})},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.CacheRequest=void 0;var o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=function e(t,r,n){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,r);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,r,n)}if("value"in o)return o.value;var u=o.get;if(void 0!==u)return u.call(n)},u=n(r(7)),a=n(r(95)),s=r(1),c=r(9),l=r(23),f=r(2),d=r(43),h=r(29),p=r(68);t.CacheRequest=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.aggregation=e.aggregation,r.query=e.query,r.rack=p.CacheRack,r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,d.Request),o(t,[{key:"execute",value:function(){var e=this;return i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"execute",this).call(this).then(function(t){if(t instanceof h.KinveyResponse||(t=new h.KinveyResponse({statusCode:t.statusCode,headers:t.headers,data:t.data})),!t.isSuccess())throw t.error;return(0,f.isDefined)(e.query)&&(0,f.isDefined)(t.data)&&(t.data=e.query.process(t.data)),(0,f.isDefined)(e.aggregation)&&(0,f.isDefined)(t.data)&&(t.data=e.aggregation.process(t.data)),t})}},{key:"toPlainObject",value:function(){var e=i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"toPlainObject",this).call(this);return e.appKey=this.appKey,e.collection=this.collection,e.entityId=this.entityId,e.encryptionKey=this.client?this.client.encryptionKey:void 0,e}},{key:"body",get:function(){return this._body},set:function(e){this._body=(0,a.default)(e)}},{key:"query",get:function(){return this._query},set:function(e){if((0,f.isDefined)(e)&&!(e instanceof c.Query))throw new s.KinveyError("Invalid query. It must be an instance of the Query class.");this._query=e}},{key:"aggregation",get:function(){return this._aggregation},set:function(e){if((0,f.isDefined)(e)&&!(e instanceof l.Aggregation))throw new s.KinveyError("Invalid aggregation. It must be an instance of the Aggregation class.");this._aggregation=e}},{key:"url",get:function(){return i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"url",this)},set:function(e){!function e(t,r,n,o){var i=Object.getOwnPropertyDescriptor(t,r);if(void 0===i){var u=Object.getPrototypeOf(t);null!==u&&e(u,r,n,o)}else if("value"in i&&i.writable)i.value=n;else{var a=i.set;void 0!==a&&a.call(o,n)}return n}(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"url",e,this);var r=global.decodeURIComponent(u.default.parse(e).pathname).replace(/^\//,"").split("/");this.appKey=r[1],this.collection=r[2],this.entityId=r[3]}}]),t}()},function(e,t,r){var n=r(194),o=1,i=4;e.exports=function(e){return n(e,o|i)}},function(e,t){e.exports=function(e,t){for(var r=-1,n=null==e?0:e.length;++r<n&&!1!==t(e[r],r,e););return e}},function(e,t){e.exports=function(){return[]}},function(e,t,r){var n=r(65),o=r(58),i=r(64),u=r(97),a=Object.getOwnPropertySymbols?function(e){for(var t=[];e;)n(t,i(e)),e=o(e);return t}:u;e.exports=a},function(e,t,r){var n=r(100),o=r(64),i=r(17);e.exports=function(e){return n(e,i,o)}},function(e,t,r){var n=r(65),o=r(3);e.exports=function(e,t,r){var i=t(e);return o(e)?i:n(i,r(e))}},function(e,t,r){var n=r(10).Uint8Array;e.exports=n},function(e,t){e.exports=function(e){var t=-1,r=Array(e.size);return e.forEach(function(e,n){r[++t]=[n,e]}),r}},function(e,t){e.exports=function(e){var t=-1,r=Array(e.size);return e.forEach(function(e){r[++t]=e}),r}},function(e,t,r){function n(e,t,r,u,a){return e===t||(null==e||null==t||!i(e)&&!i(t)?e!=e&&t!=t:o(e,t,r,u,n,a))}var o=r(247),i=r(14);e.exports=n},function(e,t,r){var n=r(106),o=r(250),i=r(107),u=1,a=2;e.exports=function(e,t,r,s,c,l){var f=r&u,d=e.length,h=t.length;if(d!=h&&!(f&&h>d))return!1;var p=l.get(e);if(p&&l.get(t))return p==t;var y=-1,v=!0,b=r&a?new n:void 0;for(l.set(e,t),l.set(t,e);++y<d;){var m=e[y],g=t[y];if(s)var _=f?s(g,m,y,t,e,l):s(m,g,y,e,t,l);if(void 0!==_){if(_)continue;v=!1;break}if(b){if(!o(t,function(e,t){if(!i(b,t)&&(m===e||c(m,e,r,s,l)))return b.push(t)})){v=!1;break}}else if(m!==g&&!c(m,g,r,s,l)){v=!1;break}}return l.delete(e),l.delete(t),v}},function(e,t,r){function n(e){var t=-1,r=null==e?0:e.length;for(this.__data__=new o;++t<r;)this.add(e[t])}var o=r(63),i=r(248),u=r(249);n.prototype.add=n.prototype.push=i,n.prototype.has=u,e.exports=n},function(e,t){e.exports=function(e,t){return e.has(t)}},function(e,t,r){var n=r(11);e.exports=function(e){return e==e&&!n(e)}},function(e,t){e.exports=function(e,t){return function(r){return null!=r&&r[e]===t&&(void 0!==t||e in Object(r))}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(269);Object.keys(n).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return n[e]}})});var o=r(282);Object.keys(o).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return o[e]}})});var i=r(30);Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return i[e]}})});var u=r(283);Object.keys(u).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return u[e]}})});var a=r(284);Object.keys(a).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return a[e]}})});var s=r(111);Object.keys(s).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return s[e]}})})},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.MemoryAdapter=t.Storage=void 0;var o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=n(r(4)),u=n(r(5)),a=n(r(3)),s=r(2),c=r(271),l=r(21),f=r(1),d=r(272),h=new c.Queue(1,1/0);t.Storage=function(){function e(t){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),!t)throw new f.KinveyError("Unable to create a Storage instance without a name.");if(!(0,u.default)(t))throw new f.KinveyError("The name is not a string. A name must be a string to create a Storage instance.");this.name=t}return o(e,[{key:"loadAdapter",value:function(){return d.MemoryAdapter.load(this.name).then(function(e){return(0,s.isDefined)(e)?e:i.default.reject(new f.KinveyError("Unable to load a storage adapter."))})}},{key:"generateObjectId",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:24,t="abcdef0123456789",r="",n=0,o=t.length;n<e;n+=1){var i=Math.floor(Math.random()*o);r+=t.substring(i,i+1)}return r}},{key:"find",value:function(e){return this.loadAdapter().then(function(t){return l.Log.debug("Find all the entities stored in the "+e+" collection.",t),t.find(e)}).catch(function(t){return l.Log.error("Unable to find all the entities stored in the "+e+" collection.",t),t instanceof f.NotFoundError||404===t.code?[]:i.default.reject(t)}).then(function(){return arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]})}},{key:"findById",value:function(e,t){if(!(0,u.default)(t)){var r=new f.KinveyError("id must be a string",t);return l.Log.error("Unable to find an entity with id "+t+" stored in the "+e+" collection.",r.message),i.default.reject(r)}return this.loadAdapter().then(function(r){return l.Log.debug("Find an entity with id "+t+" stored in the "+e+" collection.",r),r.findById(e,t)})}},{key:"save",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return h.add(function(){var n=!1;return(0,s.isDefined)(r)?((0,a.default)(r)||(n=!0,r=[r]),r=r.map(function(e){if(!(0,s.isDefined)(e._id)){var r=e._kmd||{};r.local=!0,e._kmd=r,e._id=t.generateObjectId()}return e}),t.loadAdapter().then(function(t){return t.save(e,r)}).then(function(e){return n&&e.length>0?e[0]:e})):i.default.resolve(null)})}},{key:"remove",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return i.default.all(r.map(function(r){return(0,s.isDefined)(r._id)?t.removeById(e,r._id):i.default.reject(new f.KinveyError("Unable to remove this entity because it does not have _id."))})).then(function(e){return e.reduce(function(e,t){return e.count+=t.count,e},{count:0})})}},{key:"removeById",value:function(e,t){var r=this;return h.add(function(){return(0,u.default)(t)?r.loadAdapter().then(function(r){return r.removeById(e,t)}):i.default.reject(new f.KinveyError("id must be a string",t))})}},{key:"clear",value:function(){var e=this;return h.add(function(){return e.loadAdapter().then(function(e){return e.clear()})})}}]),e}();t.MemoryAdapter=d.MemoryAdapter},function(e,t){e.exports=function(e,t,r,n){for(var o=e.length,i=r+(n?1:-1);n?i--:++i<o;)if(t(e[i],i,e))return i;return-1}},function(e,t,r){var n=r(45),o=r(15),i=r(24);e.exports=function(e,t,r){var u=-1,a=(t=n(t,e)).length;for(a||(a=1,e=void 0);++u<a;){var s=null==e?void 0:e[i(t[u])];void 0===s&&(u=a,s=r),e=o(s)?s.call(e):s}return e}},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0}),t.KinveyRequest=t.Properties=t.AuthType=t.NetworkRequest=void 0;var a=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),s=function e(t,r,n,o){var i=Object.getOwnPropertyDescriptor(t,r);if(void 0===i){var u=Object.getPrototypeOf(t);null!==u&&e(u,r,n,o)}else if("value"in i&&i.writable)i.value=n;else{var a=i.set;void 0!==a&&a.call(o,n)}return n},c=function e(t,r,n){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,r);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,r,n)}if("value"in o)return o.value;var u=o.get;if(void 0!==u)return u.call(n)},l=n(r(4)),f=r(286),d=n(r(50)),h=n(r(12)),p=n(r(287)),y=n(r(36)),v=n(r(7)),b=n(r(5)),m=r(8),g=r(9),_=r(23),w=r(2),O=r(1),k=r(43),j=r(44),E=r(68),P=r(29),x=t.NetworkRequest=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};o(this,t);var r=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.rack=E.NetworkRack,r}return u(t,k.Request),t}(),S=t.AuthType={All:"All",App:"App",Basic:"Basic",Default:"Default",Master:"Master",None:"None",Session:"Session"};Object.freeze(S);var q={all:function(e){return q.session(e).catch(function(){return q.basic(e)})},app:function(e){return e.appKey&&e.appSecret?l.default.resolve({scheme:"Basic",username:e.appKey,password:e.appSecret}):l.default.reject(new Error("Missing client appKey and/or appSecret. Use Kinvey.initialize() to set the appKey and appSecret for the client."))},basic:function(e){return q.master(e).catch(function(){return q.app(e)})},master:function(e){return e.appKey&&e.masterSecret?l.default.resolve({scheme:"Basic",username:e.appKey,password:e.masterSecret}):l.default.reject(new Error("Missing client appKey and/or masterSecret. Use Kinvey.initialize() to set the appKey and masterSecret for the client."))},none:function(){return l.default.resolve(null)},session:function(e){var t=e.getActiveUser();return(0,w.isDefined)(t)?l.default.resolve({scheme:"Kinvey",credentials:t._kmd.authtoken}):l.default.reject(new O.NoActiveUserError("There is not an active user. Please login a user and retry the request."))}},M=t.Properties=function(e){function t(){return o(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return u(t,j.Headers),t}();t.KinveyRequest=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};o(this,t);var r=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return e=(0,h.default)({skipBL:!1,trace:!1},e),r.authType=e.authType||S.None,r.query=e.query,r.aggregation=e.aggregation,r.properties=e.properties||new M,r.skipBL=!0===e.skipBL,r.trace=!0===e.trace,r}return u(t,x),a(t,[{key:"getAuthorizationHeader",value:function(){var e=this,t=l.default.resolve(void 0);if(this.authType)switch(this.authType){case S.All:t=q.all(this.client);break;case S.App:t=q.app(this.client);break;case S.Basic:t=q.basic(this.client);break;case S.Master:t=q.master(this.client);break;case S.None:t=q.none(this.client);break;case S.Session:t=q.session(this.client);break;default:t=q.session(this.client).catch(function(t){return q.master(e.client).catch(function(){throw t})})}return t.then(function(e){if((0,w.isDefined)(e)){var t=e.credentials;return e.username&&(t=new f.Buffer(e.username+":"+e.password).toString("base64")),e.scheme+" "+t}})}},{key:"execute",value:function(){var e=this,r=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this.getAuthorizationHeader().then(function(t){(0,w.isDefined)(t)?e.headers.set("Authorization",t):e.headers.remove("Authorization")}).then(function(){return c(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"execute",e).call(e)}).then(function(e){if(e instanceof P.KinveyResponse==!1&&(e=new P.KinveyResponse({statusCode:e.statusCode,headers:e.headers,data:e.data})),!1===r&&!1===e.isSuccess())throw e.error;return e}).catch(function(o){if(n&&o instanceof O.InvalidCredentialsError){var i=e.client.getActiveUser();if((0,w.isDefined)(i)){var u=(0,w.isDefined)(i._socialIdentity)?i._socialIdentity:{},a=Object.keys(u).find(function(e){return"kinveyAuth"===u[e].identity}),s=u[a];if((0,w.isDefined)(s)){return new t({method:k.RequestMethod.POST,headers:{"Content-Type":"application/x-www-form-urlencoded"},authType:S.App,url:v.default.format({protocol:e.client.micProtocol,host:e.client.micHost,pathname:"/oauth/token"}),body:{grant_type:"refresh_token",client_id:s.client_id,redirect_uri:s.redirect_uri,refresh_token:s.refresh_token},properties:e.properties,timeout:e.timeout}).execute().then(function(e){return e.data}).then(function(t){return t.identity=s.identity,t.client_id=s.client_id,t.redirect_uri=s.redirect_uri,t.protocol=e.client.micProtocol,t.host=e.client.micHost,t}).then(function(r){var n={};u[r.identity]=r,n._socialIdentity=u;return new t({method:k.RequestMethod.POST,authType:S.App,url:v.default.format({protocol:e.client.apiProtocol,host:e.client.apiHost,pathname:"/user/"+e.client.appKey+"/login"}),properties:e.properties,body:n,timeout:e.timeout,client:e.client}).execute().then(function(e){return e.data}).then(function(t){return t._socialIdentity[r.identity]=(0,p.default)(t._socialIdentity[r.identity],r),e.client.setActiveUser(t)})}).then(function(){return e.execute(r,!1)}).catch(function(){return l.default.reject(o)})}}}return l.default.reject(o)})}},{key:"appVersion",get:function(){return this.client.appVersion}},{key:"query",get:function(){return this._query},set:function(e){if((0,w.isDefined)(e)&&!(e instanceof g.Query))throw new O.KinveyError("Invalid query. It must be an instance of the Query class.");this._query=e}},{key:"aggregation",get:function(){return this._aggregation},set:function(e){if((0,w.isDefined)(e)&&!(e instanceof _.Aggregation))throw new O.KinveyError("Invalid aggregation. It must be an instance of the Aggregation class.");(0,w.isDefined)(e)&&(this.body=e.toPlainObject()),this._aggregation=e}},{key:"headers",get:function(){var e=c(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"headers",this);if(e.has("Accept")||e.set("Accept","application/json; charset=utf-8"),e.has("Content-Type")||e.set("Content-Type","application/json; charset=utf-8"),e.has("X-Kinvey-Api-Version")||e.set("X-Kinvey-Api-Version",4),!0===this.skipBL?e.set("X-Kinvey-Skip-Business-Logic",!0):e.remove("X-Kinvey-Skip-Business-Logic"),!0===this.trace?(e.set("X-Kinvey-Include-Headers-In-Response","X-Kinvey-Request-Id"),e.set("X-Kinvey-ResponseWrapper",!0)):(e.remove("X-Kinvey-Include-Headers-In-Response"),e.remove("X-Kinvey-ResponseWrapper")),this.appVersion?e.set("X-Kinvey-Client-App-Version",this.appVersion):e.remove("X-Kinvey-Client-App-Version"),this.properties){var r=this.properties.toString();if((0,y.default)(r))e.remove("X-Kinvey-Custom-Request-Properties");else{var n=function(e){if(e){var t=0,r=e.length;e=String(e||"");for(var n=0;n<r;n+=1){var o=encodeURI(e[n]).split("%").length;t+=1===o?1:o-1}return t}return 0}(r);if(n>=2e3)throw new Error("The custom properties are "+n+" bytes.It must be less then 2000 bytes.","Please remove some custom properties.");e.set("X-Kinvey-Custom-Request-Properties",r)}}else e.remove("X-Kinvey-Custom-Request-Properties");return e},set:function(e){s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"headers",e,this)}},{key:"url",get:function(){var e=c(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"url",this),r=this.query?this.query.toQueryString():{};return(0,y.default)(r)?e:(0,w.appendQuery)(e,d.default.stringify(r))},set:function(e){s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"url",e,this)}},{key:"properties",get:function(){return this._properties},set:function(e){e&&e instanceof M==!1&&(e=new M(e)),this._properties=e}}],[{key:"executeShort",value:function(e,r){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],o=(0,h.default)({method:k.RequestMethod.GET,authType:S.Session},e);r=r||m.Client.sharedInstance(),!o.url&&(0,b.default)(o.pathname)&&r&&(o.url=v.default.format({protocol:r.apiProtocol,host:r.apiHost,pathname:o.pathname}));var i=t.execute(o);return n&&(i=i.then(function(e){return e.data})),i}},{key:"execute",value:function(e){return new t(e).execute()}}]),t}()},function(e,t){e.exports=function(e){var t=null==e?0:e.length;return t?e[t-1]:void 0}},function(e,t,r){"use strict";var n=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},o=r(117),i=r(308),u=r(119),a=r(78),s=function(e){function t(r,n,o){switch(e.call(this),this.syncErrorValue=null,this.syncErrorThrown=!1,this.syncErrorThrowable=!1,this.isStopped=!1,arguments.length){case 0:this.destination=u.empty;break;case 1:if(!r){this.destination=u.empty;break}if("object"==typeof r){r instanceof t?(this.destination=r,this.destination.add(this)):(this.syncErrorThrowable=!0,this.destination=new c(this,r));break}default:this.syncErrorThrowable=!0,this.destination=new c(this,r,n,o)}}return n(t,e),t.prototype[a.rxSubscriber]=function(){return this},t.create=function(e,r,n){var o=new t(e,r,n);return o.syncErrorThrowable=!1,o},t.prototype.next=function(e){this.isStopped||this._next(e)},t.prototype.error=function(e){this.isStopped||(this.isStopped=!0,this._error(e))},t.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this))},t.prototype._next=function(e){this.destination.next(e)},t.prototype._error=function(e){this.destination.error(e),this.unsubscribe()},t.prototype._complete=function(){this.destination.complete(),this.unsubscribe()},t.prototype._unsubscribeAndRecycle=function(){var e=this._parent,t=this._parents;return this._parent=null,this._parents=null,this.unsubscribe(),this.closed=!1,this.isStopped=!1,this._parent=e,this._parents=t,this},t}(i.Subscription);t.Subscriber=s;var c=function(e){function t(t,r,n,i){e.call(this),this._parentSubscriber=t;var a,s=this;o.isFunction(r)?a=r:r&&(a=r.next,n=r.error,i=r.complete,r!==u.empty&&(s=Object.create(r),o.isFunction(s.unsubscribe)&&this.add(s.unsubscribe.bind(s)),s.unsubscribe=this.unsubscribe.bind(this))),this._context=s,this._next=a,this._error=n,this._complete=i}return n(t,e),t.prototype.next=function(e){if(!this.isStopped&&this._next){var t=this._parentSubscriber;t.syncErrorThrowable?this.__tryOrSetError(t,this._next,e)&&this.unsubscribe():this.__tryOrUnsub(this._next,e)}},t.prototype.error=function(e){if(!this.isStopped){var t=this._parentSubscriber;if(this._error)t.syncErrorThrowable?(this.__tryOrSetError(t,this._error,e),this.unsubscribe()):(this.__tryOrUnsub(this._error,e),this.unsubscribe());else{if(!t.syncErrorThrowable)throw this.unsubscribe(),e;t.syncErrorValue=e,t.syncErrorThrown=!0,this.unsubscribe()}}},t.prototype.complete=function(){var e=this;if(!this.isStopped){var t=this._parentSubscriber;if(this._complete){var r=function(){return e._complete.call(e._context)};t.syncErrorThrowable?(this.__tryOrSetError(t,r),this.unsubscribe()):(this.__tryOrUnsub(r),this.unsubscribe())}else this.unsubscribe()}},t.prototype.__tryOrUnsub=function(e,t){try{e.call(this._context,t)}catch(e){throw this.unsubscribe(),e}},t.prototype.__tryOrSetError=function(e,t,r){try{t.call(this._context,r)}catch(t){return e.syncErrorValue=t,e.syncErrorThrown=!0,!0}return!1},t.prototype._unsubscribe=function(){var e=this._parentSubscriber;this._context=null,this._parentSubscriber=null,e.unsubscribe()},t}(s)},function(e,t,r){"use strict";t.isFunction=function(e){return"function"==typeof e}},function(e,t,r){"use strict";t.errorObject={e:{}}},function(e,t,r){"use strict";t.empty={closed:!0,next:function(e){},error:function(e){throw e},complete:function(){}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PubNubListener=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=r(121);t.PubNubListener=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.EventEmitter),n(t,[{key:"message",value:function(e){this.emit(e.channel,e.message)}},{key:"status",value:function(e){var r=this,n=this._getEventNamesFromStatus(e.affectedChannels,e.affectedChannelGroups);n.length?n.forEach(function(n){r.emit(""+t.statusPrefix+n,e)}):this.emit(t.unclassifiedEvents,e)}},{key:"_getEventNamesFromStatus",value:function(e,t){return(e||[]).concat(t||[])}}],[{key:"statusPrefix",get:function(){return"status:"}},{key:"unclassifiedEvents",get:function(){return"pubNubEventsNotRouted"}}]),t}()},function(e,t){e.exports=require("events")},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.StreamACL=void 0;var o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=n(r(3)),u=n(r(323)),a=r(1),s=r(2),c="Invalid ACL object value";t.StreamACL=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.publishers=[],this.subscribers=[],this.publisherGroups=[],this.subscriberGroups=[],t&&(t instanceof e&&(t=t.toPlainObject()),this._parsePlainObject(t))}return o(e,[{key:"addPublishers",value:function(e){return this._addToAcl(this.publishers,e),this}},{key:"addSubscribers",value:function(e){return this._addToAcl(this.subscribers,e),this}},{key:"addPublisherGroups",value:function(e){return this._addToAcl(this.publisherGroups,e),this}},{key:"addSubscriberGroups",value:function(e){return this._addToAcl(this.subscriberGroups,e),this}},{key:"removePublishers",value:function(e){return this._removeFromAcl(this.publishers,e),this}},{key:"removeSubscribers",value:function(e){return this._removeFromAcl(this.subscribers,e),this}},{key:"removePublisherGroups",value:function(e){return this._removeFromAcl(this.publisherGroups,e),this}},{key:"removeSubscriberGroups",value:function(e){return this._removeFromAcl(this.subscriberGroups,e),this}},{key:"isNotEmpty",value:function(){return this.publishers.length||this.subscribers.length||this.publisherGroups.length||this.subscriberGroups.length}},{key:"toPlainObject",value:function(){var e={};return this.subscribers.length&&(e.subscribe=this.subscribers.slice(0)),this.publishers.length&&(e.publish=this.publishers.slice(0)),this.subscriberGroups.length&&(e.groups=e.groups||{},e.groups.subscribe=this.addSubscriberGroups.slice(0)),this.publisherGroups.length&&(e.groups=e.groups||{},e.groups.publish=this.publisherGroups.slice(0)),e}},{key:"_parsePlainObject",value:function(e){e.subscribe&&(this.subscribers=this._ensureValidIdArray(e.subscribe)),e.publish&&(this.publishers=this._ensureValidIdArray(e.publish)),e.groups&&(e.groups.publish&&(this.publisherGroups=this._ensureValidIdArray(e.groups.publish)),e.groups.subscribe&&(this.subscriberGroups=this._ensureValidIdArray(e.groups.subscribe)))}},{key:"_ensureValidIdArray",value:function(e){if(!this._isValidIdArray(e))throw new a.KinveyError(c);return e}},{key:"_isValidIdArray",value:function(e){var t=this;return(0,i.default)(e)&&(0,u.default)(e,function(e){var r=t._getAsId(e);return(0,s.isNonemptyString)(r)})}},{key:"_addToAcl",value:function(e,t){var r=this,n=(0,i.default)(t)?t:[t];if(!this._isValidIdArray(n))throw new a.KinveyError(c);n.forEach(function(t){var n=r._getAsId(t);e.push(n)})}},{key:"_removeFromAcl",value:function(e,t){var r=this;((0,i.default)(t)?t:[t]).forEach(function(t){var n=r._getAsId(t),o=e.indexOf(n);o>=0&&e.splice(o,1)})}},{key:"_getAsId",value:function(e){return e&&e._id?e._id:e}}],[{key:"isValidACLObject",value:function(t){try{return new e(t).isNotEmpty()}catch(e){return!1}}}]),e}()},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.SyncManager=t.SyncOperation=void 0;var o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=n(r(4)),u=n(r(75)),a=n(r(113)),s=n(r(3)),c=n(r(5)),l=n(r(7)),f=r(6),d=r(1),h=r(2),p=r(8),y=r(9),v=new Map,b=t.SyncOperation={Create:f.RequestMethod.POST,Update:f.RequestMethod.PUT,Delete:f.RequestMethod.DELETE};Object.freeze(b);t.SyncManager=function(){function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),!t)throw new d.SyncError("A collection is required.");if(!(0,c.default)(t))throw new d.SyncError("Collection must be a string.");this.collection=t,this.client=r.client||p.Client.sharedInstance()}return o(e,[{key:"find",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};(0,h.isDefined)(e)&&e instanceof y.Query==!1&&(e=new y.Query((0,a.default)(e,"toJSON",e)));return new f.CacheRequest({method:f.RequestMethod.GET,url:l.default.format({protocol:this.client.apiProtocol,host:this.client.apiHost,pathname:this.backendPathname}),query:e,properties:r.properties,timeout:r.timeout,client:this.client}).execute().then(function(e){return e.data}).then(function(n){var o=new y.Query;o.equalTo("collection",t.collection),(0,h.isDefined)(e)&&o.contains("entityId",(0,u.default)(n,function(e){return e._id}));return new f.CacheRequest({method:f.RequestMethod.GET,url:l.default.format({protocol:t.client.apiProtocol,host:t.client.apiHost,pathname:t.pathname}),properties:r.properties,query:o,timeout:r.timeout,client:t.client}).execute().then(function(e){return e.data})})}},{key:"count",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.find(e,t).then(function(e){return e.length})}},{key:"addCreateOperation",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.addOperation(b.Create,e,t)}},{key:"addUpdateOperation",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.addOperation(b.Update,e,t)}},{key:"addDeleteOperation",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.addOperation(b.Delete,e,t)}},{key:"addOperation",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:b.Create,t=this,r=arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=!1;return(0,s.default)(r)||(o=!0,r=[r]),i.default.all((0,u.default)(r,function(r){if(!r)return i.default.resolve(null);var o=r._id;if(!o)return i.default.reject(new d.SyncError("An entity is missing an _id. All entities must have an _id in order to be added to the sync table.",r));var u=(new y.Query).equalTo("entityId",o);return new f.CacheRequest({method:f.RequestMethod.GET,url:l.default.format({protocol:t.client.apiProtocol,host:t.client.apiHost,pathname:t.pathname}),properties:n.properties,query:u,timeout:n.timeout}).execute().then(function(e){return e.data}).then(function(r){var i=1===r.length?r[0]:{collection:t.collection,state:{},entityId:o};i.state=i.state||{},i.state.operation=e;return new f.CacheRequest({method:f.RequestMethod.PUT,url:l.default.format({protocol:t.client.apiProtocol,host:t.client.apiHost,pathname:t.pathname}),properties:n.properties,body:i,timeout:n.timeout}).execute()})})).then(function(){return!0===o?r[0]:r})}},{key:"pull",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return!e||e instanceof y.Query?this.count(e).then(function(r){return r>0?t.push(e).then(function(){return t.count(e)}):r}).then(function(n){if(n>0)throw new d.SyncError("Unable to pull data from the network. There are "+n+" entities that need to be synced before data is loaded from the network.");var o={method:f.RequestMethod.GET,authType:f.AuthType.Default,url:l.default.format({protocol:t.client.apiProtocol,host:t.client.apiHost,pathname:t.backendPathname}),properties:r.properties,query:e,timeout:r.timeout,client:t.client},i=new f.KinveyRequest(o);return!0===r.useDeltaFetch&&(i=new f.DeltaFetchRequest(o)),i.execute()}).then(function(e){return e.data}):i.default.reject(new d.SyncError("Invalid query. It must be an instance of the Query class."))}},{key:"push",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=0;return!0===v.get(this.collection)?i.default.reject(new d.SyncError("Data is already being pushed to the backend. Please wait for it to complete before pushing new data to the backend.")):(v.set(this.collection,!0),this.find(e).then(function(e){if(e.length>0){return function o(a){return new i.default(function(s){var c=e.slice(n,n+100);return n+=100,i.default.all((0,u.default)(c,function(e){var n=e.entityId,o=e.state,i=void 0===o?{}:o,u=i.operation||i.method;if(u===b.Delete)return new f.KinveyRequest({method:f.RequestMethod.DELETE,authType:f.AuthType.Default,url:l.default.format({protocol:t.client.apiProtocol,host:t.client.apiHost,pathname:t.backendPathname+"/"+n}),properties:r.properties,timeout:r.timeout,client:t.client}).execute().then(function(){return new f.CacheRequest({method:f.RequestMethod.DELETE,url:l.default.format({protocol:t.client.apiProtocol,host:t.client.apiHost,pathname:t.pathname+"/"+e._id}),properties:r.properties,timeout:r.timeout}).execute()}).then(function(){return{_id:n,operation:u}}).catch(function(e){return{_id:n,operation:u,error:e}});if(u===b.Create||u===b.Update){var a=!1;return new f.CacheRequest({method:f.RequestMethod.GET,url:l.default.format({protocol:t.client.apiProtocol,host:t.client.apiHost,pathname:t.backendPathname+"/"+n}),properties:r.properties,timeout:r.timeout}).execute().then(function(e){return e.data}).then(function(o){var i=new f.KinveyRequest({method:f.RequestMethod.PUT,authType:f.AuthType.Default,url:l.default.format({protocol:t.client.apiProtocol,host:t.client.apiHost,pathname:t.backendPathname+"/"+n}),properties:r.properties,timeout:r.timeout,body:o,client:t.client});return u===b.Create&&((0,h.isDefined)(o._kmd)&&!0===o._kmd.local&&(a=!0,delete o._id),i.method=f.RequestMethod.POST,i.url=l.default.format({protocol:t.client.apiProtocol,host:t.client.apiHost,pathname:t.backendPathname})),i.execute().then(function(e){return e.data}).then(function(o){return new f.CacheRequest({method:f.RequestMethod.DELETE,url:l.default.format({protocol:t.client.apiProtocol,host:t.client.apiHost,pathname:t.pathname+"/"+e._id}),properties:r.properties,timeout:r.timeout}).execute().then(function(){return new f.CacheRequest({method:f.RequestMethod.PUT,url:l.default.format({protocol:t.client.apiProtocol,host:t.client.apiHost,pathname:t.backendPathname+"/"+o._id}),properties:r.properties,timeout:r.timeout,body:o}).execute().then(function(e){return e.data})}).then(function(e){return a?new f.CacheRequest({method:f.RequestMethod.DELETE,url:l.default.format({protocol:t.client.apiProtocol,host:t.client.apiHost,pathname:t.backendPathname+"/"+n}),properties:r.properties,timeout:r.timeout}).execute().then(function(){return e}):e}).then(function(e){return{_id:n,operation:u,entity:e}})}).catch(function(e){return o._id=n,{_id:n,operation:u,entity:o,error:e}})}).catch(function(e){return{_id:n,operation:u,entity:void 0,error:e}})}return{_id:n,operation:u,entity:void 0,error:new d.SyncError("Unable to sync the entity since the operation was not recognized.",e)}})).then(function(t){return a=a.concat(t),n<e.length?s(o(a)):s(a)})})}([])}return[]}).then(function(e){return v.set(t.collection,!1),e}).catch(function(e){throw v.set(t.collection,!1),e}))}},{key:"clear",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.find(e,r).then(function(e){return i.default.all((0,u.default)(e,function(e){return new f.CacheRequest({method:f.RequestMethod.DELETE,url:l.default.format({protocol:t.client.apiProtocol,host:t.client.apiHost,pathname:t.pathname+"/"+e._id}),properties:r.properties,timeout:r.timeout}).execute().then(function(e){return e.data})}))})}},{key:"pathname",get:function(){return"/appdata/"+this.client.appKey+"/kinvey_sync"}},{key:"backendPathname",get:function(){return"/appdata/"+this.client.appKey+"/"+this.collection}}]),e}()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SyncStore=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=function(e){return e&&e.__esModule?e:{default:e}}(r(7)),i=r(6),u=r(1),a=r(9),s=r(23),c=r(2),l=r(31),f=r(74);t.SyncStore=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,f.CacheStore),n(t,[{key:"find",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return l.KinveyObservable.create(function(n){if(e&&!(e instanceof a.Query))return n.error(new u.KinveyError("Invalid query. It must be an instance of the Query class."));return new i.CacheRequest({method:i.RequestMethod.GET,url:o.default.format({protocol:t.client.apiProtocol,host:t.client.apiHost,pathname:t.pathname}),properties:r.properties,query:e,timeout:r.timeout}).execute().then(function(e){return e.data}).then(function(e){return n.next(e)}).then(function(){return n.complete()}).catch(function(e){return n.error(e)})})}},{key:"findById",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return l.KinveyObservable.create(function(n){try{if(!1===(0,c.isDefined)(e))return n.next(void 0),n.complete();return new i.CacheRequest({method:i.RequestMethod.GET,url:o.default.format({protocol:t.client.apiProtocol,host:t.client.apiHost,pathname:t.pathname+"/"+e}),properties:r.properties,timeout:r.timeout}).execute().then(function(e){return e.data}).then(function(e){return n.next(e)}).then(function(){return n.complete()}).catch(function(e){return n.error(e)})}catch(e){return n.error(e)}})}},{key:"group",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return l.KinveyObservable.create(function(n){if(!(e instanceof s.Aggregation))return n.error(new u.KinveyError("Invalid aggregation. It must be an instance of the Aggregation class."));return new i.CacheRequest({method:i.RequestMethod.POST,url:o.default.format({protocol:t.client.apiProtocol,host:t.client.apiHost,pathname:t.pathname+"/_group"}),properties:r.properties,aggregation:e,timeout:r.timeout}).execute().then(function(e){return e.data}).then(function(e){return n.next(e)}).then(function(){return n.complete()}).catch(function(e){return n.error(e)})})}},{key:"count",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return l.KinveyObservable.create(function(n){try{if(e&&!(e instanceof a.Query))throw new u.KinveyError("Invalid query. It must be an instance of the Query class.");return new i.CacheRequest({method:i.RequestMethod.GET,url:o.default.format({protocol:t.client.apiProtocol,host:t.client.apiHost,pathname:t.pathname}),properties:r.properties,query:e,timeout:r.timeout}).execute().then(function(e){return e.data}).then(function(e){return n.next(e?e.length:0)}).then(function(){return n.complete()}).catch(function(e){return n.error(e)})}catch(e){return n.error(e)}})}},{key:"syncAutomatically",get:function(){return!1}}]),t}()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=t.SocialIdentity={Kinvey:"kinvey",MobileIdentityConnect:"kinveyAuth"};Object.freeze(n)},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.Acl=void 0;var o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=n(r(27)),u=n(r(3)),a=n(r(12)),s=r(1),c=r(2);t.Acl=function(){function e(t){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),!1===(0,i.default)(t))throw new s.KinveyError("entity argument must be an object");t._acl=t._acl||{},this.entity=t}return o(e,[{key:"addReader",value:function(e){var t=this.readers;return-1===t.indexOf(e)&&t.push(e),this.entity._acl.r=t,this}},{key:"addReaderGroup",value:function(e){var t=this.readerGroups;return-1===t.indexOf(e)&&t.push(e),this.entity._acl.groups=(0,a.default)({},this.entity._acl.groups,{r:t}),this}},{key:"addWriter",value:function(e){var t=this.writers;return-1===t.indexOf(e)&&t.push(e),this.entity._acl.w=t,this}},{key:"addWriterGroup",value:function(e){var t=this.writerGroups;return-1===t.indexOf(e)&&t.push(e),this.entity._acl.groups=(0,a.default)({},this.entity._acl.groups,{w:t}),this}},{key:"isGloballyReadable",value:function(){return!0===this.entity._acl.gr&&this.entity._acl.gr}},{key:"isGloballyWritable",value:function(){return!0===this.entity._acl.gw&&this.entity._acl.gw}},{key:"removeReader",value:function(e){var t=this.readers,r=t.indexOf(e);return-1!==r&&t.splice(r,1),this.entity._acl.r=t,this}},{key:"removeReaderGroup",value:function(e){var t=this.readerGroups,r=t.indexOf(e);return-1!==r&&t.splice(r,1),this.entity._acl.groups=(0,a.default)({},this.entity._acl.groups,{r:t}),this}},{key:"removeWriter",value:function(e){var t=this.writers,r=t.indexOf(e);return-1!==r&&t.splice(r,1),this.entity._acl.w=t,this}},{key:"removeWriterGroup",value:function(e){var t=this.writerGroups,r=t.indexOf(e);return-1!==r&&t.splice(r,1),this.entity._acl.groups=(0,a.default)({},this.entity._acl.groups,{w:t}),this}},{key:"toPlainObject",value:function(){return this.entity._acl}},{key:"creator",get:function(){return this.entity._acl.creator}},{key:"readers",get:function(){return(0,u.default)(this.entity._acl.r)?this.entity._acl.r:[]}},{key:"writers",get:function(){return(0,u.default)(this.entity._acl.w)?this.entity._acl.w:[]}},{key:"readerGroups",get:function(){return(0,c.isDefined)(this.entity._acl.groups)&&(0,u.default)(this.entity._acl.groups.r)?this.entity._acl.groups.r:[]}},{key:"writerGroups",get:function(){return(0,c.isDefined)(this.entity._acl.groups)&&(0,u.default)(this.entity._acl.groups.w)?this.entity._acl.groups.w:[]}},{key:"globallyReadable",set:function(e){this.entity._acl.gr=!0===e&&e}},{key:"globallyWritable",set:function(e){this.entity._acl.gw=!0===e&&e}}]),e}()},function(e,t,r){"use strict";var n=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(r(128));e.exports=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(129);Object.keys(n).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return n[e]}})});r(81);var o=r(6),i=r(335),u=function(e){return e&&e.__esModule?e:{default:e}}(r(337));o.NetworkRack.useHttpMiddleware(new i.NodeHttpMiddleware(u.default))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(130);Object.defineProperty(t,"client",{enumerable:!0,get:function(){return n.client}}),Object.defineProperty(t,"getAppVersion",{enumerable:!0,get:function(){return n.getAppVersion}}),Object.defineProperty(t,"setAppVersion",{enumerable:!0,get:function(){return n.setAppVersion}}),Object.defineProperty(t,"init",{enumerable:!0,get:function(){return n.init}}),Object.defineProperty(t,"initialize",{enumerable:!0,get:function(){return n.initialize}}),Object.defineProperty(t,"ping",{enumerable:!0,get:function(){return n.ping}});var o=r(126);Object.defineProperty(t,"Acl",{enumerable:!0,get:function(){return o.Acl}});var i=r(23);Object.defineProperty(t,"Aggregation",{enumerable:!0,get:function(){return i.Aggregation}});var u=r(81);Object.defineProperty(t,"AuthorizationGrant",{enumerable:!0,get:function(){return u.AuthorizationGrant}});var a=r(333);Object.defineProperty(t,"CustomEndpoint",{enumerable:!0,get:function(){return a.CustomEndpoint}});var s=r(48);Object.defineProperty(t,"DataStore",{enumerable:!0,get:function(){return s.DataStore}}),Object.defineProperty(t,"DataStoreType",{enumerable:!0,get:function(){return s.DataStoreType}}),Object.defineProperty(t,"SyncOperation",{enumerable:!0,get:function(){return s.SyncOperation}});var c=r(80);Object.defineProperty(t,"LiveService",{enumerable:!0,get:function(){return c.LiveService}});var l=r(334);Object.defineProperty(t,"Files",{enumerable:!0,get:function(){return l.Files}});var f=r(21);Object.defineProperty(t,"Log",{enumerable:!0,get:function(){return f.Log}});var d=r(76);Object.defineProperty(t,"Metadata",{enumerable:!0,get:function(){return d.Metadata}});var h=r(9);Object.defineProperty(t,"Query",{enumerable:!0,get:function(){return h.Query}});var p=r(93);Object.defineProperty(t,"User",{enumerable:!0,get:function(){return p.User}});var y=r(1);Object.defineProperty(t,"ActiveUserError",{enumerable:!0,get:function(){return y.ActiveUserError}}),Object.defineProperty(t,"APIVersionNotAvailableError",{enumerable:!0,get:function(){return y.APIVersionNotAvailableError}}),Object.defineProperty(t,"APIVersionNotImplementedError",{enumerable:!0,get:function(){return y.APIVersionNotImplementedError}}),Object.defineProperty(t,"AppProblemError",{enumerable:!0,get:function(){return y.AppProblemError}}),Object.defineProperty(t,"BadRequestError",{enumerable:!0,get:function(){return y.BadRequestError}}),Object.defineProperty(t,"BLError",{enumerable:!0,get:function(){return y.BLError}}),Object.defineProperty(t,"CORSDisabledError",{enumerable:!0,get:function(){return y.CORSDisabledError}}),Object.defineProperty(t,"DuplicateEndUsersError",{enumerable:!0,get:function(){return y.DuplicateEndUsersError}}),Object.defineProperty(t,"FeatureUnavailableError",{enumerable:!0,get:function(){return y.FeatureUnavailableError}}),Object.defineProperty(t,"IncompleteRequestBodyError",{enumerable:!0,get:function(){return y.IncompleteRequestBodyError}}),Object.defineProperty(t,"IndirectCollectionAccessDisallowedError",{enumerable:!0,get:function(){return y.IndirectCollectionAccessDisallowedError}}),Object.defineProperty(t,"InsufficientCredentialsError",{enumerable:!0,get:function(){return y.InsufficientCredentialsError}}),Object.defineProperty(t,"InvalidCredentialsError",{enumerable:!0,get:function(){return y.InvalidCredentialsError}}),Object.defineProperty(t,"InvalidIdentifierError",{enumerable:!0,get:function(){return y.InvalidIdentifierError}}),Object.defineProperty(t,"InvalidQuerySyntaxError",{enumerable:!0,get:function(){return y.InvalidQuerySyntaxError}}),Object.defineProperty(t,"JSONParseError",{enumerable:!0,get:function(){return y.JSONParseError}}),Object.defineProperty(t,"KinveyError",{enumerable:!0,get:function(){return y.KinveyError}}),Object.defineProperty(t,"KinveyInternalErrorRetry",{enumerable:!0,get:function(){return y.KinveyInternalErrorRetry}}),Object.defineProperty(t,"KinveyInternalErrorStop",{enumerable:!0,get:function(){return y.KinveyInternalErrorStop}}),Object.defineProperty(t,"MissingQueryError",{enumerable:!0,get:function(){return y.MissingQueryError}}),Object.defineProperty(t,"MissingRequestHeaderError",{enumerable:!0,get:function(){return y.MissingRequestHeaderError}}),Object.defineProperty(t,"MissingRequestParameterError",{enumerable:!0,get:function(){return y.MissingRequestParameterError}}),Object.defineProperty(t,"MobileIdentityConnectError",{enumerable:!0,get:function(){return y.MobileIdentityConnectError}}),Object.defineProperty(t,"NoActiveUserError",{enumerable:!0,get:function(){return y.NoActiveUserError}}),Object.defineProperty(t,"NetworkConnectionError",{enumerable:!0,get:function(){return y.NetworkConnectionError}}),Object.defineProperty(t,"NoResponseError",{enumerable:!0,get:function(){return y.NoResponseError}}),Object.defineProperty(t,"NotFoundError",{enumerable:!0,get:function(){return y.NotFoundError}}),Object.defineProperty(t,"ParameterValueOutOfRangeError",{enumerable:!0,get:function(){return y.ParameterValueOutOfRangeError}}),Object.defineProperty(t,"PopupError",{enumerable:!0,get:function(){return y.PopupError}}),Object.defineProperty(t,"QueryError",{enumerable:!0,get:function(){return y.QueryError}}),Object.defineProperty(t,"ServerError",{enumerable:!0,get:function(){return y.ServerError}}),Object.defineProperty(t,"StaleRequestError",{enumerable:!0,get:function(){return y.StaleRequestError}}),Object.defineProperty(t,"SyncError",{enumerable:!0,get:function(){return y.SyncError}}),Object.defineProperty(t,"TimeoutError",{enumerable:!0,get:function(){return y.TimeoutError}}),Object.defineProperty(t,"UserAlreadyExistsError",{enumerable:!0,get:function(){return y.UserAlreadyExistsError}}),Object.defineProperty(t,"WritesToCollectionDisallowedError",{enumerable:!0,get:function(){return y.WritesToCollectionDisallowedError}})},function(e,t,r){"use strict";function n(){return s.Client.sharedInstance()}function o(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!1===(0,a.isDefined)(e.appKey))throw new u.KinveyError("No App Key was provided. Unable to create a new Client without an App Key.");if(!1===(0,a.isDefined)(e.appSecret)&&!1===(0,a.isDefined)(e.masterSecret))throw new u.KinveyError("No App Secret or Master Secret was provided. Unable to create a new Client without an App Secret.");return s.Client.init(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.client=void 0,t.getAppVersion=function(){var e=n();if(e)return e.appVersion},t.setAppVersion=function(e){var t=n();t&&(t.appVersion=e)},t.init=o,t.initialize=function(e){try{var t=o(e);return i.default.resolve(c.User.getActiveUser(t))}catch(e){return i.default.reject(e)}},t.ping=function(){var e=n();return new l.KinveyRequest({method:l.RequestMethod.GET,authType:l.AuthType.All,url:e.apiHostname+"/appdata/"+e.appKey}).execute().then(function(e){return e.data})};var i=function(e){return e&&e.__esModule?e:{default:e}}(r(4)),u=r(1),a=r(2),s=r(8),c=r(93),l=r(6);t.client=n},function(e,t,r){"use strict";function n(e,t,r,n){this.name="ActiveUserError",this.message=e||"An active user already exists.",this.debug=t||void 0,this.code=r||void 0,this.kinveyRequestId=n||void 0,this.stack=(new Error).stack}Object.defineProperty(t,"__esModule",{value:!0}),t.ActiveUserError=n;var o=r(0);(n.prototype=Object.create(o.BaseError.prototype)).constructor=n},function(e,t,r){"use strict";function n(e,t,r,n){this.name="APIVersionNotAvailableError",this.message=e||"This API version is not available for your app.",this.debug=t||void 0,this.code=r||void 0,this.kinveyRequestId=n||void 0,this.stack=(new Error).stack}Object.defineProperty(t,"__esModule",{value:!0}),t.APIVersionNotAvailableError=n;var o=r(0);(n.prototype=Object.create(o.BaseError.prototype)).constructor=n},function(e,t,r){"use strict";function n(e,t,r,n){this.name="APIVersionNotImplementedError",this.message=e||"This API version is not implemented.",this.debug=t||void 0,this.code=r||void 0,this.kinveyRequestId=n||void 0,this.stack=(new Error).stack}Object.defineProperty(t,"__esModule",{value:!0}),t.APIVersionNotImplementedError=n;var o=r(0);(n.prototype=Object.create(o.BaseError.prototype)).constructor=n},function(e,t,r){"use strict";function n(e,t,r,n){this.name="AppProblemError",this.message=e||"There is a problem with this app backend that prevents execution of this operation. Please contact support@kinvey.com for assistance.",this.debug=t||void 0,this.code=r||void 0,this.kinveyRequestId=n||void 0,this.stack=(new Error).stack}Object.defineProperty(t,"__esModule",{value:!0}),t.AppProblemError=n;var o=r(0);(n.prototype=Object.create(o.BaseError.prototype)).constructor=n},function(e,t,r){"use strict";function n(e,t,r,n){this.name="BadRequestError",this.message=e||"Unable to understand request.",this.debug=t||void 0,this.code=r||void 0,this.kinveyRequestId=n||void 0,this.stack=(new Error).stack}Object.defineProperty(t,"__esModule",{value:!0}),t.BadRequestError=n;var o=r(0);(n.prototype=Object.create(o.BaseError.prototype)).constructor=n},function(e,t,r){"use strict";function n(e,t,r,n){this.name="BLError",this.message=e||"The Business Logic script did not complete.",this.debug=t||void 0,this.code=r||void 0,this.kinveyRequestId=n||void 0,this.stack=(new Error).stack}Object.defineProperty(t,"__esModule",{value:!0}),t.BLError=n;var o=r(0);(n.prototype=Object.create(o.BaseError.prototype)).constructor=n},function(e,t,r){"use strict";function n(e,t,r,n){this.name="CORSDisabledError",this.message=e||"Cross Origin Support is disabled for this application.",this.debug=t||void 0,this.code=r||void 0,this.kinveyRequestId=n||void 0,this.stack=(new Error).stack}Object.defineProperty(t,"__esModule",{value:!0}),t.CORSDisabledError=n;var o=r(0);(n.prototype=Object.create(o.BaseError.prototype)).constructor=n},function(e,t,r){"use strict";function n(e,t,r,n){this.name="DuplicateEndUsersError",this.message=e||"More than one user registered with this username for this application.",this.debug=t||void 0,this.code=r||void 0,this.kinveyRequestId=n||void 0,this.stack=(new Error).stack}Object.defineProperty(t,"__esModule",{value:!0}),t.DuplicateEndUsersError=n;var o=r(0);(n.prototype=Object.create(o.BaseError.prototype)).constructor=n},function(e,t,r){"use strict";function n(e,t,r,n){this.name="FeatureUnavailableError",this.message=e||"Requested functionality is unavailable in this API version.",this.debug=t||void 0,this.code=r||void 0,this.kinveyRequestId=n||void 0,this.stack=(new Error).stack}Object.defineProperty(t,"__esModule",{value:!0}),t.FeatureUnavailableError=n;var o=r(0);(n.prototype=Object.create(o.BaseError.prototype)).constructor=n},function(e,t,r){"use strict";function n(e,t,r,n){this.name="IncompleteRequestBodyError",this.message=e||"The request body is either missing or incomplete.",this.debug=t||void 0,this.code=r||void 0,this.kinveyRequestId=n||void 0,this.stack=(new Error).stack}Object.defineProperty(t,"__esModule",{value:!0}),t.IncompleteRequestBodyError=n;var o=r(0);(n.prototype=Object.create(o.BaseError.prototype)).constructor=n},function(e,t,r){"use strict";function n(e,t,r,n){this.name="IndirectCollectionAccessDisallowedError",this.message=e||"Please use the appropriate API to access this collection for this app backend.",this.debug=t||void 0,this.code=r||void 0,this.kinveyRequestId=n||void 0,this.stack=(new Error).stack}Object.defineProperty(t,"__esModule",{value:!0}),t.IndirectCollectionAccessDisallowedError=n;var o=r(0);(n.prototype=Object.create(o.BaseError.prototype)).constructor=n},function(e,t,r){"use strict";function n(e,t,r,n){this.name="InsufficientCredentialsError",this.message=e||"The credentials used to authenticate this request are not authorized to run this operation. Please retry your request with appropriate credentials.",this.debug=t||void 0,this.code=r||void 0,this.kinveyRequestId=n||void 0,this.stack=(new Error).stack}Object.defineProperty(t,"__esModule",{value:!0}),t.InsufficientCredentialsError=n;var o=r(0);(n.prototype=Object.create(o.BaseError.prototype)).constructor=n},function(e,t,r){"use strict";function n(e,t,r,n){this.name="InvalidCredentialsError",this.message=e||"Invalid credentials. Please retry your request with correct credentials.",this.debug=t||void 0,this.code=r||void 0,this.kinveyRequestId=n||void 0,this.stack=(new Error).stack}Object.defineProperty(t,"__esModule",{value:!0}),t.InvalidCredentialsError=n;var o=r(0);(n.prototype=Object.create(o.BaseError.prototype)).constructor=n},function(e,t,r){"use strict";function n(e,t,r,n){this.name="InvalidIdentifierError",this.message=e||"One of more identifier names in the request has an invalid format.",this.debug=t||void 0,this.code=r||void 0,this.kinveyRequestId=n||void 0,this.stack=(new Error).stack}Object.defineProperty(t,"__esModule",{value:!0}),t.InvalidIdentifierError=n;var o=r(0);(n.prototype=Object.create(o.BaseError.prototype)).constructor=n},function(e,t,r){"use strict";function n(e,t,r,n){this.name="InvalidQuerySyntaxError",this.message=e||"The query string in the request has an invalid syntax.",this.debug=t||void 0,this.code=r||void 0,this.kinveyRequestId=n||void 0,this.stack=(new Error).stack}Object.defineProperty(t,"__esModule",{value:!0}),t.InvalidQuerySyntaxError=n;var o=r(0);(n.prototype=Object.create(o.BaseError.prototype)).constructor=n},function(e,t,r){"use strict";function n(e,t,r,n){this.name="JSONParseError",this.message=e||"Unable to parse the JSON in the request.",this.debug=t||void 0,this.code=r||void 0,this.kinveyRequestId=n||void 0,this.stack=(new Error).stack}Object.defineProperty(t,"__esModule",{value:!0}),t.JSONParseError=n;var o=r(0);(n.prototype=Object.create(o.BaseError.prototype)).constructor=n},function(e,t,r){"use strict";function n(e,t,r,n){this.name="KinveyInternalErrorRetry",this.message=e||"The Kinvey server encountered an unexpected error. Please retry your request.",this.debug=t||void 0,this.code=r||void 0,this.kinveyRequestId=n||void 0,this.stack=(new Error).stack}Object.defineProperty(t,"__esModule",{value:!0}),t.KinveyInternalErrorRetry=n;var o=r(0);(n.prototype=Object.create(o.BaseError.prototype)).constructor=n},function(e,t,r){"use strict";function n(e,t,r,n){this.name="KinveyInternalErrorStop",this.message=e||"The Kinvey server encountered an unexpected error. Please contact support@kinvey.com for assistance.",this.debug=t||void 0,this.code=r||void 0,this.kinveyRequestId=n||void 0,this.stack=(new Error).stack}Object.defineProperty(t,"__esModule",{value:!0}),t.KinveyInternalErrorStop=n;var o=r(0);(n.prototype=Object.create(o.BaseError.prototype)).constructor=n},function(e,t,r){"use strict";function n(e,t,r,n){this.name="KinveyError",this.message=e||"An error occurred.",this.debug=t||void 0,this.code=r||void 0,this.kinveyRequestId=n||void 0,this.stack=(new Error).stack}Object.defineProperty(t,"__esModule",{value:!0}),t.KinveyError=n;var o=r(0);(n.prototype=Object.create(o.BaseError.prototype)).constructor=n},function(e,t,r){"use strict";function n(e,t,r,n){this.name="MissingQueryError",this.message=e||"The request is missing a query string.",this.debug=t||void 0,this.code=r||void 0,this.kinveyRequestId=n||void 0,this.stack=(new Error).stack}Object.defineProperty(t,"__esModule",{value:!0}),t.MissingQueryError=n;var o=r(0);(n.prototype=Object.create(o.BaseError.prototype)).constructor=n},function(e,t,r){"use strict";function n(e,t,r,n){this.name="MissingRequestHeaderError",this.message=e||"The request is missing a required header.",this.debug=t||void 0,this.code=r||void 0,this.kinveyRequestId=n||void 0,this.stack=(new Error).stack}Object.defineProperty(t,"__esModule",{value:!0}),t.MissingRequestHeaderError=n;var o=r(0);(n.prototype=Object.create(o.BaseError.prototype)).constructor=n},function(e,t,r){"use strict";function n(e,t,r,n){this.name="MissingRequestParameterError",this.message=e||"A required parameter is missing from the request.",this.debug=t||void 0,this.code=r||void 0,this.kinveyRequestId=n||void 0,this.stack=(new Error).stack}Object.defineProperty(t,"__esModule",{value:!0}),t.MissingRequestParameterError=n;var o=r(0);(n.prototype=Object.create(o.BaseError.prototype)).constructor=n},function(e,t,r){"use strict";function n(e,t,r,n){this.name="MobileIdentityConnectError",this.message=e||"An error has occurred with Mobile Identity Connect.",this.debug=t||void 0,this.code=r||void 0,this.kinveyRequestId=n||void 0,this.stack=(new Error).stack}Object.defineProperty(t,"__esModule",{value:!0}),t.MobileIdentityConnectError=n;var o=r(0);(n.prototype=Object.create(o.BaseError.prototype)).constructor=n},function(e,t,r){"use strict";function n(e,t,r,n){this.name="NetworkConnectionError",this.message=e||"There was an error connecting to the network.",this.debug=t||void 0,this.code=r||void 0,this.kinveyRequestId=n||void 0,this.stack=(new Error).stack}Object.defineProperty(t,"__esModule",{value:!0}),t.NetworkConnectionError=n;var o=r(0);(n.prototype=Object.create(o.BaseError.prototype)).constructor=n},function(e,t,r){"use strict";function n(e,t,r,n){this.name="NoActiveUserError",this.message=e||"There is not an active user.",this.debug=t||void 0,this.code=r||void 0,this.kinveyRequestId=n||void 0,this.stack=(new Error).stack}Object.defineProperty(t,"__esModule",{value:!0}),t.NoActiveUserError=n;var o=r(0);(n.prototype=Object.create(o.BaseError.prototype)).constructor=n},function(e,t,r){"use strict";function n(e,t,r,n){this.name="NoResponseError",this.message=e||"No response was provided.",this.debug=t||void 0,this.code=r||void 0,this.kinveyRequestId=n||void 0,this.stack=(new Error).stack}Object.defineProperty(t,"__esModule",{value:!0}),t.NoResponseError=n;var o=r(0);(n.prototype=Object.create(o.BaseError.prototype)).constructor=n},function(e,t,r){"use strict";function n(e,t,r,n){this.name="NotFoundError",this.message=e||"The entity was not found.",this.debug=t||void 0,this.code=r||404,this.kinveyRequestId=n||void 0,this.stack=(new Error).stack}Object.defineProperty(t,"__esModule",{value:!0}),t.NotFoundError=n;var o=r(0);(n.prototype=Object.create(o.BaseError.prototype)).constructor=n},function(e,t,r){"use strict";function n(e,t,r,n){this.name="ParameterValueOutOfRangeError",this.message=e||"The value specified for one of the request parameters is out of range.",this.debug=t||void 0,this.code=r||void 0,this.kinveyRequestId=n||void 0,this.stack=(new Error).stack}Object.defineProperty(t,"__esModule",{value:!0}),t.ParameterValueOutOfRangeError=n;var o=r(0);(n.prototype=Object.create(o.BaseError.prototype)).constructor=n},function(e,t,r){"use strict";function n(e,t,r,n){this.name="PopupError",this.message=e||"Unable to open a popup on this platform.",this.debug=t||void 0,this.code=r||void 0,this.kinveyRequestId=n||void 0,this.stack=(new Error).stack}Object.defineProperty(t,"__esModule",{value:!0}),t.PopupError=n;var o=r(0);(n.prototype=Object.create(o.BaseError.prototype)).constructor=n},function(e,t,r){"use strict";function n(e,t,r,n){this.name="QueryError",this.message=e||"An error occurred with the query.",this.debug=t||void 0,this.code=r||void 0,this.kinveyRequestId=n||void 0,this.stack=(new Error).stack}Object.defineProperty(t,"__esModule",{value:!0}),t.QueryError=n;var o=r(0);(n.prototype=Object.create(o.BaseError.prototype)).constructor=n},function(e,t,r){"use strict";function n(e,t,r,n){this.name="ServerError",this.message=e||"An error occurred on the server.",this.debug=t||void 0,this.code=r||500,this.kinveyRequestId=n||void 0,this.stack=(new Error).stack}Object.defineProperty(t,"__esModule",{value:!0}),t.ServerError=n;var o=r(0);(n.prototype=Object.create(o.BaseError.prototype)).constructor=n},function(e,t,r){"use strict";function n(e,t,r,n){this.name="StaleRequestError",this.message=e||"The time window for this request has expired.",this.debug=t||void 0,this.code=r||void 0,this.kinveyRequestId=n||void 0,this.stack=(new Error).stack}Object.defineProperty(t,"__esModule",{value:!0}),t.StaleRequestError=n;var o=r(0);(n.prototype=Object.create(o.BaseError.prototype)).constructor=n},function(e,t,r){"use strict";function n(e,t,r,n){this.name="SyncError",this.message=e||"An error occurred during sync.",this.debug=t||void 0,this.code=r||void 0,this.kinveyRequestId=n||void 0,this.stack=(new Error).stack}Object.defineProperty(t,"__esModule",{value:!0}),t.SyncError=n;var o=r(0);(n.prototype=Object.create(o.BaseError.prototype)).constructor=n},function(e,t,r){"use strict";function n(e,t,r,n){this.name="TimeoutError",this.message=e||"The request timed out.",this.debug=t||void 0,this.code=r||void 0,this.kinveyRequestId=n||void 0,this.stack=(new Error).stack}Object.defineProperty(t,"__esModule",{value:!0}),t.TimeoutError=n;var o=r(0);(n.prototype=Object.create(o.BaseError.prototype)).constructor=n},function(e,t,r){"use strict";function n(e,t,r,n){this.name="UserAlreadyExistsError",this.message=e||"This username is already taken. Please retry your request with a different username.",this.debug=t||void 0,this.code=r||void 0,this.kinveyRequestId=n||void 0,this.stack=(new Error).stack}Object.defineProperty(t,"__esModule",{value:!0}),t.UserAlreadyExistsError=n;var o=r(0);(n.prototype=Object.create(o.BaseError.prototype)).constructor=n},function(e,t,r){"use strict";function n(e,t,r,n){this.name="WritesToCollectionDisallowedError",this.message=e||"This collection is configured to disallow any modifications to an existing entity or creation of new entities.",this.debug=t||void 0,this.code=r||void 0,this.kinveyRequestId=n||void 0,this.stack=(new Error).stack}Object.defineProperty(t,"__esModule",{value:!0}),t.WritesToCollectionDisallowedError=n;var o=r(0);(n.prototype=Object.create(o.BaseError.prototype)).constructor=n},function(e,t){e.exports=function(e){return null===e}},function(e,t){e.exports=function(e){return void 0===e}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.randomString=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:18;return""+(arguments.length>1&&void 0!==arguments[1]?arguments[1]:"")+function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,t="",r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=0;n<e;n+=1)t+=r.charAt(Math.floor(Math.random()*r.length));return t}(e)},t.isNonemptyString=function(e){return"string"==typeof e&&""!==e},t.uuidv4=function(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return""+e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function o(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments[2],n=[],i=!1;return(0,s.default)(e)&&(0,d.isDefined)(r)&&(i=!0),Object.keys(e).forEach(function(u){var a=void 0,s=e[u],l=r?r+"["+(i?"":u)+"]":u;if(!1===(0,d.isDefined)(s)){if(!0===t.removeNull)return;a=!0===t.encodeComponents?encodeURIComponent(l):l}else a=(0,c.default)(s)?o(s,t,l):t.encodeComponents?encodeURIComponent(l)+"="+encodeURIComponent(s):l+"="+s;n.push(a)}),n.join("&")}Object.defineProperty(t,"__esModule",{value:!0}),t.appendQuery=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=i.default.parse(e,!0),s=(0,l.default)(t)?u.default.parse(t):t,c=(0,a.default)({},n.query,s);r=(0,a.default)({encodeComponents:!0,removeNull:!1},r),n.query=null;var h=o(c,r);return n.search=(0,d.isDefined)(h)&&!1===(0,f.default)(h)?"?"+h:null,i.default.format(n)};var i=n(r(7)),u=n(r(50)),a=n(r(12)),s=n(r(3)),c=n(r(27)),l=n(r(5)),f=n(r(36)),d=r(82)},function(e,t,r){var n=r(15),o=r(174),i=r(11),u=r(85),a=/^\[object .+?Constructor\]$/,s=Function.prototype,c=Object.prototype,l=s.toString,f=c.hasOwnProperty,d=RegExp("^"+l.call(f).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");e.exports=function(e){return!(!i(e)||o(e))&&(n(e)?d:a).test(u(e))}},function(e,t,r){var n=r(22),o=Object.prototype,i=o.hasOwnProperty,u=o.toString,a=n?n.toStringTag:void 0;e.exports=function(e){var t=i.call(e,a),r=e[a];try{e[a]=void 0;var n=!0}catch(e){}var o=u.call(e);return n&&(t?e[a]=r:delete e[a]),o}},function(e,t){var r=Object.prototype.toString;e.exports=function(e){return r.call(e)}},function(e,t,r){var n=r(175),o=function(){var e=/[^.]+$/.exec(n&&n.keys&&n.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}();e.exports=function(e){return!!o&&o in e}},function(e,t,r){var n=r(10)["__core-js_shared__"];e.exports=n},function(e,t){e.exports=function(e,t){return null==e?void 0:e[t]}},function(e,t,r){var n=r(86),o=Math.max;e.exports=function(e,t,r){return t=o(void 0===t?e.length-1:t,0),function(){for(var i=arguments,u=-1,a=o(i.length-t,0),s=Array(a);++u<a;)s[u]=i[t+u];u=-1;for(var c=Array(t+1);++u<t;)c[u]=i[u];return c[t]=r(s),n(e,this,c)}}},function(e,t,r){var n=r(179),o=r(181)(n);e.exports=o},function(e,t,r){var n=r(180),o=r(83),i=r(32),u=o?function(e,t){return o(e,"toString",{configurable:!0,enumerable:!1,value:n(t),writable:!0})}:i;e.exports=u},function(e,t){e.exports=function(e){return function(){return e}}},function(e,t){var r=800,n=16,o=Date.now;e.exports=function(e){var t=0,i=0;return function(){var u=o(),a=n-(u-i);if(i=u,a>0){if(++t>=r)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}},function(e,t){e.exports=function(e,t){for(var r=-1,n=Array(e);++r<e;)n[r]=t(r);return n}},function(e,t,r){var n=r(16),o=r(14),i="[object Arguments]";e.exports=function(e){return o(e)&&n(e)==i}},function(e,t){e.exports=function(){return!1}},function(e,t,r){var n=r(16),o=r(55),i=r(14),u={};u["[object Float32Array]"]=u["[object Float64Array]"]=u["[object Int8Array]"]=u["[object Int16Array]"]=u["[object Int32Array]"]=u["[object Uint8Array]"]=u["[object Uint8ClampedArray]"]=u["[object Uint16Array]"]=u["[object Uint32Array]"]=!0,u["[object Arguments]"]=u["[object Array]"]=u["[object ArrayBuffer]"]=u["[object Boolean]"]=u["[object DataView]"]=u["[object Date]"]=u["[object Error]"]=u["[object Function]"]=u["[object Map]"]=u["[object Number]"]=u["[object Object]"]=u["[object RegExp]"]=u["[object Set]"]=u["[object String]"]=u["[object WeakMap]"]=!1,e.exports=function(e){return i(e)&&o(e.length)&&!!u[n(e)]}},function(e,t,r){(function(e){var n=r(84),o="object"==typeof t&&t&&!t.nodeType&&t,i=o&&"object"==typeof e&&e&&!e.nodeType&&e,u=i&&i.exports===o&&n.process,a=function(){try{return u&&u.binding&&u.binding("util")}catch(e){}}();e.exports=a}).call(t,r(56)(e))},function(e,t,r){var n=r(91)(Object.keys,Object);e.exports=n},function(e,t,r){var n=r(19)(r(10),"DataView");e.exports=n},function(e,t,r){var n=r(19)(r(10),"Promise");e.exports=n},function(e,t,r){var n=r(19)(r(10),"Set");e.exports=n},function(e,t,r){var n=r(19)(r(10),"WeakMap");e.exports=n},function(e,t){e.exports=n},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.User=void 0;var o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=n(r(4)),u=n(r(12)),a=n(r(5)),s=n(r(11)),c=n(r(36)),l=n(r(7)),f=r(8),d=r(6),h=r(1),p=r(48),y=r(81),v=r(21),b=r(2),m=r(126),g=r(76),_=r(80),w=r(332);t.User=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.data=t,this.client=r.client||f.Client.sharedInstance()}return o(e,[{key:"isActive",value:function(){var t=e.getActiveUser(this.client);return!(!(0,b.isDefined)(t)||t._id!==this._id)}},{key:"isEmailVerified",value:function(){return"confirmed"===this.metadata.emailVerification}},{key:"login",value:function(t,r){var n=this,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=t,c=this.isActive(),f=e.getActiveUser(this.client);if(!0===c)return i.default.reject(new h.ActiveUserError("This user is already the active user."));if((0,b.isDefined)(f))return i.default.reject(new h.ActiveUserError("An active user already exists. Please logout the active user before you login."));if((0,s.default)(a)?o=r||{}:a={username:t,password:r},(0,b.isDefined)(a.username)&&(a.username=String(a.username).trim()),(0,b.isDefined)(a.password)&&(a.password=String(a.password).trim()),!((0,b.isDefined)(a.username)&&""!==a.username&&(0,b.isDefined)(a.password)&&""!==a.password||(0,b.isDefined)(a._socialIdentity)))return i.default.reject(new h.KinveyError("Username and/or password missing. Please provide both a username and password to login."));return new d.KinveyRequest({method:d.RequestMethod.POST,authType:d.AuthType.App,url:l.default.format({protocol:this.client.apiProtocol,host:this.client.apiHost,pathname:this.pathname+"/login"}),body:a,properties:o.properties,timeout:o.timeout,client:this.client}).execute().then(function(e){return e.data}).then(function(e){if((0,b.isDefined)(a._socialIdentity)&&(0,b.isDefined)(e._socialIdentity)){Object.keys(e._socialIdentity).forEach(function(t){e._socialIdentity[t]=(0,u.default)({},a._socialIdentity[t],e._socialIdentity[t])}),e._socialIdentity=(0,u.default)({},a._socialIdentity,e._socialIdentity)}return delete e.password,n.client.setActiveUser(e)}).then(function(e){return n.data=e,n})}},{key:"loginWithMIC",value:function(t,r){var n=this,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},u=this.isActive(),a=e.getActiveUser(this.client);if(u)return i.default.reject(new h.ActiveUserError("This user is already the active user."));if((0,b.isDefined)(a))return i.default.reject(new h.ActiveUserError("An active user already exists. Please logout the active user before you login."));return new y.MobileIdentityConnect({client:this.client}).login(t,r,o).then(function(e){return n.connectIdentity(y.MobileIdentityConnect.identity,e,o)})}},{key:"connectIdentity",value:function(e,t){var r=this,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=this.isActive(),i={},u=i._socialIdentity||{};return u[e]=t,i._socialIdentity=u,o?this.update(i,n):this.login(i,n).catch(function(o){if(o instanceof h.NotFoundError)return r.signup(i,n).then(function(){return r.connectIdentity(e,t,n)});throw o})}},{key:"disconnectIdentity",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=i.default.resolve();return e===y.MobileIdentityConnect.identity&&(n=y.MobileIdentityConnect.logout(this,r)),n.catch(function(e){v.Log.error(e)}).then(function(){var n=t.data,o=n._socialIdentity||{};return delete o[e],n._socialIdentity=o,t.data=n,t._id?t.update(n,r):t}).then(function(){return t})}},{key:"logout",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=new d.KinveyRequest({method:d.RequestMethod.POST,authType:d.AuthType.Session,url:l.default.format({protocol:this.client.apiProtocol,host:this.client.apiHost,pathname:this.pathname+"/_logout"}),properties:t.properties,timeout:t.timeout,client:this.client});return this.unregisterFromLiveService().then(function(){return r.execute()}).catch(function(e){return v.Log.error(e),null}).then(function(){return e.client.setActiveUser(null)}).catch(function(e){return v.Log.error(e),null}).then(function(){return p.DataStore.clearCache({client:e.client})}).catch(function(e){return v.Log.error(e),null}).then(function(){return e})}},{key:"signup",value:function(t){var r=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=e.getActiveUser(this.client);if(!0===(n=(0,u.default)({state:!0},n)).state&&(0,b.isDefined)(o))throw new h.ActiveUserError("An active user already exists. Please logout the active user before you login.");t instanceof e&&(t=t.data),t=(0,u.default)(this.data,t);return new d.KinveyRequest({method:d.RequestMethod.POST,authType:d.AuthType.App,url:l.default.format({protocol:this.client.apiProtocol,host:this.client.apiHost,pathname:this.pathname}),body:(0,c.default)(t)?null:t,properties:n.properties,timeout:n.timeout,client:this.client}).execute().then(function(e){return e.data}).then(function(e){return!0===n.state?r.client.setActiveUser(e):e}).then(function(e){return r.data=e,r})}},{key:"signupWithIdentity",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n={};return n._socialIdentity={},n._socialIdentity[e]=t,this.signup(n,r)}},{key:"update",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};e=(0,u.default)(this.data,e);return(new w.UserStore).update(e,r).then(function(e){return t.isActive()?t.client.setActiveUser(e):e}).then(function(e){return t.data=e,t})}},{key:"me",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new d.KinveyRequest({method:d.RequestMethod.GET,authType:d.AuthType.Session,url:l.default.format({protocol:this.client.apiProtocol,host:this.client.apiHost,pathname:this.pathname+"/_me"}),properties:t.properties,timeout:t.timeout}).execute().then(function(e){return e.data}).then(function(t){return t=(0,u.default)(e.data,t),delete t.password,e.isActive()?e.client.setActiveUser(t):t}).then(function(t){return e.data=t,e})}},{key:"registerForLiveService",value:function(){var e=(0,_.getLiveService)(this.client),t=i.default.resolve();return e.isInitialized()||(t=e.fullInitialization(this)),t}},{key:"unregisterFromLiveService",value:function(){var e=(0,_.getLiveService)(this.client),t=i.default.resolve();return e.isInitialized()&&(t=e.fullUninitialization()),t}},{key:"_id",get:function(){return this.data._id}},{key:"_acl",get:function(){return new m.Acl(this.data)}},{key:"metadata",get:function(){return new g.Metadata(this.data)}},{key:"_kmd",get:function(){return this.metadata}},{key:"_socialIdentity",get:function(){return this.data._socialIdentity}},{key:"authtoken",get:function(){return this.metadata.authtoken}},{key:"username",get:function(){return this.data.username}},{key:"email",get:function(){return this.data.email}},{key:"pathname",get:function(){return"/user/"+this.client.appKey}}],[{key:"login",value:function(t,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return new e({},n).login(t,r,n)}},{key:"loginWithMIC",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return new this({},r).loginWithMIC(e,t,r)}},{key:"connectIdentity",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return new this({},r).connectIdentity(e,t,r)}},{key:"logout",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=e.getActiveUser(t.client);return(0,b.isDefined)(r)?r.logout(t):i.default.resolve(null)}},{key:"signup",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new this({},t).signup(e,t)}},{key:"signupWithIdentity",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return new this({},r).signupWithIdentity(e,t,r)}},{key:"update",value:function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.getActiveUser(r.client);return(0,b.isDefined)(n)?n.update(t,r):i.default.resolve(null)}},{key:"registerForLiveService",value:function(){var t=e.getActiveUser();return t?t.registerForLiveService():i.default.reject(new h.ActiveUserError("There is no active user"))}},{key:"unregisterFromLiveService",value:function(){var t=e.getActiveUser();return t?t.unregisterFromLiveService():i.default.reject(new h.ActiveUserError("There is no active user"))}},{key:"me",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=e.getActiveUser(t.client);return r?r.me(t):i.default.resolve(null)}},{key:"getActiveUser",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:f.Client.sharedInstance(),t=e.getActiveUser();return(0,b.isDefined)(t)?new this(t,{client:e}):null}},{key:"verifyEmail",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!e)return i.default.reject(new h.KinveyError("A username was not provided.","Please provide a username for the user that you would like to verify their email."));if(!(0,a.default)(e))return i.default.reject(new h.KinveyError("The provided username is not a string."));var r=t.client||f.Client.sharedInstance();return new d.KinveyRequest({method:d.RequestMethod.POST,authType:d.AuthType.App,url:l.default.format({protocol:r.apiProtocol,host:r.apiHost,pathname:"/rpc/"+r.appKey+"/"+e+"/user-email-verification-initiate"}),properties:t.properties,timeout:t.timeout,client:r}).execute().then(function(e){return e.data})}},{key:"forgotUsername",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!e)return i.default.reject(new h.KinveyError("An email was not provided.","Please provide an email for the user that you would like to retrieve their username."));if(!(0,a.default)(e))return i.default.reject(new h.KinveyError("The provided email is not a string."));var r=t.client||f.Client.sharedInstance();return new d.KinveyRequest({method:d.RequestMethod.POST,authType:d.AuthType.App,url:l.default.format({protocol:r.apiProtocol,host:r.apiHost,pathname:"/rpc/"+r.appKey+"/user-forgot-username"}),properties:t.properties,data:{email:e},timeout:t.timeout,client:r}).execute().then(function(e){return e.data})}},{key:"resetPassword",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!e)return i.default.reject(new h.KinveyError("A username was not provided.","Please provide a username for the user that you would like to verify their email."));if(!(0,a.default)(e))return i.default.reject(new h.KinveyError("The provided username is not a string."));var r=t.client||f.Client.sharedInstance();return new d.KinveyRequest({method:d.RequestMethod.POST,authType:d.AuthType.App,url:l.default.format({protocol:r.apiProtocol,host:r.apiHost,pathname:"/rpc/"+r.appKey+"/"+e+"/user-password-reset-initiate"}),properties:t.properties,timeout:t.timeout,client:r}).execute().then(function(e){return e.data})}},{key:"lookup",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(new w.UserStore).lookup(e,t)}},{key:"exists",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(new w.UserStore).exists(e,t)}},{key:"remove",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(new w.UserStore).removeById(e,t)}},{key:"restore",value:function(){return i.default.reject(new h.KinveyError("This function requires a master secret to be provided for your application. We strongly advise not to do this."))}}]),e}()},function(e,t,r){function n(e,t,r,T,A,R){var C,I=t&k,K=t&j,D=t&E;if(r&&(C=A?r(e,T,A,R):r(e)),void 0!==C)return C;if(!w(e))return e;var U=g(e);if(U){if(C=v(e),!I)return l(e,C)}else{var L=y(e),N=L==x||L==S;if(_(e))return c(e,I);if(L==q||L==P||N&&!A){if(C=K||N?{}:m(e),!I)return K?d(e,s(C,e)):f(e,a(C,e))}else{if(!M[L])return A?e:{};C=b(e,L,n,I)}}R||(R=new o);var F=R.get(e);if(F)return F;R.set(e,C);var H=D?K?p:h:K?keysIn:O,B=U?void 0:H(e);return i(B||e,function(o,i){B&&(o=e[i=o]),u(C,i,n(o,t,r,i,e,R))}),C}var o=r(62),i=r(96),u=r(51),a=r(217),s=r(218),c=r(221),l=r(222),f=r(223),d=r(225),h=r(99),p=r(226),y=r(59),v=r(227),b=r(228),m=r(237),g=r(3),_=r(35),w=r(11),O=r(17),k=1,j=2,E=4,P="[object Arguments]",x="[object Function]",S="[object GeneratorFunction]",q="[object Object]",M={};M[P]=M["[object Array]"]=M["[object ArrayBuffer]"]=M["[object DataView]"]=M["[object Boolean]"]=M["[object Date]"]=M["[object Float32Array]"]=M["[object Float64Array]"]=M["[object Int8Array]"]=M["[object Int16Array]"]=M["[object Int32Array]"]=M["[object Map]"]=M["[object Number]"]=M[q]=M["[object RegExp]"]=M["[object Set]"]=M["[object String]"]=M["[object Symbol]"]=M["[object Uint8Array]"]=M["[object Uint8ClampedArray]"]=M["[object Uint16Array]"]=M["[object Uint32Array]"]=!0,M["[object Error]"]=M[x]=M["[object WeakMap]"]=!1,e.exports=n},function(e,t){e.exports=function(){this.__data__=[],this.size=0}},function(e,t,r){var n=r(38),o=Array.prototype.splice;e.exports=function(e){var t=this.__data__,r=n(t,e);return!(r<0||(r==t.length-1?t.pop():o.call(t,r,1),--this.size,0))}},function(e,t,r){var n=r(38);e.exports=function(e){var t=this.__data__,r=n(t,e);return r<0?void 0:t[r][1]}},function(e,t,r){var n=r(38);e.exports=function(e){return n(this.__data__,e)>-1}},function(e,t,r){var n=r(38);e.exports=function(e,t){var r=this.__data__,o=n(r,e);return o<0?(++this.size,r.push([e,t])):r[o][1]=t,this}},function(e,t,r){var n=r(37);e.exports=function(){this.__data__=new n,this.size=0}},function(e,t){e.exports=function(e){var t=this.__data__,r=t.delete(e);return this.size=t.size,r}},function(e,t){e.exports=function(e){return this.__data__.get(e)}},function(e,t){e.exports=function(e){return this.__data__.has(e)}},function(e,t,r){var n=r(37),o=r(60),i=r(63),u=200;e.exports=function(e,t){var r=this.__data__;if(r instanceof n){var a=r.__data__;if(!o||a.length<u-1)return a.push([e,t]),this.size=++r.size,this;r=this.__data__=new i(a)}return r.set(e,t),this.size=r.size,this}},function(e,t,r){var n=r(206),o=r(37),i=r(60);e.exports=function(){this.size=0,this.__data__={hash:new n,map:new(i||o),string:new n}}},function(e,t,r){function n(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}var o=r(207),i=r(208),u=r(209),a=r(210),s=r(211);n.prototype.clear=o,n.prototype.delete=i,n.prototype.get=u,n.prototype.has=a,n.prototype.set=s,e.exports=n},function(e,t,r){var n=r(39);e.exports=function(){this.__data__=n?n(null):{},this.size=0}},function(e,t){e.exports=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}},function(e,t,r){var n=r(39),o="__lodash_hash_undefined__",i=Object.prototype.hasOwnProperty;e.exports=function(e){var t=this.__data__;if(n){var r=t[e];return r===o?void 0:r}return i.call(t,e)?t[e]:void 0}},function(e,t,r){var n=r(39),o=Object.prototype.hasOwnProperty;e.exports=function(e){var t=this.__data__;return n?void 0!==t[e]:o.call(t,e)}},function(e,t,r){var n=r(39),o="__lodash_hash_undefined__";e.exports=function(e,t){var r=this.__data__;return this.size+=this.has(e)?0:1,r[e]=n&&void 0===t?o:t,this}},function(e,t,r){var n=r(40);e.exports=function(e){var t=n(this,e).delete(e);return this.size-=t?1:0,t}},function(e,t){e.exports=function(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e}},function(e,t,r){var n=r(40);e.exports=function(e){return n(this,e).get(e)}},function(e,t,r){var n=r(40);e.exports=function(e){return n(this,e).has(e)}},function(e,t,r){var n=r(40);e.exports=function(e,t){var r=n(this,e),o=r.size;return r.set(e,t),this.size+=r.size==o?0:1,this}},function(e,t,r){var n=r(20),o=r(17);e.exports=function(e,t){return e&&n(t,o(t),e)}},function(e,t,r){var n=r(20),o=r(41);e.exports=function(e,t){return e&&n(t,o(t),e)}},function(e,t,r){var n=r(11),o=r(26),i=r(220),u=Object.prototype.hasOwnProperty;e.exports=function(e){if(!n(e))return i(e);var t=o(e),r=[];for(var a in e)("constructor"!=a||!t&&u.call(e,a))&&r.push(a);return r}},function(e,t){e.exports=function(e){var t=[];if(null!=e)for(var r in Object(e))t.push(r);return t}},function(e,t,r){(function(e){var n=r(10),o="object"==typeof t&&t&&!t.nodeType&&t,i=o&&"object"==typeof e&&e&&!e.nodeType&&e,u=i&&i.exports===o?n.Buffer:void 0,a=u?u.allocUnsafe:void 0;e.exports=function(e,t){if(t)return e.slice();var r=e.length,n=a?a(r):new e.constructor(r);return e.copy(n),n}}).call(t,r(56)(e))},function(e,t){e.exports=function(e,t){var r=-1,n=e.length;for(t||(t=Array(n));++r<n;)t[r]=e[r];return t}},function(e,t,r){var n=r(20),o=r(64);e.exports=function(e,t){return n(e,o(e),t)}},function(e,t){e.exports=function(e,t){for(var r=-1,n=null==e?0:e.length,o=0,i=[];++r<n;){var u=e[r];t(u,r,e)&&(i[o++]=u)}return i}},function(e,t,r){var n=r(20),o=r(98);e.exports=function(e,t){return n(e,o(e),t)}},function(e,t,r){var n=r(100),o=r(98),i=r(41);e.exports=function(e){return n(e,i,o)}},function(e,t){var r=Object.prototype.hasOwnProperty;e.exports=function(e){var t=e.length,n=e.constructor(t);return t&&"string"==typeof e[0]&&r.call(e,"index")&&(n.index=e.index,n.input=e.input),n}},function(e,t,r){var n=r(66),o=r(229),i=r(230),u=r(232),a=r(233),s=r(235),c=r(236),l="[object Boolean]",f="[object Date]",d="[object Map]",h="[object Number]",p="[object RegExp]",y="[object Set]",v="[object String]",b="[object Symbol]",m="[object ArrayBuffer]",g="[object DataView]",_="[object Float32Array]",w="[object Float64Array]",O="[object Int8Array]",k="[object Int16Array]",j="[object Int32Array]",E="[object Uint8Array]",P="[object Uint8ClampedArray]",x="[object Uint16Array]",S="[object Uint32Array]";e.exports=function(e,t,r,q){var M=e.constructor;switch(t){case m:return n(e);case l:case f:return new M(+e);case g:return o(e,q);case _:case w:case O:case k:case j:case E:case P:case x:case S:return c(e,q);case d:return i(e,q,r);case h:case v:return new M(e);case p:return u(e);case y:return a(e,q,r);case b:return s(e)}}},function(e,t,r){var n=r(66);e.exports=function(e,t){var r=t?n(e.buffer):e.buffer;return new e.constructor(r,e.byteOffset,e.byteLength)}},function(e,t,r){var n=r(231),o=r(67),i=r(102),u=1;e.exports=function(e,t,r){var a=t?r(i(e),u):i(e);return o(a,n,new e.constructor)}},function(e,t){e.exports=function(e,t){return e.set(t[0],t[1]),e}},function(e,t){var r=/\w*$/;e.exports=function(e){var t=new e.constructor(e.source,r.exec(e));return t.lastIndex=e.lastIndex,t}},function(e,t,r){var n=r(234),o=r(67),i=r(103),u=1;e.exports=function(e,t,r){var a=t?r(i(e),u):i(e);return o(a,n,new e.constructor)}},function(e,t){e.exports=function(e,t){return e.add(t),e}},function(e,t,r){var n=r(22),o=n?n.prototype:void 0,i=o?o.valueOf:void 0;e.exports=function(e){return i?Object(i.call(e)):{}}},function(e,t,r){var n=r(66);e.exports=function(e,t){var r=t?n(e.buffer):e.buffer;return new e.constructor(r,e.byteOffset,e.length)}},function(e,t,r){var n=r(238),o=r(58),i=r(26);e.exports=function(e){return"function"!=typeof e.constructor||i(e)?{}:n(o(e))}},function(e,t,r){var n=r(11),o=Object.create,i=function(){function e(){}return function(t){if(!n(t))return{};if(o)return o(t);e.prototype=t;var r=new e;return e.prototype=void 0,r}}();e.exports=i},function(e,t){e.exports=o},function(e,t,r){var n=r(241),o=r(17);e.exports=function(e,t){return e&&n(e,t,o)}},function(e,t,r){var n=r(242)();e.exports=n},function(e,t){e.exports=function(e){return function(t,r,n){for(var o=-1,i=Object(t),u=n(t),a=u.length;a--;){var s=u[e?a:++o];if(!1===r(i[s],s,i))break}return t}}},function(e,t,r){var n=r(13);e.exports=function(e,t){return function(r,o){if(null==r)return r;if(!n(r))return e(r,o);for(var i=r.length,u=t?i:-1,a=Object(r);(t?u--:++u<i)&&!1!==o(a[u],u,a););return r}}},function(e,t,r){var n=r(32);e.exports=function(e){return"function"==typeof e?e:n}},function(e,t,r){var n=r(246),o=r(253),i=r(109);e.exports=function(e){var t=o(e);return 1==t.length&&t[0][2]?i(t[0][0],t[0][1]):function(r){return r===e||n(r,e,t)}}},function(e,t,r){var n=r(62),o=r(104),i=1,u=2;e.exports=function(e,t,r,a){var s=r.length,c=s,l=!a;if(null==e)return!c;for(e=Object(e);s--;){var f=r[s];if(l&&f[2]?f[1]!==e[f[0]]:!(f[0]in e))return!1}for(;++s<c;){var d=(f=r[s])[0],h=e[d],p=f[1];if(l&&f[2]){if(void 0===h&&!(d in e))return!1}else{var y=new n;if(a)var v=a(h,p,d,e,t,y);if(!(void 0===v?o(p,h,i|u,a,y):v))return!1}}return!0}},function(e,t,r){var n=r(62),o=r(105),i=r(251),u=r(252),a=r(59),s=r(3),c=r(35),l=r(57),f=1,d="[object Arguments]",h="[object Array]",p="[object Object]",y=Object.prototype.hasOwnProperty;e.exports=function(e,t,r,v,b,m){var g=s(e),_=s(t),w=g?h:a(e),O=_?h:a(t),k=(w=w==d?p:w)==p,j=(O=O==d?p:O)==p,E=w==O;if(E&&c(e)){if(!c(t))return!1;g=!0,k=!1}if(E&&!k)return m||(m=new n),g||l(e)?o(e,t,r,v,b,m):i(e,t,w,r,v,b,m);if(!(r&f)){var P=k&&y.call(e,"__wrapped__"),x=j&&y.call(t,"__wrapped__");if(P||x){var S=P?e.value():e,q=x?t.value():t;return m||(m=new n),b(S,q,r,v,m)}}return!!E&&(m||(m=new n),u(e,t,r,v,b,m))}},function(e,t){var r="__lodash_hash_undefined__";e.exports=function(e){return this.__data__.set(e,r),this}},function(e,t){e.exports=function(e){return this.__data__.has(e)}},function(e,t){e.exports=function(e,t){for(var r=-1,n=null==e?0:e.length;++r<n;)if(t(e[r],r,e))return!0;return!1}},function(e,t,r){var n=r(22),o=r(101),i=r(25),u=r(105),a=r(102),s=r(103),c=1,l=2,f="[object Boolean]",d="[object Date]",h="[object Error]",p="[object Map]",y="[object Number]",v="[object RegExp]",b="[object Set]",m="[object String]",g="[object Symbol]",_="[object ArrayBuffer]",w="[object DataView]",O=n?n.prototype:void 0,k=O?O.valueOf:void 0;e.exports=function(e,t,r,n,O,j,E){switch(r){case w:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case _:return!(e.byteLength!=t.byteLength||!j(new o(e),new o(t)));case f:case d:case y:return i(+e,+t);case h:return e.name==t.name&&e.message==t.message;case v:case m:return e==t+"";case p:var P=a;case b:var x=n&c;if(P||(P=s),e.size!=t.size&&!x)return!1;var S=E.get(e);if(S)return S==t;n|=l,E.set(e,t);var q=u(P(e),P(t),n,O,j,E);return E.delete(e),q;case g:if(k)return k.call(e)==k.call(t)}return!1}},function(e,t,r){var n=r(99),o=1,i=Object.prototype.hasOwnProperty;e.exports=function(e,t,r,u,a,s){var c=r&o,l=n(e),f=l.length;if(f!=n(t).length&&!c)return!1;for(var d=f;d--;){var h=l[d];if(!(c?h in t:i.call(t,h)))return!1}var p=s.get(e);if(p&&s.get(t))return p==t;var y=!0;s.set(e,t),s.set(t,e);for(var v=c;++d<f;){var b=e[h=l[d]],m=t[h];if(u)var g=c?u(m,b,h,t,e,s):u(b,m,h,e,t,s);if(!(void 0===g?b===m||a(b,m,r,u,s):g)){y=!1;break}v||(v="constructor"==h)}if(y&&!v){var _=e.constructor,w=t.constructor;_!=w&&"constructor"in e&&"constructor"in t&&!("function"==typeof _&&_ instanceof _&&"function"==typeof w&&w instanceof w)&&(y=!1)}return s.delete(e),s.delete(t),y}},function(e,t,r){var n=r(108),o=r(17);e.exports=function(e){for(var t=o(e),r=t.length;r--;){var i=t[r],u=e[i];t[r]=[i,u,n(u)]}return t}},function(e,t,r){var n=r(104),o=r(255),i=r(261),u=r(71),a=r(108),s=r(109),c=r(24),l=1,f=2;e.exports=function(e,t){return u(e)&&a(t)?s(c(e),t):function(r){var u=o(r,e);return void 0===u&&u===t?i(r,e):n(t,u,l|f)}}},function(e,t,r){var n=r(70);e.exports=function(e,t,r){var o=null==e?void 0:n(e,t);return void 0===o?r:o}},function(e,t,r){var n=/^\./,o=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,i=/\\(\\)?/g,u=r(257)(function(e){var t=[];return n.test(e)&&t.push(""),e.replace(o,function(e,r,n,o){t.push(n?o.replace(i,"$1"):r||e)}),t});e.exports=u},function(e,t,r){var n=r(258),o=500;e.exports=function(e){var t=n(e,function(e){return r.size===o&&r.clear(),e}),r=t.cache;return t}},function(e,t,r){function n(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw new TypeError(i);var r=function(){var n=arguments,o=t?t.apply(this,n):n[0],i=r.cache;if(i.has(o))return i.get(o);var u=e.apply(this,n);return r.cache=i.set(o,u)||i,u};return r.cache=new(n.Cache||o),r}var o=r(63),i="Expected a function";n.Cache=o,e.exports=n},function(e,t,r){var n=r(260);e.exports=function(e){return null==e?"":n(e)}},function(e,t,r){function n(e){if("string"==typeof e)return e;if(u(e))return i(e,n)+"";if(a(e))return l?l.call(e):"";var t=e+"";return"0"==t&&1/e==-s?"-0":t}var o=r(22),i=r(47),u=r(3),a=r(46),s=1/0,c=o?o.prototype:void 0,l=c?c.toString:void 0;e.exports=n},function(e,t,r){var n=r(262),o=r(263);e.exports=function(e,t){return null!=e&&o(e,t,n)}},function(e,t){e.exports=function(e,t){return null!=e&&t in Object(e)}},function(e,t,r){var n=r(45),o=r(34),i=r(3),u=r(33),a=r(55),s=r(24);e.exports=function(e,t,r){for(var c=-1,l=(t=n(t,e)).length,f=!1;++c<l;){var d=s(t[c]);if(!(f=null!=e&&r(e,d)))break;e=e[d]}return f||++c!=l?f:!!(l=null==e?0:e.length)&&a(l)&&u(d,l)&&(i(e)||o(e))}},function(e,t,r){var n=r(265),o=r(266),i=r(71),u=r(24);e.exports=function(e){return i(e)?n(u(e)):o(e)}},function(e,t){e.exports=function(e){return function(t){return null==t?void 0:t[e]}}},function(e,t,r){var n=r(70);e.exports=function(e){return function(t){return n(t,e)}}},function(e,t){e.exports=function(e,t,r,n,o){return o(e,function(e,o,i){r=n?(n=!1,e):t(r,e,o,i)}),r}},function(e,t,r){var n=r(47);e.exports=function(e,t){return n(t,function(t){return e[t]})}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CacheMiddleware=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=function(e){return e&&e.__esModule?e:{default:e}}(r(36)),i=r(2),u=r(30),a=r(111);t.CacheMiddleware=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Cache Middleware";return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,u.Middleware),n(t,[{key:"loadStorage",value:function(e){return new a.Storage(e)}},{key:"handle",value:function(e){var t=e.method,r=e.body,n=e.appKey,u=e.collection,a=e.entityId,s=e.encryptionKey,c=this.loadStorage(n,s),l=void 0;return"GET"===t?l=(0,i.isDefined)(a)?c.findById(u,a):c.find(u):"POST"===t||"PUT"===t?l="_group"===a?c.find(u):c.save(u,r):"DELETE"===t&&(l=!1===(0,i.isDefined)(u)?c.clear():c.removeById(u,a)),l.then(function(e){var r={statusCode:"POST"===t?201:200,data:e};return"POST"===t&&"_group"===a&&(r.statusCode=200),(!1===(0,i.isDefined)(e)||(0,o.default)(e))&&(r.statusCode=204),r}).catch(function(e){return{statusCode:e.code}}).then(function(e){return{response:e}})}}]),t}()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=[],i=String.fromCharCode(9500),u=String.fromCharCode(9472),a=String.fromCharCode(9492),s=String.fromCharCode(9474);t.AsciiTree=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return n(e,null,[{key:"generate",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=function(e,t){if(0===e.level)return e.value;for(var r="\r\n",n=t?a:i,c=1;c<e.level;c+=1)r=""+r+(o[c]?" ":s),r+="  ";return""+r+n+u+" "+e.value}(t,arguments[1]);if(t.nodes.length>0){var n=t.nodes.length-1;t.nodes.forEach(function(t,i){o[t.level]=i===n,r+=e.generate(t,i===n)})}return r}}]),e}()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Queue=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=function(e){return e&&e.__esModule?e:{default:e}}(r(4));t.Queue=function(){function e(t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.pendingPromises=0,this.maxPendingPromises=void 0!==t?t:1/0,this.maxQueuedPromises=void 0!==r?r:1/0,this.queue=[]}return n(e,[{key:"add",value:function(e){var t=this;return new o.default(function(r,n,o){t.queue.length>=t.maxQueuedPromises?n(new Error("Queue limit reached")):(t.queue.push({promiseGenerator:e,resolve:r,reject:n,notify:o||function(){}}),t._dequeue())})}},{key:"getPendingLength",value:function(){return this.pendingPromises}},{key:"getQueueLength",value:function(){return this.queue.length}},{key:"_dequeue",value:function(){var e=this;if(this.pendingPromises>=this.maxPendingPromises)return!1;var t=this.queue.shift();if(!t)return!1;try{this.pendingPromises+=1,function(e){return e&&"function"==typeof e.then?e:o.default.resolve(e)}(t.promiseGenerator()).then(function(r){e.pendingPromises-=1,t.resolve(r),e._dequeue()},function(r){e.pendingPromises-=1,t.reject(r),e._dequeue()},function(e){t.notify(e)})}catch(e){this.pendingPromises-=1,t.reject(e),this._dequeue()}return!0}}]),e}()},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.MemoryAdapter=void 0;var o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=n(r(4)),u=n(r(92)),a=n(r(73)),s=n(r(42)),c=n(r(72)),l=n(r(276)),f=n(r(5)),d=n(r(3)),h=r(2),p=r(1),y={},v=function(){function e(t){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),!(0,h.isDefined)(t))throw new Error("A name for the collection is required to use the memory persistence adapter.",t);if(!(0,f.default)(t))throw new Error("The name of the collection must be a string to use the memory persistence adapter",t);this.name=t,this.cache=y[t],(0,h.isDefined)(this.cache)||(this.cache=new u.default,y[t]=this.cache)}return o(e,[{key:"find",value:function(e){try{var t=this.cache.get(e);return t?i.default.resolve(JSON.parse(t)):i.default.resolve([])}catch(e){return i.default.reject(e)}}},{key:"findById",value:function(e,t){var r=this;return this.find(e).then(function(n){var o=(0,l.default)(n,function(e){return e._id===t});return o||i.default.reject(new p.NotFoundError("An entity with _id = "+t+" was not found in the "+e+" collection on the "+r.name+" memory database."))})}},{key:"save",value:function(e,t){var r=this,n=!1;return(0,d.default)(t)||(t=[t],n=!0),0===t.length?i.default.resolve(t):this.find(e).then(function(o){o=(0,a.default)(o,"_id"),t=(0,a.default)(t,"_id");var i=Object.keys(t);return(0,s.default)(i,function(e){o[e]=t[e]}),r.cache.set(e,JSON.stringify((0,c.default)(o))),t=(0,c.default)(t),n?t[0]:t})}},{key:"removeById",value:function(e,t){var r=this;return this.find(e).then(function(n){var o=(n=(0,a.default)(n,"_id"))[t];return(0,h.isDefined)(o)?(delete n[t],r.cache.set(e,JSON.stringify((0,c.default)(n))),{count:1}):i.default.reject(new p.NotFoundError("An entity with _id = "+t+" was not found in the "+e+" collection on the "+r.name+" memory database."))})}},{key:"clear",value:function(){return this.cache.clear(),i.default.resolve(null)}}]),e}();t.MemoryAdapter={load:function(e){return i.default.resolve(new v(e))}}},function(e,t,r){var n=r(274),o=r(275),i=r(18),u=r(3);e.exports=function(e,t){return function(r,a){var s=u(r)?n:o,c=t?t():{};return s(r,e,i(a,2),c)}}},function(e,t){e.exports=function(e,t,r,n){for(var o=-1,i=null==e?0:e.length;++o<i;){var u=e[o];t(n,u,r(u),e)}return n}},function(e,t,r){var n=r(28);e.exports=function(e,t,r,o){return n(e,function(e,n,i){t(o,e,r(e),i)}),o}},function(e,t,r){var n=r(277)(r(278));e.exports=n},function(e,t,r){var n=r(18),o=r(13),i=r(17);e.exports=function(e){return function(t,r,u){var a=Object(t);if(!o(t)){var s=n(r,3);t=i(t),r=function(e){return s(a[e],e,a)}}var c=e(t,r,u);return c>-1?a[s?t[c]:c]:void 0}}},function(e,t,r){var n=r(112),o=r(18),i=r(279),u=Math.max;e.exports=function(e,t,r){var a=null==e?0:e.length;if(!a)return-1;var s=null==r?0:i(r);return s<0&&(s=u(a+s,0)),n(e,o(t,3),s)}},function(e,t,r){var n=r(280);e.exports=function(e){var t=n(e),r=t%1;return t==t?r?t-r:t:0}},function(e,t,r){var n=r(281),o=1/0,i=1.7976931348623157e308;e.exports=function(e){if(!e)return 0===e?e:0;if((e=n(e))===o||e===-o)return(e<0?-1:1)*i;return e==e?e:0}},function(e,t,r){var n=r(11),o=r(46),i=NaN,u=/^\s+|\s+$/g,a=/^[-+]0x[0-9a-f]+$/i,s=/^0b[01]+$/i,c=/^0o[0-7]+$/i,l=parseInt;e.exports=function(e){if("number"==typeof e)return e;if(o(e))return i;if(n(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=n(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(u,"");var r=s.test(e);return r||c.test(e)?l(e.slice(2),r?2:8):a.test(e)?i:+e}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.HttpMiddleware=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=function(e){return e&&e.__esModule?e:{default:e}}(r(4)),i=r(1),u=r(30);t.HttpMiddleware=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Http Middleware";return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,u.Middleware),n(t,[{key:"handle",value:function(){return o.default.reject(new i.KinveyError("Unable to send network request.","Please override the core HttpMiddleware."))}},{key:"cancel",value:function(){return o.default.resolve()}}]),t}()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ParseMiddleware=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=function(e){return e&&e.__esModule?e:{default:e}}(r(4)),i=r(2),u=r(30);t.ParseMiddleware=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Parse Middleware";return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,u.Middleware),n(t,[{key:"handle",value:function(e,t){if((0,i.isDefined)(t)&&(0,i.isDefined)(t.data)){var r=t.headers["content-type"]||t.headers["Content-Type"];if(r&&0===r.indexOf("application/json"))try{t.data=JSON.parse(t.data)}catch(e){}}return o.default.resolve({response:t})}}]),t}()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SerializeMiddleware=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=function(e){return e&&e.__esModule?e:{default:e}}(r(4)),i=r(2),u=r(30);t.SerializeMiddleware=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Serialize Middleware";return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,u.Middleware),n(t,[{key:"handle",value:function(e){if((0,i.isDefined)(e)&&(0,i.isDefined)(e.body)){var t=e.headers["content-type"]||e.headers["Content-Type"];if((0,i.isDefined)(t))if(0===t.indexOf("application/json"))e.body=JSON.stringify(e.body);else if(0===t.indexOf("application/x-www-form-urlencoded")){var r=e.body,n=[];Object.keys(r).forEach(function(e){n.push(global.encodeURIComponent(e)+"="+global.encodeURIComponent(r[e]))}),e.body=n.join("&")}}return o.default.resolve({request:e})}}]),t}()},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.DeltaFetchRequest=void 0;var o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=n(r(4)),u=n(r(73)),a=n(r(69)),s=n(r(113)),c=n(r(72)),l=n(r(42)),f=n(r(3)),d=n(r(5)),h=r(1),p=r(2),y=r(9),v=r(43),b=r(114),m=r(94),g=r(29);t.DeltaFetchRequest=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,b.KinveyRequest),o(t,[{key:"execute",value:function(){var e=this;return new m.CacheRequest({method:v.RequestMethod.GET,url:this.url,headers:this.headers,query:this.query,timeout:this.timeout,client:this.client}).execute().then(function(e){return e.data}).catch(function(e){if(!(e instanceof h.NotFoundError))throw e;return[]}).then(function(t){if((0,f.default)(t)&&t.length>0){var r=(0,u.default)(t,"_id"),n=new y.Query((0,s.default)(e.query,"toJSON",e.query));n.fields=["_id","_kmd.lmt"];return new b.KinveyRequest({method:v.RequestMethod.GET,url:e.url,headers:e.headers,authType:e.authType,query:n,timeout:e.timeout,client:e.client,properties:e.properties,skipBL:e.skipBL,trace:e.trace,followRedirect:e.followRedirect,cache:e.cache}).execute().then(function(e){return e.data}).then(function(t){var n=(0,u.default)(t,"_id"),o=n,a=Object.keys(r);(0,l.default)(a,function(e){var t=r[e],i=n[e];i&&(0,p.isDefined)(i._kmd)&&(0,p.isDefined)(t._kmd)&&i._kmd.lmt===t._kmd.lmt?delete o[e]:delete r[e]});for(var c=Object.keys(o),f=[],d=0;d<c.length;){var h=new y.Query((0,s.default)(e.query,"toJSON",e.query)),m=c.slice(d,c.length>200+d?200:c.length);h.contains("_id",m);var g=new b.KinveyRequest({method:v.RequestMethod.GET,url:e.url,headers:e.headers,authType:e.authType,query:h,timeout:e.timeout,client:e.client,properties:e.properties,skipBL:e.skipBL,trace:e.trace,followRedirect:e.followRedirect,cache:e.cache}).execute();f.push(g),d+=200}return i.default.all(f)}).then(function(t){var n=(0,a.default)(t,function(e,t){if(t.isSuccess()){var r=e.headers;r.addAll(t.headers),e.headers=r,e.data=e.data.concat(t.data)}return e},new g.Response({statusCode:g.StatusCode.Ok,data:[]}));if(n.data=n.data.concat((0,c.default)(r)),e.query){var o=new y.Query((0,s.default)(e.query,"toJSON",e.query));o.skip=0,o.limit=0,n.data=o.process(n.data)}return n})}return new b.KinveyRequest({method:v.RequestMethod.GET,url:e.url,headers:e.headers,authType:e.authType,query:e.query,timeout:e.timeout,client:e.client,properties:e.properties,skipBL:e.skipBL,trace:e.trace,followRedirect:e.followRedirect,cache:e.cache}).execute()})}},{key:"method",get:function(){return function e(t,r,n){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,r);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,r,n)}if("value"in o)return o.value;var u=o.get;if(void 0!==u)return u.call(n)}(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"method",this)},set:function(e){switch((0,d.default)(e)||(e=String(e)),e=e.toUpperCase()){case v.RequestMethod.GET:!function e(t,r,n,o){var i=Object.getOwnPropertyDescriptor(t,r);if(void 0===i){var u=Object.getPrototypeOf(t);null!==u&&e(u,r,n,o)}else if("value"in i&&i.writable)i.value=n;else{var a=i.set;void 0!==a&&a.call(o,n)}return n}(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"method",e,this);break;case v.RequestMethod.POST:case v.RequestMethod.PATCH:case v.RequestMethod.PUT:case v.RequestMethod.DELETE:default:throw new h.KinveyError("Invalid request Method. Only RequestMethod.GET is allowed.")}}}]),t}()},function(e,t){e.exports=require("buffer")},function(e,t,r){var n=r(86),o=r(288),i=r(54),u=r(289),a=i(function(e){return e.push(void 0,u),n(o,void 0,e)});e.exports=a},function(e,t,r){var n=r(20),o=r(53),i=r(41),u=o(function(e,t,r,o){n(t,i(t),e,o)});e.exports=u},function(e,t,r){var n=r(25),o=Object.prototype,i=o.hasOwnProperty;e.exports=function(e,t,r,u){return void 0===e||n(e,o[r])&&!i.call(u,r)?t:e}},function(e,t,r){var n=r(291),o=r(297),i=r(18),u=r(54),a=r(299),s=r(115),c=u(function(e,t){var r=s(t);return a(r)&&(r=void 0),a(e)?n(e,o(t,1,a,!0),i(r,2)):[]});e.exports=c},function(e,t,r){var n=r(106),o=r(292),i=r(296),u=r(47),a=r(89),s=r(107),c=200;e.exports=function(e,t,r,l){var f=-1,d=o,h=!0,p=e.length,y=[],v=t.length;if(!p)return y;r&&(t=u(t,a(r))),l?(d=i,h=!1):t.length>=c&&(d=s,h=!1,t=new n(t));e:for(;++f<p;){var b=e[f],m=null==r?b:r(b);if(b=l||0!==b?b:0,h&&m==m){for(var g=v;g--;)if(t[g]===m)continue e;y.push(b)}else d(t,m,l)||y.push(b)}return y}},function(e,t,r){var n=r(293);e.exports=function(e,t){return!(null==e||!e.length)&&n(e,t,0)>-1}},function(e,t,r){var n=r(112),o=r(294),i=r(295);e.exports=function(e,t,r){return t==t?i(e,t,r):n(e,o,r)}},function(e,t){e.exports=function(e){return e!=e}},function(e,t){e.exports=function(e,t,r){for(var n=r-1,o=e.length;++n<o;)if(e[n]===t)return n;return-1}},function(e,t){e.exports=function(e,t,r){for(var n=-1,o=null==e?0:e.length;++n<o;)if(r(t,e[n]))return!0;return!1}},function(e,t,r){function n(e,t,r,u,a){var s=-1,c=e.length;for(r||(r=i),a||(a=[]);++s<c;){var l=e[s];t>0&&r(l)?t>1?n(l,t-1,r,u,a):o(a,l):u||(a[a.length]=l)}return a}var o=r(65),i=r(298);e.exports=n},function(e,t,r){var n=r(22),o=r(34),i=r(3),u=n?n.isConcatSpreadable:void 0;e.exports=function(e){return i(e)||o(e)||!!(u&&e&&e[u])}},function(e,t,r){var n=r(13),o=r(14);e.exports=function(e){return o(e)&&n(e)}},function(e,t,r){var n=r(18),o=r(301);e.exports=function(e,t){var r=[];if(!e||!e.length)return r;var i=-1,u=[],a=e.length;for(t=n(t,3);++i<a;){var s=e[i];t(s,i,e)&&(r.push(s),u.push(i))}return o(e,u),r}},function(e,t,r){var n=r(302),o=r(33),i=Array.prototype.splice;e.exports=function(e,t){for(var r=e?t.length:0,u=r-1;r--;){var a=t[r];if(r==u||a!==s){var s=a;o(a)?i.call(e,a,1):n(e,a)}}return e}},function(e,t,r){var n=r(45),o=r(115),i=r(303),u=r(24);e.exports=function(e,t){return t=n(t,e),null==(e=i(e,t))||delete e[u(o(t))]}},function(e,t,r){var n=r(70),o=r(304);e.exports=function(e,t){return t.length<2?e:n(e,o(t,0,-1))}},function(e,t){e.exports=function(e,t,r){var n=-1,o=e.length;t<0&&(t=-t>o?0:o+t),(r=r>o?o:r)<0&&(r+=o),o=t>r?0:r-t>>>0,t>>>=0;for(var i=Array(o);++n<o;)i[n]=e[n+t];return i}},function(e,t,r){var n=r(28),o=r(13);e.exports=function(e,t){var r=-1,i=o(e)?Array(e.length):[];return n(e,function(e,n,o){i[++r]=t(e,n,o)}),i}},function(e,t,r){"use strict";var n=r(77),o=r(307),i=r(313),u=r(314),a=function(){function e(e){this._isScalar=!1,e&&(this._subscribe=e)}return e.prototype.lift=function(t){var r=new e;return r.source=this,r.operator=t,r},e.prototype.subscribe=function(e,t,r){var n=this.operator,i=o.toSubscriber(e,t,r);if(n?n.call(i,this.source):i.add(this.source?this._subscribe(i):this._trySubscribe(i)),i.syncErrorThrowable&&(i.syncErrorThrowable=!1,i.syncErrorThrown))throw i.syncErrorValue;return i},e.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(t){e.syncErrorThrown=!0,e.syncErrorValue=t,e.error(t)}},e.prototype.forEach=function(e,t){var r=this;if(t||(n.root.Rx&&n.root.Rx.config&&n.root.Rx.config.Promise?t=n.root.Rx.config.Promise:n.root.Promise&&(t=n.root.Promise)),!t)throw new Error("no Promise impl found");return new t(function(t,n){var o;o=r.subscribe(function(t){if(o)try{e(t)}catch(e){n(e),o.unsubscribe()}else e(t)},n,t)})},e.prototype._subscribe=function(e){return this.source.subscribe(e)},e.prototype[i.observable]=function(){return this},e.prototype.pipe=function(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];return 0===e.length?this:u.pipeFromArray(e)(this)},e.prototype.toPromise=function(e){var t=this;if(e||(n.root.Rx&&n.root.Rx.config&&n.root.Rx.config.Promise?e=n.root.Rx.config.Promise:n.root.Promise&&(e=n.root.Promise)),!e)throw new Error("no Promise impl found");return new e(function(e,r){var n;t.subscribe(function(e){return n=e},function(e){return r(e)},function(){return e(n)})})},e.create=function(t){return new e(t)},e}();t.Observable=a},function(e,t,r){"use strict";var n=r(116),o=r(78),i=r(119);t.toSubscriber=function(e,t,r){if(e){if(e instanceof n.Subscriber)return e;if(e[o.rxSubscriber])return e[o.rxSubscriber]()}return e||t||r?new n.Subscriber(e,t,r):new n.Subscriber(i.empty)}},function(e,t,r){"use strict";function n(e){return e.reduce(function(e,t){return e.concat(t instanceof c.UnsubscriptionError?t.errors:t)},[])}var o=r(309),i=r(310),u=r(117),a=r(311),s=r(118),c=r(312),l=function(){function e(e){this.closed=!1,this._parent=null,this._parents=null,this._subscriptions=null,e&&(this._unsubscribe=e)}return e.prototype.unsubscribe=function(){var e,t=!1;if(!this.closed){var r=this._parent,l=this._parents,f=this._unsubscribe,d=this._subscriptions;this.closed=!0,this._parent=null,this._parents=null,this._subscriptions=null;for(var h=-1,p=l?l.length:0;r;)r.remove(this),r=++h<p&&l[h]||null;if(u.isFunction(f)){a.tryCatch(f).call(this)===s.errorObject&&(t=!0,e=e||(s.errorObject.e instanceof c.UnsubscriptionError?n(s.errorObject.e.errors):[s.errorObject.e]))}if(o.isArray(d))for(h=-1,p=d.length;++h<p;){var y=d[h];if(i.isObject(y)){if(a.tryCatch(y.unsubscribe).call(y)===s.errorObject){t=!0,e=e||[];var v=s.errorObject.e;v instanceof c.UnsubscriptionError?e=e.concat(n(v.errors)):e.push(v)}}}if(t)throw new c.UnsubscriptionError(e)}},e.prototype.add=function(t){if(!t||t===e.EMPTY)return e.EMPTY;if(t===this)return this;var r=t;switch(typeof t){case"function":r=new e(t);case"object":if(r.closed||"function"!=typeof r.unsubscribe)return r;if(this.closed)return r.unsubscribe(),r;if("function"!=typeof r._addParent){var n=r;(r=new e)._subscriptions=[n]}break;default:throw new Error("unrecognized teardown "+t+" added to Subscription.")}return(this._subscriptions||(this._subscriptions=[])).push(r),r._addParent(this),r},e.prototype.remove=function(e){var t=this._subscriptions;if(t){var r=t.indexOf(e);-1!==r&&t.splice(r,1)}},e.prototype._addParent=function(e){var t=this._parent,r=this._parents;t&&t!==e?r?-1===r.indexOf(e)&&r.push(e):this._parents=[e]:this._parent=e},e.EMPTY=function(e){return e.closed=!0,e}(new e),e}();t.Subscription=l},function(e,t,r){"use strict";t.isArray=Array.isArray||function(e){return e&&"number"==typeof e.length}},function(e,t,r){"use strict";t.isObject=function(e){return null!=e&&"object"==typeof e}},function(e,t,r){"use strict";function n(){try{return o.apply(this,arguments)}catch(e){return i.errorObject.e=e,i.errorObject}}var o,i=r(118);t.tryCatch=function(e){return o=e,n}},function(e,t,r){"use strict";var n=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},o=function(e){function t(t){e.call(this),this.errors=t;var r=Error.call(this,t?t.length+" errors occurred during unsubscription:\n  "+t.map(function(e,t){return t+1+") "+e.toString()}).join("\n  "):"");this.name=r.name="UnsubscriptionError",this.stack=r.stack,this.message=r.message}return n(t,e),t}(Error);t.UnsubscriptionError=o},function(e,t,r){"use strict";function n(e){var t,r=e.Symbol;return"function"==typeof r?r.observable?t=r.observable:(t=r("observable"),r.observable=t):t="@@observable",t}var o=r(77);t.getSymbolObservable=n,t.observable=n(o.root),t.$$observable=t.observable},function(e,t,r){"use strict";function n(e){return e?1===e.length?e[0]:function(t){return e.reduce(function(e,t){return t(e)},t)}:o.noop}var o=r(315);t.pipe=function(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];return n(e)},t.pipeFromArray=n},function(e,t,r){"use strict";t.noop=function(){}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(317);Object.keys(n).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return n[e]}})})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LiveCollectionManager=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();t.getLiveCollectionManager=function(e){return c||(c=new s(e)),c};var o=r(8),i=r(1),u=r(6),a=r(49),s=t.LiveCollectionManager=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._client=t||o.Client.sharedInstance()}return n(e,[{key:"subscribeCollection",value:function(e,t){var r=this;return(0,a.isValidChannelName)(e)?(0,a.isValidReceiver)(t)?this._makeSubscriptionRequest(e,"_subscribe").then(function(){var n=r._buildChannelName(e);(0,a.getLiveService)().subscribeToChannel(n,t)}):Promise.reject(new i.KinveyError("Invalid or missing receiver")):Promise.reject(new i.KinveyError("Invalid or missing collection name"))}},{key:"unsubscribeCollection",value:function(e){var t=this;return(0,a.isValidChannelName)(e)?this._makeSubscriptionRequest(e,"_unsubscribe").then(function(){var r=t._buildChannelName(e);(0,a.getLiveService)().unsubscribeFromChannel(r)}):Promise.reject(new i.KinveyError("Invalid or missing collection name"))}},{key:"_buildChannelName",value:function(e){return this._client.appKey+".c-"+e}},{key:"_makeSubscriptionRequest",value:function(e,t){return u.KinveyRequest.executeShort({method:u.RequestMethod.POST,pathname:"/appdata/"+this._client.appKey+"/"+e+"/"+t,body:{deviceId:this._client.deviceId}})}}]),e}(),c=void 0},function(e,t){e.exports=i},function(e,t,r){e.exports=r(320)},function(e,t,r){var n=r(20),o=r(53),i=r(41),u=o(function(e,t){n(t,i(t),e)});e.exports=u},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(322);Object.keys(n).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return n[e]}})});var o=r(122);Object.keys(o).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return o[e]}})})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Stream=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=r(1),i=r(8),u=r(2),a=r(49),s=r(6),c=r(122);t.Stream=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.name=t,this._client=i.Client.sharedInstance(),this._liveService=(0,a.getLiveService)(this._client),this._subscribeChannels={},this._publishChannels={}}return n(e,[{key:"getSubstreams",value:function(){return this._makeStreamRequest("_substreams",s.RequestMethod.GET)}},{key:"getACL",value:function(e){return(0,u.isNonemptyString)(e)?this._makeStreamRequest(e,s.RequestMethod.GET):Promise.reject(new o.KinveyError("Invalid or missing id"))}},{key:"setACL",value:function(e,t){return(0,u.isNonemptyString)(e)?c.StreamACL.isValidACLObject(t)?(t instanceof c.StreamACL||(t=new c.StreamACL(t)),this._makeStreamRequest(e,s.RequestMethod.PUT,t.toPlainObject())):Promise.reject(new o.KinveyError("Invalid or missing ACL object")):Promise.reject(new o.KinveyError("Invalid or missing id"))}},{key:"follow",value:function(e,t){return this._subscribe(e,t)}},{key:"unfollow",value:function(e){return this._unsubscribe(e)}},{key:"post",value:function(e){var t=this._client.getActiveUser()._id;return this._publish(t,e)}},{key:"listen",value:function(e){var t=this._client.getActiveUser()._id;return this._subscribe(t,e)}},{key:"stopListening",value:function(){var e=this._client.getActiveUser()._id;return this._unsubscribe(e)}},{key:"send",value:function(e,t){return this._publish(e,t)}},{key:"_unsubscribeFromSubstream",value:function(e){var t=e+"/unsubscribe";return this._makeStreamRequest(t,s.RequestMethod.POST,{deviceId:this._client.deviceId})}},{key:"_subscribe",value:function(e,t){var r=this;return this._requestSubscribeAccess(e).then(function(){var n=r._subscribeChannels[e];r._liveService.subscribeToChannel(n,t)})}},{key:"_unsubscribe",value:function(e){var t=this;return this._unsubscribeFromSubstream(e).then(function(){var r=t._subscribeChannels[e];t._liveService.unsubscribeFromChannel(r),delete t._subscribeChannels[e]})}},{key:"_publish",value:function(e,t){return this._publishChannels[e]?this._retriablePublish(e,t):this._publishWithAccessRequest(e,t)}},{key:"_publishWithAccessRequest",value:function(e,t){var r=this;return this._requestPublishAccess(e).then(function(){var n=r._publishChannels[e];return r._liveService.publishToChannel(n,t)})}},{key:"_retriablePublish",value:function(e,t){var r=this,n=this._publishChannels[e];return this._liveService.publishToChannel(n,t).catch(function(n){var o=Promise.reject(n);return n.statusCode===s.StatusCode.Forbidden&&(o=r._publishWithAccessRequest(e,t)),o})}},{key:"_requestPublishAccess",value:function(e){var t=this;return this._makeStreamRequest(e+"/publish",s.RequestMethod.POST).then(function(r){return r.substreamChannelName&&(t._publishChannels[e]=r.substreamChannelName),r})}},{key:"_requestSubscribeAccess",value:function(e){var t=this,r={deviceId:this._client.deviceId};return this._makeStreamRequest(e+"/subscribe",s.RequestMethod.POST,r).then(function(r){return t._subscribeChannels[e]=r.substreamChannelName,r})}},{key:"_makeStreamRequest",value:function(e,t,r){return s.KinveyRequest.executeShort({method:t,pathname:"/stream/"+this._client.appKey+"/"+this.name+"/"+e,body:r},this._client)}}],[{key:"StreamACL",get:function(){return c.StreamACL}}]),e}()},function(e,t,r){var n=r(324),o=r(325),i=r(18),u=r(3),a=r(87);e.exports=function(e,t,r){var s=u(e)?n:o;return r&&a(e,t,r)&&(t=void 0),s(e,i(t,3))}},function(e,t){e.exports=function(e,t){for(var r=-1,n=null==e?0:e.length;++r<n;)if(!t(e[r],r,e))return!1;return!0}},function(e,t,r){var n=r(28);e.exports=function(e,t){var r=!0;return n(e,function(e,n,o){return r=!!t(e,n,o)}),r}},function(e,t,r){"use strict";function n(){var e=o.Client.sharedInstance();return(0,i.getLiveService)(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.onConnectionStatusUpdates=function(e){n().onConnectionStatusUpdates(e)},t.offConnectionStatusUpdates=function(e){n().offConnectionStatusUpdates(e)},t.isInitialized=function(){return n().isInitialized()};var o=r(8),i=r(49)},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.DataStore=t.DataStoreType=void 0;var o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=n(r(5)),u=n(r(7)),a=r(6),s=r(1),c=r(2),l=r(8),f=r(79),d=r(74),h=r(124),p=t.DataStoreType={Cache:"Cache",Network:"Network",Sync:"Sync"};Object.freeze(p);var y=function(){function e(){throw function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),new s.KinveyError("Not allowed to construct a DataStore instance. Please use the collection() function to get an instance of a DataStore instance.")}return o(e,null,[{key:"collection",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:p.Cache,r=arguments[2],n=void 0;if(!1===(0,c.isDefined)(e)||!1===(0,i.default)(e))throw new s.KinveyError("A collection is required and must be a string.");switch(t){case p.Network:n=new f.NetworkStore(e,r);break;case p.Sync:n=new h.SyncStore(e,r);break;case p.Cache:default:n=new d.CacheStore(e,r)}return n}},{key:"getInstance",value:function(e,t,r){return this.collection(e,t,r)}},{key:"clearCache",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.client||l.Client.sharedInstance(),r="/appdata/"+t.appKey;return new a.CacheRequest({method:a.RequestMethod.DELETE,url:u.default.format({protocol:t.apiProtocol,host:t.apiHost,pathname:r}),properties:e.properties,timeout:e.timeout}).execute().then(function(e){return e.data})}}]),e}();t.DataStore=y},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.MobileIdentityConnect=t.AuthorizationGrant=void 0;var o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=n(r(4)),u=n(r(5)),a=n(r(7)),s=n(r(329)),c=r(6),l=r(1),f=r(2),d=r(330),h=r(331),p=r(125),y=d.Popup,v=t.AuthorizationGrant={AuthorizationCodeLoginPage:"AuthorizationCodeLoginPage",AuthorizationCodeAPI:"AuthorizationCodeAPI"};Object.freeze(v);t.MobileIdentityConnect=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,h.Identity),o(t,[{key:"isSupported",value:function(){return!0}},{key:"login",value:function(e){var r=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:v.AuthorizationCodeLoginPage,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=this.client.appKey;(0,u.default)(o.micId)&&(a=a+"."+o.micId);return i.default.resolve().then(function(){if(n===v.AuthorizationCodeLoginPage)return r.requestCodeWithPopup(a,e,o);if(n===v.AuthorizationCodeAPI)return r.requestTempLoginUrl(a,e,o).then(function(t){return r.requestCodeWithUrl(t,a,e,o)});throw new l.KinveyError("The authorization grant "+n+" is unsupported. Please use a supported authorization grant.")}).then(function(t){return r.requestToken(t,a,e,o)}).then(function(n){return n.identity=t.identity,n.client_id=a,n.redirect_uri=e,n.protocol=r.client.micProtocol,n.host=r.client.micHost,n})}},{key:"refresh",value:function(e,r,n){var o=this,u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return i.default.resolve().then(function(){return o.refreshToken(e,r,n,u)}).then(function(e){return e.identity=t.identity,e.client_id=r,e.redirect_uri=n,e.protocol=o.client.micProtocol,e.host=o.client.micHost,e})}},{key:"requestTempLoginUrl",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n="/oauth/auth";if(r.version){var o=r.version;!1===(0,u.default)(o)&&(o=String(o)),n=(0,s.default)(0===o.indexOf("v")?o:"v"+o,n)}return new c.KinveyRequest({method:c.RequestMethod.POST,headers:{"Content-Type":"application/x-www-form-urlencoded"},url:a.default.format({protocol:this.client.micProtocol,host:this.client.micHost,pathname:n}),properties:r.properties,body:{client_id:e,redirect_uri:t,response_type:"code"}}).execute().then(function(e){return e.data.temp_login_uri})}},{key:"requestCodeWithPopup",value:function(e,t){var r=this,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return i.default.resolve().then(function(){var o="/oauth/auth",i=new y;if(n.version){var c=n.version;(0,u.default)(c)||(c=String(c)),o=(0,s.default)(0===c.indexOf("v")?c:"v"+c,o)}return i.open(a.default.format({protocol:r.client.micProtocol,host:r.client.micHost,pathname:o,query:{client_id:e,redirect_uri:t,response_type:"code"}}))}).then(function(e){return new i.default(function(r,n){function o(n){try{n.url&&0===n.url.indexOf(t)&&!1===i&&(i=!0,e.removeAllListeners(),e.close(),r(a.default.parse(n.url,!0).query.code))}catch(e){}}var i=!1;e.on("loadstart",o),e.on("loadstop",o),e.on("error",function(o){try{o.url&&0===o.url.indexOf(t)&&!1===i?(i=!0,e.removeAllListeners(),e.close(),r(a.default.parse(o.url,!0).query.code)):!1===i&&(e.removeAllListeners(),e.close(),n(new l.KinveyError(o.message,"",o.code)))}catch(e){}}),e.on("exit",function(){!1===i&&(e.removeAllListeners(),n(new l.KinveyError("Login has been cancelled.")))})})})}},{key:"requestCodeWithUrl",value:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return i.default.resolve().then(function(){return new c.KinveyRequest({method:c.RequestMethod.POST,headers:{"Content-Type":"application/x-www-form-urlencoded"},url:e,properties:n.properties,body:{client_id:t,redirect_uri:r,response_type:"code",username:n.username,password:n.password},followRedirect:!1}).execute()}).then(function(e){var t=e.headers.get("location");if(t)return a.default.parse(t,!0).query.code;throw new l.MobileIdentityConnectError("Unable to authorize user with username "+n.username+".","A location header was not provided with a code to exchange for an auth token.")})}},{key:"requestToken",value:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return new c.KinveyRequest({method:c.RequestMethod.POST,headers:{"Content-Type":"application/x-www-form-urlencoded"},authType:c.AuthType.App,url:a.default.format({protocol:this.client.micProtocol,host:this.client.micHost,pathname:"/oauth/token"}),properties:n.properties,body:{grant_type:"authorization_code",client_id:t,redirect_uri:r,code:e}}).execute().then(function(e){return e.data})}},{key:"refreshToken",value:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return new c.KinveyRequest({method:c.RequestMethod.POST,headers:{"Content-Type":"application/x-www-form-urlencoded"},authType:c.AuthType.App,url:a.default.format({protocol:this.client.micProtocol,host:this.client.micHost,pathname:"/oauth/token"}),body:{grant_type:"refresh_token",client_id:t,redirect_uri:r,refresh_token:e},properties:n.properties,timeout:n.timeout}).execute().then(function(e){return e.data})}},{key:"logout",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new c.KinveyRequest({method:c.RequestMethod.GET,headers:{"Content-Type":"application/x-www-form-urlencoded"},authType:c.AuthType.App,url:a.default.format({protocol:this.client.micProtocol,host:this.client.micHost,pathname:"/oauth/invalidate",query:{user:e._id}}),properties:t.properties}).execute().then(function(e){return e.data})}},{key:"identity",get:function(){return p.SocialIdentity.MobileIdentityConnect}}],[{key:"isSupported",value:function(){return!0}},{key:"usePopupClass",value:function(e){(0,f.isDefined)(e)&&(y=e)}},{key:"identity",get:function(){return p.SocialIdentity.MobileIdentityConnect}}]),t}()},function(e,t){e.exports=u},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Popup=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=r(121),i=r(1);t.Popup=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.EventEmitter),n(t,[{key:"open",value:function(){throw new i.PopupError("Unable to open a popup on this platform.")}},{key:"close",value:function(){return this}}],[{key:"isSupported",value:function(){return!1}}]),t}()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Identity=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=r(8),i=r(1);t.Identity=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.client=t.client||o.Client.sharedInstance()}return n(e,[{key:"isSupported",value:function(){return!1}},{key:"isOnline",value:function(e){var t=(new Date).getTime()/1e3;return e&&e.access_token&&e.expires>t}},{key:"identity",get:function(){throw new i.KinveyError("A subclass must override this property.")}}],[{key:"isSupported",value:function(){return!1}},{key:"identity",get:function(){throw new i.KinveyError("A subclass must override this property.")}}]),e}()},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.UserStore=void 0;var o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=n(r(4)),u=n(r(3)),a=n(r(5)),s=n(r(7)),c=r(6),l=r(1),f=r(31),d=r(2),h=r(9),p=r(48);t.UserStore=function(e){function t(e){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,null,e))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,p.NetworkStore),o(t,[{key:"lookup",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return f.KinveyObservable.create(function(n){if((0,d.isDefined)(e)&&!(e instanceof h.Query))return n.error(new l.KinveyError("Invalid query. It must be an instance of the Query class."));return new c.KinveyRequest({method:c.RequestMethod.POST,authType:c.AuthType.Default,url:s.default.format({protocol:t.client.apiProtocol,host:t.client.apiHost,pathname:t.pathname+"/_lookup"}),properties:r.properties,body:(0,d.isDefined)(e)?e.toPlainObject().filter:null,timeout:r.timeout,client:t.client}).execute().then(function(e){return e.data}).then(function(e){return n.next(e)}).then(function(){return n.complete()}).catch(function(e){return n.error(e)})})}},{key:"create",value:function(){return i.default.reject(new l.KinveyError("Please use `User.signup()` to create a user."))}},{key:"update",value:function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e?(0,u.default)(e)?i.default.reject(new l.KinveyError("Only one user can be updated at one time.",e)):e._id?function e(t,r,n){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,r);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,r,n)}if("value"in o)return o.value;var u=o.get;if(void 0!==u)return u.call(n)}(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"update",this).call(this,e,r):i.default.reject(new l.KinveyError("User must have an _id.")):i.default.reject(new l.KinveyError("No user was provided to be updated."))}},{key:"exists",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new c.KinveyRequest({method:c.RequestMethod.POST,authType:c.AuthType.App,url:s.default.format({protocol:this.client.apiProtocol,host:this.client.apiHost,pathname:"/rpc/"+this.client.appKey+"/check-username-exists"}),properties:t.properties,data:{username:e},timeout:t.timeout,client:this.client}).execute().then(function(e){return e.data}).then(function(){return!0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).usernameExists})}},{key:"removeById",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return f.KinveyObservable.create(function(n){if(!1===(0,d.isDefined)(e))return n.error(new l.KinveyError("An id was not provided.","Please provide a valid id for a user that you would like to remove."));if(!1===(0,a.default)(e))return n.error(new l.KinveyError("The id provided is not a string.","Please provide a valid id for a user that you would like to remove."));return new c.KinveyRequest({method:c.RequestMethod.DELETE,authType:c.AuthType.Default,url:s.default.format({protocol:t.client.apiProtocol,host:t.client.apiHost,pathname:t.pathname+"/"+e,query:!0===r.hard?{hard:!0}:void 0}),properties:r.properties,timeout:r.timeout}).execute().then(function(e){return e.data}).then(function(e){return n.next(e)}).then(function(){return n.complete()}).catch(function(e){return n.error(e)})}).toPromise()}},{key:"pathname",get:function(){return"/user/"+this.client.appKey}}]),t}()},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.CustomEndpoint=void 0;var o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=n(r(4)),u=n(r(5)),a=n(r(7)),s=r(1),c=r(8),l=r(6);t.CustomEndpoint=function(){function e(){throw function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),new s.KinveyError("Not allowed to create an instance of the `CustomEndpoint` class.","Please use `CustomEndpoint.execute()` function.")}return o(e,null,[{key:"execute",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=r.client||c.Client.sharedInstance();if(!e)return i.default.reject(new s.KinveyError("An endpoint argument is required."));if(!(0,u.default)(e))return i.default.reject(new s.KinveyError("The endpoint argument must be a string."));return new l.KinveyRequest({method:l.RequestMethod.POST,authType:l.AuthType.Default,url:a.default.format({protocol:n.apiProtocol,host:n.apiHost,pathname:"/rpc/"+n.appKey+"/custom/"+e}),properties:r.properties,body:t,timeout:r.timeout,client:n}).execute().then(function(e){return e.data})}}]),e}()},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function o(e,t){var r=e?parseInt(e.split("-")[1],10)+1:0;return r>=t?t-1:r}Object.defineProperty(t,"__esModule",{value:!0}),t.Files=t.FileStore=void 0;var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),u=n(r(4)),a=n(r(75)),s=n(r(12)),c=n(r(15)),l=n(r(61)),f=n(r(7)),d=r(6),h=r(1),p=r(31),y=r(21),v=r(2),b=r(9),m=r(48),g=t.FileStore=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,m.NetworkStore),i(t,[{key:"find",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n={tls:!0===(r=(0,s.default)({tls:!0},r)).tls};(0,l.default)(r.ttl)&&(n.ttl_in_seconds=parseInt(r.ttl,10));return p.KinveyObservable.create(function(o){if((0,v.isDefined)(e)&&!(e instanceof b.Query))return o.error(new h.KinveyError("Invalid query. It must be an instance of the Query class."));return new d.KinveyRequest({method:d.RequestMethod.GET,authType:d.AuthType.Default,url:f.default.format({protocol:t.client.apiProtocol,host:t.client.apiHost,pathname:t.pathname,query:n}),properties:r.properties,query:e,timeout:r.timeout,client:t.client}).execute().then(function(e){return e.data}).then(function(e){return o.next(e)}).then(function(){return o.complete()}).catch(function(e){return o.error(e)})}).toPromise().then(function(e){return!0===r.download?u.default.all((0,a.default)(e,function(e){return t.downloadByUrl(e._downloadURL,r)})):e})}},{key:"findById",value:function(e,t){return this.download(e,t)}},{key:"download",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n={tls:!0===(r=(0,s.default)({tls:!0},r)).tls};(0,l.default)(r.ttl)&&(n.ttl_in_seconds=parseInt(r.ttl,10));return p.KinveyObservable.create(function(o){if(!1===(0,v.isDefined)(e))return o.next(void 0),o.complete();return new d.KinveyRequest({method:d.RequestMethod.GET,authType:d.AuthType.Default,url:f.default.format({protocol:t.client.apiProtocol,host:t.client.apiHost,pathname:t.pathname+"/"+e,query:n}),properties:r.properties,timeout:r.timeout,client:t.client}).execute().then(function(e){return e.data}).then(function(e){return o.next(e)}).then(function(){return o.complete()}).catch(function(e){return o.error(e)})}).toPromise().then(function(e){return!0===r.stream?e:(r.mimeType=e.mimeType,t.downloadByUrl(e._downloadURL,r))})}},{key:"downloadByUrl",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new d.NetworkRequest({method:d.RequestMethod.GET,url:e,timeout:t.timeout}).execute().then(function(e){return e.data})}},{key:"stream",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t.stream=!0,this.download(e,t)}},{key:"upload",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};r=this.transformMetadata(e,r);var i=null;return this.saveFileMetadata(n,r).then(function(e){return i=e.data,t.makeStatusCheckRequest(e.data._uploadURL,e.data._requiredHeaders,r,n.timeout)}).then(function(a){if(y.Log.debug("File upload status check response",a),!a.isSuccess())return u.default.reject(a.error);if(200===a.statusCode||201===a.statusCode)return a;if(308!==a.statusCode){var s=new h.KinveyError("Unexpected response for upload file status check request.",!1,a.statusCode,a.headers.get("X-Kinvey-Request-ID"));return u.default.reject(s)}var c={start:o(a.headers.get("range"),r.size),timeout:n.timeout,maxBackoff:n.maxBackoff,headers:i._requiredHeaders};return t.retriableUpload(i._uploadURL,e,r,c)}).then(function(){return delete i._expiresAt,delete i._requiredHeaders,delete i._uploadURL,i._data=e,i})}},{key:"transformMetadata",value:function(e,t){var r=(0,s.default)({filename:e._filename||e.name,public:!1,size:e.size||e.length,mimeType:e.mimeType||e.type||"application/octet-stream"},t);return r._filename=t.filename,delete r.filename,r._public=t.public,delete r.public,r}},{key:"saveFileMetadata",value:function(e,t){var r=(0,v.isDefined)(t._id);return new d.KinveyRequest({method:r?d.RequestMethod.PUT:d.RequestMethod.POST,authType:d.AuthType.Default,headers:{"X-Kinvey-Content-Type":t.mimeType},url:f.default.format({protocol:this.client.apiProtocol,host:this.client.apiHost,pathname:r?this.pathname+"/"+t._id:this.pathname}),properties:e.properties,timeout:e.timeout,body:t,client:this.client}).execute()}},{key:"makeStatusCheckRequest",value:function(e,t,r,n){var o=new d.Headers(t);o.set("content-type",r.mimeType),o.set("content-range","bytes */"+r.size);return new d.NetworkRequest({method:d.RequestMethod.PUT,url:e,timeout:n,headers:o}).execute()}},{key:"retriableUpload",value:function(e,t,r,n){var i=this;return n=(0,s.default)({count:0,start:0,maxBackoff:32e3},n),y.Log.debug("Start file upload"),y.Log.debug("File upload headers",n.headers),y.Log.debug("File upload upload url",f.default),y.Log.debug("File upload file",t),y.Log.debug("File upload metadata",r),y.Log.debug("File upload options",n),this.makeUploadRequest(e,t,r,n).then(function(e){if(y.Log.debug("File upload response",e),e.isClientError())return u.default.reject(e.error);if(!e.isSuccess()&&!e.isServerError()&&308!==e.statusCode){var t=new h.KinveyError("Unexpected response for upload file request.",!1,e.statusCode,e.headers.get("X-Kinvey-Request-ID"));return u.default.reject(t)}return e}).then(function(e){var t=0;return e.isServerError()?(y.Log.debug("File upload server error. Probably network congestion.",e.statusCode,e.data),(t=Math.pow(2,n.count)+function(e,t){return Math.floor(Math.random()*(t-e))+e}(1,1001))>=n.maxBackoff?u.default.reject(e.error):(y.Log.debug("File upload will try again in "+t+" seconds."),new u.default(function(e){setTimeout(function(){n.count+=1,e(!0)},t)}))):308===e.statusCode?(y.Log.debug("File upload was incomplete (statusCode 308). Trying to upload the remainder of file."),n.start=o(e.headers.get("range"),r.size),new u.default(function(e){setTimeout(function(){n.count=0,e(!0)},t)})):new u.default(function(e){setTimeout(function(){e(!1)},t)})}).then(function(o){return o?i.retriableUpload(e,t,r,n):null})}},{key:"makeUploadRequest",value:function(e,t,r,n){var o=new d.Headers(n.headers);o.set("content-type",r.mimeType),o.set("content-range","bytes "+n.start+"-"+(r.size-1)+"/"+r.size);return new d.NetworkRequest({method:d.RequestMethod.PUT,url:e,headers:o,body:(0,c.default)(t.slice)?t.slice(n.start):t,timeout:n.timeout}).execute()}},{key:"create",value:function(e,t,r){return this.upload(e,t,r)}},{key:"update",value:function(e,t,r){return this.upload(e,t,r)}},{key:"remove",value:function(){throw new h.KinveyError("Please use removeById() to remove files one by one.")}},{key:"pathname",get:function(){return"/blob/"+this.client.appKey}}]),t}();t.Files=new g},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.NodeHttpMiddleware=void 0;var o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=n(r(336)),u=n(r(4)),a=r(6),s=r(2),c=r(1);t.NodeHttpMiddleware=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return r.pkg=e,r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a.Middleware),o(t,[{key:"handle",value:function(e){var t=this;return new u.default(function(r,n){var o=e.url,u=e.method,a=e.headers,l=e.body,f=e.timeout,d=e.followRedirect;a["X-Kinvey-Device-Information"]=function(e){var t=process.title,r=process.version,n=process.platform;return["js-"+e.name+"/"+e.version].concat([t,r,n]).map(function(e){return e?e.toString().replace(/\s/g,"_").toLowerCase():"unknown"}).join(" ")}(t.pkg),(0,i.default)({method:u,url:o,headers:a,body:l,followRedirect:d,timeout:f},function(e,t,o){return!1===(0,s.isDefined)(t)?"ESOCKETTIMEDOUT"===e.code||"ETIMEDOUT"===e.code?n(new c.TimeoutError("The network request timed out.")):"ENOENT"===e.code?n(new NoNetworkConnectionError("You do not have a network connection.")):n(e):r({response:{statusCode:t.statusCode,headers:t.headers,data:o}})})})}},{key:"cancel",value:function(){return u.default.resolve()}}]),t}()},function(e,t){e.exports=a},function(e,t){e.exports={private:!0,version:"3.9.3",name:"kinvey-node-sdk",description:"Kinvey JavaScript SDK for Node.js applications.",author:"Kinvey, Inc.",homepage:"http://www.kinvey.com",license:"Apache-2.0",main:"kinvey-node-sdk.min.js",dependencies:{"es6-promise":"~4.1.1","fast-memory-cache":"~2.0.4",lodash:"~4.17.4",loglevel:"~1.5.1",pubnub:"~4.19.0",qs:"~6.5.1",request:"~2.83.0",rxjs:"~5.5.2",sift:"~5.0.0","url-join":"~2.0.2"},scripts:{prebuild:"rm -rf dist",build:"webpack --config webpack.config.js",release:"npm run build -- --env.uglify && ./scripts/push.sh",postrelease:"rm -rf tmp"},files:["kinvey-node-sdk.min.js","kinvey-node-sdk.min.js.map"]}}])});
//# sourceMappingURL=kinvey-node-sdk.min.js.map