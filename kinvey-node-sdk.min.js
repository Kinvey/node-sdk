/**
 * kinvey-node-sdk - Kinvey JavaScript SDK for Node.js applications.
 * @version v3.12.0
 * @author Kinvey, Inc.
 * @link http://www.kinvey.com
 * @license Apache-2.0
 */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("es6-promise"),require("qs"),require("rxjs"),require("sift"),require("loglevel"),require("fast-memory-cache"),require("pubnub"),require("url-join"),require("request")):"function"==typeof define&&define.amd?define(["es6-promise","qs","rxjs","sift","loglevel","fast-memory-cache","pubnub","url-join","request"],t):"object"==typeof exports?exports.Kinvey=t(require("es6-promise"),require("qs"),require("rxjs"),require("sift"),require("loglevel"),require("fast-memory-cache"),require("pubnub"),require("url-join"),require("request")):e.Kinvey=t(e["es6-promise"],e.qs,e.rxjs,e.sift,e.loglevel,e["fast-memory-cache"],e.pubnub,e["url-join"],e.request)}("undefined"!=typeof self?self:this,function(e,t,r,n,o,i,u,a,s){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:n})},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=160)}([function(e,t,r){"use strict";function n(e,t,r,n){this.name="BaseError",this.message=e||"An error occurred.",this.debug=t||void 0,this.code=r||void 0,this.kinveyRequestId=n||void 0,this.stack=(new Error).stack}Object.defineProperty(t,"__esModule",{value:!0}),t.BaseError=n,n.prototype=Object.create(Error.prototype),n.prototype.constructor=n},function(t,r){t.exports=e},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(164);Object.keys(n).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return n[e]}})});var o=r(165);Object.keys(o).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return o[e]}})});var i=r(166);Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return i[e]}})});var u=r(167);Object.keys(u).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return u[e]}})});var a=r(168);Object.keys(a).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return a[e]}})});var s=r(0);Object.keys(s).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return s[e]}})});var c=r(169);Object.keys(c).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return c[e]}})});var l=r(170);Object.keys(l).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return l[e]}})});var f=r(171);Object.keys(f).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return f[e]}})});var d=r(172);Object.keys(d).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return d[e]}})});var p=r(173);Object.keys(p).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return p[e]}})});var y=r(174);Object.keys(y).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return y[e]}})});var h=r(175);Object.keys(h).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return h[e]}})});var v=r(176);Object.keys(v).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return v[e]}})});var b=r(177);Object.keys(b).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return b[e]}})});var _=r(178);Object.keys(_).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return _[e]}})});var m=r(179);Object.keys(m).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return m[e]}})});var g=r(180);Object.keys(g).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return g[e]}})});var O=r(181);Object.keys(O).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return O[e]}})});var w=r(182);Object.keys(w).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return w[e]}})});var k=r(183);Object.keys(k).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return k[e]}})});var E=r(184);Object.keys(E).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return E[e]}})});var P=r(185);Object.keys(P).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return P[e]}})});var j=r(186);Object.keys(j).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return j[e]}})});var S=r(187);Object.keys(S).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return S[e]}})});var M=r(188);Object.keys(M).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return M[e]}})});var I=r(189);Object.keys(I).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return I[e]}})});var x=r(190);Object.keys(x).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return x[e]}})});var C=r(191);Object.keys(C).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return C[e]}})});var R=r(192);Object.keys(R).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return R[e]}})});var T=r(193);Object.keys(T).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return T[e]}})});var q=r(194);Object.keys(q).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return q[e]}})});var A=r(195);Object.keys(A).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return A[e]}})});var D=r(196);Object.keys(D).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return D[e]}})});var N=r(197);Object.keys(N).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return N[e]}})});var K=r(198);Object.keys(K).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return K[e]}})});var U=r(199);Object.keys(U).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return U[e]}})});var F=r(200);Object.keys(F).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return F[e]}})});var L=r(201);Object.keys(L).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return L[e]}})});var B=r(202);Object.keys(B).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return B[e]}})})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(90);Object.keys(n).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return n[e]}})});var o=r(91);Object.keys(o).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return o[e]}})});var i=r(348);Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return i[e]}})});var u=r(349);Object.keys(u).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return u[e]}})});var a=r(92);Object.keys(a).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return a[e]}})})},function(e,t){var r=Array.isArray;e.exports=r},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Client=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=p(r(232)),i=p(r(15)),u=p(r(7)),a=p(r(23)),s=p(r(233)),c=r(2),l=r(14),f=r(3),d=r(29);function p(e){return e&&e.__esModule?e:{default:e}}function y(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var h=6e4,v=null,b=function(){function e(){y(this,e),this.memory=new o.default}return n(e,[{key:"get",value:function(e){if(!(0,u.default)(e))throw new c.KinveyError("ActiveUserStorage key must be a string.");try{return JSON.parse(this.memory.get(e))}catch(e){return null}}},{key:"set",value:function(e,t){if(!(0,u.default)(e))throw new c.KinveyError("ActiveUserStorage key must be a string.");return(0,f.isDefined)(t)?this.memory.set(e,JSON.stringify(t)):this.memory.delete(e),t}}]),e}();t.Client=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};y(this,e);var r="https://baas.kinvey.com",n="https://auth.kinvey.com";if(t.instanceId){var o=t.instanceId;if(!(0,u.default)(o))throw new c.KinveyError("Instance ID must be a string.");r="https://"+o+"-baas.kinvey.com",n="https://"+o+"-auth.kinvey.com"}else(0,u.default)(t.apiHostname)&&(r=/^https?:\/\//i.test(t.apiHostname)?t.apiHostname:"https://"+t.apiHostname),(0,u.default)(t.micHostname)&&(n=/^https?:\/\//i.test(t.micHostname)?t.micHostname:"https://"+t.micHostname);var s=i.default.parse(r),l=i.default.parse(n);this.deviceId=(0,f.uuidv4)(),this.apiProtocol=s.protocol,this.apiHost=s.host,this.micProtocol=l.protocol,this.micHost=l.host,this.appKey=t.appKey,this.appSecret=t.appSecret,this.masterSecret=t.masterSecret,this.encryptionKey=t.encryptionKey,this.appVersion=t.appVersion,this.defaultTimeout=(0,a.default)(t.defaultTimeout)&&t.defaultTimeout>=0?t.defaultTimeout:h,this.activeUserStorage=new b,this.storage=t.storage||d.StorageProvider.Memory}return n(e,[{key:"getActiveUser",value:function(){return this.activeUserStorage.get(this.appKey+"."+f.activeUserKey)}},{key:"setActiveUser",value:function(e){return this.activeUserStorage.set(this.appKey+"."+f.activeUserKey,e)}},{key:"toPlainObject",value:function(){return{deviceId:this.deviceId,apiHostname:this.apiHostname,apiProtocol:this.apiProtocol,apiHost:this.apiHost,micHostname:this.micHostname,micProtocol:this.micProtocol,micHost:this.micHost,appKey:this.appKey,appSecret:this.appSecret,masterSecret:this.masterSecret,encryptionKey:this.encryptionKey,appVersion:this.appVersion,storage:this.storage}}},{key:"apiHostname",get:function(){return i.default.format({protocol:this.apiProtocol,host:this.apiHost})}},{key:"micHostname",get:function(){return i.default.format({protocol:this.micProtocol,host:this.micHost})}},{key:"appVersion",get:function(){return this._appVersion},set:function(e){e&&!(0,u.default)(e)&&(e=String(e)),this._appVersion=e}},{key:"defaultTimeout",get:function(){return this._defaultTimeout},set:function(e){if(e=parseInt(e,10),!1===(0,a.default)(e)||(0,s.default)(e))throw new c.KinveyError("Invalid timeout. Timeout must be a number.");e<0&&(l.Log.info("Default timeout is less than 0. Setting default timeout to "+this.defaultTimeout+"ms."),e=this.defaultTimeout),this._defaultTimeout=e}},{key:"storage",get:function(){return this._storage},set:function(e){if(!(0,f.isValidStorageProviderValue)(e))throw new c.KinveyError("Please provide a valid set of supported storage providers for this platform");this._storage=e}}],[{key:"initialize",value:function(){throw new c.KinveyError("Please use Client.init().")}},{key:"init",value:function(t){return v=new e(t)}},{key:"sharedInstance",value:function(){if(!1===(0,f.isDefined)(v))throw new c.KinveyError("You have not initialized the library. Please call Kinvey.init() to initialize the library.");return v}}]),e}()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(48);Object.keys(n).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return n[e]}})});var o=r(116);Object.keys(o).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return o[e]}})});var i=r(117);Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return i[e]}})});var u=r(75);Object.keys(u).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return u[e]}})});var a=r(118);Object.keys(a).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return a[e]}})});var s=r(125);Object.keys(s).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return s[e]}})})},function(e,t,r){var n=r(17),o=r(4),i=r(12),u="[object String]";e.exports=function(e){return"string"==typeof e||!o(e)&&i(e)&&n(e)==u}},function(e,t){e.exports=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}},function(e,t,r){var n=r(65),o=r(24),i=r(102),u=r(21),a=r(26),s=r(18),c=Object.prototype.hasOwnProperty,l=i(function(e,t){if(a(t)||u(t))o(t,s(t),e);else for(var r in t)c.call(t,r)&&n(e,r,t[r])});e.exports=l},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Query=void 0;var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=f(r(228)),u=f(r(31)),a=f(r(106)),s=r(2),c=r(3),l=r(14);function f(e){return e&&e.__esModule?e:{default:e}}var d=["_id","_acl"],p=["$nearSphere"],y=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),t=(0,a.default)(t,{fields:[],filter:{},sort:null,limit:null,skip:0}),this.fields=t.fields,this.filter=t.filter,this.sort=t.sort,this.limit=t.limit,this.skip=t.skip,this._parent=null}return o(e,[{key:"isSupportedOffline",value:function(){var e=this;return Object.keys(this.filter).reduce(function(t,r){if(t){var o=e.filter[r];return p.some(function(e){return!o||("object"!==(void 0===o?"undefined":n(o))||!Object.keys(o).some(function(t){return t===e}))})}return t},!0)}},{key:"hasSkip",value:function(){return(0,c.isNumber)(this.skip)&&this.skip>0}},{key:"hasLimit",value:function(){return(0,c.isNumber)(this.limit)}},{key:"equalTo",value:function(e,t){return this.addFilter(e,t)}},{key:"contains",value:function(e,t){if(!1===(0,c.isDefined)(t))throw new s.QueryError("You must supply a value.");return!1===Array.isArray(t)&&(t=[t]),this.addFilter(e,"$in",t)}},{key:"containsAll",value:function(e,t){if(!1===(0,c.isDefined)(t))throw new s.QueryError("You must supply a value.");return!1===Array.isArray(t)&&(t=[t]),this.addFilter(e,"$all",t)}},{key:"greaterThan",value:function(e,t){if(!1===(0,c.isNumber)(t)&&"string"!=typeof t)throw new s.QueryError("You must supply a number or string.");return this.addFilter(e,"$gt",t)}},{key:"greaterThanOrEqualTo",value:function(e,t){if(!1===(0,c.isNumber)(t)&&"string"!=typeof t)throw new s.QueryError("You must supply a number or string.");return this.addFilter(e,"$gte",t)}},{key:"lessThan",value:function(e,t){if(!1===(0,c.isNumber)(t)&&"string"!=typeof t)throw new s.QueryError("You must supply a number or string.");return this.addFilter(e,"$lt",t)}},{key:"lessThanOrEqualTo",value:function(e,t){if(!1===(0,c.isNumber)(t)&&"string"!=typeof t)throw new s.QueryError("You must supply a number or string.");return this.addFilter(e,"$lte",t)}},{key:"notEqualTo",value:function(e,t){return this.addFilter(e,"$ne",t)}},{key:"notContainedIn",value:function(e,t){return!1===Array.isArray(t)&&(t=[t]),this.addFilter(e,"$nin",t)}},{key:"and",value:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return this.join("$and",t)}},{key:"nor",value:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];var n;return(0,c.isDefined)(this._parent)&&Object.hasOwnProperty.call(this._parent.filter,"$and")?(n=this._parent).nor.apply(n,t):this.join("$nor",t)}},{key:"or",value:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];var n;return(0,c.isDefined)(this._parent)?(n=this._parent).or.apply(n,t):this.join("$or",t)}},{key:"exists",value:function(e,t){return t=void 0===t||(t||!1),this.addFilter(e,"$exists",t)}},{key:"mod",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if("string"==typeof t&&(t=parseFloat(t)),"string"==typeof r&&(r=parseFloat(r)),!(0,c.isNumber)(t))throw new s.QueryError("divisor must be a number");if(!(0,c.isNumber)(r))throw new s.QueryError("remainder must be a number");return this.addFilter(e,"$mod",[t,r])}},{key:"matches",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=[];if(t instanceof RegExp||(t=new RegExp(t)),0!==t.source.indexOf("^"))throw new s.QueryError("regExp must have '^' at the beginning of the expression to make it an anchored expression.");if((t.ignoreCase||r.ignoreCase)&&!1!==r.ignoreCase)throw new s.QueryError("ignoreCase flag is not supported");return(t.multiline||r.multiline)&&!1!==r.multiline&&n.push("m"),!0===r.extended&&n.push("x"),!0===r.dotMatchesAll&&n.push("s"),n.length>0&&this.addFilter(e,"$options",n.join("")),this.addFilter(e,"$regex",t.source)}},{key:"near",value:function(e,t,r){if(!Array.isArray(t)||!(0,c.isNumber)(t[0])||!(0,c.isNumber)(t[1]))throw new s.QueryError("coord must be a [number, number]");var n=this.addFilter(e,"$nearSphere",[t[0],t[1]]);return(0,c.isNumber)(r)&&this.addFilter(e,"$maxDistance",r),n}},{key:"withinBox",value:function(e,t,r){if(!Array.isArray(t)||!(0,c.isNumber)(t[0])||!(0,c.isNumber)(t[1]))throw new s.QueryError("bottomLeftCoord must be a [number, number]");if(!Array.isArray(r)||!(0,c.isNumber)(r[0])||!(0,c.isNumber)(r[1]))throw new s.QueryError("upperRightCoord must be a [number, number]");t[0]=parseFloat(t[0]),t[1]=parseFloat(t[1]),r[0]=parseFloat(r[0]),r[1]=parseFloat(r[1]);var n=[[t[0],t[1]],[r[0],r[1]]];return this.addFilter(e,"$within",{$box:n})}},{key:"withinPolygon",value:function(e,t){if(!1===Array.isArray(t)||0===t.length||t.length>3)throw new s.QueryError("coords must be a [[number, number]]");return t=t.map(function(e){if(!1===(0,c.isNumber)(e[0])||!1===(0,c.isNumber)(e[1]))throw new s.QueryError("coords argument must be a [number, number]");return[parseFloat(e[0]),parseFloat(e[1])]}),this.addFilter(e,"$within",{$polygon:t})}},{key:"size",value:function(e,t){if("string"==typeof t&&(t=parseFloat(t)),!(0,c.isNumber)(t))throw new s.QueryError("size must be a number");return this.addFilter(e,"$size",t)}},{key:"ascending",value:function(e){return(0,c.isDefined)(this._parent)?this._parent.ascending(e):this.sort[e]=1,this}},{key:"descending",value:function(e){return(0,c.isDefined)(this._parent)?this._parent.descending(e):this.sort[e]=-1,this}},{key:"addFilter",value:function(e,t,r){return(0,c.isDefined)(t)&&((0,c.isDefined)(r)||3===arguments.length)?((0,u.default)(this.filter[e])||(this.filter[e]={}),this.filter[e][t]=r):this.filter[e]=t,this}},{key:"join",value:function(t,r){var n=this,o=this,i={};return 0===(r=r.map(function(t){if(!(t instanceof e)){if(!(0,u.default)(t))throw new s.QueryError("query argument must be of type: Kinvey.Query[] or Object[].");t=new e(t)}return t.toPlainObject().filter})).length&&(r=[(o=new e).toPlainObject().filter],o._parent=this),Object.keys(this.filter).forEach(function(e){i[e]=n.filter[e],delete n.filter[e]}),this.filter[t]=[i].concat(r),o}},{key:"process",value:function(e){if(!this.isSupportedOffline()){var t="This query is not able to run locally. The following filters are not supported locally:";throw p.forEach(function(e){t=t+" "+e}),l.Log.error(t),new s.QueryError(t)}if(!Array.isArray(e))throw new s.QueryError("data argument must be of type: Array.");l.Log.debug("Data length before processiong query",e.length);var r=this.toPlainObject();if(e=(0,i.default)(r.filter,e),l.Log.debug("Data length after applying query filter",r.filter,e.length),(0,c.isDefined)(r.sort)&&(l.Log.debug("Sorting data",r.sort),e.sort(function(e,t){for(var n in r.sort)if(r.sort.hasOwnProperty(n)){var o=(0,c.nested)(e,n),i=(0,c.nested)(t,n),u=r.sort[n];if((0,c.isDefined)(o)&&!1===(0,c.isDefined)(i))return 1*u;if(!1===(0,c.isDefined)(o)&&(0,c.isDefined)(i))return-1*u;if(void 0===o&&null===i)return 0;if(null===o&&void 0===i)return 0;if(o!==i)return(o<i?-1:1)*u}return 0})),Array.isArray(r.fields)&&r.fields.length>0){var n=[].concat(r.fields,d);l.Log.debug("Removing fields from data",r.fields),e=e.map(function(e){return Object.keys(e).forEach(function(t){-1===n.indexOf(t)&&delete e[t]}),e})}return(0,c.isNumber)(r.skip)?(0,c.isNumber)(r.limit)&&r.limit>0?(l.Log.debug("Skipping and limiting data",r.skip,r.limit),e.slice(r.skip,r.skip+r.limit)):(l.Log.debug("Skipping data",r.skip),e.slice(r.skip)):e}},{key:"toPlainObject",value:function(){return(0,c.isDefined)(this._parent)?this._parent.toPlainObject():{fields:this.fields,filter:this.filter,sort:this.sort,skip:this.skip,limit:this.limit}}},{key:"toQueryString",value:function(){var e={};return Object.keys(this.filter).length>0&&(e.query=this.filter),this.fields.length>0&&(e.fields=this.fields.join(",")),(0,c.isNumber)(this.limit)&&(e.limit=this.limit),(0,c.isNumber)(this.skip)&&this.skip>0&&(e.skip=this.skip),Object.keys(this.sort).length>0&&(e.sort=this.sort),Object.keys(e).forEach(function(t){e[t]="string"==typeof e[t]?e[t]:JSON.stringify(e[t])}),e}},{key:"toString",value:function(){return JSON.stringify(this.toQueryString())}},{key:"fields",get:function(){return this._fields},set:function(e){if(e=e||[],!Array.isArray(e))throw new s.QueryError("fields must be an Array");(0,c.isDefined)(this._parent)?this._parent.fields=e:this._fields=e}},{key:"filter",get:function(){return this._filter},set:function(e){this._filter=e}},{key:"sort",get:function(){return this._sort},set:function(e){if(e&&!(0,u.default)(e))throw new s.QueryError("sort must an Object");(0,c.isDefined)(this._parent)?this._parent.sort=e:this._sort=e||{}}},{key:"limit",get:function(){return this._limit},set:function(e){if("string"==typeof e&&(e=parseFloat(e)),(0,c.isDefined)(e)&&!1===(0,c.isNumber)(e))throw new s.QueryError("limit must be a number");this._parent?this._parent.limit=e:this._limit=e}},{key:"skip",get:function(){return this._skip},set:function(e){if("string"==typeof e&&(e=parseFloat(e)),!1===(0,c.isNumber)(e))throw new s.QueryError("skip must be a number");(0,c.isDefined)(this._parent)?this._parent.skip=e:this._skip=e}}]),e}();t.Query=y},function(e,t,r){var n=r(96),o="object"==typeof self&&self&&self.Object===Object&&self,i=n||o||Function("return this")();e.exports=i},function(e,t){e.exports=function(e){return null!=e&&"object"==typeof e}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(332);Object.keys(n).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return n[e]}})});var o=r(333);Object.keys(o).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return o[e]}})})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Log=void 0;var n,o=r(231),i=(n=o)&&n.__esModule?n:{default:n};i.default.setDefaultLevel(i.default.levels.SILENT);var u=i.default.methodFactory;i.default.methodFactory=function(e,t,r){var n=u(e,t,r);return function(e){e="Kinvey: "+e;for(var t=arguments.length,r=Array(t>1?t-1:0),o=1;o<t;o++)r[o-1]=arguments[o];r.length>0?n(e,r):n(e)}},t.Log=i.default},function(e,t){e.exports=require("url")},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(81);Object.keys(n).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return n[e]}})});var o=r(129);Object.keys(o).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return o[e]}})});var i=r(130);Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return i[e]}})});var u=r(133);Object.keys(u).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return u[e]}})});var a=r(341);Object.keys(a).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return a[e]}})});var s=r(132);Object.keys(s).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return s[e]}})})},function(e,t,r){var n=r(28),o=r(208),i=r(209),u="[object Null]",a="[object Undefined]",s=n?n.toStringTag:void 0;e.exports=function(e){return null==e?void 0===e?a:u:s&&s in Object(e)?o(e):i(e)}},function(e,t,r){var n=r(105),o=r(94),i=r(21);e.exports=function(e){return i(e)?n(e):o(e)}},function(e,t,r){var n=r(207),o=r(212);e.exports=function(e,t){var r=o(e,t);return n(r)?r:void 0}},function(e,t,r){var n=r(17),o=r(8),i="[object AsyncFunction]",u="[object Function]",a="[object GeneratorFunction]",s="[object Proxy]";e.exports=function(e){if(!o(e))return!1;var t=n(e);return t==u||t==a||t==i||t==s}},function(e,t,r){var n=r(20),o=r(59);e.exports=function(e){return null!=e&&o(e.length)&&!n(e)}},function(e,t,r){var n=r(94),o=r(27),i=r(58),u=r(4),a=r(21),s=r(36),c=r(26),l=r(61),f="[object Map]",d="[object Set]",p=Object.prototype.hasOwnProperty;e.exports=function(e){if(null==e)return!0;if(a(e)&&(u(e)||"string"==typeof e||"function"==typeof e.splice||s(e)||l(e)||i(e)))return!e.length;var t=o(e);if(t==f||t==d)return!e.size;if(c(e))return!n(e).length;for(var r in e)if(p.call(e,r))return!1;return!0}},function(e,t,r){var n=r(17),o=r(12),i="[object Number]";e.exports=function(e){return"number"==typeof e||o(e)&&n(e)==i}},function(e,t,r){var n=r(65),o=r(66);e.exports=function(e,t,r,i){var u=!r;r||(r={});for(var a=-1,s=t.length;++a<s;){var c=t[a],l=i?i(r[c],e[c],c,r,e):void 0;void 0===l&&(l=e[c]),u?o(r,c,l):n(r,c,l)}return r}},function(e,t){var r=e.exports={version:"2.5.3"};"number"==typeof __e&&(__e=r)},function(e,t){var r=Object.prototype;e.exports=function(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||r)}},function(e,t,r){var n=r(206),o=r(57),i=r(213),u=r(214),a=r(215),s=r(17),c=r(97),l=c(n),f=c(o),d=c(i),p=c(u),y=c(a),h=s;(n&&"[object DataView]"!=h(new n(new ArrayBuffer(1)))||o&&"[object Map]"!=h(new o)||i&&"[object Promise]"!=h(i.resolve())||u&&"[object Set]"!=h(new u)||a&&"[object WeakMap]"!=h(new a))&&(h=function(e){var t=s(e),r="[object Object]"==t?e.constructor:void 0,n=r?c(r):"";if(n)switch(n){case l:return"[object DataView]";case f:return"[object Map]";case d:return"[object Promise]";case p:return"[object Set]";case y:return"[object WeakMap]"}return t}),e.exports=h},function(e,t,r){var n=r(11).Symbol;e.exports=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(64);Object.keys(n).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return n[e]}})});var o=r(142);Object.keys(o).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return o[e]}})});var i=r(347);Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return i[e]}})});var u=r(68);Object.keys(u).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return u[e]}})});var a=r(32);Object.keys(a).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return a[e]}})});var s=r(82);Object.keys(s).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return s[e]}})});var c=r(33);Object.keys(c).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return c[e]}})});var l=r(16);Object.keys(l).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return l[e]}})});var f=r(55);Object.keys(f).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return f[e]}})})},function(e,t){e.exports=function(e,t){return e===t||e!=e&&t!=t}},function(e,t,r){var n=r(17),o=r(69),i=r(12),u="[object Object]",a=Function.prototype,s=Object.prototype,c=a.toString,l=s.hasOwnProperty,f=c.call(Object);e.exports=function(e){if(!i(e)||n(e)!=u)return!1;var t=o(e);if(null===t)return!0;var r=l.call(t,"constructor")&&t.constructor;return"function"==typeof r&&r instanceof r&&c.call(r)==f}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(326);Object.keys(n).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return n[e]}})});var o=r(327);Object.keys(o).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return o[e]}})})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(128);Object.keys(n).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return n[e]}})});var o=r(80);Object.keys(o).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return o[e]}})});var i=r(136);Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return i[e]}})});var u=r(342);Object.keys(u).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return u[e]}})})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.webSqlDatabaseSize=t.webSqlCollectionsMaster=t.sqliteCollectionsMaster=t.browserStorageCollectionsMaster=t.inedxedDbTransctionMode=void 0,t.domStringListToStringArray=function(e){var t=[];return(0,i.default)(e.length,function(r){t.push(e[r])}),t};var n,o=r(98),i=(n=o)&&n.__esModule?n:{default:n};t.inedxedDbTransctionMode={readWrite:"readwrite",readOnly:"readonly"},t.browserStorageCollectionsMaster="__master__",t.sqliteCollectionsMaster="sqlite_master",t.webSqlCollectionsMaster="sqlite_master",t.webSqlDatabaseSize=2097152},function(e,t){var r=e.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=r)},function(e,t,r){(function(e){var n=r(11),o=r(217),i="object"==typeof t&&t&&!t.nodeType&&t,u=i&&"object"==typeof e&&e&&!e.nodeType&&e,a=u&&u.exports===i?n.Buffer:void 0,s=(a?a.isBuffer:void 0)||o;e.exports=s}).call(t,r(60)(e))},function(e,t){e.exports=function(e){return e}},function(e,t,r){var n=r(17),o=r(12),i="[object Symbol]";e.exports=function(e){return"symbol"==typeof e||o(e)&&n(e)==i}},function(e,t,r){var n=r(105),o=r(229),i=r(21);e.exports=function(e){return i(e)?n(e,!0):o(e)}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.KinveyObservable=void 0;var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();t.wrapInObservable=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=(0,c.isPromiseLike)(e);return b.create(function(n){var o=void 0;if(r)o=e;else{var i=e(n);o=(0,c.wrapInPromise)(i)}o.then(function(e){r&&n.next(e),t&&n.complete()}).catch(function(e){return n.error(e)})})};var i=l(r(1)),u=r(93),a=r(234),s=l(r(20)),c=r(3);function l(e){return e&&e.__esModule?e:{default:e}}function f(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function d(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function p(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var y={closed:!0,next:function(){},error:function(e){throw e},complete:function(){},status:function(){},presence:function(){}},h=function(e){function t(e,r,n,o,i,u){f(this,t);var a=d(this,(t.__proto__||Object.getPrototypeOf(t)).call(this)),c=void 0,l=a;return a._parentSubscriber=e,(0,s.default)(r)?c=r:r&&(c=r.next,n=r.error,o=r.complete,r!==y&&(l=Object.create(r),(0,s.default)(l.unsubscribe)&&a.add(l.unsubscribe.bind(l)),l.unsubscribe=a.unsubscribe.bind(a))),a._context=l,a._next=c,a._error=n,a._complete=o,a._status=i,a._presence=u,a}return p(t,u.Subscriber),o(t,[{key:"next",value:function(e){if(!this.isStopped&&this._next){var t=this._parentSubscriber;t.syncErrorThrowable?this.__tryOrSetError(t,this._next,e)&&this.unsubscribe():this.__tryOrUnsub(this._next,e)}}},{key:"error",value:function(e){if(!this.isStopped){var t=this._parentSubscriber;if(this._error)t.syncErrorThrowable?(this.__tryOrSetError(t,this._error,e),this.unsubscribe()):(this.__tryOrUnsub(this._error,e),this.unsubscribe());else{if(!t.syncErrorThrowable)throw this.unsubscribe(),e;t.syncErrorValue=e,t.syncErrorThrown=!0,this.unsubscribe()}}}},{key:"complete",value:function(){var e=this;if(!this.isStopped){var t=this._parentSubscriber;if(this._complete){var r=function(){return e._complete.call(e._context)};t.syncErrorThrowable?(this.__tryOrSetError(t,r),this.unsubscribe()):(this.__tryOrUnsub(r),this.unsubscribe())}else this.unsubscribe()}}},{key:"status",value:function(e){if(!this.isStopped&&this._status){var t=this._parentSubscriber;t.syncErrorThrowable?this.__tryOrSetError(t,this._status,e)&&this.unsubscribe():this.__tryOrUnsub(this._status,e)}}},{key:"presence",value:function(e){if(!this.isStopped&&this._presence){var t=this._parentSubscriber;t.syncErrorThrowable?this.__tryOrSetError(t,this._presence,e)&&this.unsubscribe():this.__tryOrUnsub(this._presence,e)}}},{key:"__tryOrUnsub",value:function(e,t){try{e.call(this._context,t)}catch(e){throw this.error(e),e}}},{key:"__tryOrSetError",value:function(e,t,r){try{t.call(this._context,r)}catch(t){return e.syncErrorValue=t,e.syncErrorThrown=!0,!0}return!1}},{key:"_unsubscribe",value:function(){var e=this._parentSubscriber;this._context=null,this._parentSubscriber=null,e.unsubscribe()}}]),t}(),v=function(e){function t(e,r,o,i,a){f(this,t);var s=d(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,r,o));switch(arguments.length){case 0:s.destination=y;break;case 1:if(!1===(0,c.isDefined)(e)){s.destination=y;break}if("object"===(void 0===e?"undefined":n(e))){e instanceof u.Subscriber?(s.destination=e,s.destination.add(s)):(s.syncErrorThrowable=!0,s.destination=new h(s,e));break}default:s.syncErrorThrowable=!0,s.destination=new h(s,e,r,o,i,a)}return s}return p(t,u.Subscriber),o(t,[{key:"status",value:function(e){this.isStopped||this._status(e)}},{key:"presence",value:function(e){this.isStopped||this._presence(e)}},{key:"_status",value:function(e){this.destination.status(e)}},{key:"_presence",value:function(e){this.destination.presence(e)}}]),t}();var b=t.KinveyObservable=function(e){function t(){return f(this,t),d(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return p(t,u.Observable),o(t,[{key:"subscribe",value:function(e,t,r,n,o){var i=this.operator,u=function(e,t,r,n,o){if(e){if(e instanceof v)return e;if(e[a.rxSubscriber])return e[a.rxSubscriber]()}return e||t||r||n||o?new v(e,t,r,n,o):new v(y)}(e,t,r,n,o);if(i?i.call(u,this.source):u.add(this._trySubscribe(u)),u.syncErrorThrowable&&(u.syncErrorThrowable=!1,u.syncErrorThrown))throw u.syncErrorValue;return u}},{key:"toPromise",value:function(){var e=this;return new i.default(function(t,r){var n=void 0;e.subscribe(function(e){n=e},r,function(){t(n)})})}}],[{key:"create",value:function(e){return new t(e)}}]),t}()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Aggregation=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=p(r(9)),i=p(r(107)),u=p(r(7)),a=p(r(8)),s=p(r(20)),c=p(r(239)),l=r(2),f=r(3),d=r(10);function p(e){return e&&e.__esModule?e:{default:e}}t.Aggregation=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),t=(0,o.default)({query:null,initial:{},key:{},reduceFn:function(){}.toString()},t),this.query=t.query,this.initial=t.initial,this.key=t.key,this.reduceFn=t.reduceFn}return n(e,[{key:"by",value:function(e){return this.key[e]=!0,this}},{key:"process",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=this.toPlainObject(),r=Object.keys(t.key),n=t.reduceFn.replace(/function[\s\S]*?\([\s\S]*?\)/,"");if(t.reduce=new Function(["doc","out"],n),this.query&&(e=this.query.process(e)),r.length>0){var u=[];return r.forEach(function(r){var n={};e.forEach(function(e){var o=e[r],i=(0,f.isDefined)(n[o])?n[o]:(0,c.default)(t.initial),u=t.reduce(e,i);(0,f.isDefined)(u)&&(i=u),n[o]=i}),Object.keys(n).forEach(function(e){var t={};t[r]=e,t=(0,o.default)({},t,n[e]),u.push(t)})}),u}var a=(0,c.default)(t.initial);return(0,i.default)(e,function(e){var r=t.reduce(e,a);(0,f.isDefined)(r)&&(a=r)}),a}},{key:"toPlainObject",value:function(){return{key:this.key,initial:this.initial,reduce:this.reduceFn,reduceFn:this.reduceFn,condition:this.query?this.query.toPlainObject().filter:{},query:this.query?this.query.toPlainObject():null}}},{key:"initial",get:function(){return(0,c.default)(this._initial)},set:function(e){if(!(0,a.default)(e))throw new l.KinveyError("initial must be an Object.");this._initial=e}},{key:"query",get:function(){return this._query},set:function(e){if((0,f.isDefined)(e)&&!(e instanceof d.Query))throw new l.KinveyError("Invalid query. It must be an instance of the Query class.");this._query=e}},{key:"reduceFn",get:function(){return this._reduceFn},set:function(e){if((0,s.default)(e)&&(e=e.toString()),!(0,u.default)(e))throw new l.KinveyError("fn argument must be of type function or string.");this._reduceFn=e}}],[{key:"count",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";t=t.replace("'","\\'");var r=new e;return r.by(t),r.initial={count:0},r.reduceFn="function(doc, out) {  out.count += 1;  return out;}",r}},{key:"sum",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";t=t.replace("'","\\'");var r=new e;return r.initial={sum:0},r.reduceFn='function(doc, out) {  out.sum += doc["'+t+'"];  return out;}',r}},{key:"min",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";t=t.replace("'","\\'");var r=new e;return r.initial={min:1/0},r.reduceFn='function(doc, out) {  out.min = Math.min(out.min, doc["'+t+'"]);  return out;}',r}},{key:"max",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";t=t.replace("'","\\'");var r=new e;return r.initial={max:-1/0},r.reduceFn='function(doc, out) {  out.max = Math.max(out.max, doc["'+t+'"]);  return out;}',r}},{key:"average",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";t=t.replace("'","\\'");var r=new e;return r.initial={count:0,average:0},r.reduceFn='function(doc, out) {  out.average = (out.average * out.count + doc["'+t+'"]) / (out.count + 1);  out.count += 1;  return out;}',r}}]),e}()},function(e,t,r){var n=r(235),o=r(238)(n);e.exports=o},function(e,t,r){var n=r(240),o=r(241),i=r(242),u=r(243),a=r(244);function s(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}s.prototype.clear=n,s.prototype.delete=o,s.prototype.get=i,s.prototype.has=u,s.prototype.set=a,e.exports=s},function(e,t,r){var n=r(30);e.exports=function(e,t){for(var r=e.length;r--;)if(n(e[r][0],t))return r;return-1}},function(e,t,r){var n=r(19)(Object,"create");e.exports=n},function(e,t,r){var n=r(258);e.exports=function(e,t){var r=e.__data__;return n(t)?r["string"==typeof t?"string":"hash"]:r.map}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(282);Object.keys(n).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return n[e]}})});var o=r(79);Object.keys(o).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return o[e]}})});var i=r(126);Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return i[e]}})});var u=r(325);Object.keys(u).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return u[e]}})})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Headers=t.kinveyRequestStartHeader=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=s(r(107)),i=s(r(7)),u=s(r(31)),a=r(3);function s(e){return e&&e.__esModule?e:{default:e}}var c=t.kinveyRequestStartHeader="X-Kinvey-Request-Start";t.Headers=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.headers={},this.addAll(t)}return n(e,[{key:"get",value:function(e){if(e)return!1===(0,i.default)(e)&&(e=String(e)),this.headers[e.toLowerCase()]}},{key:"set",value:function(e,t){if(!1===(0,a.isDefined)(e)||!1===(0,a.isDefined)(t))throw new Error("A name and value must be provided to set a header.");!1===(0,i.default)(e)&&(e=String(e));var r=this.headers;return e=e.toLowerCase(),!1===(0,i.default)(t)?r[e]=JSON.stringify(t):r[e]=t,this.headers=r,this}},{key:"has",value:function(e){return!!this.get(e)}},{key:"add",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.set(e.name,e.value)}},{key:"addAll",value:function(){var t=this,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(r instanceof e&&(r=r.toPlainObject()),!1===(0,u.default)(r))throw new Error("Headers argument must be an object.");var n=Object.keys(r);return(0,o.default)(n,function(e){try{t.set(e,r[e])}catch(e){}}),this}},{key:"remove",value:function(e){if(e){!1===(0,i.default)(e)&&(e=String(e));var t=this.headers;delete t[e.toLowerCase()],this.headers=t}return this}},{key:"clear",value:function(){return this.headers={},this}},{key:"toPlainObject",value:function(){return this.headers}},{key:"toString",value:function(){return JSON.stringify(this.toPlainObject())}},{key:"requestStart",get:function(){return this.get(c)}}]),e}()},function(e,t,r){var n=r(38),o=1/0;e.exports=function(e){if("string"==typeof e||n(e))return e;var t=e+"";return"0"==t&&1/e==-o?"-0":t}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Middleware=void 0;var n,o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(1),u=(n=i)&&n.__esModule?n:{default:n},a=r(319);t.Middleware=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Middleware";!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.name=t}return o(e,[{key:"handle",value:function(){return u.default.reject(new Error("A subclass middleware must override the handle function."))}},{key:"cancel",value:function(){return u.default.resolve()}},{key:"generateTree",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return{value:this.name,level:e,nodes:[]}}},{key:"toString",value:function(){var e=this.generateTree();return a.AsciiTree.generate(e)}}]),e}()},function(e,t,r){var n=r(109),o=4;e.exports=function(e){return n(e,o)}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.testSupportCollection=void 0,t.buildCollectionUrl=function(e,t,r){e=(0,o.stripTagFromCollectionName)(e);var i="appdata/"+n.Client.sharedInstance().appKey+"/"+e;t&&(i+="/"+t);r&&(i+="/"+r);return i},t.applyQueryToDataset=function(e,t){if(!t)return e;return t.process(e)},t.applyAggregationToDataset=function(e,t){return t.process(e)};var n=r(5),o=r(13);t.testSupportCollection="__testSupport__"},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();var o={};t.KeyValuePersister=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1/0;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._cacheEnabled=t,this._ttl=r}return n(e,[{key:"read",value:function(e){var t=this;return this._cacheEnabled&&o[e]?Promise.resolve(o[e]):this._readFromPersistance(e).then(function(r){return t._cacheEnabled&&(o[e]=r),r})}},{key:"write",value:function(e,t){var r=this;return this._invalidateCache(e),this._writeToPersistance(e,t).then(function(t){return r._cacheEnabled&&r._ttl<1/0&&setTimeout(function(){r._invalidateCache(e)},r._ttl),t})}},{key:"delete",value:function(e){var t=this;return this._deleteFromPersistance(e).then(function(r){return t._invalidateCache(e),r})}},{key:"getKeys",value:function(){this._throwNotImplementedError()}},{key:"_throwNotImplementedError",value:function(){throw new Error("Abstract method not implemented")}},{key:"_readFromPersistance",value:function(e){this._throwNotImplementedError(e)}},{key:"_writeToPersistance",value:function(e,t){this._throwNotImplementedError(e,t)}},{key:"_deleteFromPersistance",value:function(e){this._throwNotImplementedError(e)}},{key:"_invalidateCache",value:function(e){this._cacheEnabled&&delete o[e]}}]),e}()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.queryCacheCollectionName=void 0,t.getCachedQuery=function(e,t){var r=f(t);if(!r&&""!==r)return n.Promise.resolve(null);return a.repositoryProvider.getOfflineRepository().then(function(t){var n=(new u.Query).equalTo("collectionName",e).and().equalTo("query",r);return t.read(l,n).then(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return t.length>0?t[0]:{_id:(0,s.generateEntityId)(),collectionName:e,query:r}})})},t.createCachedQuery=function(e,t){var r=f(t);if(!r)return n.Promise.resolve(null);return a.repositoryProvider.getOfflineRepository().then(function(t){var n={_id:(0,s.generateEntityId)(),collectionName:e,query:r};return t.create(l,n)})},t.updateCachedQuery=function(e){if(!e)return n.Promise.resolve(null);return a.repositoryProvider.getOfflineRepository().then(function(t){return t.update(l,e)})},t.deleteCachedQuery=function(e){if(!e)return n.Promise.resolve(null);return a.repositoryProvider.getOfflineRepository().then(function(t){return t.deleteById(l,e._id)})},t.clearQueryCache=function(e){return a.repositoryProvider.getOfflineRepository().then(function(t){var r=(new u.Query).equalTo("collectionName",e);return t.delete(l,r)})};var n=r(1),o=c(r(23)),i=c(r(22)),u=r(10),a=r(16),s=r(13);function c(e){return e&&e.__esModule?e:{default:e}}var l=t.queryCacheCollectionName="_QueryCache";function f(e){if(e&&((0,o.default)(e.skip)&&e.skip>0||(0,o.default)(e.limit)))return null;var t=e?e.toQueryString():{};return t&&!(0,i.default)(t)?JSON.stringify(t):""}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(137);Object.keys(n).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return n[e]}})});var o=r(139);Object.keys(o).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return o[e]}})});var i=r(141);Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return i[e]}})});var u=r(346);Object.keys(u).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return u[e]}})})},function(e,t){e.exports=function(e){return"object"==typeof e?null!==e:"function"==typeof e}},function(e,t,r){var n=r(19)(r(11),"Map");e.exports=n},function(e,t,r){var n=r(216),o=r(12),i=Object.prototype,u=i.hasOwnProperty,a=i.propertyIsEnumerable,s=n(function(){return arguments}())?n:function(e){return o(e)&&u.call(e,"callee")&&!a.call(e,"callee")};e.exports=s},function(e,t){var r=9007199254740991;e.exports=function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=r}},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(e,t,r){var n=r(218),o=r(62),i=r(63),u=i&&i.isTypedArray,a=u?o(u):n;e.exports=a},function(e,t){e.exports=function(e){return function(t){return e(t)}}},function(e,t,r){(function(e){var n=r(96),o="object"==typeof t&&t&&!t.nodeType&&t,i=o&&"object"==typeof e&&e&&!e.nodeType&&e,u=i&&i.exports===o&&n.process,a=function(){try{var e=i&&i.require&&i.require("util").types;return e||u&&u.binding&&u.binding("util")}catch(e){}}();e.exports=a}).call(t,r(60)(e))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CacheStore=void 0;var n,o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(1),u=r(9),a=(n=u)&&n.__esModule?n:{default:n},s=r(3),c=r(68),l=r(32),f=r(33),d=r(55),p=r(13);t.CacheStore=function(e){function t(e,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),e=(0,p.formTaggedCollectionName)(e,n.tag);var o=r||f.processorFactory.getCacheOfflineDataProcessor(),i=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,o,n));return i.ttl=n.ttl||void 0,i.syncManager=d.syncManagerProvider.getSyncManager(),i.useDeltaSet=!0===n.useDeltaSet,i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,c.NetworkStore),o(t,[{key:"removeById",value:function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,s.isDefined)(e)?function e(t,r,n){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,r);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,r,n)}if("value"in o)return o.value;var u=o.get;return void 0!==u?u.call(n):void 0}(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"removeById",this).call(this,e,r):i.Promise.resolve({count:0})}},{key:"clear",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=this._validateQuery(e);if(r)return r;var n=this._buildOperationObject(l.OperationType.Clear,e);return this._executeOperation(n,t).then(function(e){return{count:e}})}},{key:"pendingSyncCount",value:function(e){return this.syncManager.getSyncItemCountByEntityQuery(this.collection,e)}},{key:"pendingSyncEntities",value:function(e){return this.syncManager.getSyncEntities(this.collection,e)}},{key:"push",value:function(e){return this.syncManager.push(this.collection,e)}},{key:"pull",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return r=(0,a.default)({useDeltaSet:this.useDeltaSet},r),this.syncManager.getSyncItemCountByEntityQuery(this.collection,e).then(function(e){if(e>0){var t=(0,p.getEntitiesPendingPushError)(e,"fetch the entities");return i.Promise.reject(t)}return i.Promise.resolve()}).then(function(){return t.syncManager.pull(t.collection,e,r)})}},{key:"sync",value:function(e,t){var r=this;t=(0,a.default)({useDeltaSet:this.useDeltaSet},t);var n={};return this.push(t).then(function(o){return n.push=o,r.pull(e,t)}).then(function(e){return n.pull=e,n})}},{key:"clearSync",value:function(e){return this.syncManager.clearSync(this.collection,e)}}]),t}()},function(e,t,r){var n=r(66),o=r(30),i=Object.prototype.hasOwnProperty;e.exports=function(e,t,r){var u=e[t];i.call(e,t)&&o(u,r)&&(void 0!==r||t in e)||n(e,t,r)}},function(e,t,r){var n=r(101);e.exports=function(e,t,r){"__proto__"==t&&n?n(e,t,{configurable:!0,enumerable:!0,value:r,writable:!0}):e[t]=r}},function(e,t){var r=9007199254740991,n=/^(?:0|[1-9]\d*)$/;e.exports=function(e,t){var o=typeof e;return!!(t=null==t?r:t)&&("number"==o||"symbol"!=o&&n.test(e))&&e>-1&&e%1==0&&e<t}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.NetworkStore=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=r(1),i=b(r(7)),u=b(r(4)),a=b(r(9)),s=r(2),c=r(10),l=r(5),f=r(3),d=r(40),p=r(41),y=r(47),h=r(32),v=r(33);function b(e){return e&&e.__esModule?e:{default:e}}t.NetworkStore=function(){function e(t,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._processor=r||v.processorFactory.getNetworkProcessor(),t&&!(0,i.default)(t))throw new s.KinveyError("Collection must be a string.");this.collection=t,this.client=n.client}return n(e,[{key:"find",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=this._validateQuery(e);if(r)return(0,d.wrapInObservable)(r);t=(0,a.default)({useDeltaSet:this.useDeltaSet},t);var n=this._buildOperationObject(h.OperationType.Read,e),o=this._executeOperation(n,t);return this._ensureObservable(o)}},{key:"findById",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!e)return(0,d.wrapInObservable)(function(e){e.next(void 0)});var r=this._buildOperationObject(h.OperationType.ReadById,null,null,e),n=this._executeOperation(r,t);return this._ensureObservable(n)}},{key:"group",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=this._validateAggregationQuery(e);if(r)return this._ensureObservable(r);var n=this._buildOperationObject(h.OperationType.Group,e),o=this._executeOperation(n,t);return this._ensureObservable(o)}},{key:"count",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=this._validateQuery(e);if(r)return(0,d.wrapInObservable)(r);var n=this._buildOperationObject(h.OperationType.Count,e),o=this._executeOperation(n,t);return this._ensureObservable(o)}},{key:"create",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!(0,f.isDefined)(e))return o.Promise.resolve(null);if((0,u.default)(e))return o.Promise.reject(new s.KinveyError("Unable to create an array of entities.","Please create entities one by one."));var r=this._buildOperationObject(h.OperationType.Create,null,e);return this._executeOperation(r,t)}},{key:"update",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!(0,f.isDefined)(e))return o.Promise.resolve(null);if((0,u.default)(e)){var r=new s.KinveyError("Unable to update an array of entities.","Please update entities one by one.");return o.Promise.reject(r)}if(!(0,f.isDefined)(e._id)){return o.Promise.reject(new s.KinveyError("The entity provided does not contain an _id. An _id is required to update the entity.",e))}var n=this._buildOperationObject(h.OperationType.Update,null,e),i=this._executeOperation(n,t);return this._ensurePromise(i)}},{key:"save",value:function(e,t){return e._id?this.update(e,t):this.create(e,t)}},{key:"remove",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=this._validateQuery(e);if(r)return r;var n=this._buildOperationObject(h.OperationType.Delete,e),o=this._executeOperation(n,t).then(function(e){return{count:e}});return this._ensurePromise(o)}},{key:"removeById",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!(0,f.isDefined)(e))return o.Promise.resolve(void 0);var r=this._buildOperationObject(h.OperationType.DeleteById,null,null,e);return this._executeOperation(r,t).then(function(e){return{count:e}})}},{key:"subscribe",value:function(e){return(0,y.getLiveCollectionManager)().subscribeCollection(this.collection,e)}},{key:"unsubscribe",value:function(){return(0,y.getLiveCollectionManager)().unsubscribeCollection(this.collection)}},{key:"_validateQuery",value:function(e){return!e||e instanceof c.Query?null:o.Promise.reject(new s.KinveyError("Invalid query. It must be an instance of the Query class."))}},{key:"_validateAggregationQuery",value:function(e){return e instanceof p.Aggregation?null:o.Promise.reject(new s.KinveyError("Invalid aggregation. It must be an instance of the Aggregation class."))}},{key:"_buildOperationObject",value:function(e,t,r,n){return new h.Operation(e,this.collection,t,r,n)}},{key:"_executeOperation",value:function(e,t){return this._processor.process(e,t)}},{key:"_ensureObservable",value:function(e){if((0,f.isPromiseLike)(e))return(0,d.wrapInObservable)(e);if((0,f.isObservable)(e))return e;throw new s.KinveyError("Unexpected result type.")}},{key:"_ensurePromise",value:function(e){if((0,f.isPromiseLike)(e))return e;throw new s.KinveyError("Unexpected result type.")}},{key:"client",get:function(){return(0,f.isDefined)(this._client)?this._client:l.Client.sharedInstance()},set:function(e){e instanceof l.Client?this._client=e:this._client=null}},{key:"pathname",get:function(){var e="/appdata/"+this.client.appKey;return this.collection&&(e=e+"/"+this.collection),e}}]),e}()},function(e,t,r){var n=r(95)(Object.getPrototypeOf,Object);e.exports=n},function(e,t,r){var n=r(43),o=r(245),i=r(246),u=r(247),a=r(248),s=r(249);function c(e){var t=this.__data__=new n(e);this.size=t.size}c.prototype.clear=o,c.prototype.delete=i,c.prototype.get=u,c.prototype.has=a,c.prototype.set=s,e.exports=c},function(e,t,r){var n=r(250),o=r(257),i=r(259),u=r(260),a=r(261);function s(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}s.prototype.clear=n,s.prototype.delete=o,s.prototype.get=i,s.prototype.has=u,s.prototype.set=a,e.exports=s},function(e,t,r){var n=r(267),o=r(110),i=Object.prototype.propertyIsEnumerable,u=Object.getOwnPropertySymbols,a=u?function(e){return null==e?[]:(e=Object(e),n(u(e),function(t){return i.call(e,t)}))}:o;e.exports=a},function(e,t,r){var n=r(115);e.exports=function(e){var t=new e.constructor(e.byteLength);return new n(t).set(new n(e)),t}},function(e,r){e.exports=t},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.KinveyResponse=t.Response=t.StatusCode=void 0;var n,o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(9),u=(n=i)&&n.__esModule?n:{default:n},a=r(48),s=r(2);function c(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var l=t.StatusCode={Ok:200,Created:201,Empty:204,MovedPermanently:301,Found:302,NotModified:304,TemporaryRedirect:307,PermanentRedirect:308,Unauthorized:401,Forbidden:403,NotFound:404,ServerError:500};Object.freeze(l);var f=t.Response=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};c(this,e),t=(0,u.default)({statusCode:l.Empty,headers:new a.Headers,data:null},t),this.statusCode=t.statusCode,this.headers=t.headers,this.data=t.data}return o(e,[{key:"isSuccess",value:function(){return this.statusCode>=200&&this.statusCode<300||this.statusCode===l.MovedPermanently||this.statusCode===l.Found||this.statusCode===l.NotModified||this.statusCode===l.TemporaryRedirect||this.statusCode===l.PermanentRedirect}},{key:"isServerError",value:function(){return this.statusCode>=500&&this.statusCode<600}},{key:"isClientError",value:function(){return this.statusCode>=400&&this.statusCode<500}},{key:"toPlainObject",value:function(){return{statusCode:this.statusCode,headers:this.headers.toPlainObject(),data:this.data}}},{key:"headers",get:function(){return this._headers},set:function(e){e instanceof a.Headers||(e=new a.Headers(e)),this._headers=e}},{key:"error",get:function(){if(this.isSuccess())return null;var e=this.data||{},t=e.message||e.description,r=e.debug,n=this.statusCode,o=this.headers.get("X-Kinvey-Request-ID");return n===l.Unauthorized?new s.InsufficientCredentialsError(t,r,n,o):n===l.NotFound?new s.NotFoundError(t,r,n,o):n===l.ServerError?new s.ServerError(t,r,n,o):new s.KinveyError(t,r,n,o)}}]),e}();t.KinveyResponse=function(e){function t(){return c(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,f),o(t,[{key:"error",get:function(){if(this.isSuccess())return null;var e=this.data||{},r=e.name||e.error,n=e.message||e.description,o=e.debug,i=this.statusCode,u=this.headers.get("X-Kinvey-Request-ID"),a=void 0;if("APIVersionNotAvailable"===r)a=new s.APIVersionNotAvailableError(n,o,i,u);else if("APIVersionNotImplemented"===r)a=new s.APIVersionNotImplementedError(n,o,i,u);else if("AppProblem"===r)a=new s.AppProblemError(n,o,i,u);else if("AppProblem"===r)a=new s.AppProblemError(n,o,i,u);else if("BadRequest"===r)a=new s.BadRequestError(n,o,i,u);else if("BLInternalError"===r||"BLRuntimeError"===r||"BLSyntaxError"===r||"BLTimeoutError"===r||"BLViolationError"===r)a=new s.BLError(n,o,i,u);else if("CORSDisabled"===r)a=new s.CORSDisabledError(n,o,i,u);else if("DuplicateEndUsers"===r)a=new s.DuplicateEndUsersError(n,o,i,u);else if("FeatureUnavailable"===r)a=new s.FeatureUnavailableError(n,o,i,u);else if("IncompleteRequestBody"===r)a=new s.IncompleteRequestBodyError(n,o,i,u);else if("IndirectCollectionAccessDisallowed"===r)a=new s.IndirectCollectionAccessDisallowedError(n,o,i,u);else if("InsufficientCredentials"===r)a=new s.InsufficientCredentialsError(n,o,i,u);else if("InvalidCredentials"===r)a=new s.InvalidCredentialsError(n,o,i,u);else if("InvalidIdentifier"===r)a=new s.InvalidIdentifierError(n,o,i,u);else if("InvalidQuerySyntax"===r)a=new s.InvalidQuerySyntaxError(n,o,i,u);else if("JSONParseError"===r)a=new s.JSONParseError(n,o,i,u);else if("KinveyInternalErrorRetry"===r)a=new s.KinveyInternalErrorRetry(n,o,i,u);else if("KinveyInternalErrorStop"===r)a=new s.KinveyInternalErrorStop(n,o,i,u);else if("MissingQuery"===r)a=new s.MissingQueryError(n,o,i,u);else if("MissingRequestHeader"===r)a=new s.MissingRequestHeaderError(n,o,i,u);else if("MissingRequestParameter"===r)a=new s.MissingRequestParameterError(n,o,i,u);else if("MissingConfiguration"===r)a=new s.MissingConfigurationError(n,o,i,u);else if("EntityNotFound"===r||"CollectionNotFound"===r||"AppNotFound"===r||"UserNotFound"===r||"BlobNotFound"===r||"DocumentNotFound"===r)a=new s.NotFoundError(n,o,i,u);else if("ParameterValueOutOfRange"===r)a=new s.ParameterValueOutOfRangeError(n,o,i,u);else if("ResultSetSizeExceeded"===r)a=new s.ResultSetSizeExceededError(n,o,i,u);else if("ServerError"===r)a=new s.ServerError(n,o,i,u);else if("StaleRequest"===r)a=new s.StaleRequestError(n,o,i,u);else if("UserAlreadyExists"===r)a=new s.UserAlreadyExistsError(n,o,i,u);else{if("WritesToCollectionDisallowed"!==r)return function e(t,r,n){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,r);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,r,n)}if("value"in o)return o.value;var u=o.get;return void 0!==u?u.call(n):void 0}(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"error",this);a=new s.WritesToCollectionDisallowedError(n,o,i,u)}return a}}]),t}()},function(e,t,r){var n=r(289),o=r(302),i=r(37),u=r(4),a=r(312);e.exports=function(e){return"function"==typeof e?e:null==e?i:"object"==typeof e?u(e)?o(e[0],e[1]):n(e):a(e)}},function(e,t,r){var n=r(4),o=r(38),i=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,u=/^\w*$/;e.exports=function(e,t){if(n(e))return!1;var r=typeof e;return!("number"!=r&&"symbol"!=r&&"boolean"!=r&&null!=e&&!o(e))||u.test(e)||!i.test(e)||null!=t&&e in Object(t)}},function(e,t){e.exports=function(e,t){for(var r=-1,n=null==e?0:e.length,o=Array(n);++r<n;)o[r]=t(e[r],r,e);return o}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LiveService=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();t.isValidReceiver=y,t.isValidChannelName=h,t.getLiveService=function(e){b||(b=new v(e));return b};var o=r(1),i=p(r(322)),u=p(r(20)),a=p(r(323)),s=r(5),c=r(6),l=r(2),f=r(3),d=r(126);function p(e){return e&&e.__esModule?e:{default:e}}function y(e){if(!e)return!1;var t=e.onMessage,r=e.onError,n=e.onStatus;return(0,u.default)(t)||(0,u.default)(r)||(0,u.default)(n)}function h(e){return(0,f.isNonemptyString)(e)}var v=t.LiveService=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._client=t||s.Client.sharedInstance(),this._pubnubClient=void 0,this._pubnubListener=void 0,this._userChannelGroup=void 0,this._pubnubConfig=void 0,this._registeredUser=void 0}return n(e,[{key:"fullInitialization",value:function(e){var t=this;return this.registerUser(e).then(function(e){var r=new i.default(e),n=new d.PubNubListener;t.initialize(r,n)})}},{key:"fullUninitialization",value:function(){var e=this;return this.unregisterUser().then(function(t){return e.uninitialize(),t})}},{key:"isInitialized",value:function(){return!!this.__pubnubClient&&!!this.__pubnubListener&&!!this._registeredUser}},{key:"registerUser",value:function(e){var t=this;return e&&e.isActive()?this.isInitialized()?o.Promise.reject(new l.KinveyError("Live service already initialized")):this._makeRegisterRequest(e._id).then(function(r){return t._registeredUser=e,t._userChannelGroup=r.userChannelGroup,(0,a.default)({ssl:!0,authKey:t._registeredUser._kmd.authtoken},r)}):o.Promise.reject(new l.ActiveUserError("Missing or invalid active user"))}},{key:"initialize",value:function(e,t){if(this.isInitialized())throw new l.KinveyError("Live service already initialized");this._pubnubListener=t,this._pubnubClient=e,this._pubnubClient.addListener(this._pubnubListener),this._subscribeToUserChannelGroup()}},{key:"uninitialize",value:function(){this._unsubscribeFromAll(),this._pubnubClient=null,this._pubnubListener=null}},{key:"onConnectionStatusUpdates",value:function(e){this._pubnubListener.on(d.PubNubListener.unclassifiedEvents,e),this._pubnubListener.on(this._userChannelGroup,e)}},{key:"offConnectionStatusUpdates",value:function(e){e?(this._pubnubListener.removeListener(d.PubNubListener.unclassifiedEvents,e),this._pubnubListener.removeListener(this._userChannelGroup,e)):(this._pubnubListener.removeAllListeners(d.PubNubListener.unclassifiedEvents),this._pubnubListener.removeAllListeners(this._userChannelGroup))}},{key:"publishToChannel",value:function(e,t){if(!this.isInitialized())return o.Promise.reject(new l.KinveyError("Live service is not initialized"));var r=this._validatePublishData(e,t);return r?o.Promise.reject(r):this._pubnubClient.publish({message:t,channel:e}).catch(function(e){e=e.status&&e.status.errorData;var t=new c.Response({data:e,statusCode:e.status,headers:e.response&&e.response.headers});return o.Promise.reject(t)})}},{key:"subscribeToChannel",value:function(e,t){var r=this._validateSubscribeData(e,t);if(r)throw r;this._subscribeToListener(e,t)}},{key:"unsubscribeFromChannel",value:function(e){this._unsubscribeFromListener(e)}},{key:"unregisterUser",value:function(){var e=this;if(!this._registeredUser){return o.Promise.reject(new l.KinveyError("Cannot unregister when no user has been registered for live service"))}var t=this._registeredUser._id;return this._makeUnregisterRequst(t).then(function(t){return e._registeredUser=null,t})}},{key:"_unsubscribeFromAll",value:function(){this._pubnubClient.unsubscribeAll(),this._pubnubListener.removeAllListeners()}},{key:"_validatePublishData",value:function(e,t){var r=null;return h(e)||(r=new l.KinveyError("Invalid channel name")),void 0===t&&(r=new l.KinveyError("Missing or invalid message")),r}},{key:"_validateSubscribeData",value:function(e,t){var r=null;return h(e)||(r=new l.KinveyError("Invalid channel name")),t&&y(t)||(r=new l.KinveyError("Missing or invalid receiver")),r}},{key:"_subscribeToUserChannelGroup",value:function(){this._pubnubClient.subscribe({channelGroups:[this._userChannelGroup]})}},{key:"_subscribeToListener",value:function(e,t){(0,u.default)(t.onMessage)&&this._pubnubListener.on(e,t.onMessage),((0,u.default)(t.onError)||(0,u.default)(t.onStatus))&&this._pubnubListener.on(""+d.PubNubListener.statusPrefix+e,function(e){var r=e.error?t.onError:t.onStatus;(0,u.default)(r)&&r.call(t,e)})}},{key:"_unsubscribeFromListener",value:function(e){this._pubnubListener.removeAllListeners(e),this._pubnubListener.removeAllListeners(""+d.PubNubListener.statusPrefix+e)}},{key:"_makeRegisterRequest",value:function(e){return this._makeUserManagementRequest(e,"register-realtime")}},{key:"_makeUnregisterRequst",value:function(e){return this._makeUserManagementRequest(e,"unregister-realtime")}},{key:"_makeUserManagementRequest",value:function(e,t){return c.KinveyRequest.execute({method:c.RequestMethod.POST,pathname:"/user/"+this._client.appKey+"/"+e+"/"+t,body:{deviceId:this._client.deviceId}},this._client)}},{key:"_throwNotInitializedError",value:function(){throw new l.KinveyError("Live service has not been initialized")}},{key:"_pubnubClient",get:function(){return this.__pubnubClient||this._throwNotInitializedError(),this.__pubnubClient},set:function(e){this.__pubnubClient=e}},{key:"_pubnubListener",set:function(e){this.__pubnubListener=e},get:function(){return this.__pubnubListener||this._throwNotInitializedError(),this.__pubnubListener}}]),e}(),b=void 0},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OfflineDataProcessor=void 0;var n,o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=function e(t,r,n){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,r);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,r,n)}if("value"in o)return o.value;var u=o.get;return void 0!==u?u.call(n):void 0},u=r(1),a=r(51),s=(n=a)&&n.__esModule?n:{default:n},c=r(32),l=r(16),f=r(134),d=r(13),p=r(3),y=r(54);t.OfflineDataProcessor=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return r._syncManager=e,r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,f.DataProcessor),o(t,[{key:"process",value:function(e,r){return e.type===c.OperationType.Clear?this._processClear(e.collection,e.query,r):i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"process",this).call(this,e,r)}},{key:"_getRepository",value:function(){return this._repoPromise||(this._repoPromise=l.repositoryProvider.getOfflineRepository()),this._repoPromise}},{key:"_deleteEntityAndHandleOfflineState",value:function(e,r,n){var o=this;return i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_processDeleteById",this).call(this,e,r._id,n).then(function(t){return t?o._syncManager.addDeleteEvent(e,r).then(function(){return t}):t})}},{key:"_deleteEntitiesAndHandleOfflineState",value:function(e,r,n,o){var u=this;return i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_processDelete",this).call(this,e,n,o).then(function(t){return u._syncManager.addDeleteEvent(e,r).then(function(){return t})})}},{key:"_processUpdate",value:function(e,r,n){var o=this;return i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_processUpdate",this).call(this,e,r,n).then(function(t){return o._syncManager.addUpdateEvent(e,t).then(function(){return t})})}},{key:"_processClear",value:function(e,t,r){var n=this;return this._syncManager.clearSync(e,t).then(function(){return(0,y.clearQueryCache)(e)}).then(function(){return n._getRepository()}).then(function(n){return n.delete(e,t,r)})}},{key:"_processDelete",value:function(e,t,r){var n=this;return this._getRepository().then(function(n){return n.read(e,t,r)}).then(function(o){return(0,d.isEmpty)(o)?u.Promise.resolve(0):n._deleteEntitiesAndHandleOfflineState(e,o,t,r)})}},{key:"_processCreate",value:function(e,r,n){var o=this;return r=this._addMetadataToEntities(r),i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_processCreate",this).call(this,e,r,n).then(function(t){return o._syncManager.addCreateEvent(e,t).then(function(){return t})})}},{key:"_processDeleteById",value:function(e,t,r){var n=this;return this._getRepository().then(function(r){return r.readById(e,t)}).then(function(t){return n._deleteEntityAndHandleOfflineState(e,t,r)})}},{key:"_addOfflineMetadataToEntity",value:function(e){var t=e._kmd||{};t.local=!0,e._kmd=t,e._id=(0,d.generateEntityId)()}},{key:"_addMetadataToEntities",value:function(e){var t=this,r=!Array.isArray(e),n=(0,p.ensureArray)(e).map(function(e){return(0,p.isDefined)(e._id)||(e=(0,s.default)(e),t._addOfflineMetadataToEntity(e)),e});return r?n[0]:n}}]),t}()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();t.Repository=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return n(e,[{key:"_throwNotImplementedError",value:function(){throw new Error("Repository class abstract method not implemented")}},{key:"create",value:function(e,t){this._throwNotImplementedError(t)}},{key:"read",value:function(e,t){this._throwNotImplementedError(t)}},{key:"readById",value:function(e,t){this._throwNotImplementedError(t)}},{key:"count",value:function(e,t){this._throwNotImplementedError(t)}},{key:"update",value:function(e,t){this._throwNotImplementedError(t)}},{key:"delete",value:function(e,t){this._throwNotImplementedError(t)}},{key:"deleteById",value:function(e,t){this._throwNotImplementedError(t)}},{key:"group",value:function(e,t){this._throwNotImplementedError(t)}}]),e}()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(34);Object.keys(n).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return n[e]}})});var o=r(53);Object.keys(o).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return o[e]}})});var i=r(335);Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return i[e]}})});var u=r(83);Object.keys(u).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return u[e]}})});var a=r(336);Object.keys(a).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return a[e]}})});var s=r(340);Object.keys(s).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return s[e]}})})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.KeyValueStorePersister=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=r(1),i=r(5),u=r(2),a=r(53);t.KeyValueStorePersister=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a.KeyValuePersister),n(t,[{key:"readEntity",value:function(e,t){var r=this;return this._readEntityFromPersistance(e,t).then(function(n){return n||o.Promise.reject(r._getEntityNotFoundError(e,t))})}},{key:"writeEntities",value:function(e,t){var r=this;return this._writeEntitiesToPersistance(e,t).then(function(){return r._invalidateCache(e),!0})}},{key:"deleteEntity",value:function(e,t){var r=this;return this._deleteEntityFromPersistance(e,t).then(function(n){return r._invalidateCache(e),0===n?o.Promise.reject(r._getEntityNotFoundError(e,t)):!(n>1)||o.Promise.reject(new u.KinveyError("Delete by id matched more than one entity"))})}},{key:"_readEntityFromPersistance",value:function(e,t){this._throwNotImplementedError(t)}},{key:"_writeEntitiesToPersistance",value:function(e,t){this._throwNotImplementedError(t)}},{key:"_deleteEntityFromPersistance",value:function(e,t){this._throwNotImplementedError(t)}},{key:"_getEntityNotFoundError",value:function(e,t){return new u.NotFoundError("An entity with _id = "+t+" was not found in the "+e+" collection on the "+this._storeName+" database.")}},{key:"_storeName",get:function(){return i.Client.sharedInstance().appKey}}]),t}()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(144);Object.keys(n).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return n[e]}})});var o=r(351);Object.keys(o).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return o[e]}})})},function(e,t){var r=0,n=Math.random();e.exports=function(e){return"Symbol(".concat(void 0===e?"":e,")_",(++r+n).toString(36))}},function(e,t,r){var n=r(35),o=r(25),i=r(87),u=r(378),a=r(156),s=function(e,t,r){var c,l,f,d,p=e&s.F,y=e&s.G,h=e&s.S,v=e&s.P,b=e&s.B,_=y?n:h?n[t]||(n[t]={}):(n[t]||{}).prototype,m=y?o:o[t]||(o[t]={}),g=m.prototype||(m.prototype={});for(c in y&&(r=t),r)f=((l=!p&&_&&void 0!==_[c])?_:r)[c],d=b&&l?a(f,n):v&&"function"==typeof f?a(Function.call,f):f,_&&u(_,c,f,e&s.U),m[c]!=f&&i(m,c,d),v&&g[c]!=f&&(g[c]=f)};n.core=o,s.F=1,s.G=2,s.S=4,s.P=8,s.B=16,s.W=32,s.U=64,s.R=128,e.exports=s},function(e,t,r){var n=r(372),o=r(377);e.exports=r(88)?function(e,t,r){return n.f(e,t,o(1,r))}:function(e,t,r){return e[t]=r,e}},function(e,t,r){e.exports=!r(89)(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},function(e,t){e.exports=function(e){try{return!!e()}catch(e){return!0}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};t.isDefined=a,t.isNumber=function(e){return!Number.isNaN(parseFloat(e))&&Number.isFinite(e)},t.nested=function(e,t,r){if(!1===a(t))return e=r||e;var n=t.split("."),o=n.shift();for(;o&&e;)e=e[o],o=n.shift();return r||e},t.keyBy=function(e,t){if(!e)return{};return e.reduce(function(e,r){return e[t]=r[t],e},{})},t.isEmpty=function(e){return!a(e)||!(e.length>0)&&(0===e.length||"object"!==(void 0===e?"undefined":n(e))||Object.keys(e).reduce(function(t,r){return!!t&&!Object.hasOwnProperty.call(e,r)},!0))};var o=u(r(203)),i=u(r(204));function u(e){return e&&e.__esModule?e:{default:e}}function a(e){return!1===(0,i.default)(e)&&!1===(0,o.default)(e)}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PromiseQueue=void 0;var n,o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(1),u=(n=i)&&n.__esModule?n:{default:n},a=r(92);t.PromiseQueue=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1/0;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.pendingPromises=0,this.maxPendingPromises=t,this.maxQueuedPromises=r,this.queue=[]}return o(e,[{key:"enqueue",value:function(e){var t=this;return new u.default(function(r,n,o){t.queue.length>=t.maxQueuedPromises?n(new Error("Queue limit reached")):(t.queue.push({promiseGenerator:e,resolve:r,reject:n,notify:o||a.noop}),t._dequeue())})}},{key:"getPendingLength",value:function(){return this.pendingPromises}},{key:"getQueueLength",value:function(){return this.queue.length}},{key:"_dequeue",value:function(){var e=this;if(this.pendingPromises>=this.maxPendingPromises)return!1;var t=this.queue.shift();if(!t)return!1;try{this.pendingPromises+=1,(0,a.wrapInPromise)(t.promiseGenerator()).then(function(r){e.pendingPromises-=1,t.resolve(r),e._dequeue()},function(r){e.pendingPromises-=1,t.reject(r),e._dequeue()},function(e){t.notify(e)})}catch(e){this.pendingPromises-=1,t.reject(e),this._dequeue()}return!0}}]),e}()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.activeUserKey=void 0,t.noop=function(){},t.isPromiseLike=p,t.isObservable=function(e){return e instanceof o.Observable},t.wrapInPromise=function(e){if(p(e))return e;return n.Promise.resolve(e)},t.useIfDefined=y,t.ensureArray=h,t.isValidStorageProviderValue=function(e){var t=s.repositoryProvider.getSupportedStorages(),r=h(e);return!!e&&r.length&&r.every(function(e){return t.some(function(t){return e===t})})},t.forEachAsync=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1/0,o=new c.PromiseQueue(r);return function(e,t){var r=0,o=e.length;if((0,i.default)(e))return n.Promise.resolve();return new n.Promise(function(n){var i=function(){(r+=1)===o&&n()};e.forEach(function(e){t(e).then(i).catch(i)})})}(e,function(e){return o.enqueue(function(){return t(e)})})},t.splitQueryIntoPages=function(e,t,r){if(!(0,a.default)(t)||!(0,a.default)(r))throw new f.KinveyError("Invalid page size or expected entity count parameter");var n=Math.ceil(r/t);return(0,u.default)(n,function(n){var o=new l.Query(e);return o.skip=e.skip+n*t,o.limit=Math.min(r-n*t,t),o})};var n=r(1),o=r(93),i=d(r(22)),u=d(r(98)),a=d(r(23)),s=r(29),c=r(91),l=r(10),f=r(2);function d(e){return e&&e.__esModule?e:{default:e}}t.activeUserKey="active_user";function p(e){return!!e&&"function"==typeof e.then&&"function"==typeof e.catch}function y(e,t){return void 0!==e?e:t}function h(e){return e=y(e,[]),Array.isArray(e)?e:[e]}},function(e,t){e.exports=r},function(e,t,r){var n=r(26),o=r(205),i=Object.prototype.hasOwnProperty;e.exports=function(e){if(!n(e))return o(e);var t=[];for(var r in Object(e))i.call(e,r)&&"constructor"!=r&&t.push(r);return t}},function(e,t){e.exports=function(e,t){return function(r){return e(t(r))}}},function(e,t){var r="object"==typeof global&&global&&global.Object===Object&&global;e.exports=r},function(e,t){var r=Function.prototype.toString;e.exports=function(e){if(null!=e){try{return r.call(e)}catch(e){}try{return e+""}catch(e){}}return""}},function(e,t,r){var n=r(99),o=r(100),i=r(219),u=9007199254740991,a=4294967295,s=Math.min;e.exports=function(e,t){if((e=i(e))<1||e>u)return[];var r=a,c=s(e,a);t=o(t),e-=a;for(var l=n(c,t);++r<e;)t(r);return l}},function(e,t){e.exports=function(e,t){for(var r=-1,n=Array(e);++r<e;)n[r]=t(r);return n}},function(e,t,r){var n=r(37);e.exports=function(e){return"function"==typeof e?e:n}},function(e,t,r){var n=r(19),o=function(){try{var e=n(Object,"defineProperty");return e({},"",{}),e}catch(e){}}();e.exports=o},function(e,t,r){var n=r(103),o=r(104);e.exports=function(e){return n(function(t,r){var n=-1,i=r.length,u=i>1?r[i-1]:void 0,a=i>2?r[2]:void 0;for(u=e.length>3&&"function"==typeof u?(i--,u):void 0,a&&o(r[0],r[1],a)&&(u=i<3?void 0:u,i=1),t=Object(t);++n<i;){var s=r[n];s&&e(t,s,n,u)}return t})}},function(e,t,r){var n=r(37),o=r(222),i=r(224);e.exports=function(e,t){return i(o(e,t,n),e+"")}},function(e,t,r){var n=r(30),o=r(21),i=r(67),u=r(8);e.exports=function(e,t,r){if(!u(r))return!1;var a=typeof t;return!!("number"==a?o(r)&&i(t,r.length):"string"==a&&t in r)&&n(r[t],e)}},function(e,t,r){var n=r(99),o=r(58),i=r(4),u=r(36),a=r(67),s=r(61),c=Object.prototype.hasOwnProperty;e.exports=function(e,t){var r=i(e),l=!r&&o(e),f=!r&&!l&&u(e),d=!r&&!l&&!f&&s(e),p=r||l||f||d,y=p?n(e.length,String):[],h=y.length;for(var v in e)!t&&!c.call(e,v)||p&&("length"==v||f&&("offset"==v||"parent"==v)||d&&("buffer"==v||"byteLength"==v||"byteOffset"==v)||a(v,h))||y.push(v);return y}},function(e,t,r){var n=r(103),o=r(30),i=r(104),u=r(39),a=Object.prototype,s=a.hasOwnProperty,c=n(function(e,t){e=Object(e);var r=-1,n=t.length,c=n>2?t[2]:void 0;for(c&&i(t[0],t[1],c)&&(n=1);++r<n;)for(var l=t[r],f=u(l),d=-1,p=f.length;++d<p;){var y=f[d],h=e[y];(void 0===h||o(h,a[y])&&!s.call(e,y))&&(e[y]=l[y])}return e});e.exports=c},function(e,t,r){var n=r(108),o=r(42),i=r(100),u=r(4);e.exports=function(e,t){return(u(e)?n:o)(e,i(t))}},function(e,t){e.exports=function(e,t){for(var r=-1,n=null==e?0:e.length;++r<n&&!1!==t(e[r],r,e););return e}},function(e,t,r){var n=r(70),o=r(108),i=r(65),u=r(262),a=r(263),s=r(264),c=r(265),l=r(266),f=r(268),d=r(113),p=r(269),y=r(27),h=r(270),v=r(271),b=r(276),_=r(4),m=r(36),g=r(278),O=r(8),w=r(280),k=r(18),E=1,P=2,j=4,S="[object Arguments]",M="[object Function]",I="[object GeneratorFunction]",x="[object Object]",C={};C[S]=C["[object Array]"]=C["[object ArrayBuffer]"]=C["[object DataView]"]=C["[object Boolean]"]=C["[object Date]"]=C["[object Float32Array]"]=C["[object Float64Array]"]=C["[object Int8Array]"]=C["[object Int16Array]"]=C["[object Int32Array]"]=C["[object Map]"]=C["[object Number]"]=C[x]=C["[object RegExp]"]=C["[object Set]"]=C["[object String]"]=C["[object Symbol]"]=C["[object Uint8Array]"]=C["[object Uint8ClampedArray]"]=C["[object Uint16Array]"]=C["[object Uint32Array]"]=!0,C["[object Error]"]=C[M]=C["[object WeakMap]"]=!1,e.exports=function e(t,r,R,T,q,A){var D,N=r&E,K=r&P,U=r&j;if(R&&(D=q?R(t,T,q,A):R(t)),void 0!==D)return D;if(!O(t))return t;var F=_(t);if(F){if(D=h(t),!N)return c(t,D)}else{var L=y(t),B=L==M||L==I;if(m(t))return s(t,N);if(L==x||L==S||B&&!q){if(D=K||B?{}:b(t),!N)return K?f(t,a(D,t)):l(t,u(D,t))}else{if(!C[L])return q?t:{};D=v(t,L,N)}}A||(A=new n);var Q=A.get(t);if(Q)return Q;if(A.set(t,D),w(t))return t.forEach(function(n){D.add(e(n,r,R,n,t,A))}),D;if(g(t))return t.forEach(function(n,o){D.set(o,e(n,r,R,o,t,A))}),D;var z=U?K?p:d:K?keysIn:k,H=F?void 0:z(t);return o(H||t,function(n,o){H&&(n=t[o=n]),i(D,o,e(n,r,R,o,t,A))}),D}},function(e,t){e.exports=function(){return[]}},function(e,t,r){var n=r(112),o=r(69),i=r(72),u=r(110),a=Object.getOwnPropertySymbols?function(e){for(var t=[];e;)n(t,i(e)),e=o(e);return t}:u;e.exports=a},function(e,t){e.exports=function(e,t){for(var r=-1,n=t.length,o=e.length;++r<n;)e[o+r]=t[r];return e}},function(e,t,r){var n=r(114),o=r(72),i=r(18);e.exports=function(e){return n(e,i,o)}},function(e,t,r){var n=r(112),o=r(4);e.exports=function(e,t,r){var i=t(e);return o(e)?i:n(i,r(e))}},function(e,t,r){var n=r(11).Uint8Array;e.exports=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.KinveyRequest=t.Properties=t.AuthType=t.NetworkRequest=void 0;var n=function e(t,r,n,o){var i=Object.getOwnPropertyDescriptor(t,r);if(void 0===i){var u=Object.getPrototypeOf(t);null!==u&&e(u,r,n,o)}else if("value"in i&&i.writable)i.value=n;else{var a=i.set;void 0!==a&&a.call(o,n)}return n},o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=function e(t,r,n){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,r);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,r,n)}if("value"in o)return o.value;var u=o.get;return void 0!==u?u.call(n):void 0},u=M(r(1)),a=r(284),s=M(r(74)),c=M(r(9)),l=M(r(106)),f=M(r(22)),d=M(r(8)),p=M(r(15)),y=M(r(7)),h=M(r(285)),v=r(5),b=r(10),_=r(41),m=r(3),g=r(2),O=r(117),w=r(48),k=r(118),E=r(75),P=r(14),j=r(47),S=r(29);function M(e){return e&&e.__esModule?e:{default:e}}function I(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function x(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function C(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}h.default.configure(u.default);var R=new h.default,T=t.NetworkRequest=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};I(this,t);var r=x(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.rack=k.NetworkRack,r.file=!0===e.file,r}return C(t,O.Request),o(t,[{key:"toPlainObject",value:function(){return Object.assign(i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"toPlainObject",this).call(this),{file:this.file})}}]),t}(),q=t.AuthType={All:"All",App:"App",Basic:"Basic",Default:"Default",Master:"Master",None:"None",Session:"Session",Client:"Client"};Object.freeze(q);var A={all:function(e){return A.session(e).catch(function(){return A.basic(e)})},app:function(e){return e.appKey&&e.appSecret?u.default.resolve({scheme:"Basic",username:e.appKey,password:e.appSecret}):u.default.reject(new Error("Missing client appKey and/or appSecret. Use Kinvey.initialize() to set the appKey and appSecret for the client."))},basic:function(e){return A.master(e).catch(function(){return A.app(e)})},client:function(e,t){return e.appKey&&e.appSecret?(t||(t=e.appKey),u.default.resolve({scheme:"Basic",username:t,password:e.appSecret})):u.default.reject(new Error("Missing client appKey and/or appSecret Use Kinvey.initialize() to set the appKey and appSecret for the client."))},master:function(e){return e.appKey&&e.masterSecret?u.default.resolve({scheme:"Basic",username:e.appKey,password:e.masterSecret}):u.default.reject(new Error("Missing client appKey and/or masterSecret. Use Kinvey.initialize() to set the appKey and masterSecret for the client."))},none:function(){return u.default.resolve(null)},session:function(e){var t=e.getActiveUser();return(0,m.isDefined)(t)?(0,d.default)(t._kmd)&&(0,m.isDefined)(t._kmd.authtoken)?u.default.resolve({scheme:"Kinvey",credentials:t._kmd.authtoken}):u.default.reject(new g.NoActiveUserError("The active user does not have a valid auth token.")):u.default.reject(new g.NoActiveUserError("There is not an active user. Please login a user and retry the request."))}};function D(e){var t=(0,j.getLiveService)(e.client),r=u.default.resolve();return t.isInitialized()&&(r=t.fullUninitialization()),r.then(function(){return e.client.setActiveUser(null)}).catch(function(e){return P.Log.error(e),null}).then(function(){return S.DataStore.clearCache({client:e.client})}).catch(function(e){return P.Log.error(e),null})}var N=t.Properties=function(e){function t(){return I(this,t),x(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return C(t,w.Headers),t}();t.KinveyRequest=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};I(this,t);var r=x(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return e=(0,c.default)({skipBL:!1,trace:!1},e),r.authType=e.authType||q.None,r.query=e.query,r.aggregation=e.aggregation,r.properties=e.properties||new N,r.skipBL=!0===e.skipBL,r.trace=!0===e.trace,r.clientId=e.clientId,r.kinveyFileTTL=e.kinveyFileTTL,r.kinveyFileTLS=e.kinveyFileTLS,r}return C(t,T),o(t,[{key:"getAuthorizationHeader",value:function(e,t){var r=u.default.resolve(void 0);if(e)switch(e){case q.All:r=A.all(t);break;case q.App:r=A.app(t);break;case q.Basic:r=A.basic(t);break;case q.Client:r=A.client(t,this.clientId);break;case q.Master:r=A.master(t);break;case q.None:r=A.none(t);break;case q.Session:r=A.session(t);break;default:r=A.session(t).catch(function(e){return A.master(t).catch(function(){throw e})})}return r.then(function(e){if((0,m.isDefined)(e)){var t=e.credentials;return e.username&&(t=a.Buffer.from(e.username+":"+e.password).toString("base64")),e.scheme+" "+t}})}},{key:"execute",value:function(){var e=this,r=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this.getAuthorizationHeader(this.authType,this.client).then(function(t){(0,m.isDefined)(t)?e.headers.set("Authorization",t):e.headers.remove("Authorization")}).then(function(){return i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"execute",e).call(e)}).then(function(e){if(e instanceof E.KinveyResponse==!1&&(e=new E.KinveyResponse({statusCode:e.statusCode,headers:e.headers,data:e.data})),!1===r&&!1===e.isSuccess())throw e.error;return e}).catch(function(o){if(o instanceof g.InvalidCredentialsError){if(n){if(R.paused)return R.add(function(){return e.execute(r,!1).catch(function(){return u.default.reject(o)})});R.pause();var i=e.client.getActiveUser(),a=(0,m.isDefined)(i)&&(0,m.isDefined)(i._socialIdentity)?i._socialIdentity:{},s=Object.keys(a).find(function(e){return"kinveyAuth"===a[e].identity}),c=a[s];if((0,m.isDefined)(c))return new t({method:O.RequestMethod.POST,headers:{"Content-Type":"application/x-www-form-urlencoded"},authType:q.Client,url:p.default.format({protocol:e.client.micProtocol,host:e.client.micHost,pathname:"/oauth/token"}),body:{grant_type:"refresh_token",client_id:c.client_id,redirect_uri:c.redirect_uri,refresh_token:c.refresh_token},properties:e.properties,timeout:e.timeout,clientId:c.client_id}).execute().then(function(e){return e.data}).then(function(t){return t.identity=c.identity,t.client_id=c.client_id,t.redirect_uri=c.redirect_uri,t.protocol=e.client.micProtocol,t.host=e.client.micHost,t}).then(function(r){var n={};return a[r.identity]=r,n._socialIdentity=a,new t({method:O.RequestMethod.POST,authType:q.App,url:p.default.format({protocol:e.client.apiProtocol,host:e.client.apiHost,pathname:"/user/"+e.client.appKey+"/login"}),properties:e.properties,body:n,timeout:e.timeout,client:e.client}).execute().then(function(e){return e.data}).then(function(t){return t._socialIdentity[r.identity]=(0,l.default)(t._socialIdentity[r.identity],r),e.client.setActiveUser(t)})}).catch(function(){return D(e).then(function(){return R.start(),u.default.reject(o)})}).then(function(){return R.start(),e.execute(r,!1)});R.start()}return D(e).then(function(){return u.default.reject(o)})}return u.default.reject(o)})}},{key:"appVersion",get:function(){return this.client.appVersion}},{key:"query",get:function(){return this._query},set:function(e){if((0,m.isDefined)(e)&&!(e instanceof b.Query))throw new g.KinveyError("Invalid query. It must be an instance of the Query class.");this._query=e}},{key:"aggregation",get:function(){return this._aggregation},set:function(e){if((0,m.isDefined)(e)&&!(e instanceof _.Aggregation))throw new g.KinveyError("Invalid aggregation. It must be an instance of the Aggregation class.");(0,m.isDefined)(e)&&(this.body=e.toPlainObject()),this._aggregation=e}},{key:"headers",get:function(){var e=i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"headers",this);if(e.has("Accept")||e.set("Accept","application/json; charset=utf-8"),e.has("Content-Type")||e.set("Content-Type","application/json; charset=utf-8"),e.has("X-Kinvey-Api-Version")||e.set("X-Kinvey-Api-Version",4),!0===this.skipBL?e.set("X-Kinvey-Skip-Business-Logic",!0):e.remove("X-Kinvey-Skip-Business-Logic"),!0===this.trace?(e.set("X-Kinvey-Include-Headers-In-Response","X-Kinvey-Request-Id"),e.set("X-Kinvey-ResponseWrapper",!0)):(e.remove("X-Kinvey-Include-Headers-In-Response"),e.remove("X-Kinvey-ResponseWrapper")),this.appVersion?e.set("X-Kinvey-Client-App-Version",this.appVersion):e.remove("X-Kinvey-Client-App-Version"),this.properties){var r=this.properties.toString();if((0,f.default)(r))e.remove("X-Kinvey-Custom-Request-Properties");else{var n=function(e){if(e){var t=0,r=e.length;e=String(e||"");for(var n=0;n<r;n+=1){var o=encodeURI(e[n]).split("%").length;t+=1===o?1:o-1}return t}return 0}(r);if(n>=2e3)throw new Error("The custom properties are "+n+" bytes.It must be less then 2000 bytes.","Please remove some custom properties.");e.set("X-Kinvey-Custom-Request-Properties",r)}}else e.remove("X-Kinvey-Custom-Request-Properties");return e},set:function(e){n(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"headers",e,this)}},{key:"url",get:function(){var e=i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"url",this),r={kinveyfile_ttl:this.kinveyFileTTL,kinveyfile_tls:this.kinveyFileTLS};return this.query&&(r=Object.assign({},r,this.query.toQueryString())),(0,f.default)(r)?e:(0,m.appendQuery)(e,s.default.stringify(r))},set:function(e){n(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"url",e,this)}},{key:"properties",get:function(){return this._properties},set:function(e){e&&e instanceof N==!1&&(e=new N(e)),this._properties=e}}],[{key:"execute",value:function(e,r){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],o=(0,c.default)({method:O.RequestMethod.GET,authType:q.Default},e);r=r||v.Client.sharedInstance(),!o.url&&(0,y.default)(o.pathname)&&r&&(o.url=p.default.format({protocol:r.apiProtocol,host:r.apiHost,pathname:o.pathname}));var i=new t(o).execute();return n&&(i=i.then(function(e){return e.data})),i}}]),t}()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Request=t.RequestMethod=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=y(r(1)),i=y(r(74)),u=y(r(9)),a=y(r(7)),s=y(r(23)),c=r(5),l=r(2),f=r(3),d=r(75),p=r(48);function y(e){return e&&e.__esModule?e:{default:e}}var h=t.RequestMethod={GET:"GET",POST:"POST",PATCH:"PATCH",PUT:"PUT",DELETE:"DELETE"};Object.freeze(h);t.Request=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),t=(0,u.default)({followRedirect:!0},t),this.id=(0,f.randomString)(),this.client=t.client,this.method=t.method||h.GET,this.headers=t.headers||new p.Headers,this.url=t.url||"",this.body=t.body||t.data,this.timeout=(0,f.isDefined)(t.timeout)?t.timeout:this.client.defaultTimeout,this.followRedirect=!0===t.followRedirect,this.cache=!0===t.cache}return n(e,[{key:"execute",value:function(){return!1===(0,f.isDefined)(this.rack)?(Log.error("Unable to execute the request. Please provide a rack to execute the request."),o.default.reject(new l.KinveyError("Unable to execute the request. Please provide a rack to execute the request."))):this.rack.execute(this.toPlainObject()).then(function(e){if(!1===(0,f.isDefined)(e))throw new l.NoResponseError;return e instanceof d.Response==!1&&(e=new d.Response({statusCode:e.statusCode,headers:e.headers,data:e.data})),e})}},{key:"cancel",value:function(){return this.rack.cancel()}},{key:"toPlainObject",value:function(){return{id:this.id,method:this.method,headers:this.headers.toPlainObject(),url:this.url,body:this.body,timeout:this.timeout,followRedirect:this.followRedirect,encryptionKey:this.client.encryptionKey}}},{key:"client",get:function(){return this._client||c.Client.sharedInstance()},set:function(e){if(e&&e instanceof c.Client==!1)throw new l.KinveyError("client must be an instance of the Client class.");this._client=e}},{key:"method",get:function(){return this._method},set:function(e){switch((0,a.default)(e)||(e=String(e)),e=e.toUpperCase()){case h.GET:case h.POST:case h.PATCH:case h.PUT:case h.DELETE:this._method=e;break;default:throw new l.KinveyError("Invalid request method. Only GET, POST, PATCH, PUT, and DELETE are allowed.")}}},{key:"headers",get:function(){return this._headers},set:function(e){e instanceof p.Headers||(e=new p.Headers(e)),this._headers=e}},{key:"url",get:function(){return!0===this.cache?(0,f.appendQuery)(this._url,i.default.stringify({_:Math.random().toString(36).substr(2)})):this._url},set:function(e){this._url=e}},{key:"data",get:function(){return this.body},set:function(e){this.body=e}},{key:"timeout",get:function(){return this._timeout},set:function(e){if(e=parseInt(e,10),!1===(0,s.default)(e)||isNaN(e))throw new l.KinveyError("Invalid timeout. Timeout must be a number.");this._timeout=e}},{key:"followRedirect",get:function(){return this._followRedirect},set:function(e){this._followRedirect=!!e}},{key:"cache",get:function(){return this._cache},set:function(e){this._cache=!!e}}]),e}()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.NetworkRack=t.Rack=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=function e(t,r,n){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,r);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,r,n)}if("value"in o)return o.value;var u=o.get;return void 0!==u?u.call(n):void 0},i=d(r(1)),u=d(r(287)),a=d(r(20)),s=d(r(316)),c=r(3),l=r(14),f=r(125);function d(e){return e&&e.__esModule?e:{default:e}}function p(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function y(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function h(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var v=t.Rack=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Rack";p(this,t);var r=y(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.middlewares=[],r.canceled=!1,r.activeMiddleware=void 0,r}return h(t,f.Middleware),n(t,[{key:"use",value:function(e){if((0,c.isDefined)(e)){if(e instanceof f.Middleware)return void this.middlewares.push(e);throw new Error("Unable to use the middleware. It must be an instance of Middleware.")}}},{key:"reset",value:function(){this.middlewares=[]}},{key:"execute",value:function(e){var t=this;return!1===(0,c.isDefined)(e)?i.default.reject(new Error("Request is undefined. Please provide a valid request.")):(0,u.default)((0,s.default)(this.middlewares),function(r,n){return r.then(function(r){var o=r.request,u=r.response;return t.canceled?i.default.reject(new Error("Cancelled")):(t.activeMiddleware=n,n.handle(o||e,u))})},i.default.resolve({request:e})).then(function(e){var r=e.response;return!0===t.canceled?i.default.reject(new Error("Cancelled")):(t.canceled=!1,t.activeMiddleware=void 0,r)}).catch(function(e){throw t.canceled=!1,t.activeMiddleware=void 0,e})}},{key:"cancel",value:function(){return this.canceled=!0,(0,c.isDefined)(this.activeMiddleware)&&(0,a.default)(this.activeMiddleware.cancel)?this.activeMiddleware.cancel():i.default.resolve()}},{key:"handle",value:function(e){return this.execute(e)}},{key:"generateTree",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"generateTree",this).call(this,e);return(0,s.default)(this.middlewares).forEach(function(t){r.nodes.push(t.generateTree(e+1))}),r}}]),t}(),b=new(function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Network Rack";p(this,t);var r=y(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.use(new f.SerializeMiddleware),r.use(new f.HttpMiddleware),r.use(new f.ParseMiddleware),r}return h(t,v),n(t,[{key:"useHttpMiddleware",value:function(e){this.reset(),this.use(new f.SerializeMiddleware),this.use(e),this.use(new f.ParseMiddleware)}},{key:"execute",value:function(e){return l.Log.debug("Executing network request",e),o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"execute",this).call(this,e).then(function(t){return l.Log.debug("Received response for network request: "+e.id,t),t}).catch(function(t){throw l.Log.error("Received error for network request id: "+e.id,t),t})}}]),t}());t.NetworkRack=b},function(e,t,r){var n=r(291),o=r(12);e.exports=function e(t,r,i,u,a){return t===r||(null==t||null==r||!o(t)&&!o(r)?t!=t&&r!=r:n(t,r,i,u,e,a))}},function(e,t,r){var n=r(292),o=r(295),i=r(296),u=1,a=2;e.exports=function(e,t,r,s,c,l){var f=r&u,d=e.length,p=t.length;if(d!=p&&!(f&&p>d))return!1;var y=l.get(e);if(y&&l.get(t))return y==t;var h=-1,v=!0,b=r&a?new n:void 0;for(l.set(e,t),l.set(t,e);++h<d;){var _=e[h],m=t[h];if(s)var g=f?s(m,_,h,t,e,l):s(_,m,h,e,t,l);if(void 0!==g){if(g)continue;v=!1;break}if(b){if(!o(t,function(e,t){if(!i(b,t)&&(_===e||c(_,e,r,s,l)))return b.push(t)})){v=!1;break}}else if(_!==m&&!c(_,m,r,s,l)){v=!1;break}}return l.delete(e),l.delete(t),v}},function(e,t,r){var n=r(8);e.exports=function(e){return e==e&&!n(e)}},function(e,t){e.exports=function(e,t){return function(r){return null!=r&&r[e]===t&&(void 0!==t||e in Object(r))}}},function(e,t,r){var n=r(124),o=r(49);e.exports=function(e,t){for(var r=0,i=(t=n(t,e)).length;null!=e&&r<i;)e=e[o(t[r++])];return r&&r==i?e:void 0}},function(e,t,r){var n=r(4),o=r(77),i=r(304),u=r(307);e.exports=function(e,t){return n(e)?e:o(e,t)?[e]:i(u(e))}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(318);Object.keys(n).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return n[e]}})});var o=r(50);Object.keys(o).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return o[e]}})});var i=r(320);Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return i[e]}})});var u=r(321);Object.keys(u).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return u[e]}})})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PubNubListener=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=r(127);t.PubNubListener=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.EventEmitter),n(t,[{key:"message",value:function(e){this.emit(e.channel,e.message)}},{key:"status",value:function(e){var r=this,n=this._getEventNamesFromStatus(e.affectedChannels,e.affectedChannelGroups);n.length?n.forEach(function(n){r.emit(""+t.statusPrefix+n,e)}):this.emit(t.unclassifiedEvents,e)}},{key:"_getEventNamesFromStatus",value:function(e,t){var r=t||[];return(e||[]).concat(r)}}],[{key:"statusPrefix",get:function(){return"status:"}},{key:"unclassifiedEvents",get:function(){return"pubNubEventsNotRouted"}}]),t}()},function(e,t){e.exports=require("events")},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CacheOfflineDataProcessor=void 0;var n,o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=function e(t,r,n){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,r);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,r,n)}if("value"in o)return o.value;var u=o.get;return void 0!==u?u.call(n):void 0},u=r(1),a=r(51),s=(n=a)&&n.__esModule?n:{default:n},c=r(10),l=r(2),f=r(80),d=r(3),p=r(40),y=r(13),h=r(135),v=r(54);t.CacheOfflineDataProcessor=function(e){function t(e,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n._networkRepository=r,n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,f.OfflineDataProcessor),o(t,[{key:"_deleteEntityAndHandleOfflineState",value:function(e,r,n){var o=this;if((0,y.isLocalEntity)(r))return i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_deleteEntityAndHandleOfflineState",this).call(this,e,r,n);return this._attemptDeleteByIdOverNetwork(e,r._id,n).then(function(t){return t?o._syncManager.removeSyncItemForEntityId(e,r._id).then(function(){return o._getRepository()}).then(function(t){return t.deleteById(e,r._id,n)}):o._syncManager.addDeleteEvent(e,r).then(function(){return 0})})}},{key:"_processDelete",value:function(e,t,r){var n=this,o=void 0;return this._attemptDeleteOverNetwork(e,t,r).then(function(e){return o=e,n._getRepository()}).then(function(n){return n.read(e,t,r)}).then(function(i){return(0,y.isEmpty)(i)?0:o?n._deleteEntitiesOffline(e,t,i,r):n._syncManager.addDeleteEvent(e,i).then(function(){return 0})})}},{key:"_processCreate",value:function(e,r,n){var o=this,u=void 0;return r=(0,s.default)(r),i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_processCreate",this).call(this,e,r,n).then(function(t){return u=t,o._networkRepository.create(e,r,n)}).then(function(t){return o._replaceNetworkEntityOffline(e,u._id,t).then(function(){return o._syncManager.removeSyncItemForEntityId(e,u._id)}).then(function(){return t})})}},{key:"_processRead",value:function(e,r){var n=this,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=void 0,s=o.useDeltaSet;return(0,p.wrapInObservable)(function(f){return i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_processRead",n).call(n,e,r,o).then(function(t){return a=t,f.next(a),n._ensureCountBeforeRead(e,"fetch the entities",r)}).then(function(){return s?(0,h.deltaSet)(e,r,o).catch(function(t){if(t instanceof l.InvalidCachedQuery)return s=!1,(0,v.getCachedQuery)(e,r).then(function(e){return(0,v.deleteCachedQuery)(e)}).catch(function(e){if(e instanceof l.NotFoundError)return null;throw e}).then(function(){return n._networkRepository.read(e,r,Object.assign(o,{dataOnly:!1}))});throw t}):n._networkRepository.read(e,r,Object.assign(o,{dataOnly:!1}))}).then(function(t){return(0,v.getCachedQuery)(e,r).then(function(e){return e&&t.headers?(e.lastRequest=t.headers.requestStart,(0,v.updateCachedQuery)(e)):null}).then(function(){return t.data?t.data:t})}).then(function(l){if(s){var f=[];if(l.deleted.length>0){var d=new c.Query;d.contains("_id",l.deleted.map(function(e){return e._id})),f.push(n._deleteEntitiesOffline(e,d,l.deleted))}return l.changed.length>0&&f.push(n._replaceOfflineEntities(e,l.changed,l.changed)),u.Promise.all(f).then(function(){return i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_processRead",n).call(n,e,r,o)})}return n._replaceOfflineEntities(e,a,l).then(function(){return l})}).then(function(e){return f.next(e),e})})}},{key:"_processReadById",value:function(e,r,n){var o=this,u=void 0;return(0,p.wrapInObservable)(function(a){var s=(new c.Query).equalTo("_id",r);return i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_processReadById",o).call(o,e,r,n).catch(function(e){return o._catchNotFoundError(e)}).then(function(t){return a.next(t),u=t,o._ensureCountBeforeRead(e,"find the entity",s)}).then(function(){return o._networkRepository.readById(e,r,n)}).then(function(t){return a.next(t),o._replaceOfflineEntities(e,u,(0,d.ensureArray)(t))})})}},{key:"_processUpdate",value:function(e,r,n){var o=this;return i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_processUpdate",this).call(this,e,r,n).then(function(){return o._networkRepository.update(e,r,n)}).then(function(t){return o._getRepository().then(function(r){return r.update(e,t,n)}).then(function(){return o._syncManager.removeSyncItemForEntityId(e,t._id)}).then(function(){return t})})}},{key:"_processCount",value:function(e,r,n){var o=this;return(0,p.wrapInObservable)(function(u){return i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_processCount",o).call(o,e,r,n).then(function(t){return u.next(t),o._networkRepository.count(e,r,n)}).then(function(e){return u.next(e)})})}},{key:"_processGroup",value:function(e,r,n){var o=this;return(0,p.wrapInObservable)(function(u){return i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_processGroup",o).call(o,e,r,n).catch(function(){return[]}).then(function(t){return u.next(t),o._networkRepository.group(e,r,n)}).then(function(e){return u.next(e)})})}},{key:"_replaceNetworkEntityOffline",value:function(e,t,r){return this._getRepository().then(function(n){var o=u.Promise.resolve();return t&&(o=n.deleteById(e,t)),o.then(function(){return n.create(e,r)})})}},{key:"_replaceOfflineEntities",value:function(e,t,r){var n=this,o=u.Promise.resolve(),i=(0,d.ensureArray)(t);if(t&&(0,y.isNotEmpty)(i)){var a=(new c.Query).contains("_id",i.map(function(e){return e._id}));o=this._getRepository().then(function(t){return t.delete(e,a)})}return o.then(function(){return n._getRepository()}).then(function(t){return t.create(e,r)})}},{key:"_attemptDeleteByIdOverNetwork",value:function(e,t,r){var n=this;return new u.Promise(function(o){return n._networkRepository.deleteById(e,t,r).then(function(){return o(!0)}).catch(function(e){e instanceof l.NotFoundError?o(!0):o(!1)})})}},{key:"_attemptDeleteOverNetwork",value:function(e,t,r){var n=this;return new u.Promise(function(o){n._networkRepository.delete(e,t,r).then(function(){return o(!0)}).catch(function(){return o(!1)})})}},{key:"_deleteEntitiesOffline",value:function(e,t,r,n){var o=this;return this._getRepository().then(function(r){return r.delete(e,t,n)}).then(function(t){return o._syncManager.removeSyncItemsForIds(e,r.map(function(e){return e._id})).then(function(){return t})})}},{key:"_ensureCountBeforeRead",value:function(e,t,r){return this._syncManager.getSyncItemCountByEntityQuery(e,r).then(function(e){return 0===e?e:u.Promise.reject((0,y.getEntitiesPendingPushError)(e,t))})}},{key:"_catchNotFoundError",value:function(e){if(!(e instanceof l.NotFoundError))return u.Promise.reject(e)}}]),t}()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.StorageProvider={Memory:"Memory",WebSQL:"WebSQL",IndexedDB:"IndexedDB",LocalStorage:"LocalStorage",SessionStorage:"SessionStorage",SQLite:"SQLite"}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(131);Object.keys(n).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return n[e]}})});var o=r(334);Object.keys(o).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return o[e]}})})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.InmemoryOfflineRepository=void 0;var n,o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(1),u=r(328),a=(n=u)&&n.__esModule?n:{default:n},s=r(2),c=r(132),l=r(52),f=r(3);t.InmemoryOfflineRepository=function(e){function t(e,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n._persister=e,n._queue=r,n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,c.OfflineRepository),o(t,[{key:"create",value:function(e,t){var r=this;return this._enqueueCrudOperation(e,function(){return r._create(e,t).then(function(){return t})})}},{key:"read",value:function(e,t){return this._readAll(e).then(function(e){return t?(0,l.applyQueryToDataset)(e,t):e})}},{key:"readById",value:function(e,t){return this._readAll(e).then(function(r){var n=r.find(function(e){return e._id===t});if(!n){var o="An entity with id "+t+' was not found in the collection "'+e+'"';return i.Promise.reject(new s.NotFoundError(o))}return n})}},{key:"count",value:function(e,t){return this._readAll(e).then(function(e){return(0,l.applyQueryToDataset)(e,t).length})}},{key:"update",value:function(e,t){var r=this;return this._enqueueCrudOperation(e,function(){return r._update(e,t).then(function(){return t})})}},{key:"delete",value:function(e,t){var r=this;return this._enqueueCrudOperation(e,function(){return r._delete(e,t)})}},{key:"deleteById",value:function(e,t){var r=this;return this._enqueueCrudOperation(e,function(){return r._deleteById(e,t)})}},{key:"clear",value:function(e){var t=this,r=i.Promise.resolve(e);return e||(r=this._getAllCollections()),r.then(function(e){return t._clearCollections(e)})}},{key:"group",value:function(e,t){return this._readAll(e).then(function(e){return(0,l.applyAggregationToDataset)(e,t)})}},{key:"_formCollectionKey",value:function(e){return this._getAppKey()+"."+e}},{key:"_deleteMatchingEntitiesFromPersistance",value:function(e,t,r){var n=(0,a.default)(r,"_id"),o=t.filter(function(e){return!n[e._id]});return t.length-o.length>0?this._saveAll(e,o):i.Promise.resolve()}},{key:"_delete",value:function(e,t){var r=this;return this._readAll(e).then(function(n){var o=(0,l.applyQueryToDataset)(n,t);return r._deleteMatchingEntitiesFromPersistance(e,n,o).then(function(){return o.length})})}},{key:"_deleteById",value:function(e,t){var r=this;return this._readAll(e).then(function(n){var o=n.findIndex(function(e){return e._id===t});return o>-1?(n.splice(o,1),r._saveAll(e,n).then(function(){return 1})):i.Promise.resolve(0)})}},{key:"_getAllCollections",value:function(){var e=this;return this._persister.getKeys().then(function(t){var r=[];return(t=t||[]).forEach(function(t){e._keyBelongsToApp(t)&&r.push(e._getCollectionFromKey(t))}),r})}},{key:"_update",value:function(e,t){var r=this,n=(0,f.ensureArray)(t),o=(0,a.default)(n,"_id"),i=n.length;return this._readAll(e).then(function(t){return t.forEach(function(e,r){i>0&&o[e._id]&&(t[r]=o[e._id],delete o[e._id],i-=1)}),i>0&&Object.keys(o).forEach(function(e){t.push(o[e])}),r._saveAll(e,t)})}},{key:"_readAll",value:function(e){var t=this._formCollectionKey(e);return this._persister.read(t).then(function(e){return e||[]})}},{key:"_saveAll",value:function(e,t){var r=this._formCollectionKey(e);return this._persister.write(r,t)}},{key:"_deleteAll",value:function(e){var t=this._getAppKey(),r=this._formCollectionKey(e);return r!==t+"."+f.activeUserKey?this._persister.delete(r):i.Promise.resolve()}},{key:"_enqueueCrudOperation",value:function(e,t){var r=this._formCollectionKey(e);return this._queue.enqueue(r,t)}},{key:"_keyBelongsToApp",value:function(e){var t=this._getAppKey();return 0===e.indexOf(t)}},{key:"_getCollectionFromKey",value:function(e){var t=this._getAppKey();return e.substring((t+".").length)}},{key:"_clearCollections",value:function(e){var t=this,r=(0,f.ensureArray)(e).map(function(e){return t._enqueueCrudOperation(e,function(){return t._deleteAll(e)})});return i.Promise.all(r).then(function(){return!0})}},{key:"_create",value:function(e,t){var r=this;return this._readAll(e).then(function(n){return n=n.concat(t),r._saveAll(e,n)})}}]),t}()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OfflineRepository=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=r(5),i=r(81);t.OfflineRepository=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i.Repository),n(t,[{key:"clear",value:function(){this._throwNotImplementedError()}},{key:"_throwNotImplementedError",value:function(){throw new Error("Method of OfflineRepository not implemented")}},{key:"_getAppKey",value:function(){return o.Client.sharedInstance().appKey}}]),t}()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.NetworkRepository=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=r(1),i=r(6),u=r(41),a=r(81),s=r(3),c=r(52);t.NetworkRepository=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a.Repository),n(t,[{key:"read",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=this._buildRequestConfig(e,i.RequestMethod.GET,null,t,null,null,r);return this._makeHttpRequest(n,r.dataOnly)}},{key:"readById",value:function(e,t,r){var n=this._buildRequestConfig(e,i.RequestMethod.GET,null,null,t,null,r);return this._makeHttpRequest(n)}},{key:"create",value:function(e,t,r){return this._processBatch(e,i.RequestMethod.POST,t,r)}},{key:"update",value:function(e,t,r){return this._processBatch(e,i.RequestMethod.PUT,t,r)}},{key:"deleteById",value:function(e,t,r){var n=this._buildRequestConfig(e,i.RequestMethod.DELETE,null,null,t,null,r);return this._makeHttpRequest(n).then(function(e){return e.count})}},{key:"delete",value:function(e,t,r){var n=this._buildRequestConfig(e,i.RequestMethod.DELETE,null,t,null,null,r);return this._makeHttpRequest(n).then(function(e){return e.count})}},{key:"count",value:function(e,t,r){var n=this._buildRequestConfig(e,i.RequestMethod.GET,null,t,null,"_count",null,r);return this._makeHttpRequest(n,r.dataOnly).then(function(e){return!1===r.dataOnly?e:e.count})}},{key:"group",value:function(e,t,r){var n=this._buildRequestConfig(e,i.RequestMethod.POST,null,t,null,"_group",null,r);return this._makeHttpRequest(n)}},{key:"_processBatch",value:function(e,t,r,n){var u=this,a=!Array.isArray(r),c=(0,s.ensureArray)(r).map(function(r){var o=t===i.RequestMethod.PUT?r._id:null,a=u._buildRequestConfig(e,t,r,null,o,null,n);return u._makeHttpRequest(a)});return o.Promise.all(c).then(function(e){return a?e&&e[0]:e})}},{key:"_makeHttpRequest",value:function(e,t){return i.KinveyRequest.execute(e,null,t)}},{key:"_buildRequestConfig",value:function(e,t,r,n,o,i,a){a=a||{};var s={method:t,pathname:(0,c.buildCollectionUrl)(e,o,i),timeout:a.timeout,properties:a.properties,trace:a.trace,skipBL:a.skipBL,kinveyFileTTL:a.kinveyFileTTL,kinveyFileTLS:a.kinveyFileTLS};return r&&(s.body=r),n instanceof u.Aggregation?s.aggregation=n:s.query=n,s}}]),t}()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DataProcessor=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=r(1),i=r(2),u=r(32);r(3);t.DataProcessor=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return n(e,[{key:"_getRepository",value:function(){throw new Error("_getRepository not implemented")}},{key:"process",value:function(e,t){var r=e.collection,n=e.data,a=e.query,s=e.entityId;switch(e.type){case u.OperationType.Create:return this._processCreate(r,n,t);case u.OperationType.Read:return this._processRead(r,a,t);case u.OperationType.ReadById:return this._processReadById(r,s,t);case u.OperationType.Update:return this._processUpdate(r,n,t);case u.OperationType.Delete:return this._processDelete(r,a,t);case u.OperationType.DeleteById:return this._processDeleteById(r,s,t);case u.OperationType.Count:return this._processCount(r,a,t);case u.OperationType.Group:return this._processGroup(r,a,t);default:var c=new i.KinveyError("Unexpected operation type: "+e.type);return o.Promise.reject(c)}}},{key:"_processCreate",value:function(e,t,r){return this._getRepository().then(function(n){return n.create(e,t,r)})}},{key:"_processRead",value:function(e,t,r){return this._getRepository().then(function(n){return n.read(e,t,r)})}},{key:"_processReadById",value:function(e,t,r){return this._getRepository().then(function(n){return n.readById(e,t,r)})}},{key:"_processUpdate",value:function(e,t,r){return this._getRepository().then(function(n){return n.update(e,t,r)})}},{key:"_processDelete",value:function(e,t,r){return this._getRepository().then(function(n){return n.delete(e,t,r)})}},{key:"_processDeleteById",value:function(e,t,r){return this._getRepository().then(function(n){return n.deleteById(e,t,r)})}},{key:"_processCount",value:function(e,t,r){return this._getRepository().then(function(n){return n.count(e,t,r)})}},{key:"_processGroup",value:function(e,t,r){return this._getRepository().then(function(n){return n.group(e,t,r)})}}]),e}()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.deltaSet=function(e,t,r){return(0,s.getCachedQuery)(e,t).then(function(s){if(!s||!s.lastRequest)throw new u.InvalidCachedQuery;var c=i.Client.sharedInstance(),l=new o.KinveyRequest({authType:o.AuthType.Default,method:o.RequestMethod.GET,url:(0,n.format)({protocol:c.apiProtocol,host:c.apiHost,pathname:(0,a.buildCollectionUrl)(e,null,"_deltaset"),query:{since:s.lastRequest}}),query:t,timeout:r.timeout,followRedirect:r.followRedirect,cache:r.cache,properties:r.properties,skipBL:r.skipBL,trace:r.trace,client:c});return l.execute().catch(function(e){if(e instanceof u.ParameterValueOutOfRangeError||e instanceof u.ResultSetSizeExceededError||e instanceof u.MissingConfigurationError)throw new u.InvalidCachedQuery;throw e})})};var n=r(15),o=r(6),i=r(5),u=r(2),a=r(13),s=r(54)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.NetworkDataProcessor=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=r(1),i=r(134),u=r(16);t.NetworkDataProcessor=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i.DataProcessor),n(t,[{key:"_getRepository",value:function(){if(!this._repoPromise){var e=u.repositoryProvider.getNetworkRepository();this._repoPromise=o.Promise.resolve(e)}return this._repoPromise}}]),t}()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SyncManager=void 0;var n,o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(1),u=r(51),a=(n=u)&&n.__esModule?n:{default:n},s=r(14),c=r(2),l=r(343),f=r(139),d=r(140),p=r(13),y=r(16),h=r(10),v=r(3),b=r(135),_=r(54);var m=(0,l.getPlatformConfig)(),g=m.maxConcurrentPullRequests,O=m.maxConcurrentPushRequests,w={};t.SyncManager=function(){function e(t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._networkRepo=t,this._syncStateManager=r}return o(e,[{key:"push",value:function(e){var t=this;return(0,p.isEmpty)(e)||!(0,v.isNonemptyString)(e)?i.Promise.reject(new c.KinveyError("Invalid or missing collection name")):this._pushIsInProgress(e)?i.Promise.reject(new c.SyncError("Data is already being pushed to the backend. Please wait for it to complete before pushing new data to the backend.")):(this._markPushStart(e),this._syncStateManager.getSyncItems(e).then(function(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return t._processSyncItems(e,r)}).then(function(r){return t._markPushEnd(e),r}).catch(function(e){return t._markPushEnd(),i.Promise.reject(e)}))}},{key:"pull",value:function(e,t){var r=this,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return i.Promise.resolve().then(function(){if(!(0,v.isNonemptyString)(e))throw new c.KinveyError("Invalid or missing collection name")}).then(function(){return n.useDeltaSet?(0,b.deltaSet)(e,t,n).then(function(r){return(0,_.getCachedQuery)(e,t).then(function(e){return e?(e.lastRequest=r.headers.requestStart,(0,_.updateCachedQuery)(e)):null}).then(function(){return r.data})}).then(function(t){if(t.deleted.length>0){var n=new h.Query;return n.contains("_id",t.deleted.map(function(e){return e._id})),r._deleteOfflineEntities(e,n).then(function(){return t})}return t}).then(function(t){return t.changed.length>0?r._getOfflineRepo().then(function(r){return r.update(e,t.changed)}).then(function(){return t.changed.length}):0}):n.autoPagination?r._paginatedPull(e,t,n):r._fetchItemsFromServer(e,t,n).then(function(r){return(0,_.getCachedQuery)(e,t).then(function(e){return e&&r.headers?(e.lastRequest=r.headers.requestStart,(0,_.updateCachedQuery)(e)):null}).then(function(){return r.data?r.data:r})}).then(function(n){return r._replaceOfflineEntities(e,t,n).then(function(e){return e.length})})}).catch(function(o){if(o instanceof c.InvalidCachedQuery)return(0,_.getCachedQuery)(e,t).then(function(e){return(0,_.deleteCachedQuery)(e)}).catch(function(e){if(e instanceof c.NotFoundError)return null;throw e}).then(function(){return r.pull(e,t,Object.assign(n,{useDeltaSet:!1}))});throw o})}},{key:"getSyncItemCount",value:function(e){return(0,v.isNonemptyString)(e)?this._syncStateManager.getSyncItemCount(e):i.Promise.reject(new c.KinveyError("Invalid or missing collection name"))}},{key:"getSyncItemCountByEntityQuery",value:function(e,t){var r=this;return t?this._getOfflineRepo().then(function(r){return r.read(e,t)}).then(function(t){var n=t.map(function(e){return e._id});return r._syncStateManager.getSyncItemCount(e,n)}):this._syncStateManager.getSyncItemCount(e)}},{key:"getSyncEntities",value:function(e,t){var r=this;return this._getOfflineRepo().then(function(r){return r.read(e,t)}).then(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return r._syncStateManager.getSyncItems(e,t.map(function(e){return e._id}))})}},{key:"clearSync",value:function(e,t){var r=this;return t?this._getEntityIdsForQuery(e,t).then(function(t){return r._syncStateManager.removeSyncItemsForIds(e,t)}):this._syncStateManager.removeAllSyncItems(e)}},{key:"addCreateEvent",value:function(e,t){return this._addEvent(e,t,f.SyncOperation.Create)}},{key:"addDeleteEvent",value:function(e,t){return this._addEvent(e,t,f.SyncOperation.Delete)}},{key:"addUpdateEvent",value:function(e,t){return this._addEvent(e,t,f.SyncOperation.Update)}},{key:"removeSyncItemForEntityId",value:function(e,t){return this._syncStateManager.removeSyncItemForEntityId(e,t)}},{key:"removeSyncItemsForIds",value:function(e,t){return this._syncStateManager.removeSyncItemsForIds(e,t)}},{key:"_deleteOfflineEntities",value:function(e,t){return this._getOfflineRepo().then(function(r){return r.delete(e,t)})}},{key:"_replaceOfflineEntities",value:function(e,t){var r=this,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return t&&(t.hasSkip()||t.hasLimit())?this._getOfflineRepo().then(function(t){return t.update(e,n)}):this._deleteOfflineEntities(e,t).then(function(){return r._getOfflineRepo()}).then(function(t){return t.update(e,n)})}},{key:"_getPushOpResult",value:function(e,t){var r={_id:e,operation:t};return t!==f.SyncOperation.Delete&&(r.entity=null),r}},{key:"_sanitizeOfflineEntity",value:function(e){var t=(0,a.default)(e);return delete t._id,t._kmd&&delete t._kmd.local,t}},{key:"_replaceOfflineEntityWithNetwork",value:function(e,t,r){var n=void 0;return this._getOfflineRepo().then(function(r){return(n=r).deleteById(e,t)}).then(function(){return n.create(e,r)})}},{key:"_pushCreate",value:function(e,t){var r=this,n=t;t._kmd&&t._kmd.local&&(n=this._sanitizeOfflineEntity(t));var o=this._getPushOpResult(t._id,f.SyncOperation.Create);return this._networkRepo.create(e,n).then(function(n){return o.entity=n,r._replaceOfflineEntityWithNetwork(e,t._id,n)}).then(function(){return o}).catch(function(e){return o.error=e,o})}},{key:"_pushDelete",value:function(e,t){var r=this._getPushOpResult(t,f.SyncOperation.Delete);return this._networkRepo.deleteById(e,t).then(function(){return r}).catch(function(e){return r.error=e,r})}},{key:"_pushUpdate",value:function(e,t){var r=this,n=this._getPushOpResult(t._id,f.SyncOperation.Update);return this._networkRepo.update(e,t).then(function(e){return n.entity=e,r._getOfflineRepo()}).then(function(t){return t.update(e,n.entity)}).then(function(){return n}).catch(function(e){return n.entity=t,n.error=e,n})}},{key:"_handlePushOp",value:function(e,t,r){var n=t.state,o=t.entityId,i=n.operation;switch(i){case f.SyncOperation.Create:return this._pushCreate(e,r);case f.SyncOperation.Delete:return this._pushDelete(e,o);case f.SyncOperation.Update:return this._pushUpdate(e,r);default:var u=this._getPushOpResult(o,i);return u.error=new c.SyncError("Unexpected sync operation: "+i),u}}},{key:"_pushItem",value:function(e,t){var r=this,n=t.entityId,o=t.state;return this._getOfflineRepo().then(function(t){return t.readById(e,n)}).catch(function(t){return t instanceof c.NotFoundError?o.operation!==f.SyncOperation.Delete?r._syncStateManager.removeSyncItemForEntityId(e,n).then(function(){return i.Promise.reject(t)}):null:i.Promise.reject(t)}).then(function(n){return r._handlePushOp(e,t,n)})}},{key:"_processSyncItem",value:function(e,t){var r=this;return this._pushItem(e,t).then(function(e){return e.error?e:r._syncStateManager.removeSyncItemForEntityId(t.collection,t.entityId).then(function(){return e})}).catch(function(e){var n=r._getPushOpResult(t.entityId,t.state.operation);return n.error=e,n})}},{key:"_processSyncItems",value:function(e,t){var r=this,n=[];return(0,v.forEachAsync)(t,function(t){return r._processSyncItem(e,t).then(function(e){return n.push(e)})},O).then(function(){return n})}},{key:"_fetchItemsFromServer",value:function(e,t,r){return this._networkRepo.read(e,t,Object.assign(r,{dataOnly:!1}))}},{key:"_getOfflineRepo",value:function(){return this._offlineRepoPromise||(this._offlineRepoPromise=y.repositoryProvider.getOfflineRepository()),this._offlineRepoPromise}},{key:"_pushIsInProgress",value:function(e){return!!w[e]}},{key:"_markPushStart",value:function(e){this._pushIsInProgress(e)?s.Log.debug("Marking push start, when push already started"):w[e]=!0}},{key:"_markPushEnd",value:function(e){this._pushIsInProgress(e)?delete w[e]:s.Log.debug("Marking push end, when push is NOT started")}},{key:"_getEntityIdsForQuery",value:function(e,t){return this._getOfflineRepo().then(function(r){return r.read(e,t)}).then(function(e){return e.map(function(e){return e._id})})}},{key:"_addEvent",value:function(e,t,r){var n=this._validateCrudEventEntities(t);return n||this._setState(e,t,r).then(function(){return t})}},{key:"_validateCrudEventEntities",value:function(e){if(!e||(0,p.isEmpty)(e))return i.Promise.reject(new c.SyncError("Invalid or missing entity/entities array."));var t=(0,v.ensureArray)(e).find(function(e){return!e._id});if(t){return i.Promise.reject(new c.SyncError("An entity is missing an _id. All entities must have an _id in order to be added to the sync table.",t))}return null}},{key:"_setState",value:function(e,t,r){switch(r){case f.SyncOperation.Create:return this._syncStateManager.addCreateEvent(e,t);case f.SyncOperation.Update:return this._syncStateManager.addUpdateEvent(e,t);case f.SyncOperation.Delete:return this._syncStateManager.addDeleteEvent(e,t);default:return i.Promise.reject(new c.SyncError("Invalid sync event name"))}}},{key:"_getInternalPullQuery",value:function(e,t){var r,n,o,i=e=e||{},u=i.filter,a=i.sort,s=i.fields,c=new h.Query({filter:u,sort:a,fields:s});return c.limit=t,a&&!(0,p.isEmpty)(a)||(c.sort=(r={},n=d.defaultPullSortField,o=1,n in r?Object.defineProperty(r,n,{value:o,enumerable:!0,configurable:!0,writable:!0}):r[n]=o,r)),c}},{key:"_fetchAndUpdateEntities",value:function(e,t,r){var n=this;return this._networkRepo.read(e,t,r).then(function(t){return n._getOfflineRepo().then(function(r){return r.update(e,t)})})}},{key:"_executePaginationQueries",value:function(e,t,r){var n=this,o=0;return(0,v.forEachAsync)(t,function(t){return n._fetchAndUpdateEntities(e,t,r).then(function(e){o+=e.length})},g).then(function(){return o})}},{key:"_getExpectedEntityCount",value:function(e,t){var r=new h.Query({filter:t.filter});return this._networkRepo.count(e,r,{dataOnly:!1}).then(function(e){return{lastRequest:e.headers?e.headers.requestStart:void 0,count:e.data?e.data.count:e}})}},{key:"_paginatedPull",value:function(e,t){var r=this,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=void 0;return t=t||new h.Query,this._getExpectedEntityCount(e,t).then(function(i){var u=i.lastRequest,a=i.count;return o=r._getInternalPullQuery(t,a),r._deleteOfflineEntities(e).then(function(){var t=n.autoPagination&&n.autoPagination.pageSize||d.maxEntityLimit,i=(0,v.splitQueryIntoPages)(o,t,a);return r._executePaginationQueries(e,i,n)}).then(function(r){return(0,_.getCachedQuery)(e,t).then(function(e){return e?(e.lastRequest=u,(0,_.updateCachedQuery)(e)):null}).then(function(){return r})})})}}]),e}()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.platformName={nativeScript:"NativeScript",html5:"HTML5",nodeJs:"nodejs",phoneGap:"PhoneGap"}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.SyncOperation={Create:"POST",Update:"PUT",Delete:"DELETE"}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.syncCollectionName="kinvey_sync",t.maxEntityLimit=1e4,t.defaultPullSortField="_kmd.ect"},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SyncStateManager=void 0;var n,o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(1),u=r(51),a=(n=u)&&n.__esModule?n:{default:n},s=r(10),c=r(55),l=r(16),f=r(140),d=r(3),p=r(13);t.SyncStateManager=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return o(e,[{key:"addCreateEvent",value:function(e,t){var r=this._buildSyncItemsForEntities(e,t,c.SyncOperation.Create);return this._createSyncItems(e,r)}},{key:"addUpdateEvent",value:function(e,t){var r=this._buildSyncItemsForEntities(e,t,c.SyncOperation.Update);return this._upsertSyncItems(e,r)}},{key:"addDeleteEvent",value:function(e,t){var r=this._groupSyncItemDataForDeleteEvent(e,t),n=i.Promise.resolve();if((0,p.isNotEmpty)(r.localEntityIds)){var o=this._getEntitiesFilter(e,r.localEntityIds);n=this._deleteSyncItems(e,o)}var u=i.Promise.resolve();return(0,p.isNotEmpty)(r.syncItemsToUpsert)&&(u=this._upsertSyncItems(e,r.syncItemsToUpsert,r.syncItemsToUpsertIds)),i.Promise.all([n,u])}},{key:"getSyncItems",value:function(e,t){var r=this,n=this._getEntitiesFilter(e,t);return this._getRepository().then(function(t){return t.read(r._getSyncCollectionName(e),n)})}},{key:"getSyncItemCount",value:function(e,t){var r=this,n=this._getEntitiesFilter(e,t);return this._getRepository().then(function(t){return t.count(r._getSyncCollectionName(e),n)})}},{key:"removeSyncItemForEntityId",value:function(e,t){var r=(new s.Query).equalTo("entityId",t);return this._deleteSyncItems(e,r)}},{key:"removeSyncItemsForIds",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=this._getEntitiesFilter(e,t);return this._deleteSyncItems(e,r)}},{key:"removeAllSyncItems",value:function(e){var t=this._getCollectionFilter(e);return this._deleteSyncItems(e,t)}},{key:"_getRepository",value:function(){return this._repoPromise||(this._repoPromise=l.repositoryProvider.getOfflineRepository()),this._repoPromise}},{key:"_deleteSyncItems",value:function(e,t){var r=this;return this._getRepository().then(function(n){return n.delete(r._getSyncCollectionName(e),t)})}},{key:"_getSyncItemsByEntityIds",value:function(e){var t=(new s.Query).contains("entityId",e);return this._getRepository().then(function(e){return e.read(f.syncCollectionName,t)})}},{key:"_getUpdatedSyncItem",value:function(e,t){var r=(0,a.default)(e);return r._id=t._id,r}},{key:"_upsertSyncItems",value:function(e,t,r){var n=this;r||(r=t.map(function(e){return e.entityId}));var o=(new s.Query).contains("entityId",r);return this._getRepository().then(function(t){return t.delete(n._getSyncCollectionName(e),o).then(function(){return t})}).then(function(r){return r.create(n._getSyncCollectionName(e),t)})}},{key:"_getEntitiesFilter",value:function(e,t){var r=this._getCollectionFilter(e);return t&&r.and().contains("entityId",(0,d.ensureArray)(t)),r}},{key:"_getCollectionFilter",value:function(e){var t=new s.Query;return t.equalTo("collection",e),(0,p.collectionHasTag)(e)&&t.or().equalTo("collection",(0,p.stripTagFromCollectionName)(e)),t}},{key:"_buildSyncItem",value:function(e,t,r){return{_id:(0,p.generateEntityId)(),collection:e,entityId:r,state:{operation:t}}}},{key:"_buildSyncItemsForEntities",value:function(e,t,r){var n=this;return(0,d.ensureArray)(t).map(function(t){return n._buildSyncItem(e,r,t._id)})}},{key:"_groupSyncItemDataForDeleteEvent",value:function(e,t){var r=this,n=[],o=[],i=[];return(0,d.ensureArray)(t).forEach(function(t){if((0,p.isLocalEntity)(t))n.push(t._id);else{var u=r._buildSyncItem(e,c.SyncOperation.Delete,t._id);o.push(u),i.push(t._id)}}),{localEntityIds:n,syncItemsToUpsert:o,syncItemsToUpsertIds:i}}},{key:"_createSyncItems",value:function(e,t){var r=this;return this._getRepository().then(function(n){return n.create(r._getSyncCollectionName(e),t)})}},{key:"_getSyncCollectionName",value:function(e){var t=(0,p.getTagFromCollectionName)(e);return(0,p.formTaggedCollectionName)(f.syncCollectionName,t)}}]),e}()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SyncStore=void 0;var n=r(64),o=r(33);t.SyncStore=function(e){function t(e,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var i=r||o.processorFactory.getOfflineProcessor();return function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,i,n))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,n.CacheStore),t}()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(350);Object.keys(n).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return n[e]}})})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=t.SocialIdentity={Kinvey:"kinvey",MobileIdentityConnect:"kinveyAuth"};Object.freeze(n)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Acl=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=c(r(31)),i=c(r(4)),u=c(r(9)),a=r(2),s=r(3);function c(e){return e&&e.__esModule?e:{default:e}}t.Acl=function(){function e(t){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),!1===(0,o.default)(t))throw new a.KinveyError("entity argument must be an object");t._acl=t._acl||{},this.entity=t}return n(e,[{key:"addReader",value:function(e){var t=this.readers;return-1===t.indexOf(e)&&t.push(e),this.entity._acl.r=t,this}},{key:"addReaderGroup",value:function(e){var t=this.readerGroups;return-1===t.indexOf(e)&&t.push(e),this.entity._acl.groups=(0,u.default)({},this.entity._acl.groups,{r:t}),this}},{key:"addWriter",value:function(e){var t=this.writers;return-1===t.indexOf(e)&&t.push(e),this.entity._acl.w=t,this}},{key:"addWriterGroup",value:function(e){var t=this.writerGroups;return-1===t.indexOf(e)&&t.push(e),this.entity._acl.groups=(0,u.default)({},this.entity._acl.groups,{w:t}),this}},{key:"isGloballyReadable",value:function(){return!0===this.entity._acl.gr&&this.entity._acl.gr}},{key:"isGloballyWritable",value:function(){return!0===this.entity._acl.gw&&this.entity._acl.gw}},{key:"removeReader",value:function(e){var t=this.readers,r=t.indexOf(e);return-1!==r&&t.splice(r,1),this.entity._acl.r=t,this}},{key:"removeReaderGroup",value:function(e){var t=this.readerGroups,r=t.indexOf(e);return-1!==r&&t.splice(r,1),this.entity._acl.groups=(0,u.default)({},this.entity._acl.groups,{r:t}),this}},{key:"removeWriter",value:function(e){var t=this.writers,r=t.indexOf(e);return-1!==r&&t.splice(r,1),this.entity._acl.w=t,this}},{key:"removeWriterGroup",value:function(e){var t=this.writerGroups,r=t.indexOf(e);return-1!==r&&t.splice(r,1),this.entity._acl.groups=(0,u.default)({},this.entity._acl.groups,{w:t}),this}},{key:"toPlainObject",value:function(){return this.entity._acl}},{key:"creator",get:function(){return this.entity._acl.creator}},{key:"readers",get:function(){return(0,i.default)(this.entity._acl.r)?this.entity._acl.r:[]}},{key:"writers",get:function(){return(0,i.default)(this.entity._acl.w)?this.entity._acl.w:[]}},{key:"readerGroups",get:function(){return(0,s.isDefined)(this.entity._acl.groups)&&(0,i.default)(this.entity._acl.groups.r)?this.entity._acl.groups.r:[]}},{key:"writerGroups",get:function(){return(0,s.isDefined)(this.entity._acl.groups)&&(0,i.default)(this.entity._acl.groups.w)?this.entity._acl.groups.w:[]}},{key:"globallyReadable",set:function(e){this.entity._acl.gr=!0===e&&e}},{key:"globallyWritable",set:function(e){this.entity._acl.gw=!0===e&&e}}]),e}()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Metadata=void 0;var n,o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(31),u=(n=i)&&n.__esModule?n:{default:n},a=r(2),s=r(3);t.Metadata=function(){function e(t){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),!1===(0,u.default)(t))throw new a.KinveyError("entity argument must be an object");t._kmd=t._kmd||{},this.entity=t}return o(e,[{key:"isLocal",value:function(){return!0===this.entity._kmd.local}},{key:"toPlainObject",value:function(){return this.entity._kmd}},{key:"createdAt",get:function(){if((0,s.isDefined)(this.entity._kmd.ect))return new Date(this.entity._kmd.ect)}},{key:"ect",get:function(){return this.createdAt}},{key:"emailVerification",get:function(){if((0,s.isDefined)(this.entity._kmd.emailVerification))return this.entity._kmd.emailVerification.status}},{key:"lastModified",get:function(){if((0,s.isDefined)(this.entity._kmd.lmt))return new Date(this.entity._kmd.lmt)}},{key:"lmt",get:function(){return this.lastModified}},{key:"authtoken",get:function(){return this.entity._kmd.authtoken}}]),e}()},function(e,t,r){var n=r(148);e.exports=function(e){return Object(n(e))}},function(e,t){e.exports=function(e){if(void 0==e)throw TypeError("Can't call method on  "+e);return e}},function(e,t){var r={}.hasOwnProperty;e.exports=function(e,t){return r.call(e,t)}},function(e,t,r){var n=r(151),o=r(148);e.exports=function(e){return n(o(e))}},function(e,t,r){var n=r(152);e.exports=Object("z").propertyIsEnumerable(0)?Object:function(e){return"String"==n(e)?e.split(""):Object(e)}},function(e,t){var r={}.toString;e.exports=function(e){return r.call(e).slice(8,-1)}},function(e,t,r){var n=r(154),o=Math.min;e.exports=function(e){return e>0?o(n(e),9007199254740991):0}},function(e,t){var r=Math.ceil,n=Math.floor;e.exports=function(e){return isNaN(e=+e)?0:(e>0?n:r)(e)}},function(e,t,r){var n=r(35),o=n["__core-js_shared__"]||(n["__core-js_shared__"]={});e.exports=function(e){return o[e]||(o[e]={})}},function(e,t,r){var n=r(379);e.exports=function(e,t,r){if(n(e),void 0===t)return e;switch(r){case 1:return function(r){return e.call(t,r)};case 2:return function(r,n){return e.call(t,r,n)};case 3:return function(r,n,o){return e.call(t,r,n,o)}}return function(){return e.apply(t,arguments)}}},function(e,t,r){var n=r(156),o=r(151),i=r(147),u=r(153),a=r(382);e.exports=function(e,t){var r=1==e,s=2==e,c=3==e,l=4==e,f=6==e,d=5==e||f,p=t||a;return function(t,a,y){for(var h,v,b=i(t),_=o(b),m=n(a,y,3),g=u(_.length),O=0,w=r?p(t,g):s?p(t,0):void 0;g>O;O++)if((d||O in _)&&(v=m(h=_[O],O,b),e))if(r)w[O]=v;else if(v)switch(e){case 3:return!0;case 5:return h;case 6:return O;case 2:w.push(h)}else if(l)return!1;return f?-1:c||l?l:w}}},function(e,t,r){var n=r(155)("wks"),o=r(85),i=r(35).Symbol,u="function"==typeof i;(e.exports=function(e){return n[e]||(n[e]=u&&i[e]||(u?i:o)("Symbol."+e))}).store=n},function(e,t,r){var n=r(158)("unscopables"),o=Array.prototype;void 0==o[n]&&r(87)(o,n,{}),e.exports=function(e){o[n][e]=!0}},function(e,t,r){"use strict";var n=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(r(161));e.exports=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(162);Object.keys(n).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return n[e]}})});r(84);var o,i=r(6),u=r(387),a=r(390),s=(o=a)&&o.__esModule?o:{default:o};i.NetworkRack.useHttpMiddleware(new u.NodeHttpMiddleware(s.default))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WritesToCollectionDisallowedError=t.UserAlreadyExistsError=t.TimeoutError=t.SyncError=t.StaleRequestError=t.ServerError=t.QueryError=t.PopupError=t.ParameterValueOutOfRangeError=t.NotFoundError=t.NoResponseError=t.NetworkConnectionError=t.NoActiveUserError=t.MobileIdentityConnectError=t.MissingRequestParameterError=t.MissingRequestHeaderError=t.MissingQueryError=t.KinveyInternalErrorStop=t.KinveyInternalErrorRetry=t.KinveyError=t.JSONParseError=t.InvalidQuerySyntaxError=t.InvalidIdentifierError=t.InvalidCredentialsError=t.InsufficientCredentialsError=t.IndirectCollectionAccessDisallowedError=t.IncompleteRequestBodyError=t.FeatureUnavailableError=t.DuplicateEndUsersError=t.CORSDisabledError=t.BLError=t.BadRequestError=t.AppProblemError=t.APIVersionNotImplementedError=t.APIVersionNotAvailableError=t.ActiveUserError=t.User=t.KinveyRequest=t.AuthType=t.RequestMethod=t.Properties=t.Query=t.Metadata=t.Log=t.Files=t.LiveService=t.SyncOperation=t.DataStoreType=t.DataStore=t.CustomEndpoint=t.Client=t.AuthorizationGrant=t.Aggregation=t.Acl=t.ping=t.initialize=t.init=t.setAppVersion=t.getAppVersion=t.client=t.DataAccess=void 0;var n=r(163);Object.defineProperty(t,"client",{enumerable:!0,get:function(){return n.client}}),Object.defineProperty(t,"getAppVersion",{enumerable:!0,get:function(){return n.getAppVersion}}),Object.defineProperty(t,"setAppVersion",{enumerable:!0,get:function(){return n.setAppVersion}}),Object.defineProperty(t,"init",{enumerable:!0,get:function(){return n.init}}),Object.defineProperty(t,"initialize",{enumerable:!0,get:function(){return n.initialize}}),Object.defineProperty(t,"ping",{enumerable:!0,get:function(){return n.ping}});var o=r(145);Object.defineProperty(t,"Acl",{enumerable:!0,get:function(){return o.Acl}});var i=r(41);Object.defineProperty(t,"Aggregation",{enumerable:!0,get:function(){return i.Aggregation}});var u=r(84);Object.defineProperty(t,"AuthorizationGrant",{enumerable:!0,get:function(){return u.AuthorizationGrant}});var a=r(5);Object.defineProperty(t,"Client",{enumerable:!0,get:function(){return a.Client}});var s=r(356);Object.defineProperty(t,"CustomEndpoint",{enumerable:!0,get:function(){return s.CustomEndpoint}});var c=r(29);Object.defineProperty(t,"DataStore",{enumerable:!0,get:function(){return c.DataStore}}),Object.defineProperty(t,"DataStoreType",{enumerable:!0,get:function(){return c.DataStoreType}}),Object.defineProperty(t,"SyncOperation",{enumerable:!0,get:function(){return c.SyncOperation}});var l=r(47);Object.defineProperty(t,"LiveService",{enumerable:!0,get:function(){return l.LiveServiceFacade}});var f=r(357);Object.defineProperty(t,"Files",{enumerable:!0,get:function(){return f.Files}});var d=r(14);Object.defineProperty(t,"Log",{enumerable:!0,get:function(){return d.Log}});var p=r(146);Object.defineProperty(t,"Metadata",{enumerable:!0,get:function(){return p.Metadata}});var y=r(10);Object.defineProperty(t,"Query",{enumerable:!0,get:function(){return y.Query}});var h=r(6);Object.defineProperty(t,"Properties",{enumerable:!0,get:function(){return h.Properties}}),Object.defineProperty(t,"RequestMethod",{enumerable:!0,get:function(){return h.RequestMethod}});var v=r(116);Object.defineProperty(t,"AuthType",{enumerable:!0,get:function(){return v.AuthType}}),Object.defineProperty(t,"KinveyRequest",{enumerable:!0,get:function(){return v.KinveyRequest}});var b=r(143);Object.defineProperty(t,"User",{enumerable:!0,get:function(){return b.User}});var _=r(2);Object.defineProperty(t,"ActiveUserError",{enumerable:!0,get:function(){return _.ActiveUserError}}),Object.defineProperty(t,"APIVersionNotAvailableError",{enumerable:!0,get:function(){return _.APIVersionNotAvailableError}}),Object.defineProperty(t,"APIVersionNotImplementedError",{enumerable:!0,get:function(){return _.APIVersionNotImplementedError}}),Object.defineProperty(t,"AppProblemError",{enumerable:!0,get:function(){return _.AppProblemError}}),Object.defineProperty(t,"BadRequestError",{enumerable:!0,get:function(){return _.BadRequestError}}),Object.defineProperty(t,"BLError",{enumerable:!0,get:function(){return _.BLError}}),Object.defineProperty(t,"CORSDisabledError",{enumerable:!0,get:function(){return _.CORSDisabledError}}),Object.defineProperty(t,"DuplicateEndUsersError",{enumerable:!0,get:function(){return _.DuplicateEndUsersError}}),Object.defineProperty(t,"FeatureUnavailableError",{enumerable:!0,get:function(){return _.FeatureUnavailableError}}),Object.defineProperty(t,"IncompleteRequestBodyError",{enumerable:!0,get:function(){return _.IncompleteRequestBodyError}}),Object.defineProperty(t,"IndirectCollectionAccessDisallowedError",{enumerable:!0,get:function(){return _.IndirectCollectionAccessDisallowedError}}),Object.defineProperty(t,"InsufficientCredentialsError",{enumerable:!0,get:function(){return _.InsufficientCredentialsError}}),Object.defineProperty(t,"InvalidCredentialsError",{enumerable:!0,get:function(){return _.InvalidCredentialsError}}),Object.defineProperty(t,"InvalidIdentifierError",{enumerable:!0,get:function(){return _.InvalidIdentifierError}}),Object.defineProperty(t,"InvalidQuerySyntaxError",{enumerable:!0,get:function(){return _.InvalidQuerySyntaxError}}),Object.defineProperty(t,"JSONParseError",{enumerable:!0,get:function(){return _.JSONParseError}}),Object.defineProperty(t,"KinveyError",{enumerable:!0,get:function(){return _.KinveyError}}),Object.defineProperty(t,"KinveyInternalErrorRetry",{enumerable:!0,get:function(){return _.KinveyInternalErrorRetry}}),Object.defineProperty(t,"KinveyInternalErrorStop",{enumerable:!0,get:function(){return _.KinveyInternalErrorStop}}),Object.defineProperty(t,"MissingQueryError",{enumerable:!0,get:function(){return _.MissingQueryError}}),Object.defineProperty(t,"MissingRequestHeaderError",{enumerable:!0,get:function(){return _.MissingRequestHeaderError}}),Object.defineProperty(t,"MissingRequestParameterError",{enumerable:!0,get:function(){return _.MissingRequestParameterError}}),Object.defineProperty(t,"MobileIdentityConnectError",{enumerable:!0,get:function(){return _.MobileIdentityConnectError}}),Object.defineProperty(t,"NoActiveUserError",{enumerable:!0,get:function(){return _.NoActiveUserError}}),Object.defineProperty(t,"NetworkConnectionError",{enumerable:!0,get:function(){return _.NetworkConnectionError}}),Object.defineProperty(t,"NoResponseError",{enumerable:!0,get:function(){return _.NoResponseError}}),Object.defineProperty(t,"NotFoundError",{enumerable:!0,get:function(){return _.NotFoundError}}),Object.defineProperty(t,"ParameterValueOutOfRangeError",{enumerable:!0,get:function(){return _.ParameterValueOutOfRangeError}}),Object.defineProperty(t,"PopupError",{enumerable:!0,get:function(){return _.PopupError}}),Object.defineProperty(t,"QueryError",{enumerable:!0,get:function(){return _.QueryError}}),Object.defineProperty(t,"ServerError",{enumerable:!0,get:function(){return _.ServerError}}),Object.defineProperty(t,"StaleRequestError",{enumerable:!0,get:function(){return _.StaleRequestError}}),Object.defineProperty(t,"SyncError",{enumerable:!0,get:function(){return _.SyncError}}),Object.defineProperty(t,"TimeoutError",{enumerable:!0,get:function(){return _.TimeoutError}}),Object.defineProperty(t,"UserAlreadyExistsError",{enumerable:!0,get:function(){return _.UserAlreadyExistsError}}),Object.defineProperty(t,"WritesToCollectionDisallowedError",{enumerable:!0,get:function(){return _.WritesToCollectionDisallowedError}}),r(360);t.DataAccess={Repository:c.Repository,NetworkRepository:c.NetworkRepository,OfflineRepository:c.OfflineRepository,InmemoryOfflineRepository:c.InmemoryOfflineRepository,KeyValueStoreOfflineRepository:c.KeyValueStoreOfflineRepository,KeyValuePersister:c.KeyValuePersister,KeyValueStorePersister:c.KeyValueStorePersister,MemoryKeyValuePersister:c.MemoryKeyValuePersister,BrowserKeyValuePersister:c.BrowserKeyValuePersister,SqlKeyValueStorePersister:c.SqlKeyValueStorePersister,IndexedDbKeyValueStorePersister:c.IndexedDbKeyValueStorePersister,repositoryProvider:c.repositoryProvider}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.client=void 0,t.getAppVersion=function(){var e=f();if(e)return e.appVersion;return},t.setAppVersion=function(e){var t=f();t&&(t.appVersion=e)},t.init=d,t.initialize=function(e){try{var t=d(e);return i.default.resolve(c.User.getActiveUser(t))}catch(e){return i.default.reject(e)}},t.ping=function(){var e=f();return new l.KinveyRequest({method:l.RequestMethod.GET,authType:l.AuthType.All,url:e.apiHostname+"/appdata/"+e.appKey}).execute().then(function(e){return e.data})};var n,o=r(1),i=(n=o)&&n.__esModule?n:{default:n},u=r(2),a=r(3),s=r(5),c=r(143),l=r(6);function f(){return s.Client.sharedInstance()}function d(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!1===(0,a.isDefined)(e.appKey))throw new u.KinveyError("No App Key was provided. Unable to create a new Client without an App Key.");if(!1===(0,a.isDefined)(e.appSecret)&&!1===(0,a.isDefined)(e.masterSecret))throw new u.KinveyError("No App Secret or Master Secret was provided. Unable to create a new Client without an App Secret.");return s.Client.init(e)}t.client=f},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ActiveUserError=o;var n=r(0);function o(e,t,r,n){this.name="ActiveUserError",this.message=e||"An active user already exists.",this.debug=t||void 0,this.code=r||void 0,this.kinveyRequestId=n||void 0,this.stack=(new Error).stack}o.prototype=Object.create(n.BaseError.prototype),o.prototype.constructor=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.APIVersionNotAvailableError=o;var n=r(0);function o(e,t,r,n){this.name="APIVersionNotAvailableError",this.message=e||"This API version is not available for your app.",this.debug=t||void 0,this.code=r||void 0,this.kinveyRequestId=n||void 0,this.stack=(new Error).stack}o.prototype=Object.create(n.BaseError.prototype),o.prototype.constructor=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.APIVersionNotImplementedError=o;var n=r(0);function o(e,t,r,n){this.name="APIVersionNotImplementedError",this.message=e||"This API version is not implemented.",this.debug=t||void 0,this.code=r||void 0,this.kinveyRequestId=n||void 0,this.stack=(new Error).stack}o.prototype=Object.create(n.BaseError.prototype),o.prototype.constructor=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AppProblemError=o;var n=r(0);function o(e,t,r,n){this.name="AppProblemError",this.message=e||"There is a problem with this app backend that prevents execution of this operation. Please contact support@kinvey.com for assistance.",this.debug=t||void 0,this.code=r||void 0,this.kinveyRequestId=n||void 0,this.stack=(new Error).stack}o.prototype=Object.create(n.BaseError.prototype),o.prototype.constructor=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BadRequestError=o;var n=r(0);function o(e,t,r,n){this.name="BadRequestError",this.message=e||"Unable to understand request.",this.debug=t||void 0,this.code=r||void 0,this.kinveyRequestId=n||void 0,this.stack=(new Error).stack}o.prototype=Object.create(n.BaseError.prototype),o.prototype.constructor=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BLError=o;var n=r(0);function o(e,t,r,n){this.name="BLError",this.message=e||"The Business Logic script did not complete.",this.debug=t||void 0,this.code=r||void 0,this.kinveyRequestId=n||void 0,this.stack=(new Error).stack}o.prototype=Object.create(n.BaseError.prototype),o.prototype.constructor=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CORSDisabledError=o;var n=r(0);function o(e,t,r,n){this.name="CORSDisabledError",this.message=e||"Cross Origin Support is disabled for this application.",this.debug=t||void 0,this.code=r||void 0,this.kinveyRequestId=n||void 0,this.stack=(new Error).stack}o.prototype=Object.create(n.BaseError.prototype),o.prototype.constructor=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DuplicateEndUsersError=o;var n=r(0);function o(e,t,r,n){this.name="DuplicateEndUsersError",this.message=e||"More than one user registered with this username for this application.",this.debug=t||void 0,this.code=r||void 0,this.kinveyRequestId=n||void 0,this.stack=(new Error).stack}o.prototype=Object.create(n.BaseError.prototype),o.prototype.constructor=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FeatureUnavailableError=o;var n=r(0);function o(e,t,r,n){this.name="FeatureUnavailableError",this.message=e||"Requested functionality is unavailable in this API version.",this.debug=t||void 0,this.code=r||void 0,this.kinveyRequestId=n||void 0,this.stack=(new Error).stack}o.prototype=Object.create(n.BaseError.prototype),o.prototype.constructor=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.IncompleteRequestBodyError=o;var n=r(0);function o(e,t,r,n){this.name="IncompleteRequestBodyError",this.message=e||"The request body is either missing or incomplete.",this.debug=t||void 0,this.code=r||void 0,this.kinveyRequestId=n||void 0,this.stack=(new Error).stack}o.prototype=Object.create(n.BaseError.prototype),o.prototype.constructor=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.IndirectCollectionAccessDisallowedError=o;var n=r(0);function o(e,t,r,n){this.name="IndirectCollectionAccessDisallowedError",this.message=e||"Please use the appropriate API to access this collection for this app backend.",this.debug=t||void 0,this.code=r||void 0,this.kinveyRequestId=n||void 0,this.stack=(new Error).stack}o.prototype=Object.create(n.BaseError.prototype),o.prototype.constructor=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.InsufficientCredentialsError=o;var n=r(0);function o(e,t,r,n){this.name="InsufficientCredentialsError",this.message=e||"The credentials used to authenticate this request are not authorized to run this operation. Please retry your request with appropriate credentials.",this.debug=t||void 0,this.code=r||void 0,this.kinveyRequestId=n||void 0,this.stack=(new Error).stack}o.prototype=Object.create(n.BaseError.prototype),o.prototype.constructor=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.InvalidCachedQuery=o;var n=r(0);function o(e,t,r,n){this.name="InvalidCachedQuery",this.message=e||"Invalid cached query.",this.debug=t||void 0,this.code=r||void 0,this.kinveyRequestId=n||void 0,this.stack=(new Error).stack}o.prototype=Object.create(n.BaseError.prototype),o.prototype.constructor=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.InvalidCredentialsError=o;var n=r(0);function o(e,t,r,n){this.name="InvalidCredentialsError",this.message=e||"Invalid credentials. Please retry your request with correct credentials.",this.debug=t||void 0,this.code=r||void 0,this.kinveyRequestId=n||void 0,this.stack=(new Error).stack}o.prototype=Object.create(n.BaseError.prototype),o.prototype.constructor=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.InvalidIdentifierError=o;var n=r(0);function o(e,t,r,n){this.name="InvalidIdentifierError",this.message=e||"One of more identifier names in the request has an invalid format.",this.debug=t||void 0,this.code=r||void 0,this.kinveyRequestId=n||void 0,this.stack=(new Error).stack}o.prototype=Object.create(n.BaseError.prototype),o.prototype.constructor=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.InvalidQuerySyntaxError=o;var n=r(0);function o(e,t,r,n){this.name="InvalidQuerySyntaxError",this.message=e||"The query string in the request has an invalid syntax.",this.debug=t||void 0,this.code=r||void 0,this.kinveyRequestId=n||void 0,this.stack=(new Error).stack}o.prototype=Object.create(n.BaseError.prototype),o.prototype.constructor=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.JSONParseError=o;var n=r(0);function o(e,t,r,n){this.name="JSONParseError",this.message=e||"Unable to parse the JSON in the request.",this.debug=t||void 0,this.code=r||void 0,this.kinveyRequestId=n||void 0,this.stack=(new Error).stack}o.prototype=Object.create(n.BaseError.prototype),o.prototype.constructor=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.KinveyError=o;var n=r(0);function o(e,t,r,n){this.name="KinveyError",this.message=e||"An error occurred.",this.debug=t||void 0,this.code=r||void 0,this.kinveyRequestId=n||void 0,this.stack=(new Error).stack}o.prototype=Object.create(n.BaseError.prototype),o.prototype.constructor=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.KinveyInternalErrorRetry=o;var n=r(0);function o(e,t,r,n){this.name="KinveyInternalErrorRetry",this.message=e||"The Kinvey server encountered an unexpected error. Please retry your request.",this.debug=t||void 0,this.code=r||void 0,this.kinveyRequestId=n||void 0,this.stack=(new Error).stack}o.prototype=Object.create(n.BaseError.prototype),o.prototype.constructor=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.KinveyInternalErrorStop=o;var n=r(0);function o(e,t,r,n){this.name="KinveyInternalErrorStop",this.message=e||"The Kinvey server encountered an unexpected error. Please contact support@kinvey.com for assistance.",this.debug=t||void 0,this.code=r||void 0,this.kinveyRequestId=n||void 0,this.stack=(new Error).stack}o.prototype=Object.create(n.BaseError.prototype),o.prototype.constructor=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MissingConfigurationError=o;var n=r(0);function o(e,t,r,n){this.name="MissingConfigurationError",this.message=e||"Missing configuration error.",this.debug=t||void 0,this.code=r||void 0,this.kinveyRequestId=n||void 0,this.stack=(new Error).stack}o.prototype=Object.create(n.BaseError.prototype),o.prototype.constructor=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MissingQueryError=o;var n=r(0);function o(e,t,r,n){this.name="MissingQueryError",this.message=e||"The request is missing a query string.",this.debug=t||void 0,this.code=r||void 0,this.kinveyRequestId=n||void 0,this.stack=(new Error).stack}o.prototype=Object.create(n.BaseError.prototype),o.prototype.constructor=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MissingRequestHeaderError=o;var n=r(0);function o(e,t,r,n){this.name="MissingRequestHeaderError",this.message=e||"The request is missing a required header.",this.debug=t||void 0,this.code=r||void 0,this.kinveyRequestId=n||void 0,this.stack=(new Error).stack}o.prototype=Object.create(n.BaseError.prototype),o.prototype.constructor=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MissingRequestParameterError=o;var n=r(0);function o(e,t,r,n){this.name="MissingRequestParameterError",this.message=e||"A required parameter is missing from the request.",this.debug=t||void 0,this.code=r||void 0,this.kinveyRequestId=n||void 0,this.stack=(new Error).stack}o.prototype=Object.create(n.BaseError.prototype),o.prototype.constructor=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MobileIdentityConnectError=o;var n=r(0);function o(e,t,r,n){this.name="MobileIdentityConnectError",this.message=e||"An error has occurred with Mobile Identity Connect.",this.debug=t||void 0,this.code=r||void 0,this.kinveyRequestId=n||void 0,this.stack=(new Error).stack}o.prototype=Object.create(n.BaseError.prototype),o.prototype.constructor=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.NetworkConnectionError=o;var n=r(0);function o(e,t,r,n){this.name="NetworkConnectionError",this.message=e||"There was an error connecting to the network.",this.debug=t||void 0,this.code=r||void 0,this.kinveyRequestId=n||void 0,this.stack=(new Error).stack}o.prototype=Object.create(n.BaseError.prototype),o.prototype.constructor=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.NoActiveUserError=o;var n=r(0);function o(e,t,r,n){this.name="NoActiveUserError",this.message=e||"There is not an active user.",this.debug=t||void 0,this.code=r||void 0,this.kinveyRequestId=n||void 0,this.stack=(new Error).stack}o.prototype=Object.create(n.BaseError.prototype),o.prototype.constructor=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.NoResponseError=o;var n=r(0);function o(e,t,r,n){this.name="NoResponseError",this.message=e||"No response was provided.",this.debug=t||void 0,this.code=r||void 0,this.kinveyRequestId=n||void 0,this.stack=(new Error).stack}o.prototype=Object.create(n.BaseError.prototype),o.prototype.constructor=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.NotFoundError=o;var n=r(0);function o(e,t,r,n){this.name="NotFoundError",this.message=e||"The entity was not found.",this.debug=t||void 0,this.code=r||404,this.kinveyRequestId=n||void 0,this.stack=(new Error).stack}o.prototype=Object.create(n.BaseError.prototype),o.prototype.constructor=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ParameterValueOutOfRangeError=o;var n=r(0);function o(e,t,r,n){this.name="ParameterValueOutOfRangeError",this.message=e||"The value specified for one of the request parameters is out of range.",this.debug=t||void 0,this.code=r||void 0,this.kinveyRequestId=n||void 0,this.stack=(new Error).stack}o.prototype=Object.create(n.BaseError.prototype),o.prototype.constructor=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PopupError=o;var n=r(0);function o(e,t,r,n){this.name="PopupError",this.message=e||"Unable to open a popup on this platform.",this.debug=t||void 0,this.code=r||void 0,this.kinveyRequestId=n||void 0,this.stack=(new Error).stack}o.prototype=Object.create(n.BaseError.prototype),o.prototype.constructor=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.QueryError=o;var n=r(0);function o(e,t,r,n){this.name="QueryError",this.message=e||"An error occurred with the query.",this.debug=t||void 0,this.code=r||void 0,this.kinveyRequestId=n||void 0,this.stack=(new Error).stack}o.prototype=Object.create(n.BaseError.prototype),o.prototype.constructor=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ResultSetSizeExceededError=o;var n=r(0);function o(e,t,r,n){this.name="ResultSetSizeExceededError",this.message=e||"Result set size exceeded.",this.debug=t||void 0,this.code=r||void 0,this.kinveyRequestId=n||void 0,this.stack=(new Error).stack}o.prototype=Object.create(n.BaseError.prototype),o.prototype.constructor=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ServerError=o;var n=r(0);function o(e,t,r,n){this.name="ServerError",this.message=e||"An error occurred on the server.",this.debug=t||void 0,this.code=r||500,this.kinveyRequestId=n||void 0,this.stack=(new Error).stack}o.prototype=Object.create(n.BaseError.prototype),o.prototype.constructor=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.StaleRequestError=o;var n=r(0);function o(e,t,r,n){this.name="StaleRequestError",this.message=e||"The time window for this request has expired.",this.debug=t||void 0,this.code=r||void 0,this.kinveyRequestId=n||void 0,this.stack=(new Error).stack}o.prototype=Object.create(n.BaseError.prototype),o.prototype.constructor=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SyncError=o;var n=r(0);function o(e,t,r,n){this.name="SyncError",this.message=e||"An error occurred during sync.",this.debug=t||void 0,this.code=r||void 0,this.kinveyRequestId=n||void 0,this.stack=(new Error).stack}o.prototype=Object.create(n.BaseError.prototype),o.prototype.constructor=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TimeoutError=o;var n=r(0);function o(e,t,r,n){this.name="TimeoutError",this.message=e||"The request timed out.",this.debug=t||void 0,this.code=r||void 0,this.kinveyRequestId=n||void 0,this.stack=(new Error).stack}o.prototype=Object.create(n.BaseError.prototype),o.prototype.constructor=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UserAlreadyExistsError=o;var n=r(0);function o(e,t,r,n){this.name="UserAlreadyExistsError",this.message=e||"This username is already taken. Please retry your request with a different username.",this.debug=t||void 0,this.code=r||void 0,this.kinveyRequestId=n||void 0,this.stack=(new Error).stack}o.prototype=Object.create(n.BaseError.prototype),o.prototype.constructor=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WritesToCollectionDisallowedError=o;var n=r(0);function o(e,t,r,n){this.name="WritesToCollectionDisallowedError",this.message=e||"This collection is configured to disallow any modifications to an existing entity or creation of new entities.",this.debug=t||void 0,this.code=r||void 0,this.kinveyRequestId=n||void 0,this.stack=(new Error).stack}o.prototype=Object.create(n.BaseError.prototype),o.prototype.constructor=o},function(e,t){e.exports=function(e){return null===e}},function(e,t){e.exports=function(e){return void 0===e}},function(e,t,r){var n=r(95)(Object.keys,Object);e.exports=n},function(e,t,r){var n=r(19)(r(11),"DataView");e.exports=n},function(e,t,r){var n=r(20),o=r(210),i=r(8),u=r(97),a=/^\[object .+?Constructor\]$/,s=Function.prototype,c=Object.prototype,l=s.toString,f=c.hasOwnProperty,d=RegExp("^"+l.call(f).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");e.exports=function(e){return!(!i(e)||o(e))&&(n(e)?d:a).test(u(e))}},function(e,t,r){var n=r(28),o=Object.prototype,i=o.hasOwnProperty,u=o.toString,a=n?n.toStringTag:void 0;e.exports=function(e){var t=i.call(e,a),r=e[a];try{e[a]=void 0;var n=!0}catch(e){}var o=u.call(e);return n&&(t?e[a]=r:delete e[a]),o}},function(e,t){var r=Object.prototype.toString;e.exports=function(e){return r.call(e)}},function(e,t,r){var n,o=r(211),i=(n=/[^.]+$/.exec(o&&o.keys&&o.keys.IE_PROTO||""))?"Symbol(src)_1."+n:"";e.exports=function(e){return!!i&&i in e}},function(e,t,r){var n=r(11)["__core-js_shared__"];e.exports=n},function(e,t){e.exports=function(e,t){return null==e?void 0:e[t]}},function(e,t,r){var n=r(19)(r(11),"Promise");e.exports=n},function(e,t,r){var n=r(19)(r(11),"Set");e.exports=n},function(e,t,r){var n=r(19)(r(11),"WeakMap");e.exports=n},function(e,t,r){var n=r(17),o=r(12),i="[object Arguments]";e.exports=function(e){return o(e)&&n(e)==i}},function(e,t){e.exports=function(){return!1}},function(e,t,r){var n=r(17),o=r(59),i=r(12),u={};u["[object Float32Array]"]=u["[object Float64Array]"]=u["[object Int8Array]"]=u["[object Int16Array]"]=u["[object Int32Array]"]=u["[object Uint8Array]"]=u["[object Uint8ClampedArray]"]=u["[object Uint16Array]"]=u["[object Uint32Array]"]=!0,u["[object Arguments]"]=u["[object Array]"]=u["[object ArrayBuffer]"]=u["[object Boolean]"]=u["[object DataView]"]=u["[object Date]"]=u["[object Error]"]=u["[object Function]"]=u["[object Map]"]=u["[object Number]"]=u["[object Object]"]=u["[object RegExp]"]=u["[object Set]"]=u["[object String]"]=u["[object WeakMap]"]=!1,e.exports=function(e){return i(e)&&o(e.length)&&!!u[n(e)]}},function(e,t,r){var n=r(220);e.exports=function(e){var t=n(e),r=t%1;return t==t?r?t-r:t:0}},function(e,t,r){var n=r(221),o=1/0,i=1.7976931348623157e308;e.exports=function(e){return e?(e=n(e))===o||e===-o?(e<0?-1:1)*i:e==e?e:0:0===e?e:0}},function(e,t,r){var n=r(8),o=r(38),i=NaN,u=/^\s+|\s+$/g,a=/^[-+]0x[0-9a-f]+$/i,s=/^0b[01]+$/i,c=/^0o[0-7]+$/i,l=parseInt;e.exports=function(e){if("number"==typeof e)return e;if(o(e))return i;if(n(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=n(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(u,"");var r=s.test(e);return r||c.test(e)?l(e.slice(2),r?2:8):a.test(e)?i:+e}},function(e,t,r){var n=r(223),o=Math.max;e.exports=function(e,t,r){return t=o(void 0===t?e.length-1:t,0),function(){for(var i=arguments,u=-1,a=o(i.length-t,0),s=Array(a);++u<a;)s[u]=i[t+u];u=-1;for(var c=Array(t+1);++u<t;)c[u]=i[u];return c[t]=r(s),n(e,this,c)}}},function(e,t){e.exports=function(e,t,r){switch(r.length){case 0:return e.call(t);case 1:return e.call(t,r[0]);case 2:return e.call(t,r[0],r[1]);case 3:return e.call(t,r[0],r[1],r[2])}return e.apply(t,r)}},function(e,t,r){var n=r(225),o=r(227)(n);e.exports=o},function(e,t,r){var n=r(226),o=r(101),i=r(37),u=o?function(e,t){return o(e,"toString",{configurable:!0,enumerable:!1,value:n(t),writable:!0})}:i;e.exports=u},function(e,t){e.exports=function(e){return function(){return e}}},function(e,t){var r=800,n=16,o=Date.now;e.exports=function(e){var t=0,i=0;return function(){var u=o(),a=n-(u-i);if(i=u,a>0){if(++t>=r)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}},function(e,t){e.exports=n},function(e,t,r){var n=r(8),o=r(26),i=r(230),u=Object.prototype.hasOwnProperty;e.exports=function(e){if(!n(e))return i(e);var t=o(e),r=[];for(var a in e)("constructor"!=a||!t&&u.call(e,a))&&r.push(a);return r}},function(e,t){e.exports=function(e){var t=[];if(null!=e)for(var r in Object(e))t.push(r);return t}},function(e,t){e.exports=o},function(e,t){e.exports=i},function(e,t,r){var n=r(23);e.exports=function(e){return n(e)&&e!=+e}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.rxSubscriber="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("rxSubscriber"):"@@rxSubscriber",t.$$rxSubscriber=t.rxSubscriber},function(e,t,r){var n=r(236),o=r(18);e.exports=function(e,t){return e&&n(e,t,o)}},function(e,t,r){var n=r(237)();e.exports=n},function(e,t){e.exports=function(e){return function(t,r,n){for(var o=-1,i=Object(t),u=n(t),a=u.length;a--;){var s=u[e?a:++o];if(!1===r(i[s],s,i))break}return t}}},function(e,t,r){var n=r(21);e.exports=function(e,t){return function(r,o){if(null==r)return r;if(!n(r))return e(r,o);for(var i=r.length,u=t?i:-1,a=Object(r);(t?u--:++u<i)&&!1!==o(a[u],u,a););return r}}},function(e,t,r){var n=r(109),o=1,i=4;e.exports=function(e){return n(e,o|i)}},function(e,t){e.exports=function(){this.__data__=[],this.size=0}},function(e,t,r){var n=r(44),o=Array.prototype.splice;e.exports=function(e){var t=this.__data__,r=n(t,e);return!(r<0||(r==t.length-1?t.pop():o.call(t,r,1),--this.size,0))}},function(e,t,r){var n=r(44);e.exports=function(e){var t=this.__data__,r=n(t,e);return r<0?void 0:t[r][1]}},function(e,t,r){var n=r(44);e.exports=function(e){return n(this.__data__,e)>-1}},function(e,t,r){var n=r(44);e.exports=function(e,t){var r=this.__data__,o=n(r,e);return o<0?(++this.size,r.push([e,t])):r[o][1]=t,this}},function(e,t,r){var n=r(43);e.exports=function(){this.__data__=new n,this.size=0}},function(e,t){e.exports=function(e){var t=this.__data__,r=t.delete(e);return this.size=t.size,r}},function(e,t){e.exports=function(e){return this.__data__.get(e)}},function(e,t){e.exports=function(e){return this.__data__.has(e)}},function(e,t,r){var n=r(43),o=r(57),i=r(71),u=200;e.exports=function(e,t){var r=this.__data__;if(r instanceof n){var a=r.__data__;if(!o||a.length<u-1)return a.push([e,t]),this.size=++r.size,this;r=this.__data__=new i(a)}return r.set(e,t),this.size=r.size,this}},function(e,t,r){var n=r(251),o=r(43),i=r(57);e.exports=function(){this.size=0,this.__data__={hash:new n,map:new(i||o),string:new n}}},function(e,t,r){var n=r(252),o=r(253),i=r(254),u=r(255),a=r(256);function s(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}s.prototype.clear=n,s.prototype.delete=o,s.prototype.get=i,s.prototype.has=u,s.prototype.set=a,e.exports=s},function(e,t,r){var n=r(45);e.exports=function(){this.__data__=n?n(null):{},this.size=0}},function(e,t){e.exports=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}},function(e,t,r){var n=r(45),o="__lodash_hash_undefined__",i=Object.prototype.hasOwnProperty;e.exports=function(e){var t=this.__data__;if(n){var r=t[e];return r===o?void 0:r}return i.call(t,e)?t[e]:void 0}},function(e,t,r){var n=r(45),o=Object.prototype.hasOwnProperty;e.exports=function(e){var t=this.__data__;return n?void 0!==t[e]:o.call(t,e)}},function(e,t,r){var n=r(45),o="__lodash_hash_undefined__";e.exports=function(e,t){var r=this.__data__;return this.size+=this.has(e)?0:1,r[e]=n&&void 0===t?o:t,this}},function(e,t,r){var n=r(46);e.exports=function(e){var t=n(this,e).delete(e);return this.size-=t?1:0,t}},function(e,t){e.exports=function(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e}},function(e,t,r){var n=r(46);e.exports=function(e){return n(this,e).get(e)}},function(e,t,r){var n=r(46);e.exports=function(e){return n(this,e).has(e)}},function(e,t,r){var n=r(46);e.exports=function(e,t){var r=n(this,e),o=r.size;return r.set(e,t),this.size+=r.size==o?0:1,this}},function(e,t,r){var n=r(24),o=r(18);e.exports=function(e,t){return e&&n(t,o(t),e)}},function(e,t,r){var n=r(24),o=r(39);e.exports=function(e,t){return e&&n(t,o(t),e)}},function(e,t,r){(function(e){var n=r(11),o="object"==typeof t&&t&&!t.nodeType&&t,i=o&&"object"==typeof e&&e&&!e.nodeType&&e,u=i&&i.exports===o?n.Buffer:void 0,a=u?u.allocUnsafe:void 0;e.exports=function(e,t){if(t)return e.slice();var r=e.length,n=a?a(r):new e.constructor(r);return e.copy(n),n}}).call(t,r(60)(e))},function(e,t){e.exports=function(e,t){var r=-1,n=e.length;for(t||(t=Array(n));++r<n;)t[r]=e[r];return t}},function(e,t,r){var n=r(24),o=r(72);e.exports=function(e,t){return n(e,o(e),t)}},function(e,t){e.exports=function(e,t){for(var r=-1,n=null==e?0:e.length,o=0,i=[];++r<n;){var u=e[r];t(u,r,e)&&(i[o++]=u)}return i}},function(e,t,r){var n=r(24),o=r(111);e.exports=function(e,t){return n(e,o(e),t)}},function(e,t,r){var n=r(114),o=r(111),i=r(39);e.exports=function(e){return n(e,i,o)}},function(e,t){var r=Object.prototype.hasOwnProperty;e.exports=function(e){var t=e.length,n=new e.constructor(t);return t&&"string"==typeof e[0]&&r.call(e,"index")&&(n.index=e.index,n.input=e.input),n}},function(e,t,r){var n=r(73),o=r(272),i=r(273),u=r(274),a=r(275),s="[object Boolean]",c="[object Date]",l="[object Map]",f="[object Number]",d="[object RegExp]",p="[object Set]",y="[object String]",h="[object Symbol]",v="[object ArrayBuffer]",b="[object DataView]",_="[object Float32Array]",m="[object Float64Array]",g="[object Int8Array]",O="[object Int16Array]",w="[object Int32Array]",k="[object Uint8Array]",E="[object Uint8ClampedArray]",P="[object Uint16Array]",j="[object Uint32Array]";e.exports=function(e,t,r){var S=e.constructor;switch(t){case v:return n(e);case s:case c:return new S(+e);case b:return o(e,r);case _:case m:case g:case O:case w:case k:case E:case P:case j:return a(e,r);case l:return new S;case f:case y:return new S(e);case d:return i(e);case p:return new S;case h:return u(e)}}},function(e,t,r){var n=r(73);e.exports=function(e,t){var r=t?n(e.buffer):e.buffer;return new e.constructor(r,e.byteOffset,e.byteLength)}},function(e,t){var r=/\w*$/;e.exports=function(e){var t=new e.constructor(e.source,r.exec(e));return t.lastIndex=e.lastIndex,t}},function(e,t,r){var n=r(28),o=n?n.prototype:void 0,i=o?o.valueOf:void 0;e.exports=function(e){return i?Object(i.call(e)):{}}},function(e,t,r){var n=r(73);e.exports=function(e,t){var r=t?n(e.buffer):e.buffer;return new e.constructor(r,e.byteOffset,e.length)}},function(e,t,r){var n=r(277),o=r(69),i=r(26);e.exports=function(e){return"function"!=typeof e.constructor||i(e)?{}:n(o(e))}},function(e,t,r){var n=r(8),o=Object.create,i=function(){function e(){}return function(t){if(!n(t))return{};if(o)return o(t);e.prototype=t;var r=new e;return e.prototype=void 0,r}}();e.exports=i},function(e,t,r){var n=r(279),o=r(62),i=r(63),u=i&&i.isMap,a=u?o(u):n;e.exports=a},function(e,t,r){var n=r(27),o=r(12),i="[object Map]";e.exports=function(e){return o(e)&&n(e)==i}},function(e,t,r){var n=r(281),o=r(62),i=r(63),u=i&&i.isSet,a=u?o(u):n;e.exports=a},function(e,t,r){var n=r(27),o=r(12),i="[object Set]";e.exports=function(e){return o(e)&&n(e)==i}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(283);Object.keys(n).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return n[e]}})})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LiveCollectionManager=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();t.getLiveCollectionManager=function(e){l||(l=new c(e));return l};var o=r(1),i=r(5),u=r(2),a=r(6),s=r(79);var c=t.LiveCollectionManager=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._client=t||i.Client.sharedInstance()}return n(e,[{key:"subscribeCollection",value:function(e,t){var r=this;return(0,s.isValidChannelName)(e)?(0,s.isValidReceiver)(t)?this._makeSubscriptionRequest(e,"_subscribe").then(function(){var n=r._buildChannelName(e),o=r._buildPersonalChannelName(e),i=(0,s.getLiveService)();i.subscribeToChannel(n,t),i.subscribeToChannel(o,t)}):o.Promise.reject(new u.KinveyError("Invalid or missing receiver")):o.Promise.reject(new u.KinveyError("Invalid or missing collection name"))}},{key:"unsubscribeCollection",value:function(e){var t=this;return(0,s.isValidChannelName)(e)?this._makeSubscriptionRequest(e,"_unsubscribe").then(function(){var r=t._buildChannelName(e),n=t._buildPersonalChannelName(e),o=(0,s.getLiveService)();o.unsubscribeFromChannel(r),o.unsubscribeFromChannel(n)}):o.Promise.reject(new u.KinveyError("Invalid or missing collection name"))}},{key:"_buildChannelName",value:function(e){return this._client.appKey+".c-"+e}},{key:"_buildPersonalChannelName",value:function(e){return this._buildChannelName(e)+".u-"+this._client.getActiveUser()._id}},{key:"_makeSubscriptionRequest",value:function(e,t){return a.KinveyRequest.execute({method:a.RequestMethod.POST,pathname:"/appdata/"+this._client.appKey+"/"+e+"/"+t,body:{deviceId:this._client.deviceId}})}}]),e}(),l=void 0},function(e,t){e.exports=require("buffer")},function(e,t,r){e.exports=r(286)},function(e,t,r){var n,o;!function(i,u){"use strict";"object"==typeof e&&e.exports?e.exports=u():void 0===(o="function"==typeof(n=u)?n.call(t,r,t,e):n)||(e.exports=o)}(0,function(){"use strict";var e="undefined"!=typeof Promise?Promise:function(){return{then:function(){throw new Error("Queue.configure() before use Queue")}}},t=function(){};function r(e,t,r){this.options=r=r||{},this.pendingPromises=0,this.maxPendingPromises=void 0!==e?e:1/0,this.maxQueuedPromises=void 0!==t?t:1/0,this.queue=[],this.paused=!1}return r.configure=function(t){e=t},r.prototype.add=function(r){var n=this;return new e(function(e,o,i){n.queue.length>=n.maxQueuedPromises?o(new Error("Queue limit reached")):(n.queue.push({promiseGenerator:r,resolve:e,reject:o,notify:i||t}),n._dequeue())})},r.prototype.getPendingLength=function(){return this.pendingPromises},r.prototype.getQueueLength=function(){return this.queue.length},r.prototype.pause=function(){this.paused=!0},r.prototype.start=function(){return this.paused=!1,this._dequeue()},r.prototype._dequeue=function(){var t=this;if(this.paused)return!1;if(this.pendingPromises>=this.maxPendingPromises)return!1;var r,n=this.queue.shift();if(!n)return this.options.onEmpty&&this.options.onEmpty(),!1;try{this.pendingPromises++,(r=n.promiseGenerator(),r&&"function"==typeof r.then?r:new e(function(e){e(r)})).then(function(e){t.pendingPromises--,n.resolve(e),t._dequeue()},function(e){t.pendingPromises--,n.reject(e),t._dequeue()},function(e){n.notify(e)})}catch(e){t.pendingPromises--,n.reject(e),t._dequeue()}return!0},r})},function(e,t,r){var n=r(288),o=r(42),i=r(76),u=r(315),a=r(4);e.exports=function(e,t,r){var s=a(e)?n:u,c=arguments.length<3;return s(e,i(t,4),r,c,o)}},function(e,t){e.exports=function(e,t,r,n){var o=-1,i=null==e?0:e.length;for(n&&i&&(r=e[++o]);++o<i;)r=t(r,e[o],o,e);return r}},function(e,t,r){var n=r(290),o=r(301),i=r(122);e.exports=function(e){var t=o(e);return 1==t.length&&t[0][2]?i(t[0][0],t[0][1]):function(r){return r===e||n(r,e,t)}}},function(e,t,r){var n=r(70),o=r(119),i=1,u=2;e.exports=function(e,t,r,a){var s=r.length,c=s,l=!a;if(null==e)return!c;for(e=Object(e);s--;){var f=r[s];if(l&&f[2]?f[1]!==e[f[0]]:!(f[0]in e))return!1}for(;++s<c;){var d=(f=r[s])[0],p=e[d],y=f[1];if(l&&f[2]){if(void 0===p&&!(d in e))return!1}else{var h=new n;if(a)var v=a(p,y,d,e,t,h);if(!(void 0===v?o(y,p,i|u,a,h):v))return!1}}return!0}},function(e,t,r){var n=r(70),o=r(120),i=r(297),u=r(300),a=r(27),s=r(4),c=r(36),l=r(61),f=1,d="[object Arguments]",p="[object Array]",y="[object Object]",h=Object.prototype.hasOwnProperty;e.exports=function(e,t,r,v,b,_){var m=s(e),g=s(t),O=m?p:a(e),w=g?p:a(t),k=(O=O==d?y:O)==y,E=(w=w==d?y:w)==y,P=O==w;if(P&&c(e)){if(!c(t))return!1;m=!0,k=!1}if(P&&!k)return _||(_=new n),m||l(e)?o(e,t,r,v,b,_):i(e,t,O,r,v,b,_);if(!(r&f)){var j=k&&h.call(e,"__wrapped__"),S=E&&h.call(t,"__wrapped__");if(j||S){var M=j?e.value():e,I=S?t.value():t;return _||(_=new n),b(M,I,r,v,_)}}return!!P&&(_||(_=new n),u(e,t,r,v,b,_))}},function(e,t,r){var n=r(71),o=r(293),i=r(294);function u(e){var t=-1,r=null==e?0:e.length;for(this.__data__=new n;++t<r;)this.add(e[t])}u.prototype.add=u.prototype.push=o,u.prototype.has=i,e.exports=u},function(e,t){var r="__lodash_hash_undefined__";e.exports=function(e){return this.__data__.set(e,r),this}},function(e,t){e.exports=function(e){return this.__data__.has(e)}},function(e,t){e.exports=function(e,t){for(var r=-1,n=null==e?0:e.length;++r<n;)if(t(e[r],r,e))return!0;return!1}},function(e,t){e.exports=function(e,t){return e.has(t)}},function(e,t,r){var n=r(28),o=r(115),i=r(30),u=r(120),a=r(298),s=r(299),c=1,l=2,f="[object Boolean]",d="[object Date]",p="[object Error]",y="[object Map]",h="[object Number]",v="[object RegExp]",b="[object Set]",_="[object String]",m="[object Symbol]",g="[object ArrayBuffer]",O="[object DataView]",w=n?n.prototype:void 0,k=w?w.valueOf:void 0;e.exports=function(e,t,r,n,w,E,P){switch(r){case O:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case g:return!(e.byteLength!=t.byteLength||!E(new o(e),new o(t)));case f:case d:case h:return i(+e,+t);case p:return e.name==t.name&&e.message==t.message;case v:case _:return e==t+"";case y:var j=a;case b:var S=n&c;if(j||(j=s),e.size!=t.size&&!S)return!1;var M=P.get(e);if(M)return M==t;n|=l,P.set(e,t);var I=u(j(e),j(t),n,w,E,P);return P.delete(e),I;case m:if(k)return k.call(e)==k.call(t)}return!1}},function(e,t){e.exports=function(e){var t=-1,r=Array(e.size);return e.forEach(function(e,n){r[++t]=[n,e]}),r}},function(e,t){e.exports=function(e){var t=-1,r=Array(e.size);return e.forEach(function(e){r[++t]=e}),r}},function(e,t,r){var n=r(113),o=1,i=Object.prototype.hasOwnProperty;e.exports=function(e,t,r,u,a,s){var c=r&o,l=n(e),f=l.length;if(f!=n(t).length&&!c)return!1;for(var d=f;d--;){var p=l[d];if(!(c?p in t:i.call(t,p)))return!1}var y=s.get(e);if(y&&s.get(t))return y==t;var h=!0;s.set(e,t),s.set(t,e);for(var v=c;++d<f;){var b=e[p=l[d]],_=t[p];if(u)var m=c?u(_,b,p,t,e,s):u(b,_,p,e,t,s);if(!(void 0===m?b===_||a(b,_,r,u,s):m)){h=!1;break}v||(v="constructor"==p)}if(h&&!v){var g=e.constructor,O=t.constructor;g!=O&&"constructor"in e&&"constructor"in t&&!("function"==typeof g&&g instanceof g&&"function"==typeof O&&O instanceof O)&&(h=!1)}return s.delete(e),s.delete(t),h}},function(e,t,r){var n=r(121),o=r(18);e.exports=function(e){for(var t=o(e),r=t.length;r--;){var i=t[r],u=e[i];t[r]=[i,u,n(u)]}return t}},function(e,t,r){var n=r(119),o=r(303),i=r(309),u=r(77),a=r(121),s=r(122),c=r(49),l=1,f=2;e.exports=function(e,t){return u(e)&&a(t)?s(c(e),t):function(r){var u=o(r,e);return void 0===u&&u===t?i(r,e):n(t,u,l|f)}}},function(e,t,r){var n=r(123);e.exports=function(e,t,r){var o=null==e?void 0:n(e,t);return void 0===o?r:o}},function(e,t,r){var n=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,o=/\\(\\)?/g,i=r(305)(function(e){var t=[];return 46===e.charCodeAt(0)&&t.push(""),e.replace(n,function(e,r,n,i){t.push(n?i.replace(o,"$1"):r||e)}),t});e.exports=i},function(e,t,r){var n=r(306),o=500;e.exports=function(e){var t=n(e,function(e){return r.size===o&&r.clear(),e}),r=t.cache;return t}},function(e,t,r){var n=r(71),o="Expected a function";function i(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw new TypeError(o);var r=function(){var n=arguments,o=t?t.apply(this,n):n[0],i=r.cache;if(i.has(o))return i.get(o);var u=e.apply(this,n);return r.cache=i.set(o,u)||i,u};return r.cache=new(i.Cache||n),r}i.Cache=n,e.exports=i},function(e,t,r){var n=r(308);e.exports=function(e){return null==e?"":n(e)}},function(e,t,r){var n=r(28),o=r(78),i=r(4),u=r(38),a=1/0,s=n?n.prototype:void 0,c=s?s.toString:void 0;e.exports=function e(t){if("string"==typeof t)return t;if(i(t))return o(t,e)+"";if(u(t))return c?c.call(t):"";var r=t+"";return"0"==r&&1/t==-a?"-0":r}},function(e,t,r){var n=r(310),o=r(311);e.exports=function(e,t){return null!=e&&o(e,t,n)}},function(e,t){e.exports=function(e,t){return null!=e&&t in Object(e)}},function(e,t,r){var n=r(124),o=r(58),i=r(4),u=r(67),a=r(59),s=r(49);e.exports=function(e,t,r){for(var c=-1,l=(t=n(t,e)).length,f=!1;++c<l;){var d=s(t[c]);if(!(f=null!=e&&r(e,d)))break;e=e[d]}return f||++c!=l?f:!!(l=null==e?0:e.length)&&a(l)&&u(d,l)&&(i(e)||o(e))}},function(e,t,r){var n=r(313),o=r(314),i=r(77),u=r(49);e.exports=function(e){return i(e)?n(u(e)):o(e)}},function(e,t){e.exports=function(e){return function(t){return null==t?void 0:t[e]}}},function(e,t,r){var n=r(123);e.exports=function(e){return function(t){return n(t,e)}}},function(e,t){e.exports=function(e,t,r,n,o){return o(e,function(e,o,i){r=n?(n=!1,e):t(r,e,o,i)}),r}},function(e,t,r){var n=r(317),o=r(18);e.exports=function(e){return null==e?[]:n(e,o(e))}},function(e,t,r){var n=r(78);e.exports=function(e,t){return n(t,function(t){return e[t]})}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.HttpMiddleware=void 0;var n,o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(1),u=(n=i)&&n.__esModule?n:{default:n},a=r(2),s=r(50);t.HttpMiddleware=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Http Middleware";return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,s.Middleware),o(t,[{key:"handle",value:function(){return u.default.reject(new a.KinveyError("Unable to send network request.","Please override the core HttpMiddleware."))}},{key:"cancel",value:function(){return u.default.resolve()}}]),t}()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();var o=[],i=String.fromCharCode(9500),u=String.fromCharCode(9472),a=String.fromCharCode(9492),s=String.fromCharCode(9474);t.AsciiTree=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return n(e,null,[{key:"generate",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=function(e,t){if(0===e.level)return e.value;for(var r="\r\n",n=t?a:i,c=1;c<e.level;c+=1)r=""+r+(o[c]?" ":s),r+="  ";return""+r+n+u+" "+e.value}(t,arguments[1]);if(t.nodes.length>0){var n=t.nodes.length-1;t.nodes.forEach(function(t,i){o[t.level]=i===n,r+=e.generate(t,i===n)})}return r}}]),e}()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ParseMiddleware=void 0;var n,o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(1),u=(n=i)&&n.__esModule?n:{default:n},a=r(3),s=r(50);t.ParseMiddleware=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Parse Middleware";return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,s.Middleware),o(t,[{key:"handle",value:function(e,t){if((0,a.isDefined)(t)&&(0,a.isDefined)(t.data)){var r=t.headers["content-type"]||t.headers["Content-Type"];if(r&&0===r.indexOf("application/json"))try{t.data=JSON.parse(t.data)}catch(e){}}return u.default.resolve({response:t})}}]),t}()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SerializeMiddleware=void 0;var n,o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(1),u=(n=i)&&n.__esModule?n:{default:n},a=r(3),s=r(50);t.SerializeMiddleware=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Serialize Middleware";return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,s.Middleware),o(t,[{key:"handle",value:function(e){if((0,a.isDefined)(e)&&(0,a.isDefined)(e.body)){var t=e.headers["content-type"]||e.headers["Content-Type"];if((0,a.isDefined)(t))if(0===t.indexOf("application/json"))e.body=JSON.stringify(e.body);else if(0===t.indexOf("application/x-www-form-urlencoded")){var r=e.body,n=[];Object.keys(r).forEach(function(e){n.push(global.encodeURIComponent(e)+"="+global.encodeURIComponent(r[e]))}),e.body=n.join("&")}}return u.default.resolve({request:e})}}]),t}()},function(e,t){e.exports=u},function(e,t,r){e.exports=r(324)},function(e,t,r){var n=r(24),o=r(102),i=r(39),u=o(function(e,t){n(t,i(t),e)});e.exports=u},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LiveServiceFacade=void 0;var n=r(5),o=r(79);function i(){var e=n.Client.sharedInstance();return(0,o.getLiveService)(e)}t.LiveServiceFacade={onConnectionStatusUpdates:function(e){i().onConnectionStatusUpdates(e)},offConnectionStatusUpdates:function(e){i().offConnectionStatusUpdates(e)},isInitialized:function(){return i().isInitialized()}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}();t.Operation=function(){function e(t,r,n,o,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.type=t,this.collection=r,n&&(this.query=n),o&&(this.data=o),i&&(this.entityId=i)}return n(e,[{key:"clone",value:function(){return new e(this.type,this.collection,this.query,this.data,this.entityId)}}]),e}()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.OperationType={Create:"create",Read:"read",ReadById:"readById",Update:"update",Delete:"delete",DeleteById:"deleteById",Count:"count",Clear:"clear",Group:"group"}},function(e,t,r){var n=r(66),o=r(329)(function(e,t,r){n(e,r,t)});e.exports=o},function(e,t,r){var n=r(330),o=r(331),i=r(76),u=r(4);e.exports=function(e,t){return function(r,a){var s=u(r)?n:o,c=t?t():{};return s(r,e,i(a,2),c)}}},function(e,t){e.exports=function(e,t,r,n){for(var o=-1,i=null==e?0:e.length;++o<i;){var u=e[o];t(n,u,r(u),e)}return n}},function(e,t,r){var n=r(42);e.exports=function(e,t,r,o){return n(e,function(e,n,i){t(o,e,r(e),i)}),o}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.buildCollectionUrl=t.dataStoreTagSeparator=void 0;var n=r(52);Object.defineProperty(t,"buildCollectionUrl",{enumerable:!0,get:function(){return n.buildCollectionUrl}}),t.getEntitiesPendingPushError=function(e,t){var r="are "+e+" entities, matching the provided query";1===e&&(r="is "+e+" entity, matching the provided query or id");var n="Unable to "+t+" on the backend. There "+r+", pending push to the backend. The result will overwrite your local changes.";return new a.KinveyError(n)},t.generateEntityId=function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:24,t="abcdef0123456789",r="",n=0,o=t.length;n<e;n+=1){var i=Math.floor(Math.random()*o);r+=t.substring(i,i+1)}return r},t.isNotEmpty=function(e){return!(0,u.default)(e)},t.isEmpty=function(e){return(0,u.default)(e)},t.isLocalEntity=function(e){return!!e&&!!e._kmd&&!0===e._kmd.local},t.isValidDataStoreTag=function(e){return(0,s.isNonemptyString)(e)&&/^[a-z0-9-]+$/i.test(e)},t.collectionHasTag=function(e){return e.indexOf(c)>=0},t.formTaggedCollectionName=function(e,t){if(t)return""+e+c+t;return e},t.stripTagFromCollectionName=function(e){return e.split(c)[0]},t.getTagFromCollectionName=function(e){return e.split(c)[1]};var o,i=r(22),u=(o=i)&&o.__esModule?o:{default:o},a=r(2),s=r(3);var c=t.dataStoreTagSeparator="."},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PromiseQueueByKey=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=r(3);t.PromiseQueueByKey=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1/0;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._queuesByKey={},this._simultaneousOpsCount=t,this._maxQueueLength=r}return n(e,[{key:"enqueue",value:function(e,t){return this._queuesByKey[e]||(this._queuesByKey[e]=new o.PromiseQueue(this._simultaneousOpsCount,this._maxQueueLength)),this._queuesByKey[e].enqueue(t)}}]),e}()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.KeyValueStoreOfflineRepository=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=r(2),i=r(131),u=r(82);t.KeyValueStoreOfflineRepository=function(e){function t(e,r){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),!(e instanceof u.KeyValueStorePersister))throw new o.KinveyError("KeyValueStoreOfflineRepository only works with an instance of KeyValueStorePersister");return function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,r))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i.InmemoryOfflineRepository),n(t,[{key:"create",value:function(e,t){return this._batchUpsert(e,t)}},{key:"update",value:function(e,t){return this._batchUpsert(e,t)}},{key:"readById",value:function(e,t){return this._persister.readEntity(e,t)}},{key:"deleteById",value:function(e,t){return this._persister.deleteEntity(e,t).then(function(e){return e?1:0})}},{key:"_formCollectionKey",value:function(e){return e}},{key:"_getAllCollections",value:function(){return this._persister.getKeys()}},{key:"_batchUpsert",value:function(e,t){return this._persister.writeEntities(e,t).then(function(){return t})}}]),t}()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MemoryKeyValuePersister=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=r(1),i=r(53);var u={};t.MemoryKeyValuePersister=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i.KeyValuePersister),n(t,[{key:"getKeys",value:function(){return o.Promise.resolve(Object.keys(u))}},{key:"_readFromPersistance",value:function(e){var t=u[e]||[];return o.Promise.resolve(t.slice(0))}},{key:"_writeToPersistance",value:function(e,t){return u[e]=t.slice(0),o.Promise.resolve(!0)}},{key:"_deleteFromPersistance",value:function(e){return delete u[e],o.Promise.resolve(!0)}}]),t}()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(337);Object.keys(n).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return n[e]}})});var o=r(338);Object.keys(o).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return o[e]}})});var i=r(339);Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return i[e]}})})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WebSqlSqlModule=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=r(1),i=r(2),u=r(34);var a={};t.WebSqlSqlModule=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._databaseName=t}return n(e,[{key:"openTransaction",value:function(e,t,r){var n=this,s=arguments.length>3&&void 0!==arguments[3]&&arguments[3],c=a[this._databaseName],l='"'+e+'"',f=e===u.webSqlCollectionsMaster,d=Array.isArray(t);return t=d?t:[[t,r]],new o.Promise(function(r,o){try{c||(c=global.openDatabase(n._databaseName,1,"Kinvey Cache",u.webSqlDatabaseSize),a[n._databaseName]=c);var p=s||"function"!=typeof c.readTransaction;c[p?"transaction":"readTransaction"](function(e){s&&!f&&e.executeSql("CREATE TABLE IF NOT EXISTS "+l+" (key BLOB PRIMARY KEY NOT NULL, value BLOB NOT NULL)");var n=t.length,o=[];0===n?r(d?o:o.shift()):t.forEach(function(t){var i=t[0].replace("#{collection}",l);e.executeSql(i,t[1],function(e,t){var i=[];if(t.rows.length>0)for(var u=0,a=t.rows.length;u<a;u+=1)try{var s=t.rows.item(u).value,c=f?s:JSON.parse(s);i.push(c)}catch(e){}else i=t.rowsAffected;o.push(i),0===(n-=1)&&r(d?o:o.shift())})})},function(t){if((t="string"==typeof t?t:t.message)&&-1===t.indexOf("no such table"))return r([]);var a=["table",e];return n.openTransaction(u.webSqlCollectionsMaster,"SELECT name AS value from #{collection} WHERE type = ? AND name = ?",a).then(function(t){return 0===t?r([]):o(new i.KinveyError("Unable to open a transaction for the "+e+" collection on the "+n._databaseName+" WebSQL database."))}).catch(o)})}catch(e){o(e)}})}}]),e}()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.IndexedDbKeyValueStorePersister=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=r(1),i=r(2),u=r(83),a=r(3),s=r(34);var c={};t.IndexedDbKeyValueStorePersister=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.inTransaction=!1,e.queue=[],e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,u.KeyValueStorePersister),n(t,[{key:"getKeys",value:function(){return this._getDb().then(function(e){return(0,s.domStringListToStringArray)(e.objectStoreNames)})}},{key:"_readFromPersistance",value:function(e){var t=this;return new o.Promise(function(r,n){t._openTransaction(e,!1,function(t){var o=t.objectStore(e).openCursor(),i=[];o.onsuccess=function(e){var t=e.target.result;return(0,a.isDefined)(t)?(i.push(t.value),t.continue()):r(i)},o.onerror=function(e){n(e.target.error)}},function(e){e instanceof i.NotFoundError&&r([]),n(e)})})}},{key:"_writeToPersistance",value:function(e,t){var r=this;return t?this._deleteFromPersistance(e).then(function(){return r._upsertEntities(e,t)}):o.Promise.reject(new i.KinveyError("Invalid or missing entities array"))}},{key:"_deleteFromPersistance",value:function(e){var t=this;return new o.Promise(function(r,n){t._openTransaction(e,!0,function(t){t.objectStore(e).clear(),t.oncomplete=function(e){return r(e)},t.onerror=function(e){return n(e)}},n)})}},{key:"_readEntityFromPersistance",value:function(e,t){var r=this;return new o.Promise(function(n,o){r._openTransaction(e,!1,function(r){var i=r.objectStore(e).get(t);i.onsuccess=function(e){var t=e.target.result;n(t)},i.onerror=o},o)})}},{key:"_writeEntitiesToPersistance",value:function(e,t){return this._upsertEntities(e,t)}},{key:"_deleteEntityFromPersistance",value:function(e,t){var r=this;return new o.Promise(function(n,o){r._openTransaction(e,!0,function(i){var u=i.objectStore(e),s=u.get(t);u.delete(t),i.oncomplete=function(){var i=s.result;(0,a.isDefined)(i)?n({count:1}):o(r._getEntityNotFoundError(e,t))},i.onerror=function(){o(r._getEntityNotFoundError(e,t))}},o)})}},{key:"_openTransaction",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments[2],n=this,o=arguments[3],u=arguments.length>4&&void 0!==arguments[4]&&arguments[4],l=c[this._storeName];if((0,a.isDefined)(l))if("function"==typeof l.objectStoreNames.contains?l.objectStoreNames.contains(e):-1!==l.objectStoreNames.indexOf(e))try{var f=t?s.inedxedDbTransctionMode.readWrite:s.inedxedDbTransctionMode.readOnly,d=l.transaction(e,f);if((0,a.isDefined)(d))return r(d);throw new i.KinveyError("Unable to open a transaction for "+e+" collection on the "+this._storeName+" IndexedDB database.")}catch(e){return o(e)}else if(!1===t)return o(new i.NotFoundError("The "+e+" collection was not found on the "+this._storeName+" IndexedDB database."));if(!1===u&&this.inTransaction)return this.queue.push(function(){n._openTransaction(e,t,r,o)});this.inTransaction=!0;var p=void 0;try{p=this._openDb()}catch(e){o(e)}return p.onupgradeneeded=function(r){l=r.target.result,c[n._storeName]=l,!0===t&&l.createObjectStore(e,{keyPath:"_id"})},p.onsuccess=function(i){l=i.target.result,c[n._storeName]=l,l.onversionchange=function(){(0,a.isDefined)(l)&&(l.close(),l=null,c[n._storeName]=null)};var u=function(e){return function(t){if(e(t),n.inTransaction=!1,n.queue.length>0){var r=n.queue;n.queue=[],r.forEach(function(e){e.call(n)})}}};return n._openTransaction(e,t,u(r),u(o),!0)},p.onblocked=function(){},p.onerror=function(e){o(new Error("Unable to open the "+n._storeName+" IndexedDB database. "+e.target.error.message+"."))},p}},{key:"_upsertEntities",value:function(e,t){var r=this,n=!Array.isArray(t);return 0===(t=(0,a.ensureArray)(t)).length?o.Promise.resolve(null):new o.Promise(function(o,u){r._openTransaction(e,!0,function(a){var s=a.objectStore(e);t.forEach(function(e){s.put(e)}),a.oncomplete=function(){o(n?t[0]:t)},a.onerror=function(t){u(new i.KinveyError("An error occurred while saving the entities to the "+e+" collection on the "+r._storeName+" IndexedDB database. "+t.target.error.message+"."))}},u)})}},{key:"_getIndexedDbObj",value:function(){return global.indexedDB||global.webkitIndexedDB||global.mozIndexedDB||global.msIndexedDB}},{key:"_openDb",value:function(){var e=c[this._storeName],t=this._getIndexedDbObj();if((0,a.isDefined)(e)){var r=e.version+1;return e.close(),t.open(this._storeName,r)}return t.open(this._storeName)}},{key:"_getDb",value:function(){var e=this,t=c[this._storeName];return t?o.Promise.resolve(t):new o.Promise(function(t,r){var n=function(e){var r=e.target.result;t(r)},o=e._openDb();o.onupgradeneeded=n,o.onsuccess=n,o.onerror=function(e){return r(e)}})}}]),t}()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BrowserKeyValuePersister=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=r(1),i=r(5),u=r(53),a=r(34);t.BrowserKeyValuePersister=function(e){function t(e,r,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var o=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,r,n));return o._store=e,o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,u.KeyValuePersister),n(t,[{key:"getKeys",value:function(){return o.Promise.resolve(Object.keys(this._store))}},{key:"_readFromPersistance",value:function(e){var t=this._store.getItem(e);return this._deserialize(t)}},{key:"_writeToPersistance",value:function(e,t){var r=this;return this._ensureCollectionExists(e).then(function(){return r._serializeAndSet(e,t)})}},{key:"_deleteFromPersistance",value:function(e){return this._store.removeItem(e),o.Promise.resolve()}},{key:"_buildMasterCollectionName",value:function(){return i.Client.sharedInstance().appKey+"."+a.browserStorageCollectionsMaster}},{key:"_ensureCollectionExists",value:function(e){var t=this,r=this._buildMasterCollectionName();return this._readFromPersistance(r).then(function(n){return(n=n||[]).find(function(t){return t===e})?o.Promise.resolve():(n.push(e),t._serializeAndSet(r,n))})}},{key:"_serializeAndSet",value:function(e,t){var r=this;return this._serialize(t).then(function(t){return r._store.setItem(e,t)})}},{key:"_serialize",value:function(e){try{return o.Promise.resolve(JSON.stringify(e))}catch(e){return o.Promise.reject(e)}}},{key:"_deserialize",value:function(e){try{var t=JSON.parse(e);return o.Promise.resolve(t)}catch(e){return o.Promise.reject(e)}}}]),t}()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SqlKeyValueStorePersister=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=r(1),i=r(2),u=r(83),a=r(34),s=r(3);t.SqlKeyValueStorePersister=function(e){function t(e,r,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var o=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,r,n));return o._sqlModule=e,o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,u.KeyValueStorePersister),n(t,[{key:"getKeys",value:function(){return this._sqlModule.openTransaction(a.sqliteCollectionsMaster,"SELECT name AS value FROM #{collection} WHERE type = ?",["table"],!1).then(function(e){return e.filter(function(e){return"_QueryCache"===e||"__testSupport__"===e||/^[a-zA-Z0-9-]{1,128}/.test(e)})})}},{key:"_readFromPersistance",value:function(e){return this._sqlModule.openTransaction(e,"SELECT value FROM #{collection}",[]).catch(function(){return[]})}},{key:"_writeToPersistance",value:function(e,t){var r=this;return t?this._deleteFromPersistance(e).then(function(){return r._upsertEntities(e,t)}):o.Promise.reject(new i.KinveyError("Invalid or missing entities array"))}},{key:"_deleteFromPersistance",value:function(e){return this._sqlModule.openTransaction(e,"DELETE FROM #{collection}",void 0,!0).then(function(e){return{count:e}})}},{key:"_readEntityFromPersistance",value:function(e,t){return this._sqlModule.openTransaction(e,"SELECT value FROM #{collection} WHERE key = ?",[t]).then(function(e){return e[0]})}},{key:"_writeEntitiesToPersistance",value:function(e,t){return this._upsertEntities(e,(0,s.ensureArray)(t))}},{key:"_deleteEntityFromPersistance",value:function(e,t){return this._sqlModule.openTransaction(e,"DELETE FROM #{collection} WHERE key = ?",[t],!0)}},{key:"_upsertEntities",value:function(e,t){var r=!Array.isArray(t);if(0===(t=(0,s.ensureArray)(t)).length)return o.Promise.resolve(null);var n=t.map(function(e){return["REPLACE INTO #{collection} (key, value) VALUES (?, ?)",[e._id,JSON.stringify(e)]]});return this._sqlModule.openTransaction(e,n,null,!0).then(function(){return r?t[0]:t})}}]),t}()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.repositoryProvider=void 0;var n,o=r(1),i=r(18),u=(n=i)&&n.__esModule?n:{default:n},a=r(5),s=r(2),c=r(130),l=r(133),f=r(129),d=r(3),p=r(13),y=r(82),h=r(52);var v=new p.PromiseQueueByKey,b=void 0,_=function(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}({},f.StorageProvider.Memory,function(e){var t=new y.MemoryKeyValuePersister;return new c.InmemoryOfflineRepository(t,e)});function m(e){return e.reduce(function(e,t){return e.catch(function(){var e=function(e){var t=_[e];if(!t){var r='The requested storage provider "'+e+'" is not available in this environment';throw new s.KinveyError(r)}return t(v)}(t);return function(e){return e.create(h.testSupportCollection,{_id:"1"})}(e).then(function(){return e})})},o.Promise.reject())}function g(){return m((0,d.ensureArray)(a.Client.sharedInstance().storage)).catch(function(){return o.Promise.reject(new s.KinveyError("None of the selected storage providers are supported in this environment."))})}t.repositoryProvider={getNetworkRepository:function(){return new l.NetworkRepository},getOfflineRepository:function(){return b||(b=g()),b},setSupportedRepoBuilders:function(e){_=e},getSupportedStorages:function(){return(0,u.default)(_)}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.processorFactory=void 0;var n=r(16),o=r(80),i=r(136),u=r(128),a=r(55);t.processorFactory={getOfflineProcessor:function(){var e=a.syncManagerProvider.getSyncManager();return new o.OfflineDataProcessor(e)},getNetworkProcessor:function(){return new i.NetworkDataProcessor},getCacheOfflineDataProcessor:function(){var e=n.repositoryProvider.getNetworkRepository(),t=a.syncManagerProvider.getSyncManager();return new u.CacheOfflineDataProcessor(t,e)}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(138);Object.keys(n).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return n[e]}})});var o=r(344);Object.keys(o).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(t,e,{enumerable:!0,get:function(){return o[e]}})})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getPlatformConfig=function(){if(!s)return u.Log.debug("getPlatformConfig() called before setPlatformConfig()"),a.platformConfigs.base;return s},t.setPlatformConfig=function(e){s=(0,i.default)(a.platformConfigs.base,a.platformConfigs[e]||{})};var n,o=r(9),i=(n=o)&&n.__esModule?n:{default:n},u=r(14),a=r(345);var s=void 0},function(e,t,r){"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),t.platformConfigs=void 0;var o=r(138);function i(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}t.platformConfigs=(i(n={base:{maxConcurrentPushRequests:100,maxConcurrentPullRequests:32}},o.platformName.nativeScript,{maxConcurrentPullRequests:2}),i(n,o.platformName.phoneGap,{maxConcurrentPullRequests:2}),n)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.syncManagerProvider=void 0;var n=r(137),o=r(16),i=r(141);t.syncManagerProvider={getSyncManager:function(){var e=o.repositoryProvider.getNetworkRepository(),t=new i.SyncStateManager;return new n.SyncManager(e,t)}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DataStore=t.DataStoreType=void 0;var n,o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(7),u=(n=i)&&n.__esModule?n:{default:n},a=r(2),s=r(3),c=r(68),l=r(64),f=r(142),d=r(33),p=r(16),y=r(13);var h=t.DataStoreType={Cache:"Cache",Network:"Network",Sync:"Sync"};Object.freeze(h);var v=function(){function e(){throw function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),new a.KinveyError("Not allowed to construct a DataStore instance. Please use the collection() function to get a DataStore instance.")}return o(e,null,[{key:"collection",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:h.Cache,r=arguments[2],n=void 0,o=r&&"tag"in r;if(!1===(0,s.isDefined)(e)||!1===(0,u.default)(e))throw new a.KinveyError("A collection is required and must be a string.");if(o&&!(0,y.isValidDataStoreTag)(r.tag))throw new a.KinveyError("Please provide a valid data store tag.");switch(t){case h.Network:if(o)throw new a.KinveyError('The tagged option is not valid for data stores of type "Network"');var i=d.processorFactory.getNetworkProcessor();n=new c.NetworkStore(e,i,r);break;case h.Sync:var p=d.processorFactory.getOfflineProcessor();n=new f.SyncStore(e,p,r);break;case h.Cache:default:var v=d.processorFactory.getCacheOfflineDataProcessor();n=new l.CacheStore(e,v,r)}return n}},{key:"getInstance",value:function(e,t,r){return this.collection(e,t,r)}},{key:"clearCache",value:function(){return p.repositoryProvider.getOfflineRepository().then(function(e){return e.clear()}).then(function(){return null})}}]),e}();t.DataStore=v},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.randomString=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:18;return""+(arguments.length>1&&void 0!==arguments[1]?arguments[1]:"")+function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,t="",r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=0;n<e;n+=1)t+=r.charAt(Math.floor(Math.random()*r.length));return t}(e)},t.isNonemptyString=function(e){return"string"==typeof e&&""!==e},t.uuidv4=function(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return""+e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.appendQuery=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},f=n.default.parse(e,!0),d=(0,s.default)(t)?o.default.parse(t):t,p=(0,i.default)({},f.query,d);r=(0,i.default)({encodeComponents:!0,removeNull:!1},r),f.query=null;var y=function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};var n=arguments[2];var o=[];var i=!1;(0,u.default)(t)&&(0,l.isDefined)(n)&&(i=!0);Object.keys(t).forEach(function(u){var s=void 0,c=t[u],f=n?n+"["+(i?"":u)+"]":u;if(!1===(0,l.isDefined)(c)){if(!0===r.removeNull)return;s=!0===r.encodeComponents?encodeURIComponent(f):f}else s=(0,a.default)(c)?e(c,r,f):r.encodeComponents?encodeURIComponent(f)+"="+encodeURIComponent(c):f+"="+c;o.push(s)});return o.join("&")}(p,r);return f.search=(0,l.isDefined)(y)&&!1===(0,c.default)(y)?"?"+y:null,n.default.format(f)};var n=f(r(15)),o=f(r(74)),i=f(r(9)),u=f(r(4)),a=f(r(31)),s=f(r(7)),c=f(r(22)),l=r(90);function f(e){return e&&e.__esModule?e:{default:e}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.User=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=O(r(1)),i=O(r(9)),u=O(r(7)),a=O(r(8)),s=O(r(22)),c=O(r(15)),l=r(5),f=r(6),d=r(2),p=r(29),y=r(84),h=r(14),v=r(3),b=r(145),_=r(146),m=r(47),g=r(355);function O(e){return e&&e.__esModule?e:{default:e}}t.User=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.data=t,this.client=r.client||l.Client.sharedInstance()}return n(e,[{key:"isActive",value:function(){var t=e.getActiveUser(this.client);return!(!(0,v.isDefined)(t)||t._id!==this._id)}},{key:"isEmailVerified",value:function(){return"confirmed"===this.metadata.emailVerification}},{key:"login",value:function(t,r){var n=this,u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=t,l=this.isActive(),p=e.getActiveUser(this.client);return!0===l?o.default.reject(new d.ActiveUserError("This user is already the active user.")):(0,v.isDefined)(p)?o.default.reject(new d.ActiveUserError("An active user already exists. Please logout the active user before you login.")):((0,a.default)(s)?u=r||{}:s={username:t,password:r},(0,v.isDefined)(s.username)&&(s.username=String(s.username).trim()),(0,v.isDefined)(s.password)&&(s.password=String(s.password).trim()),(0,v.isDefined)(s.username)&&""!==s.username&&(0,v.isDefined)(s.password)&&""!==s.password||(0,v.isDefined)(s._socialIdentity)?new f.KinveyRequest({method:f.RequestMethod.POST,authType:f.AuthType.App,url:c.default.format({protocol:this.client.apiProtocol,host:this.client.apiHost,pathname:this.pathname+"/login"}),body:s,properties:u.properties,timeout:u.timeout,client:this.client}).execute().then(function(e){return e.data}).then(function(e){(0,v.isDefined)(s._socialIdentity)&&(0,v.isDefined)(e._socialIdentity)&&(Object.keys(e._socialIdentity).forEach(function(t){e._socialIdentity[t]=(0,i.default)({},s._socialIdentity[t],e._socialIdentity[t])}),e._socialIdentity=(0,i.default)({},s._socialIdentity,e._socialIdentity));return delete e.password,n.client.setActiveUser(e)}).then(function(e){return n.data=e,n}):o.default.reject(new d.KinveyError("Username and/or password missing. Please provide both a username and password to login.")))}},{key:"loginWithMIC",value:function(t,r){var n=this,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},u=this.isActive(),a=e.getActiveUser(this.client);return u?o.default.reject(new d.ActiveUserError("This user is already the active user.")):(0,v.isDefined)(a)?o.default.reject(new d.ActiveUserError("An active user already exists. Please logout the active user before you login.")):new y.MobileIdentityConnect({client:this.client}).login(t,r,i).then(function(e){return n.connectIdentity(y.MobileIdentityConnect.identity,e,i)})}},{key:"connectIdentity",value:function(e,t){var r=this,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=this.isActive(),i={},u=i._socialIdentity||{};return u[e]=t,i._socialIdentity=u,o?this.update(i,n):this.login(i,n).catch(function(o){if(o instanceof d.NotFoundError)return r.signup(i,n).then(function(){return r.connectIdentity(e,t,n)});throw o})}},{key:"disconnectIdentity",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=o.default.resolve();return e===y.MobileIdentityConnect.identity&&(n=y.MobileIdentityConnect.logout(this,r)),n.catch(function(e){h.Log.error(e)}).then(function(){var n=t.data,o=n._socialIdentity||{};return delete o[e],n._socialIdentity=o,t.data=n,t._id?t.update(n,r):t}).then(function(){return t})}},{key:"logout",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=new f.KinveyRequest({method:f.RequestMethod.POST,authType:f.AuthType.Session,url:c.default.format({protocol:this.client.apiProtocol,host:this.client.apiHost,pathname:this.pathname+"/_logout"}),properties:t.properties,timeout:t.timeout,client:this.client});return this.unregisterFromLiveService().then(function(){return r.execute()}).catch(function(e){return h.Log.error(e),null}).then(function(){return e.client.setActiveUser(null)}).catch(function(e){return h.Log.error(e),null}).then(function(){return p.DataStore.clearCache({client:e.client})}).catch(function(e){return h.Log.error(e),null}).then(function(){return e})}},{key:"signup",value:function(t){var r=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=e.getActiveUser(this.client);if(!0===(n=(0,i.default)({state:!0},n)).state&&(0,v.isDefined)(o))throw new d.ActiveUserError("An active user already exists. Please logout the active user before you login.");return t instanceof e&&(t=t.data),t=(0,i.default)(this.data,t),new f.KinveyRequest({method:f.RequestMethod.POST,authType:f.AuthType.App,url:c.default.format({protocol:this.client.apiProtocol,host:this.client.apiHost,pathname:this.pathname}),body:(0,s.default)(t)?null:t,properties:n.properties,timeout:n.timeout,client:this.client}).execute().then(function(e){return e.data}).then(function(e){return!0===n.state?r.client.setActiveUser(e):e}).then(function(e){return r.data=e,r})}},{key:"signupWithIdentity",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n={_socialIdentity:{}};return n._socialIdentity[e]=t,this.signup(n,r)}},{key:"update",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e=(0,i.default)(this.data,e),(new g.UserStore).update(e,r).then(function(e){return t.isActive()?t.client.setActiveUser(e):e}).then(function(e){return t.data=e,t})}},{key:"me",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new f.KinveyRequest({method:f.RequestMethod.GET,authType:f.AuthType.Session,url:c.default.format({protocol:this.client.apiProtocol,host:this.client.apiHost,pathname:this.pathname+"/_me"}),properties:t.properties,timeout:t.timeout}).execute().then(function(e){return e.data}).then(function(t){return delete t.password,e.isActive()?e.client.setActiveUser(t):t}).then(function(t){return e.data=t,e})}},{key:"registerForLiveService",value:function(){var e=(0,m.getLiveService)(this.client),t=o.default.resolve();return e.isInitialized()||(t=e.fullInitialization(this)),t}},{key:"unregisterFromLiveService",value:function(){var e=(0,m.getLiveService)(this.client),t=o.default.resolve();return e.isInitialized()&&(t=e.fullUninitialization()),t}},{key:"_id",get:function(){return this.data._id}},{key:"_acl",get:function(){return new b.Acl(this.data)}},{key:"metadata",get:function(){return new _.Metadata(this.data)}},{key:"_kmd",get:function(){return this.metadata}},{key:"_socialIdentity",get:function(){return this.data._socialIdentity}},{key:"authtoken",get:function(){return this.metadata.authtoken}},{key:"username",get:function(){return this.data.username}},{key:"email",get:function(){return this.data.email}},{key:"pathname",get:function(){return"/user/"+this.client.appKey}}],[{key:"login",value:function(t,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return new e({},n).login(t,r,n)}},{key:"loginWithMIC",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return new this({},r).loginWithMIC(e,t,r)}},{key:"connectIdentity",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return new this({},r).connectIdentity(e,t,r)}},{key:"logout",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=e.getActiveUser(t.client);return(0,v.isDefined)(r)?r.logout(t):o.default.resolve(null)}},{key:"signup",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new this({},t).signup(e,t)}},{key:"signupWithIdentity",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return new this({},r).signupWithIdentity(e,t,r)}},{key:"update",value:function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.getActiveUser(r.client);return(0,v.isDefined)(n)?n.update(t,r):o.default.resolve(null)}},{key:"registerForLiveService",value:function(){var t=e.getActiveUser();return t?t.registerForLiveService():o.default.reject(new d.ActiveUserError("There is no active user"))}},{key:"unregisterFromLiveService",value:function(){var t=e.getActiveUser();return t?t.unregisterFromLiveService():o.default.reject(new d.ActiveUserError("There is no active user"))}},{key:"me",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=e.getActiveUser(t.client);return r?r.me(t):o.default.resolve(null)}},{key:"getActiveUser",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:l.Client.sharedInstance(),t=e.getActiveUser();return(0,v.isDefined)(t)?new this(t,{client:e}):null}},{key:"verifyEmail",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!e)return o.default.reject(new d.KinveyError("A username was not provided.","Please provide a username for the user that you would like to verify their email."));if(!(0,u.default)(e))return o.default.reject(new d.KinveyError("The provided username is not a string."));var r=t.client||l.Client.sharedInstance();return new f.KinveyRequest({method:f.RequestMethod.POST,authType:f.AuthType.App,url:c.default.format({protocol:r.apiProtocol,host:r.apiHost,pathname:"/rpc/"+r.appKey+"/"+e+"/user-email-verification-initiate"}),properties:t.properties,timeout:t.timeout,client:r}).execute().then(function(e){return e.data})}},{key:"forgotUsername",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!e)return o.default.reject(new d.KinveyError("An email was not provided.","Please provide an email for the user that you would like to retrieve their username."));if(!(0,u.default)(e))return o.default.reject(new d.KinveyError("The provided email is not a string."));var r=t.client||l.Client.sharedInstance();return new f.KinveyRequest({method:f.RequestMethod.POST,authType:f.AuthType.App,url:c.default.format({protocol:r.apiProtocol,host:r.apiHost,pathname:"/rpc/"+r.appKey+"/user-forgot-username"}),properties:t.properties,data:{email:e},timeout:t.timeout,client:r}).execute().then(function(e){return e.data})}},{key:"resetPassword",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!e)return o.default.reject(new d.KinveyError("A username was not provided.","Please provide a username for the user that you would like to verify their email."));if(!(0,u.default)(e))return o.default.reject(new d.KinveyError("The provided username is not a string."));var r=t.client||l.Client.sharedInstance();return new f.KinveyRequest({method:f.RequestMethod.POST,authType:f.AuthType.App,url:c.default.format({protocol:r.apiProtocol,host:r.apiHost,pathname:"/rpc/"+r.appKey+"/"+e+"/user-password-reset-initiate"}),properties:t.properties,timeout:t.timeout,client:r}).execute().then(function(e){return e.data})}},{key:"lookup",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(new g.UserStore).lookup(e,t)}},{key:"exists",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(new g.UserStore).exists(e,t)}},{key:"remove",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(new g.UserStore).removeById(e,t)}},{key:"restore",value:function(){return o.default.reject(new d.KinveyError("This function requires a master secret to be provided for your application. We strongly advise not to do this."))}}]),e}()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MobileIdentityConnect=t.AuthorizationGrant=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=y(r(1)),i=y(r(7)),u=y(r(15)),a=y(r(352)),s=r(6),c=r(2),l=r(3),f=r(353),d=r(354),p=r(144);function y(e){return e&&e.__esModule?e:{default:e}}var h=f.Popup,v=t.AuthorizationGrant={AuthorizationCodeLoginPage:"AuthorizationCodeLoginPage",AuthorizationCodeAPI:"AuthorizationCodeAPI"};Object.freeze(v);t.MobileIdentityConnect=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,d.Identity),n(t,[{key:"isSupported",value:function(){return!0}},{key:"_getMicPath",value:function(e){var t=3;return e.version&&(t=e.version),!1===(0,i.default)(t)&&(t=String(t)),(0,a.default)(0===t.indexOf("v")?t:"v"+t,"/oauth/auth")}},{key:"login",value:function(e){var r=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:v.AuthorizationCodeLoginPage,u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!(0,i.default)(e))return o.default.reject(new c.KinveyError("A redirectUri is required and must be a string."));var a=this.client.appKey;return(0,i.default)(u.micId)&&(a=a+"."+u.micId),o.default.resolve().then(function(){if(n===v.AuthorizationCodeLoginPage)return r.requestCodeWithPopup(a,e,u);if(n===v.AuthorizationCodeAPI)return r.requestTempLoginUrl(a,e,u).then(function(t){return r.requestCodeWithUrl(t,a,e,u)});throw new c.KinveyError("The authorization grant "+n+" is unsupported. Please use a supported authorization grant.")}).then(function(t){return r.requestToken(t,a,e,u)}).then(function(n){return n.identity=t.identity,n.client_id=a,n.redirect_uri=e,n.protocol=r.client.micProtocol,n.host=r.client.micHost,n})}},{key:"refresh",value:function(e,r,n){var i=this,u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return o.default.resolve().then(function(){return i.refreshToken(e,r,n,u)}).then(function(e){return e.identity=t.identity,e.client_id=r,e.redirect_uri=n,e.protocol=i.client.micProtocol,e.host=i.client.micHost,e})}},{key:"requestTempLoginUrl",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return new s.KinveyRequest({method:s.RequestMethod.POST,headers:{"Content-Type":"application/x-www-form-urlencoded"},url:u.default.format({protocol:this.client.micProtocol,host:this.client.micHost,pathname:this._getMicPath(r)}),properties:r.properties,body:{client_id:e,redirect_uri:t,response_type:"code"}}).execute().then(function(e){return e.data.temp_login_uri})}},{key:"parseCode",value:function(e){if("string"==typeof e)return u.default.parse(e,!0).query.code}},{key:"requestCodeWithPopup",value:function(e,t){var r=this,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return o.default.resolve().then(function(){return(new h).open(u.default.format({protocol:r.client.micProtocol,host:r.client.micHost,pathname:r._getMicPath(n),query:{client_id:e,redirect_uri:t,response_type:"code",scope:"openid"}}))}).then(function(e){return new o.default(function(r,n){var o=!1,i=function(i){try{if(i.url&&0===i.url.toLowerCase().indexOf(t.toLowerCase())&&!1===o){var a=u.default.parse(i.url,!0).query||{};o=!0,e.removeAllListeners(),e.close(),a.code?r(a.code):a.error?n(new c.KinveyError(a.error,a.error_description)):n(new c.KinveyError("The redirect uri did not contain a code or error."))}}catch(e){}};e.on("loadstart",i),e.on("loadstop",i),e.on("error",function(i){try{if(i.url&&0===i.url.toLowerCase().indexOf(t.toLowerCase())&&!1===o){var a=u.default.parse(i.url,!0).query||{};o=!0,e.removeAllListeners(),e.close(),a.code?r(a.code):a.error?n(new c.KinveyError(a.error,a.error_description)):n(new c.KinveyError("The redirect uri did not contain a code or error."))}else!1===o&&(e.removeAllListeners(),e.close(),n(new c.KinveyError(i.message,"",i.code)))}catch(e){}}),e.on("exit",function(){!1===o&&(e.removeAllListeners(),n(new c.KinveyError("Login has been cancelled.")))})})})}},{key:"requestCodeWithUrl",value:function(e,t,r){var n=this,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return o.default.resolve().then(function(){return new s.KinveyRequest({method:s.RequestMethod.POST,headers:{"Content-Type":"application/x-www-form-urlencoded"},url:e,properties:i.properties,body:{client_id:t,redirect_uri:r,response_type:"code",username:i.username,password:i.password,scope:"openid"},followRedirect:!1}).execute()}).then(function(e){var t=e.headers.get("location");if(t)return n.parseCode(t);throw new c.MobileIdentityConnectError("Unable to authorize user with username "+i.username+".","A location header was not provided with a code to exchange for an auth token.")})}},{key:"requestToken",value:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return new s.KinveyRequest({method:s.RequestMethod.POST,headers:{"Content-Type":"application/x-www-form-urlencoded"},authType:s.AuthType.Client,url:u.default.format({protocol:this.client.micProtocol,host:this.client.micHost,pathname:"/oauth/token"}),properties:n.properties,body:{grant_type:"authorization_code",client_id:t,redirect_uri:r,code:e},clientId:t}).execute().then(function(e){return e.data})}},{key:"refreshToken",value:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return new s.KinveyRequest({method:s.RequestMethod.POST,headers:{"Content-Type":"application/x-www-form-urlencoded"},authType:s.AuthType.Client,url:u.default.format({protocol:this.client.micProtocol,host:this.client.micHost,pathname:"/oauth/token"}),body:{grant_type:"refresh_token",client_id:t,redirect_uri:r,refresh_token:e},clientId:t,properties:n.properties,timeout:n.timeout}).execute().then(function(e){return e.data})}},{key:"logout",value:function(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1];return o.default.resolve()}},{key:"identity",get:function(){return p.SocialIdentity.MobileIdentityConnect}}],[{key:"isSupported",value:function(){return!0}},{key:"usePopupClass",value:function(e){(0,l.isDefined)(e)&&(h=e)}},{key:"identity",get:function(){return p.SocialIdentity.MobileIdentityConnect}}]),t}()},function(e,t){e.exports=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Popup=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=r(127),i=r(2);t.Popup=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.EventEmitter),n(t,[{key:"open",value:function(){throw new i.PopupError("Unable to open a popup on this platform.")}},{key:"close",value:function(){return this}}],[{key:"isSupported",value:function(){return!1}}]),t}()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Identity=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=r(5),i=r(2);t.Identity=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.client=t.client||o.Client.sharedInstance()}return n(e,[{key:"isSupported",value:function(){return!1}},{key:"isOnline",value:function(e){var t=(new Date).getTime()/1e3;return e&&e.access_token&&e.expires>t}},{key:"identity",get:function(){throw new i.KinveyError("A subclass must override this property.")}}],[{key:"isSupported",value:function(){return!1}},{key:"identity",get:function(){throw new i.KinveyError("A subclass must override this property.")}}]),e}()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UserStore=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=y(r(1)),i=y(r(4)),u=y(r(7)),a=y(r(15)),s=r(5),c=r(6),l=r(2),f=r(40),d=r(3),p=r(10);function y(e){return e&&e.__esModule?e:{default:e}}t.UserStore=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._client=s.Client.sharedInstance()}return n(e,[{key:"lookup",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if((0,d.isDefined)(e)&&!(e instanceof p.Query)){return(0,f.wrapInObservable)(o.default.reject(new l.KinveyError("Invalid query. It must be an instance of the Query class.")))}var r=new c.KinveyRequest({method:c.RequestMethod.POST,authType:c.AuthType.Default,url:a.default.format({protocol:this._client.apiProtocol,host:this._client.apiHost,pathname:this.pathname+"/_lookup"}),properties:t.properties,body:(0,d.isDefined)(e)?e.toPlainObject().filter:null,timeout:t.timeout,client:this._client}).execute().then(function(e){return e.data});return(0,f.wrapInObservable)(r)}},{key:"create",value:function(){return o.default.reject(new l.KinveyError("Please use `User.signup()` to create a user."))}},{key:"update",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e?(0,i.default)(e)?o.default.reject(new l.KinveyError("Only one user can be updated at one time.",e)):e._id?!1===(0,d.isDefined)(e)?o.default.resolve(null):new c.KinveyRequest({method:c.RequestMethod.PUT,authType:c.AuthType.Default,url:a.default.format({protocol:this._client.apiProtocol,host:this._client.apiHost,pathname:this.pathname+"/"+e._id}),properties:t.properties,data:e,timeout:t.timeout,client:this._client}).execute().then(function(e){return e.data}):o.default.reject(new l.KinveyError("User must have an _id.")):o.default.reject(new l.KinveyError("No user was provided to be updated."))}},{key:"exists",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new c.KinveyRequest({method:c.RequestMethod.POST,authType:c.AuthType.App,url:a.default.format({protocol:this._client.apiProtocol,host:this._client.apiHost,pathname:"/rpc/"+this._client.appKey+"/check-username-exists"}),properties:t.properties,data:{username:e},timeout:t.timeout,client:this._client}).execute().then(function(e){return e.data}).then(function(){return!0===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).usernameExists})}},{key:"removeById",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return f.KinveyObservable.create(function(n){return!1===(0,d.isDefined)(e)?n.error(new l.KinveyError("An id was not provided.","Please provide a valid id for a user that you would like to remove.")):!1===(0,u.default)(e)?n.error(new l.KinveyError("The id provided is not a string.","Please provide a valid id for a user that you would like to remove.")):new c.KinveyRequest({method:c.RequestMethod.DELETE,authType:c.AuthType.Default,url:a.default.format({protocol:t._client.apiProtocol,host:t._client.apiHost,pathname:t.pathname+"/"+e,query:!0===r.hard?{hard:!0}:void 0}),properties:r.properties,timeout:r.timeout}).execute().then(function(e){return e.data}).then(function(e){return n.next(e)}).then(function(){return n.complete()}).catch(function(e){return n.error(e)})}).toPromise()}},{key:"pathname",get:function(){return"/user/"+this._client.appKey}}]),e}()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CustomEndpoint=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=l(r(1)),i=l(r(7)),u=l(r(15)),a=r(2),s=r(5),c=r(6);function l(e){return e&&e.__esModule?e:{default:e}}t.CustomEndpoint=function(){function e(){throw function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),new a.KinveyError("Not allowed to create an instance of the `CustomEndpoint` class.","Please use `CustomEndpoint.execute()` function.")}return n(e,null,[{key:"execute",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=r.client||s.Client.sharedInstance();return e?(0,i.default)(e)?new c.KinveyRequest({method:c.RequestMethod.POST,authType:c.AuthType.Default,url:u.default.format({protocol:n.apiProtocol,host:n.apiHost,pathname:"/rpc/"+n.appKey+"/custom/"+e}),properties:r.properties,body:t,timeout:r.timeout,client:n}).execute().then(function(e){return e.data}):o.default.reject(new a.KinveyError("The endpoint argument must be a string.")):o.default.reject(new a.KinveyError("An endpoint argument is required."))}}]),e}()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Files=t.FileStore=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=b(r(1)),i=b(r(358)),u=b(r(9)),a=b(r(20)),s=b(r(23)),c=b(r(15)),l=r(6),f=r(2),d=r(40),p=r(14),y=r(3),h=r(10),v=r(5);function b(e){return e&&e.__esModule?e:{default:e}}function _(e,t){var r=e?parseInt(e.split("-")[1],10)+1:0;return r>=t?t-1:r}var m=t.FileStore=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return n(e,[{key:"find",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n={tls:!0===(r=(0,u.default)({tls:!0},r)).tls};return(0,s.default)(r.ttl)&&(n.ttl_in_seconds=parseInt(r.ttl,10)),d.KinveyObservable.create(function(o){return!(0,y.isDefined)(e)||e instanceof h.Query?new l.KinveyRequest({method:l.RequestMethod.GET,authType:l.AuthType.Default,url:c.default.format({protocol:t.client.apiProtocol,host:t.client.apiHost,pathname:t.pathname,query:n}),properties:r.properties,query:e,timeout:r.timeout,client:t.client}).execute().then(function(e){return e.data}).then(function(e){return o.next(e)}).then(function(){return o.complete()}).catch(function(e){return o.error(e)}):o.error(new f.KinveyError("Invalid query. It must be an instance of the Query class."))}).toPromise().then(function(e){return!0===r.download?o.default.all((0,i.default)(e,function(e){return t.downloadByUrl(e._downloadURL,r)})):e})}},{key:"findById",value:function(e,t){return this.download(e,t)}},{key:"download",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n={tls:!0===(r=(0,u.default)({tls:!0},r)).tls};return(0,s.default)(r.ttl)&&(n.ttl_in_seconds=parseInt(r.ttl,10)),d.KinveyObservable.create(function(o){return!1===(0,y.isDefined)(e)?(o.next(void 0),o.complete()):new l.KinveyRequest({method:l.RequestMethod.GET,authType:l.AuthType.Default,url:c.default.format({protocol:t.client.apiProtocol,host:t.client.apiHost,pathname:t.pathname+"/"+e,query:n}),properties:r.properties,timeout:r.timeout,client:t.client}).execute().then(function(e){return e.data}).then(function(e){return o.next(e)}).then(function(){return o.complete()}).catch(function(e){return o.error(e)})}).toPromise().then(function(e){return!0===r.stream?e:(r.mimeType=e.mimeType,t.downloadByUrl(e._downloadURL,r))})}},{key:"downloadByUrl",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new l.NetworkRequest({method:l.RequestMethod.GET,url:e,timeout:t.timeout,file:!0}).execute().then(function(e){return e.data})}},{key:"stream",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t.stream=!0,this.download(e,t)}},{key:"upload",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};r=this.transformMetadata(e,r);var i=null;return this.saveFileMetadata(n,r).then(function(e){return i=e.data,t.makeStatusCheckRequest(e.data._uploadURL,e.data._requiredHeaders,r,n.timeout)}).then(function(u){if(p.Log.debug("File upload status check response",u),!u.isSuccess())return o.default.reject(u.error);if(200===u.statusCode||201===u.statusCode)return u;if(308!==u.statusCode){var a=new f.KinveyError("Unexpected response for upload file status check request.",!1,u.statusCode,u.headers.get("X-Kinvey-Request-ID"));return o.default.reject(a)}var s={start:_(u.headers.get("range"),r.size),timeout:n.timeout,maxBackoff:n.maxBackoff,headers:i._requiredHeaders};return t.retriableUpload(i._uploadURL,e,r,s)}).then(function(){return delete i._expiresAt,delete i._requiredHeaders,delete i._uploadURL,i._data=e,i})}},{key:"transformMetadata",value:function(e,t){var r=(0,u.default)({filename:e._filename||e.name,public:!1,size:e.size||e.length,mimeType:e.mimeType||e.type||"application/octet-stream"},t);return r._filename=t.filename,delete r.filename,r._public=t.public,delete r.public,r}},{key:"saveFileMetadata",value:function(e,t){if(t.size<=0)return o.default.reject(new f.KinveyError("Unable to create a file with a size of 0.",t));var r=(0,y.isDefined)(t._id);return new l.KinveyRequest({method:r?l.RequestMethod.PUT:l.RequestMethod.POST,authType:l.AuthType.Default,headers:{"X-Kinvey-Content-Type":t.mimeType},url:c.default.format({protocol:this.client.apiProtocol,host:this.client.apiHost,pathname:r?this.pathname+"/"+t._id:this.pathname}),properties:e.properties,timeout:e.timeout,body:t,client:this.client}).execute()}},{key:"makeStatusCheckRequest",value:function(e,t,r,n){var o=new l.Headers(t);return o.set("content-type",r.mimeType),o.set("content-range","bytes */"+r.size),new l.NetworkRequest({method:l.RequestMethod.PUT,url:e,timeout:n,headers:o}).execute()}},{key:"retriableUpload",value:function(e,t,r,n){var i=this;return n=(0,u.default)({count:0,start:0,maxBackoff:32e3},n),p.Log.debug("Start file upload"),p.Log.debug("File upload headers",n.headers),p.Log.debug("File upload upload url",c.default),p.Log.debug("File upload file",t),p.Log.debug("File upload metadata",r),p.Log.debug("File upload options",n),this.makeUploadRequest(e,t,r,n).then(function(e){if(p.Log.debug("File upload response",e),e.isClientError())return o.default.reject(e.error);if(!e.isSuccess()&&!e.isServerError()&&308!==e.statusCode){var t=new f.KinveyError("Unexpected response for upload file request.",!1,e.statusCode,e.headers.get("X-Kinvey-Request-ID"));return o.default.reject(t)}return e}).then(function(e){var t,i,u=0;return e.isServerError()?(p.Log.debug("File upload server error. Probably network congestion.",e.statusCode,e.data),(u=Math.pow(2,n.count)+(t=1,i=1001,Math.floor(Math.random()*(i-t))+t))>=n.maxBackoff?o.default.reject(e.error):(p.Log.debug("File upload will try again in "+u+" seconds."),new o.default(function(e){setTimeout(function(){n.count+=1,e(!0)},u)}))):308===e.statusCode?(p.Log.debug("File upload was incomplete (statusCode 308). Trying to upload the remainder of file."),n.start=_(e.headers.get("range"),r.size),new o.default(function(e){setTimeout(function(){n.count=0,e(!0)},u)})):new o.default(function(e){setTimeout(function(){e(!1)},u)})}).then(function(o){return o?i.retriableUpload(e,t,r,n):null})}},{key:"makeUploadRequest",value:function(e,t,r,n){var o=new l.Headers(n.headers);return o.set("content-type",r.mimeType),o.set("content-range","bytes "+n.start+"-"+(r.size-1)+"/"+r.size),new l.NetworkRequest({method:l.RequestMethod.PUT,url:e,headers:o,body:(0,a.default)(t.slice)?t.slice(n.start):t,timeout:n.timeout}).execute()}},{key:"create",value:function(e,t,r){return this.upload(e,t,r)}},{key:"update",value:function(e,t,r){return this.upload(e,t,r)}},{key:"removeById",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return d.KinveyObservable.create(function(n){try{return!1===(0,y.isDefined)(e)?(n.next(void 0),n.complete()):new l.KinveyRequest({method:l.RequestMethod.DELETE,authType:l.AuthType.Default,url:c.default.format({protocol:t.client.apiProtocol,host:t.client.apiHost,pathname:t.pathname+"/"+e}),properties:r.properties,timeout:r.timeout}).execute().then(function(e){return e.data}).then(function(e){return n.next(e)}).then(function(){return n.complete()}).catch(function(e){return n.error(e)})}catch(e){return n.error(e)}}).toPromise()}},{key:"remove",value:function(){throw new f.KinveyError("Please use removeById() to remove files one by one.")}},{key:"client",get:function(){return(0,y.isDefined)(this._clientInstance)||(this._clientInstance=v.Client.sharedInstance()),this._clientInstance}},{key:"pathname",get:function(){return"/blob/"+this.client.appKey}}]),e}();t.Files=new m},function(e,t,r){var n=r(78),o=r(76),i=r(359),u=r(4);e.exports=function(e,t){return(u(e)?n:i)(e,o(t,3))}},function(e,t,r){var n=r(42),o=r(21);e.exports=function(e,t){var r=-1,i=o(e)?Array(e.length):[];return n(e,function(e,n,o){i[++r]=t(e,n,o)}),i}},function(e,t,r){"use strict";r(361),r(362),r(380),r(385)},function(e,t,r){"use strict";function n(e){return e!=e}Object.defineProperty(t,"__esModule",{value:!0}),t.isNaN=n,Number.isNaN=Number.isNaN||n},function(e,t,r){"use strict";r(363),"function"!=typeof Object.assign&&Object.defineProperty(Object,"assign",{value:function(e,t){if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var r=Object(e),n=1;n<arguments.length;n++){var o=arguments[n];if(null!=o)for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(r[i]=o[i])}return r},writable:!0,configurable:!0})},function(e,t,r){r(364),e.exports=r(25).Object.keys},function(e,t,r){var n=r(147),o=r(365);r(371)("keys",function(){return function(e){return o(n(e))}})},function(e,t,r){var n=r(366),o=r(370);e.exports=Object.keys||function(e){return n(e,o)}},function(e,t,r){var n=r(149),o=r(150),i=r(367)(!1),u=r(369)("IE_PROTO");e.exports=function(e,t){var r,a=o(e),s=0,c=[];for(r in a)r!=u&&n(a,r)&&c.push(r);for(;t.length>s;)n(a,r=t[s++])&&(~i(c,r)||c.push(r));return c}},function(e,t,r){var n=r(150),o=r(153),i=r(368);e.exports=function(e){return function(t,r,u){var a,s=n(t),c=o(s.length),l=i(u,c);if(e&&r!=r){for(;c>l;)if((a=s[l++])!=a)return!0}else for(;c>l;l++)if((e||l in s)&&s[l]===r)return e||l||0;return!e&&-1}}},function(e,t,r){var n=r(154),o=Math.max,i=Math.min;e.exports=function(e,t){return(e=n(e))<0?o(e+t,0):i(e,t)}},function(e,t,r){var n=r(155)("keys"),o=r(85);e.exports=function(e){return n[e]||(n[e]=o(e))}},function(e,t){e.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},function(e,t,r){var n=r(86),o=r(25),i=r(89);e.exports=function(e,t){var r=(o.Object||{})[e]||Object[e],u={};u[e]=t(r),n(n.S+n.F*i(function(){r(1)}),"Object",u)}},function(e,t,r){var n=r(373),o=r(374),i=r(376),u=Object.defineProperty;t.f=r(88)?Object.defineProperty:function(e,t,r){if(n(e),t=i(t,!0),n(r),o)try{return u(e,t,r)}catch(e){}if("get"in r||"set"in r)throw TypeError("Accessors not supported!");return"value"in r&&(e[t]=r.value),e}},function(e,t,r){var n=r(56);e.exports=function(e){if(!n(e))throw TypeError(e+" is not an object!");return e}},function(e,t,r){e.exports=!r(88)&&!r(89)(function(){return 7!=Object.defineProperty(r(375)("div"),"a",{get:function(){return 7}}).a})},function(e,t,r){var n=r(56),o=r(35).document,i=n(o)&&n(o.createElement);e.exports=function(e){return i?o.createElement(e):{}}},function(e,t,r){var n=r(56);e.exports=function(e,t){if(!n(e))return e;var r,o;if(t&&"function"==typeof(r=e.toString)&&!n(o=r.call(e)))return o;if("function"==typeof(r=e.valueOf)&&!n(o=r.call(e)))return o;if(!t&&"function"==typeof(r=e.toString)&&!n(o=r.call(e)))return o;throw TypeError("Can't convert object to primitive value")}},function(e,t){e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},function(e,t,r){var n=r(35),o=r(87),i=r(149),u=r(85)("src"),a=Function.toString,s=(""+a).split("toString");r(25).inspectSource=function(e){return a.call(e)},(e.exports=function(e,t,r,a){var c="function"==typeof r;c&&(i(r,"name")||o(r,"name",t)),e[t]!==r&&(c&&(i(r,u)||o(r,u,e[t]?""+e[t]:s.join(String(t)))),e===n?e[t]=r:a?e[t]?e[t]=r:o(e,t,r):(delete e[t],o(e,t,r)))})(Function.prototype,"toString",function(){return"function"==typeof this&&this[u]||a.call(this)})},function(e,t){e.exports=function(e){if("function"!=typeof e)throw TypeError(e+" is not a function!");return e}},function(e,t,r){r(381),e.exports=r(25).Array.find},function(e,t,r){"use strict";var n=r(86),o=r(157)(5),i=!0;"find"in[]&&Array(1).find(function(){i=!1}),n(n.P+n.F*i,"Array",{find:function(e){return o(this,e,arguments.length>1?arguments[1]:void 0)}}),r(159)("find")},function(e,t,r){var n=r(383);e.exports=function(e,t){return new(n(e))(t)}},function(e,t,r){var n=r(56),o=r(384),i=r(158)("species");e.exports=function(e){var t;return o(e)&&("function"!=typeof(t=e.constructor)||t!==Array&&!o(t.prototype)||(t=void 0),n(t)&&null===(t=t[i])&&(t=void 0)),void 0===t?Array:t}},function(e,t,r){var n=r(152);e.exports=Array.isArray||function(e){return"Array"==n(e)}},function(e,t,r){r(386),e.exports=r(25).Array.findIndex},function(e,t,r){"use strict";var n=r(86),o=r(157)(6),i="findIndex",u=!0;i in[]&&Array(1)[i](function(){u=!1}),n(n.P+n.F*u,"Array",{findIndex:function(e){return o(this,e,arguments.length>1?arguments[1]:void 0)}}),r(159)(i)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.NodeHttpMiddleware=void 0;var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=l(r(388)),i=l(r(1)),u=l(r(389)),a=r(6),s=r(3),c=r(2);function l(e){return e&&e.__esModule?e:{default:e}}t.NodeHttpMiddleware=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return r.pkg=e,r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a.Middleware),n(t,[{key:"handle",value:function(e){var t=this;return new i.default(function(r,n){var i,a,l,f,d=e.url,p=e.method,y=e.headers,h=e.body,v=e.timeout,b=e.followRedirect;/kinvey\.com/gm.test(d)&&(y["X-Kinvey-Device-Information"]=(i=t.pkg,a=process.title,l=process.version,f=process.platform,["js-"+i.name+"/"+i.version].concat([a,l,f]).map(function(e){return e?e.toString().replace(/\s/g,"_").toLowerCase():"unknown"}).join(" ")),y["X-Kinvey-Device-Info"]=JSON.stringify(function(e){return{hv:1,os:u.default.platform(),ov:u.default.release(),sdk:e.name,pv:process.version}}(t.pkg))),(0,o.default)({method:p,url:d,headers:y,body:h,followRedirect:b,timeout:v},function(e,t,o){return!1===(0,s.isDefined)(t)?"ESOCKETTIMEDOUT"===e.code||"ETIMEDOUT"===e.code?n(new c.TimeoutError("The network request timed out.")):"ENOENT"===e.code?n(new c.NetworkConnectionError("You do not have a network connection.")):n(e):r({response:{statusCode:t.statusCode,headers:t.headers,data:o}})})})}},{key:"cancel",value:function(){return i.default.resolve()}}]),t}()},function(e,t){e.exports=s},function(e,t){e.exports=require("os")},function(e,t){e.exports={private:!0,version:"3.12.0",name:"kinvey-node-sdk",description:"Kinvey JavaScript SDK for Node.js applications.",author:"Kinvey, Inc.",homepage:"http://www.kinvey.com",license:"Apache-2.0",main:"kinvey-node-sdk.min.js",dependencies:{"es6-promise":"~4.1.1","fast-memory-cache":"~2.0.4",lodash:"~4.17.4",loglevel:"~1.5.1",pubnub:"~4.19.0",qs:"~6.5.1",request:"~2.83.0",rxjs:"~6.2.2",sift:"~5.0.0","url-join":"~2.0.2"},scripts:{prebuild:"rm -rf dist",build:"webpack --config webpack.config.js",release:"npm run build -- --env.uglify && ./scripts/push.sh",postrelease:"rm -rf tmp"},files:["kinvey-node-sdk.min.js","kinvey-node-sdk.min.js.map"]}}])});
//# sourceMappingURL=kinvey-node-sdk.min.js.map